import{_ as gs,E as ys}from"./base-361a4e37.js";import{H as Ee,f as be,_ as Me,a as Ae,u as Ne,E as mo,b as ro,c as jo,G as Vt,i as Is,I as wt,d as bs,e as Cs,g as ks,h as Fe,p as ke,j as Ls,k as St,l as Wo,m as ws,n as Ns,o as Ot,q as xs,r as $s,s as Ts}from"./flag-85d490b2.js";import{g as qo,h as Lo,j as wo,f as Et,E as Pt}from"./el-button-2c19bbef.js";/* empty css                *//* empty css                   *//* empty css                  */import{P as ve,_ as Xe,G as Te,D as Us,b as lo,c as Nt}from"./_plugin-vue_export-helper-9c88e07d.js";import{b as Vs,d as Ss,a as Mt,u as Os,c as At,o as t,k as i,n as H,l as ze,r as Dt,q as W,p as fo,y as Es,B as I,ai as co,F as J,m as l,t as S,v as u,O as w,P,s as b,a1 as z,I as io,R as No,S as xo,D as Rt,C as Ft,M as ao,N as po,H as no,aj as Ps,w as Ms,ak as As,a0 as Ds,ah as Rs,Y as Fs}from"./index-d1cde4b6.js";import{E as Bs,a as js}from"./index-1a999d8d.js";import{E as Bo}from"./index-7bbf4eff.js";import{p as Ws}from"./pdf1-970f6d13.js";import{f as qs}from"./formatTime-47d7a857.js";import"./_commonjsHelpers-de833af9.js";const Gs=Vs({direction:{type:String,values:["horizontal","vertical"],default:"horizontal"},contentPosition:{type:String,values:["left","center","right"],default:"center"},borderStyle:{type:Ss(String),default:"solid"}}),Zs=Mt({name:"ElDivider"}),Js=Mt({...Zs,props:Gs,setup(O){const y=O,N=Os("divider"),R=At(()=>N.cssVar({"border-style":y.borderStyle}));return(j,oe)=>(t(),i("div",{class:H([ze(N).b(),ze(N).m(j.direction)]),style:fo(ze(R)),role:"separator"},[j.$slots.default&&j.direction!=="vertical"?(t(),i("div",{key:0,class:H([ze(N).e("text"),ze(N).is(j.contentPosition)])},[Dt(j.$slots,"default")],2)):W("v-if",!0)],6))}});var Xs=gs(Js,[["__file","/home/runner/work/element-plus/element-plus/packages/components/divider/src/divider.vue"]]);const Ys=Es(Xs);const Hs="/assets/Steps-37dd4960.svg",vo=(O,y,N,R,j)=>{var oe,q,X;if(y.titleName=="关节弹响"){if(((oe=y.orthOptionsList.find(E=>E.id==O))==null?void 0:oe.optionName)=="弹响"){R.value=!0;return}if(O==10){R.value=!1,y.otherContent="",j.value.orthTitleList.forEach(K=>{K.titleName=="关节弹响"?(K.optionId=10,K.text="",K.selectId=""):K.titleName=="侧关节"&&(K.optionId=[],K.text="",K.showInput=!1,K.selectId1="",K.selectId2="")});const E=j.value.orthTitleList.find(K=>K.titleName=="侧关节");let ce={apmtId:N,titleId:E.id,optionsIdStr:[],otherContent:"",cephalometricsContent:"",fdiToothCode:"",showPosition:""};ve("/prod-api/business/optionsResult",ce)}}else if(y.titleName=="骨龄"&&(((q=y.orthOptionsList.find(E=>E.id==O))==null?void 0:q.optionName)=="骨龄超"||((X=y.orthOptionsList.find(E=>E.id==O))==null?void 0:X.optionName)=="骨龄晚")){y.orthOptionsList.forEach(E=>{E.id==O?(E.clicked=!0,E.visible=!0):E.clicked=!1});return}y.type==2&&(y.optionId1.includes(10)&&y.optionId1.length<y.optionId.length?(y.optionId1=y.optionId.filter(E=>E!==10),y.optionId=y.optionId1):!y.optionId1.includes(10)&&y.optionId1.length<y.optionId.length&&y.optionId.includes(10)&&(y.optionId1=[10],y.optionId=[10],y.otherContent=""),y.orthOptionsList.forEach(E=>{y.optionId.includes(E.id)?E.choosen=!0:E.choosen=!1})),y.type==1&&(y.orthOptionsList.forEach(E=>{O!==E.id?E.choosen=!1:E.choosen=!0}),(y.titleName=="面中三分之一"||y.titleName=="面下三分之一"||y.titleName=="正貌")&&y.aiFlag=="1"&&(y.aiFlag="0"))};const $o=O=>(No("data-v-1aad20bf"),O=O(),xo(),O),zs={class:"stepOne"},Qs={class:"patientInfo"},Ks={class:"patientInfo__item"},ea=$o(()=>l("span",{class:"patientInfo__item__desc"},"患者姓名",-1)),oa={class:"patientInfo__item__detail"},ta={class:"patientInfo__item"},sa=$o(()=>l("span",{class:"patientInfo__item__desc"},"病例号",-1)),aa={class:"patientInfo__item__detail"},na={class:"patientInfo__item"},la=$o(()=>l("span",{class:"patientInfo__item__desc"},"性别",-1)),ia={class:"patientInfo__item__detail"},da={class:"patientInfo__item"},ra=$o(()=>l("span",{class:"patientInfo__item__desc"},"生日",-1)),ca={class:"patientInfo__item__detail"},ua={class:"content inquiry",style:{"min-height":"600px"}},ha={class:"innerContent content"},pa={key:0,src:Me},fa={key:1,src:Ae},ma={key:1,style:{display:"flex"}},va={class:"content"},_a={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",fill:`
                              none
                            `,version:"1.1",width:"9.999975204467773",height:"9.999975204467773",viewBox:"0 0 9.999975204467773 9.999975204467773"},ga=["fill"],ya={key:0,src:Me},Ia={key:1,src:Ae},ba={key:1,style:{display:"inline-flex"}},Ca={class:"specialTitle"},ka={key:2,style:{display:"inline-flex"}},La={class:"specialTitle side"},wa={__name:"stepOne",props:{pdfId:String},setup(O,{expose:y}){const N=I(!1);y({clicked:N});const R=O,j=I(""),oe=I(""),q=co(),X=q.params.appId,E=q.params.patientId,ce=le=>{le.otherContent&&(le.visible=!0),le.hover=!0};let K;const Y=le=>{le.hover=!1,K=setTimeout(()=>{le.visible=!1},300);const ne=document.querySelectorAll(".myPopper");Array.from(ne).forEach(g=>{g.addEventListener("mouseenter",()=>{clearTimeout(K)})})};async function U(le,ne,g){g.visible=!1,g.otherContent?(await Ne(le,ne,g.otherContent,X)).code==200&ne.titleName=="骨龄"&&pe():(ne.optionId="",io(()=>{ne.orthOptionsList.forEach(ie=>ie.clicked=!1)}))}const m=I({});async function G(){const le=await Te(`prod-api/business/patient/ljPatient/${E}`);m.value=le.data,sessionStorage.setItem("name",m.value.Name)}G();const fe=I([]);async function _e(){const le=await Te(`/prod-api/business/orthClass/list/2/问诊/${X}`);fe.value=le.data,le.data.forEach(ne=>ne.orthTitleList.forEach(g=>g.showInput=!1)),le.data.forEach(ne=>{ne.orthTitleList.forEach(g=>{if(g.orthOptionsList[g.orthOptionsList.length-1].otherContent&&(g.otherContent=g.orthOptionsList[g.orthOptionsList.length-1].otherContent),g.type==1){g.optionId="",g.text="",g.showInput=!1;const ie=g.orthOptionsList.filter(v=>v.choosen===!0);ie.length>0&&(g.optionId=ie[0].id)}else if(g.type==2){g.optionId=[],g.optionId1=[],g.text="",g.showInput=!1;const ie=g.orthOptionsList.filter(v=>v.choosen===!0);ie.length>0&&(g.optionId=ie.map(v=>v.id),g.optionId1=g.optionId)}})})}_e();const Ie=I({}),ue=I([]);async function pe(){const le=await Te(`/prod-api/business/orthClass/list/2/临床检查/${X}`);Ie.value=le.data[0],le.data.forEach(ne=>{ne.orthTitleList.forEach(g=>g.showInput=!1)}),le.data.forEach(ne=>{ne.orthTitleList.forEach(g=>{if(g.orthOptionsList[g.orthOptionsList.length-1].otherContent&&(g.otherContent=g.orthOptionsList[g.orthOptionsList.length-1].otherContent),g.titleName=="关节弹响"){g.optionId="",g.text="",g.showInput=!1,g.selectId="";const ie=g.orthOptionsList.filter(v=>v.choosen===!0);if(ie.length>0){g.optionId=ie[0].id,xe.value=g.optionId!==10;const v=g.listMap.filter(V=>V.choosen===!0);v.length>0&&(g.selectId=v[0].id)}}else if(g.titleName=="侧关节"){g.optionId=[],g.text="",g.showInput=!1,g.selectId1="",g.selectId2="";const ie=g.orthOptionsList.filter(V=>V.choosen===!0);ie.length>0&&(g.selectId1=ie[0].id);const v=g.listMap.filter(V=>V.choosen===!0);v.length>0&&(g.selectId2=v[0].id)}else if(g.titleName=="骨龄"){g.optionId="",g.text="",g.showInput=!1,g.selectId1="",g.selectId2="",ue.value=g.orthOptionsList.filter(v=>v.optionName==="骨龄超"||v.optionName==="骨龄晚").map(()=>I(null)),g.orthOptionsList.forEach(v=>{(v.optionName==="骨龄超"||v.optionName==="骨龄晚")&&(v.fillColor="#C9CDD4",v.seriousColor="#f44c4c",v.hoverColor="#2e6ce4",v.clicked=!!v.choosen,v.visible=!1)});const ie=g.orthOptionsList.filter(v=>v.choosen===!0);ie.length>0&&(g.optionId=ie[0].id)}else if(g.type==1){g.optionId="",g.text="",g.showInput=!1;const ie=g.orthOptionsList.filter(v=>v.choosen===!0);ie.length>0&&(g.optionId=ie[0].id)}else if(g.type==2){g.optionId=[],g.optionId1=[],g.text="",g.showInput=!1;const ie=g.orthOptionsList.filter(v=>v.choosen===!0);ie.length>0&&(g.optionId=ie.map(v=>v.id),g.optionId1=g.optionId)}})})}pe();const xe=I(!1);async function F(le,ne){N.value=!0,R.pdfId&&sessionStorage.removeItem(R.pdfId),vo(le,ne,X,xe,Ie),(await Ne(ne.optionId,ne,"",X)).code==200&ne.titleName=="骨龄"}const we=le=>{ue.value[le].value[0].input.value||ue.value[le].value[0].focus()};async function me(le,ne){if(ne.titleName=="关节弹响"){let g={apmtId:X,titleId:ne.id,optionsIdStr:[le.optionId,le.selectId],otherContent:"",cephalometricsContent:"",fdiToothCode:"",showPosition:""};await ve("/prod-api/business/optionsResult",g)}if(ne.titleName=="侧关节"){let g={apmtId:X,titleId:ne.id,optionsIdStr:le.selectId2==""?[le.selectId1]:[le.selectId1,le.selectId2],otherContent:"",cephalometricsContent:"",fdiToothCode:"",showPosition:""};await ve("/prod-api/business/optionsResult",g)}}const Pe=(le,ne)=>{Ne(le,ne,"",X)};return(le,ne)=>{const g=qo,ie=mo,v=ro,V=Lo,_=wo,L=jo,T=Bs,ye=js;return t(),i("div",zs,[J(Ee,{text:"患者信息",backgroundColor:"#f4f7fd"}),l("div",Qs,[l("div",Ks,[ea,l("span",oa,S(m.value.Name),1)]),l("div",ta,[sa,l("span",aa,S(m.value.PrivateId),1)]),l("div",na,[la,l("span",ia,S(m.value.Sex===1?"男":m.value.Sex===2?"女":"未知"),1)]),l("div",da,[ra,l("span",ca,S(m.value.age),1)])]),J(Ee,{text:"问诊",backgroundColor:"#f4f7fd"}),l("div",ua,[J(be,{label:"主诉",width:"58px"},{default:u(()=>[J(g,{modelValue:j.value,"onUpdate:modelValue":ne[0]||(ne[0]=C=>j.value=C)},null,8,["modelValue"])]),_:1}),J(be,{label:"现病史",width:"58px"},{default:u(()=>[J(g,{modelValue:oe.value,"onUpdate:modelValue":ne[1]||(ne[1]=C=>oe.value=C)},null,8,["modelValue"])]),_:1}),(t(!0),i(w,null,P(fe.value,C=>(t(),i(w,{key:C.id},[C.className?(t(),b(be,{key:0,label:C.className,class:"specialFormItem"},{default:u(()=>[l("div",ha,[(t(!0),i(w,null,P(C.orthTitleList,d=>(t(),b(be,{label:d.titleName,width:"100px",key:d.id},{default:u(()=>[d.type==1?(t(),b(v,{key:0,modelValue:d.optionId,"onUpdate:modelValue":D=>d.optionId=D,onChange:D=>F(d.optionId,d)},{default:u(()=>[(t(!0),i(w,null,P(d.orthOptionsList,D=>(t(),b(ie,{class:H({serious:D.serious=="1",checked:D.choosen===!0}),key:D.id,label:D.id},{default:u(()=>[z(S(D.optionName),1)]),_:2},1032,["class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):W("",!0),d.type==2?(t(),b(_,{key:1,modelValue:d.optionId,"onUpdate:modelValue":D=>d.optionId=D,onChange:D=>F(d.optionId,d)},{default:u(()=>[(t(!0),i(w,null,P(d.orthOptionsList,D=>(t(),b(V,{class:H({serious:D.serious=="1",checked:D.choosen===!0}),key:D.id,label:D.id},{default:u(()=>[z(S(D.optionName)+" ",1),D.serious=="0"?(t(),i("img",pa)):(t(),i("img",fa))]),_:2},1032,["class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):W("",!0),d.optionId.constructor===Array&&d.optionId.includes(9)||d.optionId==9?(t(),b(g,{key:2,placeholder:"请输入",modelValue:d.otherContent,"onUpdate:modelValue":D=>d.otherContent=D,onBlur:D=>Pe(d.optionId,d)},null,8,["modelValue","onUpdate:modelValue","onBlur"])):W("",!0)]),_:2},1032,["label"]))),128))])]),_:2},1032,["label"])):(t(),i("div",ma,[(t(!0),i(w,null,P(C.orthTitleList,d=>(t(),b(be,{label:d.titleName,width:"100px",key:d.id},{default:u(()=>[J(v,{modelValue:d.optionId,"onUpdate:modelValue":D=>d.optionId=D,onChange:D=>F(d.optionId,d)},{default:u(()=>[(t(!0),i(w,null,P(d.orthOptionsList,D=>(t(),b(ie,{key:D.id,label:D.id,class:H({serious:D.serious=="1",checked:D.choosen===!0})},{default:u(()=>[z(S(D.optionName),1)]),_:2},1032,["label","class"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1032,["label"]))),128))]))],64))),128))]),J(Ee,{text:"临床检查",backgroundColor:"#f4f7fd"}),l("div",va,[(t(!0),i(w,null,P(Ie.value.orthTitleList,C=>(t(),i(w,{key:C.id},[C.titleName!=="关节弹响"&&C.titleName!=="侧关节"?(t(),b(be,{key:0,label:C.titleName,width:"100px"},{default:u(()=>[C.type==1?(t(),b(v,{key:0,modelValue:C.optionId,"onUpdate:modelValue":d=>C.optionId=d,onChange:d=>F(C.optionId,C)},{default:u(()=>[(t(!0),i(w,null,P(C.orthOptionsList,(d,D)=>(t(),i(w,{key:d.id},[d.optionSuffix?(t(),b(L,{key:1,"popper-class":"myPopper","popper-style":{width:"auto","min-width":"100px"},placement:"top-start",width:200,visible:d.visible,onShow:x=>we(D-2)},{reference:u(()=>[J(ie,{class:H({serious:d.serious=="1",checked:d.choosen===!0}),label:d.id,onMouseenter:x=>ce(d),onMouseleave:x=>Y(d)},{default:u(()=>[z(S(d.optionName),1),(t(),i("svg",_a,[l("g",null,[l("path",{d:"M0,4.99999C0,2.23857,2.23857,0,4.99999,0C7.76141,0,9.99998,2.23857,9.99998,4.99999C9.99998,7.76141,7.76141,9.99998,4.99999,9.99998C2.23857,9.99998,0,7.76141,0,4.99999C0,4.99999,0,4.99999,0,4.99999ZM5.49999,3.49999C5.49999,3.49999,5.49999,2.49999,5.49999,2.49999C5.49999,2.49999,4.49999,2.49999,4.49999,2.49999C4.49999,2.49999,4.49999,3.49999,4.49999,3.49999C4.49999,3.49999,5.49999,3.49999,5.49999,3.49999C5.49999,3.49999,5.49999,3.49999,5.49999,3.49999ZM4.49999,3.99999C4.49999,3.99999,4.49999,7.49998,4.49999,7.49998C4.49999,7.49998,5.49999,7.49998,5.49999,7.49998C5.49999,7.49998,5.49999,3.99999,5.49999,3.99999C5.49999,3.99999,4.49999,3.99999,4.49999,3.99999C4.49999,3.99999,4.49999,3.99999,4.49999,3.99999Z","fill-rule":"evenodd",fill:d.clicked?d.seriousColor:d.hover?d.hoverColor:d.fillColor,"fill-opacity":"1"},null,8,ga)])]))]),_:2},1032,["class","label","onMouseenter","onMouseleave"])]),default:u(()=>{var x;return[J(g,{maxlength:"2",ref_for:!0,ref:ue.value[D-2],modelValue:d.otherContent,"onUpdate:modelValue":r=>d.otherContent=r,onBlur:r=>U(C.optionId,C,d),class:H({borderless:d.otherContent})},null,8,["modelValue","onUpdate:modelValue","onBlur","class"]),z(S((x=d.optionSuffix)==null?void 0:x.substr(-1)),1)]}),_:2},1032,["visible","onShow"])):(t(),b(ie,{key:0,class:H({serious:d.serious=="1"}),label:d.id},{default:u(()=>[z(S(d.optionName),1)]),_:2},1032,["class","label"]))],64))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):W("",!0),C.type==2?(t(),b(_,{key:1,modelValue:C.optionId,"onUpdate:modelValue":d=>C.optionId=d,onChange:d=>F(C.optionId,C)},{default:u(()=>[(t(!0),i(w,null,P(C.orthOptionsList,d=>(t(),b(V,{class:H({serious:d.serious=="1",checked:d.choosen===!0}),key:d.id,label:d.id},{default:u(()=>[z(S(d.optionName)+" ",1),d.serious=="0"?(t(),i("img",ya)):(t(),i("img",Ia))]),_:2},1032,["class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):W("",!0),C.optionId.constructor===Array&&C.optionId.includes(9)||C.optionId==9?(t(),b(g,{key:2,placeholder:"请输入",modelValue:C.otherContent,"onUpdate:modelValue":d=>C.otherContent=d,onBlur:d=>Pe(C.optionId,C)},null,8,["modelValue","onUpdate:modelValue","onBlur"])):W("",!0)]),_:2},1032,["label"])):W("",!0),C.titleName=="关节弹响"?(t(),i("div",ba,[l("div",Ca,S(C.titleName),1),J(v,{class:"specialRadio",modelValue:C.optionId,"onUpdate:modelValue":d=>C.optionId=d,onChange:d=>F(C.optionId,C)},{default:u(()=>[(t(!0),i(w,null,P(C.orthOptionsList,d=>(t(),b(ie,{class:H({serious:d.serious=="1",checked:d.choosen===!0}),key:d.id,label:d.id},{default:u(()=>[z(S(d.optionName),1)]),_:2},1032,["class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),xe.value?(t(),b(ye,{key:0,modelValue:C.selectId,"onUpdate:modelValue":d=>C.selectId=d,class:"specialSelect",onChange:d=>me(C,C)},{default:u(()=>[(t(!0),i(w,null,P(C.listMap,d=>(t(),b(T,{key:d.id,label:d.optionName,value:d.id},{default:u(()=>[z(S(d.optionName),1)]),_:2},1032,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):W("",!0)])):W("",!0),xe.value&&C.titleName=="侧关节"?(t(),i("div",ka,[l("div",La,S(C.titleName),1),J(ye,{modelValue:C.selectId1,"onUpdate:modelValue":d=>C.selectId1=d,class:"specialSelect",onChange:d=>me(C,C)},{default:u(()=>[(t(!0),i(w,null,P(C.orthOptionsList,d=>(t(),b(T,{key:d.id,label:d.optionName,value:d.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),J(ye,{modelValue:C.selectId2,"onUpdate:modelValue":d=>C.selectId2=d,class:"specialSelect",onChange:d=>me(C,C)},{default:u(()=>[(t(!0),i(w,null,P(C.listMap,d=>(t(),b(T,{key:d.id,label:d.optionName,value:d.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])])):W("",!0)],64))),128))])])}}},Na=Xe(wa,[["__scopeId","data-v-1aad20bf"]]),xa="/assets/arrange-8ba5d6cc.svg",$a="/assets/AIFlagForFront-be72ba22.svg",Ta="/assets/AI-1752b7a7.svg",Ua="/assets/downwards-554b1728.svg",Va="/assets/upwards-d82d8d75.svg",Sa="/assets/close-3d4ba752.svg";function ko(O,y){let N;O.includes("-")?N=O.split("-").filter(m=>m!=="-"):N=O.split("");const R=y.find(m=>N[0]==="Na"?m.label=="N":m.label==N[0]),j=y.find(m=>m.label==N[1]),oe=y.find(m=>m.label==N[2]),q={x:j.x-R.x,y:j.y-R.y},X={x:oe.x-j.x,y:oe.y-j.y},E=Math.sqrt(q.x*q.x+q.y*q.y),ce=Math.sqrt(X.x*X.x+X.y*X.y),K=q.x*X.x+q.y*X.y;return 180-Math.acos(K/(E*ce))*180/Math.PI}function Do(O,y){const N=O.split("/"),R=N[0],j=N[1],oe=xt(R,y),q=xt(j,y);return oe/(q!==0?q:1)*100}function xt(O,y){let N;O.includes("-")?N=O.split("-").filter(E=>E!=="-"):N=O.split("");const R=y.find(E=>E.label==N[0]),j=y.find(E=>E.label==N[1]),oe=j.x-R.x,q=j.y-R.y;return Math.sqrt(oe*oe+q*q)}function Ro(O,y){let N,R,j,oe;O=="U1-SN"&&(N=y.find(m=>m.label=="UI"),R=y.find(m=>m.label=="UI_1"),j=y.find(m=>m.label=="S"),oe=y.find(m=>m.label=="N")),O=="SN-MP"&&(N=y.find(m=>m.label=="S"),R=y.find(m=>m.label=="N"),j=y.find(m=>m.label=="Go_1"),oe=y.find(m=>m.label=="Me")),O=="L1-MP"&&(N=y.find(m=>m.label=="LI"),R=y.find(m=>m.label=="LI_1"),j=y.find(m=>m.label=="Go_1"),oe=y.find(m=>m.label=="Me")),O=="FH-MP"&&(N=y.find(m=>m.label=="P"),R=y.find(m=>m.label=="Or"),j=y.find(m=>m.label=="Go_1"),oe=y.find(m=>m.label=="Me")),O=="ODI"&&(N=y.find(m=>m.label=="A"),R=y.find(m=>m.label=="B"),j=y.find(m=>m.label=="Go"),oe=y.find(m=>m.label=="Gn"),console.log(N,R,j,oe)),O=="APDIAngle1"&&(N=y.find(m=>m.label=="N"),R=y.find(m=>m.label=="P"),j=y.find(m=>m.label=="P"),oe=y.find(m=>m.label=="Or")),O=="APDIAngle2"&&(N=y.find(m=>m.label=="A"),R=y.find(m=>m.label=="B"),j=y.find(m=>m.label=="N"),oe=y.find(m=>m.label=="P"));const q={x:R.x-N.x,y:R.y-N.y},X={x:oe.x-j.x,y:oe.y-j.y},E=q.x*X.x+q.y*X.y,ce=Math.sqrt(q.x**2+q.y**2),K=Math.sqrt(X.x**2+X.y**2);return Math.acos(E/(ce*K))*(180/Math.PI)}function $t(O,y,N,R,j,oe){const q={x:(j.x+oe.x)/2,y:(j.y+oe.y)/2},X={x:(N.x+R.x)/2,y:(N.y+R.y)/2},E={x:X.x-q.x,y:X.y-q.y},ce={x:O.x-q.x,y:O.y-q.y},Y=(ce.x*E.x+ce.y*E.y)/(E.x*E.x+E.y*E.y),U=O.x+Y*E.x,m=O.y+Y*E.y,G={x:U,y:m},fe=[y.x-q.x,y.y-q.y],Ie=(fe[0]*E.x+fe[1]*E.y)/(E.x*E.x+E.y*E.y),ue=y.x+Ie*E.x,pe=y.y+Ie*E.y,xe={x:ue,y:pe},F=xe.x-G.x,we=xe.y-G.y,me=Math.sqrt(F*F+we*we);return xe.x>G.x?me:-me}function Fo(O,y,N){const R=Math.sqrt(Math.pow(y.x-N.x,2)+Math.pow(y.y-N.y,2)),j={x:y.x-O.x,y:y.y-O.y},oe={x:N.x-O.x,y:N.y-O.y};return Math.abs((j.x*oe.y-j.y*oe.x)/R)}function Bt(O,y){const N=y.x-O.x,R=y.y-O.y;return Math.sqrt(N*N+R*R)}function Tt(O){const y=O.find(R=>R.label=="forehead_center"),N=O.find(R=>R.label=="chin_2");return Bt(y,N)/3}const Ve=O=>(No("data-v-87b13372"),O=O(),xo(),O),Oa={class:"stepTwo"},Ea=Ve(()=>l("img",{src:xa},null,-1)),Pa={class:"content",style:{"min-height":"700px"}},Ma={key:0,id:"FrontalRose",width:"320",height:"240"},Aa=["src"],Da=["onClick"],Ra=["src"],Fa={class:"aiFlagImg",src:$a},Ba={key:0,src:Me},ja={key:1,src:Ae},Wa={class:"content"},qa=["src"],Ga=["onClick"],Za=["src"],Ja={key:0,src:Me},Xa={key:1,src:Ae},Ya={class:"content panoramic"},Ha=["src"],za=["onClick"],Qa=["src"],Ka={class:"imageItem__content specialComponent",style:{"min-width":"780px"}},en={class:"container"},on={class:"left-column"},tn={key:0,src:Me},sn={key:1,src:Ae},an={class:"right-column"},nn={key:0,src:Me},ln={key:1,src:Ae},dn={class:"leftLower-column"},rn=["onClick"],cn={class:"diagram"},un={class:"diagramBox"},hn={class:"toothItem1"},pn={class:"toothItem2"},fn={class:"diagramBox"},mn={class:"toothItem3"},vn={class:"toothItem4"},_n={class:"selectContainer",id:"selectContainer"},gn={class:"container"},yn=["id","onClick"],In=Ve(()=>l("div",{class:"left"},"右",-1)),bn=Ve(()=>l("div",{class:"right"},"左",-1)),Cn={class:"leftLower-column"},kn=["onClick"],Ln={class:"diagram"},wn={class:"diagramBox"},Nn={class:"toothItem1"},xn={class:"toothItem2"},$n={class:"diagramBox"},Tn={class:"toothItem3"},Un={class:"toothItem4"},Vn={class:"selectContainer",id:"selectContainer"},Sn={class:"container"},On=["id","onClick"],En=Ve(()=>l("div",{class:"left"},"右",-1)),Pn=Ve(()=>l("div",{class:"right"},"左",-1)),Mn={class:"placeholderContainer"},An=["src"],Dn={class:"imageItem__content specialComponent cephalometric",style:{"min-width":"800px"}},Rn={key:0,class:"formItem"},Fn=["onMouseenter"],Bn=Ve(()=>l("img",{src:Wo},null,-1)),jn={class:"formItem__content"},Wn={style:{width:"100px",display:"flex","align-items":"center"}},qn={src:Ua},Gn={src:Va},Zn={key:1,class:"formItem"},Jn={class:"formItem__label"},Xn=Ve(()=>l("img",{src:Wo},null,-1)),Yn={class:"formItem__content"},Hn={class:"imageManagement__images subSection"},zn={class:"title"},Qn=Ve(()=>l("div",{class:"title__left"},"图库",-1)),Kn=Ve(()=>l("div",{class:"title__middle"},[l("img",{src:ws,style:{"margin-right":"4px"}}),z(" 可直接拖拽照片到右侧指定位置或点击下方一键“自动分类”哦～ ")],-1)),el={class:"title__right file-upload"},ol={class:"file-upload__label"},tl={style:{"padding-left":"14px","padding-bottom":"50px","padding-top":"50px"}},sl={key:0,class:"imgContainer__empty",src:Cs},al={class:"imgContainer"},nl=["onMouseenter","onMouseleave"],ll={style:{position:"relative",border:"1px solid #e5e6eb","border-radius":"12px"}},il=["src","onDragstart","onClick"],dl=["onClick"],rl=Ve(()=>l("span",null,"加载上次影像",-1)),cl=Ve(()=>l("img",{src:Ns},null,-1)),ul=[rl,cl],hl={class:"classifyWrapper"},pl={style:{"margin-right":"6px"}},fl={class:"imageManagement__classify subSection"},ml=Ve(()=>l("div",{class:"title"},"分类",-1)),vl={class:"imageWrapper"},_l=["onMouseenter","onMouseleave"],gl={style:{position:"relative",border:"1px solid #e5e6eb","border-radius":"12px"}},yl=["src","onDrop","onDragover","onDragstart"],Il={key:0,style:{cursor:"pointer"},class:"deleteImage",src:ks},bl={class:"item__caption"},Cl={class:"dialog-footer"},kl=Ve(()=>l("div",{class:"overlay__header"},null,-1)),Ll=Ve(()=>l("div",{class:"overlay__mask"},null,-1)),wl=["src"],Nl=Ve(()=>l("img",{id:"img",style:{opacity:0}},null,-1)),Ut=665/390,xl={__name:"stepTwo",props:{pdfId:String},setup(O,{expose:y}){const N=I(!1);y({clicked:N});const R=O,j=I(!1),oe=()=>{Ke.value.style.display="flex",j.value=!0},q=()=>{Ke.value.style.display="none",j.value=!1},X=I(window.innerWidth-900),E=I((X.value/Ut).toFixed(2));window.addEventListener("resize",()=>{if(window.innerWidth<1080)return;document.getElementById("myCanvas")&&(X.value=window.innerWidth-900,E.value=(X.value/Ut).toFixed(2),Z.value=qe.value.map(s=>({label:s.label,x:s.x*X.value,y:s.y*E.value})),so(X.value,E.value,!0))});const ce=I([]),K=e=>{ce.value.forEach(s=>{s.forEach(o=>{var a;o.active=!1,(a=e.toothCode)!=null&&a.includes(o.value+"")&&(o.active=!0)})})},Y=(e,s)=>{Ot(e,s)},U=I([]),m=I([]),G=new FormData;ce.value=Vt();const fe=I(!1),_e=e=>{const s=e.target.files;if(s.length>16)e.preventDefault(),Fe("最多上传16张图片");else{for(let o=0;o<s.length;o++){const a=s[o];if(G.append("files",a),a){const n=new FileReader;n.onload=()=>{U.value.push(n.result),m.value.push({imgUrl:n.result,showFlag:!1,choose:!0,file:a})},n.readAsDataURL(a)}}fe.value?me.value[0].imageList=m.value:(me.value.unshift({file:!0,StartTime:"2023-8-14",imageList:m.value}),fe.value=!0)}},Ie=e=>{e.measured=!0,e.cephalometricsContent!==e.AIValue&&(e.aiFlag="0");let s={apmtId:ee,titleId:e.id,optionsIdStr:[],otherContent:"",cephalometricsContent:e.cephalometricsContent?e.cephalometricsContent:"",fdiToothCode:"",showPosition:""};ve("/prod-api/business/optionsResult",s).then(o=>{if(o.code==200&&o.data.optionsId){e.optionId=o.data.optionsId;let a={apmtId:ee,titleId:e.id,optionsIdStr:[o.data.optionsId],otherContent:"",cephalometricsContent:"",fdiToothCode:"",showPosition:""};e.inputVal=e.cephalometricsContent,ve("/prod-api/business/optionsResult",a),ve("/prod-api/business/optionsResult/updateAIType",{apmtId:ee,cephalometricsList:[{titleId:e.id,aiType:2}]})}else o.code==500&&o.msg&&(e.cephalometricsContent=e.inputVal,Fe({type:"error",message:o.msg}))})},ue=()=>{},pe=At(()=>{let e=0;return me.value.forEach(s=>{s.imageList.forEach(o=>{o.choose&&e++})}),e}),xe=e=>{e.choose=!e.choose},F=e=>{e.id?Us(`/prod-api/business/orthImage/${e.id}`).then(s=>{if(s.code==200){const o=g.value.find(a=>e==a);o.fileUrl=ke,o.id=void 0}}):e.fileUrl=ke},we=I(0),me=I([]),Pe=I([]),le=()=>{to.value=!0,g.value.forEach(e=>{e.fileUrl=ke}),Po()},ne=()=>{if(me.value.length<Pe.value.length){Pe.value[me.value.length].imageList.forEach(s=>{s.imgUrl=s.fileUrl});const e=Pe.value.slice(we.value+1).find(s=>s.imageList.length!==0);e?(me.value.push(e),we.value=Pe.value.findIndex(s=>s==me.value[me.value.length-1]),me.value[me.value.length-1].imageList.forEach(s=>{s.imgUrl=s.fileUrl})):Fe("没有更多图像了哦")}},g=I([{caption:"正面像",typeName:"FrontalRepose",fileUrl:ke},{caption:"正面微笑像",typeName:"FrontalSmile",fileUrl:ke},{caption:"90度侧面像",typeName:"LeftProfile",fileUrl:ke},{caption:"90度侧面微笑像",typeName:"RightProfile",fileUrl:ke},{caption:"45度侧面像",typeName:"LeftSideProfile",fileUrl:ke},{caption:"45度侧面微笑像",typeName:"RightSideProfile",fileUrl:ke},{caption:"口内照（左侧）",typeName:"",fileUrl:ke},{caption:"口内照（右侧）",typeName:"",fileUrl:ke},{caption:"磨牙关系（左侧）",typeName:"Left",fileUrl:ke},{caption:"磨牙关系（右侧）",typeName:"Right",fileUrl:ke},{caption:"正面咬合",typeName:"Anterior",fileUrl:ke},{caption:"前牙覆盖",typeName:"Cover",fileUrl:ke},{caption:"上颌",typeName:"Upper",fileUrl:ke},{caption:"下颌",typeName:"Lower",fileUrl:ke},{caption:"全景片",typeName:"Panoramic",fileUrl:ke},{caption:"侧位片",typeName:"Cephalometric",fileUrl:ke}]);async function ie(){let e;const s=await Nt({url:"http://47.101.150.34:8177/bonceph/platform/user/login",method:"post",data:{username:"bonceph",userpwd:"4371f7b311bf4f88cbd27855f3143430"}});return s.status==200&&(e=s.data.data.token),e}const v=I(!1),V=I();async function _(){if(pe.value==0)Fe({message:"未选中图片",type:"error"});else{const e=Bo.service({lock:!0,text:"正在分类中",background:"rgba(0, 0, 0, 0.7)",target:V.value});e.value=!0;const s=new FormData;let o,a;me.value.filter(p=>p.file===void 0).forEach(p=>{a=p.imageList.filter(k=>k.choose===!0).map(k=>{if(k.choose)return{ljUrl:k.imgUrl,ljId:k.id,LJCreateDatetime:k.timestamp}})}),o=JSON.stringify({patientId:Ge,apmtId:ee,orthImageList:a}),me.value.filter(p=>p.file===!0).length>0?me.value.filter(p=>p.file===!0)[0].imageList.filter(p=>p.choose===!0).forEach(p=>{s.append("files",p.file)}):s.append("files",null),s.append("orthImageString",o);const n=await ve("/prod-api/business/orthImage/handleMultiImage",s,!0);e.close(),n.code===200&&(me.value.forEach(p=>p.imageList.forEach(k=>k.choose=!1)),n.data.forEach(p=>{g.value.forEach(k=>{p.typeName==k.typeName&&(k.fileUrl=p.fileUrl,k.imageId=p.fileId)})}))}}const L=I(null),T=I(),ye=e=>{L.value=e,L.value.rightDrop=!0,T.value=L.value.fileUrl;const s=document.getElementById("img");s.src=e.fileUrl,s.style.opacity=1,s.width=120,s.height=80,s.style.position="absolute",s.style.top="-9999px",s.style.objectFit="cover",s.style.border="2px solid #2E6CE4",s.style.boxShadow="0px 9px 18px 0px rgba(0, 0, 0, 0.57)",event.dataTransfer.setDragImage(s,60,40)},C=(e,s)=>{e.file?(s.dataTransfer.setData("text/plain",e),L.value=s.dataTransfer.files[0]):L.value=e;const o=document.getElementById("img");o.src=e.imgUrl,o.style.opacity=1,o.width=120,o.height=80,o.style.position="absolute",o.style.top="-9999px",o.style.objectFit="cover",o.style.border="2px solid #2E6CE4",o.style.boxShadow="0px 9px 18px 0px rgba(0, 0, 0, 0.57)",s.dataTransfer.setDragImage(o,60,40)},d=()=>{const e=document.getElementById("img");e.style.opacity=0},D=(e,s)=>{const o=document.getElementById("img");if(o.style.opacity=0,e.target.classList.remove("hover"),!L.value.rightDrop)r(L.value,s);else{if(L.value.id)F(L.value);else{const a=g.value.find(n=>L.value.fileUrl==n.fileUrl);a.fileUrl=ke}s.id?lo("/prod-api/business/orthImage",{id:s.id,imageUrl:T.value}).then(()=>{Po()}):s.fileUrl=T.value}},x=I(0);async function r(e,s){const o=new FormData;e.type?(o.append("file",e,"Cover"),o.append("orthImageString",JSON.stringify({patientId:Ge,apmtId:ee,orthImageList:[]}))):o.append("orthImageString",JSON.stringify({patientId:Ge,apmtId:ee,orthImageList:[{ljUrl:e.imgUrl,ljId:e.id,LJCreateDatetime:e.timestamp}]}));const a=await ve("/prod-api/business/orthImage/handleSingleImage",o,!0);a.code==200&&a.data[0].fileUrl?(s.fileUrl=a.data[0].fileUrl,s.imageId=a.data[0].fileId):(s.fileUrl=ke,x.value==0?(x.value++,Fe({message:"拖拽失败，请再试一次",type:"warning"})):Fe({message:"拖拽失败，请联系管理员",type:"warning"}))}async function Q(){to.value=!1,g.value.forEach(o=>o.reminder=!1);const s=g.value.filter(o=>o.fileUrl!=="/src/assets/ortho/imagePlaceholder.png").map(o=>({imageType:o.caption,imageUrl:o.fileUrl,imageId:o.fileId||null}));ve("/prod-api/business/orthImage",{apmtId:ee,orthImageList:s}).then(()=>{Ye()})}const te=e=>{!e.target.src.endsWith("jpeg")&&!e.target.src.endsWith("jpg")&&(e.target.src=xs,e.target.classList.add("hover"))},Se=e=>{!e.target.src.endsWith("jpeg")&&!e.target.src.endsWith("jpg")&&(e.target.src=ke),e.target.classList.remove("hover")};function Ye(){uo(),at(),Ho(),st()}const ge=()=>{g.value.forEach(e=>e.reminder=!1)},Be=co(),ee=Be.params.appId,Ge=Be.params.patientId,Qe=I([]),Ze=I([]),jt=["forehead_center","eyebrow_right_corner_left","eyebrow_left_corner_right","nose_middle_contour","chin_2","cheek_right_1","cheek_left_1"],Wt=I(0),qt=I(0),To=I(0);function Go(e,s,o,a){const n=new Image,p=document.getElementById(a),k=p.getContext("2d");n.onload=function(){const B=n.width,f=n.height;let M=B,de=f;To.value=B/f,M>e&&(M=e,de=M/To.value),de>s&&(de=s,M=de*To.value),p.width=M,Wt.value=M,p.height=de,qt.value=de,k.clearRect(0,0,p.width,p.height),k.drawImage(n,0,0,M,de),Gt(k,n,p,We.value)},n.src=o}function Gt(e,s,o,a){e.clearRect(0,0,o.width,o.height),e.drawImage(s,0,0,o.width,o.height),a.forEach(function(n){const p=n.x,k=n.y;e.beginPath(),e.arc(p,k,2,0,2*Math.PI),e.fillStyle="red",e.fill()}),Yt(e,o)}async function Zt(e){const s=Fo(e[6],e[0],e[3]),o=Fo(e[5],e[0],e[3]),a=Qe.value[0].orthTitleList[0];if(a.aiFlag="1",a.aiTest=!0,s<o){const n=a.orthOptionsList[2].id;await Ne(n,a,"",ee)}else if(s>o){const n=a.orthOptionsList[1].id;await Ne(n,a,"",ee)}else{const n=a.orthOptionsList[0].id;await Ne(n,a,"",ee)}}async function Jt(e){const s=Qe.value[0].orthTitleList[3];s.aiFlag="1",s.aiTest=!0;const o=Fo(e[3],e[2],e[1]),a=Tt(e);Xo(o,a,s)}async function Xt(e){const s=Qe.value[0].orthTitleList[4];s.aiFlag="1",s.aiTest=!0;const o=Bt(e[3],e[4]),a=Tt(e);Xo(o,a,s)}async function Zo(e){await Zt(e),await Jt(e),await Xt(e),uo()}const Jo=I(!1);async function Xo(e,s,o){if(e>s){const a=o.orthOptionsList[2].id;await Ne(a,o,"",ee)}else if(e<s){const a=o.orthOptionsList[1].id;await Ne(a,o,"",ee)}else{const a=o.orthOptionsList[0].id;await Ne(a,o,"",ee)}uo()}function Yt(e,s){e.strokeStyle="green",e.lineWidth=1,e.beginPath(),We.value.forEach(o=>{e.moveTo(0,o.y),e.lineTo(s.width,o.y),e.strokeStyle="blue"}),e.stroke(),e.strokeStyle="purple",e.lineWidth=1,e.beginPath(),e.moveTo(We.value[0].x,0),e.lineTo(We.value[3].x,s.height),e.stroke()}async function Ht(e){ve("/prod-api/business/orthPoint",{apmtId:ee,pointType:2,pointList:e})}const We=I([]),go=I();async function uo(){const e=await Te(`/prod-api/business/orthClass/list/2/面型评估/${ee}`);Qe.value=e.data,e.data.forEach(s=>s.orthTitleList.forEach(o=>o.showInput=!1)),e.data.forEach(s=>{if(!s.imageUrl)s.hasImage=!1;else{s.hasImage=!0;const o=document.createElement("link");if(o.href=s.imageUrl,o.rel="preload",o.as="image",document.head.appendChild(o),s.className==="正面像"){const a=s.orthTitleList.find(de=>de.titleName=="正貌"),n=s.orthTitleList.find(de=>de.titleName=="面中三分之一"),p=s.orthTitleList.find(de=>de.titleName=="面下三分之一"),k=a.orthOptionsList.some(de=>de.choosen==!0),B=n.orthOptionsList.some(de=>de.choosen==!0),f=p.orthOptionsList.some(de=>de.choosen==!0);Jo.value=!k||!B||!f,go.value=s.imageUrl;const M=new FormData;M.append("imageUrl",s.imageUrl),Te(`/prod-api/business/orthPoint/list?apmtId=${ee}&pointType=2`).then(de=>{de.data.length>0?(We.value=de.data.map(ae=>({label:ae.pointName,x:ae.xcoordinate,y:ae.ycoordinate})),Jo.value&&Zo(We.value),io(()=>{Go(320,240,go.value,"FrontalRose")})):ve("/prod-api/business/orthImage/calculateFaceShapeSet",M,!0).then(ae=>{const c=ae.data.face_list[0].landmark201,h=new Image;h.onload=()=>{const{width:A,height:$,ratio:se}=zt(h.width,h.height,320,240),Le=A/h.width,re=$/h.height;We.value=jt.map(Ce=>({label:Ce,x:c[Ce].x*Le,y:c[Ce].y*re})),Zo(We.value);const he=We.value.map(Ce=>[Ce.label,Ce.x,Ce.y]);Ht(he)},h.src=go.value,io(()=>{Go(320,240,go.value,"FrontalRose")})})})}}if(s.className=="90度侧面像"){Ze.value=[...s.orthTitleList];const o=s.orthTitleList.find(k=>k.titleName=="凸面型表现"),a=s.orthTitleList.find(k=>k.titleName=="凹面型表现"),n=!o.orthOptionsList.some(k=>k.choosen===!0),p=!a.orthOptionsList.some(k=>k.choosen===!0);n&&p?s.orthTitleList.splice(1,2):p?s.orthTitleList.splice(2,1):n&&s.orthTitleList.splice(1,1)}s.orthTitleList.forEach(o=>{if(o.type==1){o.optionId="",o.text="",o.showInput=!1;const a=o.orthOptionsList.filter(n=>n.choosen===!0);a.length>0&&(o.optionId=a[0].id)}else if(o.type==2){o.optionId=[],o.optionId1=[],o.text="",o.showInput=!1;const a=o.orthOptionsList.filter(n=>n.choosen===!0);a.length>0&&(o.optionId=a.map(n=>n.id),o.optionId1=o.optionId)}})}),Mo.value.style.display="block"}function zt(e,s,o,a){let n=0,p=e,k=s;return n=e/s,p>o&&(p=o,k=p/n),k>a&&(k=a,p=k*n),{width:p,height:k,ratio:n}}const Yo=I([]);async function Ho(){const e=await Te(`/prod-api/business/orthClass/list/2/口内照/${ee}`);Yo.value=e.data,e.data.forEach(s=>s.orthTitleList.forEach(o=>o.showInput=!1)),e.data.forEach(s=>{s.imageUrl?s.hasImage=!0:s.hasImage=!1,s.orthTitleList.forEach(o=>{if(o.type==1){o.optionId="",o.text="",o.showInput=!1;const a=o.orthOptionsList.filter(n=>n.choosen===!0);a.length>0&&(o.optionId=a[0].id)}else if(o.type==2){o.optionId=[],o.optionId1=[],o.text="",o.showInput=!1;const a=o.orthOptionsList.filter(n=>n.choosen===!0);a.length>0&&(o.optionId=a.map(n=>n.id),o.optionId1=o.optionId)}})})}function Qt(){return new Promise(e=>{setTimeout(e,0)})}async function Kt(){const e=[uo,Ho,st,at,ps];for(;e.length>0;)e.shift()(),await Qt()}Kt();const zo=I(),$e=I([]),Qo=I(),Ko=I(),et=I(!1),ot=I([]);function tt(e){e.value.forEach(s=>{s.orthTitleList.forEach(o=>{o.topLeft=[],o.topRight=[],o.bottomLeft=[],o.bottomRight=[];const a=JSON.parse(o.showPosition);o.fdiToothCode?(o.toothCode=o.fdiToothCode.split(","),o.fdiToothCode.split(",").forEach((n,p)=>{n.startsWith("1")||n.startsWith("5")?o.topLeft.push(a[p][0]):n.startsWith("2")||n.startsWith("6")?o.topRight.push(a[p][0]):n.startsWith("4")||n.startsWith("8")?o.bottomLeft.push(a[p][0]):(n.startsWith("3")||n.startsWith("7"))&&o.bottomRight.push(a[p][0])})):o.toothCode=[],o.position=a||[],o.submitAble=!1})}),e.value.forEach(s=>{s.orthTitleList.forEach(o=>{if(o.type==1){o.optionId="",o.text="",o.showInput=!1;const a=o.orthOptionsList.filter(n=>n.choosen===!0);a.length>0&&(o.optionId=a[0].id)}else if(o.type==2){o.optionId=[],o.optionId1=[],o.text="",o.showInput=!1;const a=o.orthOptionsList.filter(n=>n.choosen===!0);a.length>0&&(o.optionId=a.map(n=>n.id),o.optionId1=o.optionId)}})})}async function st(){const e=await Te(`/prod-api/business/orthClass/list/2/全景片/${ee}`);$e.value=e.data,e.data.forEach(s=>{if(Qo.value=s.sourceApmtId?s.sourceApmtId:ee,Ko.value=s.id,s.imageUrl?(s.hasImage=!0,zo.value=s.imageUrl):s.hasImage=!1,!s.flag){et.value=!0;const o={sourceApmtId:Qo.value,apmtId:ee,classId:Ko.value};ve("/prod-api/business/orthClass/mouthCheck",o).then(a=>{if(a.code==200){const n=$e.value[0].orthTitleList.slice(0,6);ot.value=a.data.slice(6),$e.value[0].orthTitleList=[...n,...ot.value],tt($e)}})}s.orthTitleList.forEach(o=>{o.showInput=!1,o.popVisible=!1})}),et.value||tt($e)}const ho=I();ho.value=Is;const De=I(null),Oe=I([]);function es(e){return/^[a-zA-Z]$/.test(e)}async function at(){const e=await Te(`/prod-api/business/orthClass/list/2/侧位片/${ee}`);Oe.value=e.data[0].orthTitleList,De.value=e.data[0].imageUrl,Oe.value.some(s=>s.aiFlag=="0")&&(Eo.value=!0),De.value&&(Oe.value.some(s=>s.cephalometricsContent)?Te(`/prod-api/business/orthPoint/list/?apmtId=${ee}`).then(s=>{Co.value=!0,yo.value=s.data,Io.value=yo.value.filter(o=>vt.includes(o.pointName)),qe.value=Io.value.map(o=>({label:o.pointName,x:o.xCoordinate,y:o.yCoordinate})),so(X.value,E.value,!0)}):so(X.value,E.value,!1)),Oe.value.forEach(s=>{es(s.titleName[0])&&(s.showInput=!0),s.cephalometricsContent&&(s.measured=!0);const o=s.orthOptionsList.filter(a=>a.choosen===!0);o.length>0&&(s.optionId=o[0].id),s.AIValue=s.cephalometricsContent,s.inputVal=s.cephalometricsContent})}async function os(e){return fetch(e).then(s=>s.blob())}const Ke=I(null),nt=I(0),lt=I(0),it=()=>{const e=new Image,s=document.getElementById("myZoomCanvas"),o=s.getContext("2d");e.onload=function(){const a=e.width,n=e.height;let p=a,k=n;const B=window.innerWidth,f=window.innerHeight;p>B?(p=B,k=p/He.value):(e.width=window.innerWidth,e.height=e.width/He.value,p=e.width,k=e.height),k>f?(k=f,p=k*He.value):(e.width=window.innerWidth,e.height=e.width/He.value,p=e.width,k=e.height),s.width=p,nt.value=s.width,s.height=k,lt.value=s.height,Ue.value=qe.value.map(M=>({label:M.label,x:M.x*p,y:M.y*k})),Ao(o,e,s,!0)},s.addEventListener("mousemove",a=>ns(a,e,s,o,nt.value,lt.value)),s.addEventListener("mousedown",a=>ss(a,s)),s.addEventListener("mouseup",as),e.src=De.value},ts=()=>{Ke.value.style.display="flex",it()},dt=I(0),rt=I(0),ct=I(0),ut=I(0),Uo=I(!1),eo=I(null);function ss(e,s){eo.value=ft(e,s),dt.value=e.clientX,rt.value=e.clientY}function as(e){Uo.value=!1,eo.value=null,ct.value=e.clientX,ut.value=e.clientY}let ht=I(0),pt=I(0);const Je=I(),Vo=I(!0);function ns(e,s,o,a,n,p){const k=ft(e,o);if(k)a.fillStyle="white",a.font="20px Arial",a.fillText(k.label,k.x+5,k.y-5),Vo.value=!1;else{if(Vo.value)return;it(),Vo.value=!0}if(Eo.value=!0,Uo.value=!0,Uo.value&&eo.value){let B=e.clientX-o.getBoundingClientRect().x,f=e.clientY-o.getBoundingClientRect().y;eo.value.x=B,eo.value.y=f;let M=qe.value.find(ae=>ae.label==eo.value.label);M.x=B/n,M.y=f/p,Je.value=M.label,ht.value=M.x,pt.value=M.y;const de=Ue.value.find(ae=>ae.label==M.label);if(de.x=M.x*n,de.y=M.y*p,Ao(a,s,o,!0),Je.value&&(a.fillStyle="white",a.font="20px Arial",a.fillText(M.label,de.x+5,de.y-5)),It.forEach(ae=>{if(M.label!=="A"&&M.label!=="Me"&&ae.includes(M.label)){let c=Do(ae,Ue.value);Re(c,ae,!0)}else if(M.label=="Me"&&(ae.includes("M")||ae.includes("Me"))){let c=Do(ae,Ue.value);Re(c,ae,!0)}Oe.value.forEach(c=>{c.titleName.includes(M.label)&&(c.changeCoor=!0),M.label=="Me"&&(c.titleName.includes("M")||c.titleName.includes("Me"))&&(c.changeCoor=!0)})}),yt.forEach(ae=>{if(M.label!=="A"&&M.label!=="Me"&&ae.includes(M.label)){let c=ko(ae,Ue.value);Re(c,ae,!0)}else if(M.label=="Me"&&(ae.includes("M")||ae.includes("Me"))){let c=ko(ae,Ue.value);Re(c,ae,!0)}else if(M.label=="A"&&ae.includes(M.label)&&!ae.includes("Ar")){let c=ko(ae,Ue.value);Re(c,ae,!0)}Oe.value.forEach(c=>{(M.label=="Me"&&(c.titleName.includes("M")||c.titleName.includes("Me"))||M.label=="A"&&c.titleName.includes("A")&&!c.titleName.includes("Ar")||c.titleName.includes(M.label))&&(c.changeCoor=!0)})}),bt.forEach(ae=>{if(M.label!=="A"&&M.label!=="Me"&&ae.includes(M.label)){let c=Ro(ae,Ue.value);Re(c,ae,!0)}else if(M.label=="Me"&&(ae.includes("M")||ae.includes("Me"))){let c=Ro(ae,Ue.value);Re(c,ae,!0)}Oe.value.forEach(c=>{c.titleName.includes(M.label)&&(c.changeCoor=!0),M.label=="Me"&&(c.titleName.includes("M")||c.titleName.includes("Me"))&&(c.changeCoor=!0)})}),["A","B","UI","LI","L6","U6"].includes(M.label)){Oe.value.forEach(re=>{re.titleName=="Wits"&&(re.changeCoor=!0)});const ae=Ue.value.find(re=>re.label=="A"),c=Ue.value.find(re=>re.label=="B"),h=Ue.value.find(re=>re.label=="UI"),A=Ue.value.find(re=>re.label=="LI"),$=Ue.value.find(re=>re.label=="U6"),se=Ue.value.find(re=>re.label=="L6"),Le=$t(ae,c,h,A,$,se);Re(Le,"Wits",!0)}}}function ft(e,s){const o=s.getBoundingClientRect().x,a=s.getBoundingClientRect().y,n=e.clientX,p=e.clientY;for(let k=0;k<Ue.value.length;k++){let B=Ue.value[k],f=n-o-B.x,M=p-a-B.y;if(Math.sqrt(f*f+M*M)<=5)return B}return null}const So=I(0),Oo=I(0),ls=I(null),mt=e=>{if(j.value){Ke.value.style.display="none",j.value=!1;return}else if(e===!0||!(rt.value!==ut.value||dt.value!==ct.value)){Ke.value.style.display="none",so(X.value,E.value,!0),Oe.value.forEach(o=>{if(Je.value!=="Me"&&Je.value!=="A"){if(o.titleName.includes(Je.value)){o.aiFlag="0";let a={apmtId:ee,titleId:o.id,optionsIdStr:[],otherContent:"",cephalometricsContent:o.cephalometricsContent,fdiToothCode:"",showPosition:""};ve("/prod-api/business/optionsResult",a).then(n=>{if(n.code==200&&n.data.optionsId){o.optionId=n.data.optionsId;let p={apmtId:ee,titleId:o.id,optionsIdStr:[n.data.optionsId],otherContent:"",cephalometricsContent:"",fdiToothCode:"",showPosition:""};ve("/prod-api/business/optionsResult",p)}})}}else if(Je.value=="Me"&&(o.titleName.includes("M")||o.titleName.includes("Me"))){o.aiFlag="0";let a={apmtId:ee,titleId:o.id,optionsIdStr:[],otherContent:"",cephalometricsContent:o.cephalometricsContent,fdiToothCode:"",showPosition:""};ve("/prod-api/business/optionsResult",a).then(n=>{if(n.code==200){o.optionId=n.data.optionsId;let p={apmtId:ee,titleId:o.id,optionsIdStr:[n.data.optionsId],otherContent:"",cephalometricsContent:"",fdiToothCode:"",showPosition:""};ve("/prod-api/business/optionsResult",p)}})}else if(Je.value=="A"&&(o.titleName.includes("A")&&o.titleName.length==3||o.titleName=="Wits")){o.aiFlag="0";let a={apmtId:ee,titleId:o.id,optionsIdStr:[],otherContent:"",cephalometricsContent:o.cephalometricsContent,fdiToothCode:"",showPosition:""};ve("/prod-api/business/optionsResult",a).then(n=>{if(n.code==200&&n.data.optionsId){o.optionId=n.data.optionsId;let p={apmtId:ee,titleId:o.id,optionsIdStr:[n.data.optionsId],otherContent:"",cephalometricsContent:"",fdiToothCode:"",showPosition:""};ve("/prod-api/business/optionsResult",p)}})}}),lo("/prod-api/business/orthPoint",{apmtId:ee,pointName:Je.value,xCoordinate:ht.value,yCoordinate:pt.value});const s=Oe.value.filter(o=>o.changeCoor===!0).map(o=>({titleId:o.id,aiType:1}));ve("/prod-api/business/optionsResult/updateAIType",{apmtId:ee,cephalometricsList:s})}},yo=I([]),Z=I([]),Ue=I([]),qe=I([]),Io=I([]),vt=["A","N","B","Or","Po","Go","Go_1","UI","UI_1","S","P","Go`","Me","Ar","LI","LI_1","Ratio1","Ratio2","U6","L6","Gn","ANS","PNS"];async function is(e){const s=new FormData;s.append("file",e),s.append("mobile","13014532111");const o=await ie();if(o){const a=await Nt({url:"http://47.101.150.34:8177/bonceph/platform/marker/predict",method:"post",data:s,headers:{Authorization:`${o}`,"content-type":"multipart/form-data"}});a.status==200&&(yo.value=a.data.data,Io.value=yo.value.filter(n=>vt.includes(n[0])),qe.value=Io.value.map(n=>({label:n[0],x:n[1],y:n[2]})))}}const Eo=I(!1);function ds(e,s,o,a,n,p,k,B){const f=(B-p)*(o-e)-(k-n)*(a-s);if(f===0)return null;const M=((k-n)*(s-p)-(B-p)*(e-n))/f,de=e+M*(o-e),ae=s+M*(a-s);return{x:de,y:ae}}const rs=(e,s,o,a,n)=>{e.beginPath(),e.moveTo(s.x,s.y),e.lineTo(o.x,o.y),e.stroke(),e.beginPath(),e.moveTo(a.x,a.y),e.lineTo(n.x,n.y),e.stroke()},oo=(e,s,o,a,n)=>{const p=ds(s.x,s.y,o.x,o.y,a.x,a.y,n.x,n.y);e.beginPath(),e.moveTo(s.x,s.y),e.lineTo(o.x,o.y),e.stroke(),e.beginPath(),e.moveTo(a.x,a.y),e.lineTo(n.x,n.y),e.stroke(),us(s,p,a)},_t=(e,s,o,a)=>{e.beginPath(),e.moveTo(s.x,s.y),e.lineTo(o.x,o.y),e.lineTo(a.x,a.y),e.stroke()};function gt(e,s,o){const a={x:s.x-e.x,y:s.y-e.y},n={x:o.x-e.x,y:o.y-e.y},p=Math.sqrt(a.x**2+a.y**2),k=(n.x*a.x+n.y*a.y)/p**2;return{x:e.x+k*a.x,y:e.y+k*a.y}}const cs=e=>{if(Co.value){const o=document.getElementById("myCanvas").getContext("2d");o.lineWidth=1.5,o.save(),o.strokeStyle="blue";let a=[],n,p,k,B;if(["颈椎分期","腺样体","扁桃体"].includes(e))return;if(["S-Go/N-Me","S-N/Go`-Me"].includes(e))a=e.split("/").map(f=>f.split("-")),n=Z.value.find(f=>f.label==a[0][0]),p=Z.value.find(f=>f.label==a[0][1]),k=Z.value.find(f=>f.label==a[1][0]),B=Z.value.find(f=>f.label==a[1][1]),rs(o,n,p,k,B);else if(e.includes("-"))a=e.split("-").filter(f=>f!=="-"),a.length==2?(e==="L1-MP"&&(n=Z.value.find(f=>f.label=="LI_1"),p=Z.value.find(f=>f.label=="LI"),k=Z.value.find(f=>f.label=="Go_1"),B=Z.value.find(f=>f.label=="Me"),oo(o,n,p,k,B)),e==="SN-MP"&&(n=Z.value.find(f=>f.label=="S"),p=Z.value.find(f=>f.label=="N"),k=Z.value.find(f=>f.label=="Go_1"),B=Z.value.find(f=>f.label=="Me"),oo(o,n,p,k,B)),e==="U1-SN"&&(n=Z.value.find(f=>f.label=="UI_1"),p=Z.value.find(f=>f.label=="UI"),k=Z.value.find(f=>f.label=="S"),B=Z.value.find(f=>f.label=="N"),oo(o,n,p,k,B)),e==="FH-MP"&&(n=Z.value.find(f=>f.label=="P"),p=Z.value.find(f=>f.label=="Or"),k=Z.value.find(f=>f.label=="Go_1"),B=Z.value.find(f=>f.label=="Me"),oo(o,n,p,k,B))):a.length==3&&(a[0]=="Na"?(n=Z.value.find(f=>f.label=="N"),p=Z.value.find(f=>f.label==a[1]),k=Z.value.find(f=>f.label==a[2]),_t(o,n,p,k)):(n=Z.value.find(f=>f.label==a[0]),p=Z.value.find(f=>f.label==a[1]),k=Z.value.find(f=>f.label==a[2]),_t(o,n,p,k)));else if(e=="Wits"){const f=Z.value.find(re=>re.label=="A"),M=Z.value.find(re=>re.label=="B"),de=Z.value.find(re=>re.label=="UI"),ae=Z.value.find(re=>re.label=="LI"),c=Z.value.find(re=>re.label=="U6"),h=Z.value.find(re=>re.label=="L6"),A={x:(c.x+h.x)/2,y:(c.y+h.y)/2},$={x:(de.x+ae.x)/2,y:(de.y+ae.y)/2},se=gt($,A,f),Le=gt($,A,M);o.beginPath(),o.moveTo(A.x,A.y),o.lineTo($.x,$.y),o.strokeStyle="blue",o.stroke(),o.setLineDash([5,5]),o.beginPath(),o.moveTo(f.x,f.y),o.lineTo(se.x,se.y),o.strokeStyle="blue",o.stroke(),o.setLineDash([5,5]),o.beginPath(),o.moveTo(M.x,M.y),o.lineTo(Le.x,Le.y),o.strokeStyle="blue",o.stroke()}else e=="ODI"?(n=Z.value.find(f=>f.label=="A"),p=Z.value.find(f=>f.label=="B"),k=Z.value.find(f=>f.label=="Go"),B=Z.value.find(f=>f.label=="Gn"),oo(o,n,p,k,B)):e=="APDI"?(n=Z.value.find(f=>f.label=="A"),p=Z.value.find(f=>f.label=="B"),k=Z.value.find(f=>f.label=="Go"),B=Z.value.find(f=>f.label=="Gn"),oo(o,n,p,k,B)):(a=e.split(""),n=Z.value.find(f=>f.label==a[0]),p=Z.value.find(f=>f.label==a[1]),k=Z.value.find(f=>f.label==a[2]),o.beginPath(),o.moveTo(n.x,n.y),o.lineTo(p.x,p.y),o.lineTo(k.x,k.y),o.stroke())}};function us(e,s,o){const n=document.getElementById("myCanvas").getContext("2d");n.setLineDash([5,5]),n.beginPath(),n.moveTo(e.x,e.y),n.lineTo(s.x,s.y),n.lineTo(o.x,o.y),n.stroke()}const hs=()=>{Co.value&&so(X.value,E.value,!0)},to=I(!1),bo=e=>{to.value=!0,g.value.find(s=>s.caption===e).reminder=!0,Po()};async function ps(){me.value.length===0&&Te(`/prod-api/business/orthImage/imageList?patientId=${Ge}`).then(e=>{Pe.value=e.data,e.data.find(s=>s.imageList.length!==0)&&(me.value[0]=e.data.find(s=>s.imageList.length!==0),we.value=e.data.findIndex(s=>s.imageList.length!==0),me.value[0].imageList.forEach(s=>{s.imgUrl=s.fileUrl,s.choose=!1}))})}async function Po(){const e=await Te(`/prod-api/business/orthImage/list?apmtId=${ee}`);e.code==200&&e.data.length>0?e.data.forEach(s=>{g.value.forEach(o=>{s.imageType==o.caption&&(o.fileUrl=s.imageUrl,o.id=s.id)})}):g.value.forEach(s=>{s.fileUrl=ke})}const yt=["ANB","Ar-Go`-Me","Ar-Go`-N","Na-Go`-Me","S-Ar-Go`","Na-S-Ar","SNA","SNB"],It=["S-Go/N-Me","S-N/Go`-Me"],bt=["U1-SN","SN-MP","L1-MP","FH-MP"];function Re(e,s,o){const a=Oe.value.find(n=>n.titleName==s);a.cephalometricsContent=e.toFixed(2),a.inputVal=a.cephalometricsContent,a.AIValue=a.cephalometricsContent,o?a.aiFlag="0":a.aiFlag="1"}function fs(){It.forEach(B=>{let f=Do(B,Z.value);Re(f,B,!1)}),yt.forEach(B=>{let f=ko(B,Z.value);Re(f,B,!1)}),bt.forEach(B=>{let f=Ro(B,Z.value);Re(f,B,!1)});const e=Z.value.find(B=>B.label=="A"),s=Z.value.find(B=>B.label=="B"),o=Z.value.find(B=>B.label=="UI"),a=Z.value.find(B=>B.label=="LI"),n=Z.value.find(B=>B.label=="U6"),p=Z.value.find(B=>B.label=="L6"),k=$t(e,s,o,a,n,p);Re(k,"Wits",!1)}async function ms(){Oe.value.forEach(e=>{if(!["颈椎分期","腺样体","扁桃体"].includes(e.titleName)){e.measured=!0;let s={apmtId:ee,titleId:e.id,optionsIdStr:[],otherContent:"",cephalometricsContent:e.cephalometricsContent,fdiToothCode:"",showPosition:"",aiFlag:"1"};ve("/prod-api/business/optionsResult",s).then(o=>{if(o.code==200&&o.data.optionsId){e.optionId=o.data.optionsId;let a={apmtId:ee,titleId:e.id,optionsIdStr:[o.data.optionsId],otherContent:"",cephalometricsContent:"",fdiToothCode:"",showPosition:""};ve("/prod-api/business/optionsResult",a)}})}}),ve("/prod-api/business/orthPoint",{apmtId:ee,pointList:qe.value.map(e=>[e.label,e.x,e.y])})}const Co=I(!1);function vs(){so(X.value,E.value,!0),fs(),ms(),Oe.value.forEach(e=>e.aiFlag="1"),v.value=!1}const Mo=I(null),Ct=()=>{const e=Bo.service({lock:!0,text:"正在计算中",background:"rgba(0, 0, 0, 0.7)",target:Mo.value});e.value=!0,De.value&&os(De.value+`?random=${Math.random()}`).then(s=>{is(s).then(()=>{Co.value=!0,Z.value=qe.value.map(o=>({label:o.label,x:o.x*Oo.value,y:o.y*So.value})),e.close(),vs()})}).catch(s=>console.error("Error converting imageUrl to File:",s))};function Ao(e,s,o,a){e.clearRect(0,0,o.width,o.height),e.drawImage(s,0,0,o.width,o.height),a?Ue.value.forEach(function(n){const p=n.x,k=n.y;e.beginPath(),e.arc(p,k,5,0,2*Math.PI),e.fillStyle="red",e.fill()}):Z.value.forEach(function(n){const p=n.x,k=n.y;e.beginPath(),e.arc(p,k,2,0,2*Math.PI),e.fillStyle="red",e.fill(),e.fillStyle="white",e.font="20px Arial"})}let He=I(0);function so(e,s,o){const a=new Image,n=document.getElementById("myCanvas"),p=n.getContext("2d");a.onload=function(){const k=a.width,B=a.height;let f=k,M=B;He.value=k/B,f>e&&(f=e,M=f/He.value),M>s&&(M=s,f=M*He.value),n.width=f,Oo.value=f,X.value=f,n.height=M,So.value=M,E.value=M,Z.value=qe.value.map(de=>({label:de.label,x:de.x*Oo.value,y:de.y*So.value})),p.clearRect(0,0,n.width,n.height),p.drawImage(a,0,0,f,M),o&&Ao(p,a,n,!1)},a.src=De.value}Rt(()=>{Ft(qe.value,e=>{e&&Eo.value&&Ct()}),window.addEventListener("click",e=>{const s=document.querySelector(".el-popper.el-popover");if(s&&e.target!==s&&!s.contains(e.target)){const o=$e.value[0].orthTitleList.findIndex(a=>a.popVisible===!0);o!==-1&&($e.value[0].orthTitleList[o].popVisible=!1)}})});const je=(e,s,o)=>{if(R.pdfId&&sessionStorage.removeItem(R.pdfId),s.titleName=="侧貌"){const a=Qe.value.find(n=>n.className=="90度侧面像");if(s.orthOptionsList.find(n=>e==n.id).optionName=="凸面型"){const n=Ze.value.find(p=>p.titleName=="凹面型表现");Ne([],n,"",ee),a.orthTitleList=Ze.value.filter(p=>!p.titleName.includes("凹")),n.orthOptionsList.forEach(p=>p.choosen=!1),n.optionId=[]}else if(s.orthOptionsList.find(n=>e==n.id).optionName=="凹面型"){const n=Ze.value.find(p=>p.titleName=="凸面型表现");Ne([],n,"",ee),a.orthTitleList=Ze.value.filter(p=>!p.titleName.includes("凸")),n.optionId=[],n.orthOptionsList.forEach(p=>p.choosen=!1)}else if(s.orthOptionsList.find(n=>e==n.id).optionName=="直面型"){a.orthTitleList=Ze.value.filter(k=>!k.titleName.includes("凸")&&!k.titleName.includes("凹"));const n=Ze.value.find(k=>k.titleName=="凸面型表现"),p=Ze.value.find(k=>k.titleName=="凹面型表现");n.optionId=[],p.optionId=[],Ne([],n,"",ee),Ne([],p,"",ee),uo()}}o=="侧位片"&&(s.aiFlag="0",ve("/prod-api/business/optionsResult/updateAIType",{apmtId:ee,cephalometricsList:[{titleId:s.id,aiType:3}]})),vo(e,s,ee),Ne(s.optionId,s,"",ee)},kt=(e,s)=>{if(s.hasImage)$e.value[0].orthTitleList.forEach(o=>{e!==o&&(o.popVisible=!1)}),e.popVisible=!e.popVisible;else return},Lt=e=>{if(console.log(e.submitAble),!e.submitAble)return;let s={apmtId:ee,titleId:e.id,optionsIdStr:[],otherContent:"",cephalometricsContent:"",fdiToothCode:e.toothCode.join(),showPosition:JSON.stringify(e.position)};ve("/prod-api/business/optionsResult",s).then(()=>{e.submitAble=!1})},_s=(e,s)=>{Ne(e,s,"",ee)};return(e,s)=>{const o=mo,a=ro,n=Lo,p=wo,k=qo,B=jo,f=Et,M=Pt,de=Ls,ae=St;return t(),i(w,null,[l("div",Oa,[l("div",{class:"button",onClick:le},[Ea,z("影像管理")]),J(Ee,{text:"面型评估",backgroundColor:"#f4f7fd"}),l("div",Pa,[(t(!0),i(w,null,P(Qe.value,(c,h)=>(t(),b(wt,{key:c.id,imageCaption:c.className,class:H({removeBorder:c.className==="90度侧面像"||c.className==="45度侧面像"})},{img:u(()=>[c.imageUrl?(t(),i(w,{key:0},[c.className=="正面像"?(t(),i("canvas",Ma)):(t(),i("img",{key:1,src:c.imageUrl,style:{height:"240px","object-fit":"cover"}},null,8,Aa))],64)):(t(),i("div",{key:1,class:"imageItem__placeholder",onClick:A=>bo(c.className)},[l("img",{src:ho.value,class:"addPic"},null,8,Ra)],8,Da))]),content:u(()=>[(t(!0),i(w,null,P(c.orthTitleList,A=>(t(),b(be,{key:A.id,label:A.titleName,width:"120px"},{default:u(()=>[A.type==1?(t(),b(a,{key:0,modelValue:A.optionId,"onUpdate:modelValue":$=>A.optionId=$,onChange:$=>je(A.optionId,A,c.className,c)},{default:u(()=>[(t(!0),i(w,null,P(A.orthOptionsList,$=>(t(),b(o,{disabled:!c.hasImage,class:H({serious:$.serious=="1",checked:$.choosen===!0}),key:$.id,label:$.id},{default:u(()=>[z(S($.optionName)+" ",1),ao(l("img",Fa,null,512),[[po,A.aiFlag=="1"&&h==0&&$.choosen]])]),_:2},1032,["disabled","class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):W("",!0),A.type==2?(t(),b(p,{key:1,modelValue:A.optionId,"onUpdate:modelValue":$=>A.optionId=$,onChange:$=>je(A.optionId,A,c.className,c)},{default:u(()=>[(t(!0),i(w,null,P(A.orthOptionsList,$=>(t(),b(n,{disabled:!c.hasImage,class:H({serious:$.serious=="1",checked:$.choosen===!0}),key:$.id,label:$.id},{default:u(()=>[z(S($.optionName)+" ",1),$.serious=="0"?(t(),i("img",Ba)):(t(),i("img",ja))]),_:2},1032,["disabled","class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):W("",!0)]),_:2},1032,["label"]))),128))]),_:2},1032,["imageCaption","class"]))),128))]),J(Ee,{text:"口内照"}),l("div",Wa,[(t(!0),i(w,null,P(Yo.value,c=>(t(),b(wt,{key:c.id,imageCaption:c.className},{img:u(()=>[c.imageUrl?(t(),i("img",{key:0,src:c.imageUrl,style:{width:"320px",height:"240px","object-fit":"cover"}},null,8,qa)):(t(),i("div",{key:1,class:"imageItem__placeholder",onClick:h=>bo(c.className)},[l("img",{src:ho.value,class:"addPic"},null,8,Za)],8,Ga))]),content:u(()=>[(t(!0),i(w,null,P(c.orthTitleList,h=>(t(),b(be,{key:h.id,label:h.titleName,width:"100px"},{default:u(()=>[h.type==1?(t(),b(a,{key:0,modelValue:h.optionId,"onUpdate:modelValue":A=>h.optionId=A,onChange:A=>je(h.optionId,h)},{default:u(()=>[(t(!0),i(w,null,P(h.orthOptionsList,A=>(t(),b(o,{disabled:!c.hasImage,class:H({serious:A.serious=="1",checked:A.choosen===!0}),key:A.id,label:A.id},{default:u(()=>[z(S(A.optionName),1)]),_:2},1032,["disabled","class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):W("",!0),h.type==2?(t(),b(p,{key:1,modelValue:h.optionId,"onUpdate:modelValue":A=>h.optionId=A,onChange:A=>je(h.optionId,h)},{default:u(()=>[(t(!0),i(w,null,P(h.orthOptionsList,A=>(t(),b(n,{disabled:!c.hasImage,class:H({serious:A.serious=="1",checked:A.choosen===!0}),key:A.id,label:A.id},{default:u(()=>[z(S(A.optionName)+" ",1),A.serious=="0"?(t(),i("img",Ja)):(t(),i("img",Xa))]),_:2},1032,["disabled","class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):W("",!0)]),_:2},1032,["label"]))),128))]),_:2},1032,["imageCaption"]))),128))]),J(Ee,{text:"全景片"}),l("div",Ya,[(t(!0),i(w,null,P($e.value,c=>(t(),i("div",{key:c.id,class:"placeholderContainer"},[l("div",{class:"image",style:fo({flex:c.imageUrl?"1":"0","min-width":c.imageUrl?"250px":"auto"})},[c.imageUrl?(t(),i("img",{key:0,src:c.imageUrl,style:{width:"100%",cursor:"pointer"},onClick:oe},null,8,Ha)):(t(),i("div",{key:1,class:"imageItem__placeholder",onClick:h=>bo(c.className)},[l("img",{src:ho.value,class:"addPic"},null,8,Qa)],8,za))],4),l("div",Ka,[l("div",en,[l("div",on,[(t(!0),i(w,null,P($e.value[0].orthTitleList,(h,A)=>(t(),i(w,{key:h.id},[A<=2?(t(),b(be,{key:0,label:h.titleName,width:"120px"},{default:u(()=>[h.type==1?(t(),b(a,{key:0,modelValue:h.optionId,"onUpdate:modelValue":$=>h.optionId=$,onChange:$=>je(h.optionId,h)},{default:u(()=>[(t(!0),i(w,null,P(h.orthOptionsList,$=>(t(),b(o,{disabled:!$e.value[0].hasImage,class:H({serious:$.serious=="1",checked:$.choosen===!0}),key:$.id,label:$.id},{default:u(()=>[z(S($.optionName),1)]),_:2},1032,["disabled","class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):W("",!0),h.optionId==136?(t(),b(k,{key:1,placeholder:"请输入",modelValue:h.otherContent,"onUpdate:modelValue":$=>h.otherContent=$,onBlur:$=>_s(h.optionId,h)},null,8,["modelValue","onUpdate:modelValue","onBlur"])):h.type==2?(t(),b(p,{key:2,modelValue:h.optionId,"onUpdate:modelValue":$=>h.optionId=$,onChange:$=>je(h.optionId,h)},{default:u(()=>[(t(!0),i(w,null,P(h.orthOptionsList,$=>(t(),b(n,{disabled:!$e.value[0].hasImage,class:H({serious:$.serious=="1",checked:$.choosen===!0}),key:$.id,label:$.id},{default:u(()=>[z(S($.optionName)+" ",1),$.serious=="0"?(t(),i("img",tn)):(t(),i("img",sn))]),_:2},1032,["disabled","class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):W("",!0)]),_:2},1032,["label"])):W("",!0)],64))),128))]),l("div",an,[(t(!0),i(w,null,P($e.value[0].orthTitleList,(h,A)=>(t(),i(w,{key:h.id},[A<=5&&A>=3?(t(),b(be,{key:0,label:h.titleName,width:"120px"},{default:u(()=>[h.type==1?(t(),b(a,{key:0,modelValue:h.optionId,"onUpdate:modelValue":$=>h.optionId=$,onChange:$=>je(h.optionId,h)},{default:u(()=>[(t(!0),i(w,null,P(h.orthOptionsList,$=>(t(),b(o,{disabled:!$e.value[0].hasImage,class:H({serious:$.serious=="1",checked:$.choosen===!0}),key:$.id,label:$.id},{default:u(()=>[z(S($.optionName),1)]),_:2},1032,["disabled","class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):W("",!0),h.type==2?(t(),b(p,{key:1,modelValue:h.optionId,"onUpdate:modelValue":$=>h.optionId=$,onChange:$=>je(h.optionId,h)},{default:u(()=>[(t(!0),i(w,null,P(h.orthOptionsList,$=>(t(),b(n,{disabled:!$e.value[0].hasImage,class:H({serious:$.serious=="1",checked:$.choosen===!0}),key:$.id,label:$.id},{default:u(()=>[z(S($.optionName)+" ",1),$.serious=="0"?(t(),i("img",nn)):(t(),i("img",ln))]),_:2},1032,["disabled","class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):W("",!0)]),_:2},1032,["label"])):W("",!0)],64))),128))]),l("div",dn,[(t(!0),i(w,null,P($e.value[0].orthTitleList,(h,A)=>(t(),i(w,{key:h.id},[A>=6&&A<=12?(t(),b(be,{key:0,label:h.titleName,width:"120px"},{default:u(()=>[J(B,{width:490,visible:h.popVisible,onShow:$=>K(h),onAfterLeave:$=>Lt(h)},{reference:u(()=>{var $,se,Le,re;return[l("div",{class:"diagramWrapper",onClick:no(he=>kt(h,$e.value[0]),["stop"])},[l("div",cn,[l("div",un,[l("div",hn,S(($=h.topLeft)==null?void 0:$.sort((he,Ce)=>he.sort-Ce.sort).map(he=>he.value).join("")),1),l("div",pn,S((se=h.topRight)==null?void 0:se.sort((he,Ce)=>he.sort-Ce.sort).map(he=>he.value).join("")),1)]),l("div",fn,[l("div",mn,S((Le=h.bottomLeft)==null?void 0:Le.sort((he,Ce)=>he.sort-Ce.sort).map(he=>he.value).join("")),1),l("div",vn,S((re=h.bottomRight)==null?void 0:re.sort((he,Ce)=>he.sort-Ce.sort).map(he=>he.value).join("")),1)])])],8,rn)]}),default:u(()=>[l("div",_n,[l("div",gn,[(t(!0),i(w,null,P(ce.value,($,se)=>(t(),i("div",{key:se,class:H(["symptomBox",{itemAlignRight:se===2||se===4||se===0||se===6,marginTop:se==4||se==5,marginBottom:se==2||se==3,marginRight:se===2||se===4||se===0||se===6,marginLeft:se===1||se===3||se===5||se===7}])},[(t(!0),i(w,null,P($,(Le,re)=>(t(),i("div",{class:H(["symptomItem",{selected:Le.active===!0}]),id:Le.value,key:re,onClick:no(he=>Y(Le,h),["stop"])},S(Le.label),11,yn))),128))],2))),128))]),In,bn])]),_:2},1032,["visible","onShow","onAfterLeave"])]),_:2},1032,["label"])):W("",!0)],64))),128))]),l("div",Cn,[(t(!0),i(w,null,P($e.value[0].orthTitleList,(h,A)=>(t(),i(w,{key:h.id},[A>=13?(t(),b(be,{key:0,label:h.titleName,width:"120px"},{default:u(()=>[J(B,{width:490,visible:h.popVisible,onShow:$=>K(h),onAfterLeave:$=>Lt(h)},{reference:u(()=>{var $,se,Le,re;return[l("div",{class:"diagramWrapper",onClick:no(he=>kt(h,$e.value[0]),["stop"])},[l("div",Ln,[l("div",wn,[l("div",Nn,S(($=h.topLeft)==null?void 0:$.sort((he,Ce)=>he.sort-Ce.sort).map(he=>he.value).join("")),1),l("div",xn,S((se=h.topRight)==null?void 0:se.sort((he,Ce)=>he.sort-Ce.sort).map(he=>he.value).join("")),1)]),l("div",$n,[l("div",Tn,S((Le=h.bottomLeft)==null?void 0:Le.sort((he,Ce)=>he.sort-Ce.sort).map(he=>he.value).join("")),1),l("div",Un,S((re=h.bottomRight)==null?void 0:re.sort((he,Ce)=>he.sort-Ce.sort).map(he=>he.value).join("")),1)])])],8,kn)]}),default:u(()=>[l("div",Vn,[l("div",Sn,[(t(!0),i(w,null,P(ce.value,($,se)=>(t(),i("div",{key:se,class:H(["symptomBox",{itemAlignRight:se===2||se===4||se===0||se===6,marginTop:se==4||se==5,marginBottom:se==2||se==3,marginRight:se===2||se===4||se===0||se===6,marginLeft:se===1||se===3||se===5||se===7}])},[(t(!0),i(w,null,P($,(Le,re)=>(t(),i("div",{class:H(["symptomItem",{selected:Le.active===!0}]),id:Le.value,key:re,onClick:no(he=>Y(Le,h),["stop"])},S(Le.label),11,On))),128))],2))),128))]),En,Pn])]),_:2},1032,["visible","onShow","onAfterLeave"])]),_:2},1032,["label"])):W("",!0)],64))),128))])])])]))),128))]),J(Ee,{text:"侧位片"}),l("div",{class:"content cephalometric",ref_key:"loadingTarget",ref:Mo,style:{display:"none"}},[l("div",Mn,[l("div",{class:"image",style:fo({flex:De.value?"1":"0"})},[ao(l("canvas",{ref_key:"myCanvas",ref:ls,id:"myCanvas",onClick:ts,style:{cursor:"pointer"}},null,512),[[po,De.value]]),De.value?(t(),b(f,{key:0,class:"cephalometric__button",type:"primary",onClick:Ct},{default:u(()=>[z("AI测量")]),_:1})):(t(),i("div",{key:1,class:"imageItem__placeholder",onClick:s[0]||(s[0]=c=>bo("侧位片"))},[l("img",{src:ho.value,class:"addPic"},null,8,An)]))],4),l("div",Dn,[(t(!0),i(w,null,P(Oe.value,c=>(t(),i(w,{key:c.id},[c.showInput?(t(),i("div",Rn,[l("div",{class:"formItem__label",onMouseenter:h=>cs(c.titleName),onMouseleave:hs},S(c.titleName=="Wits"?c.titleName+"(mm)":c.titleName=="S-Go/N-Me"||c.titleName=="S-N/Go`-Me"?c.titleName+"(%)":c.titleName+"(˚)"),41,Fn),J(M,{class:"box-item",effect:"light",placement:"top",content:c.titlePrompt},{default:u(()=>[Bn]),_:2},1032,["content"]),l("div",jn,[l("img",{src:Ta,style:fo({opacity:`${c.aiFlag=="1"?1:0}`})},null,4),l("div",Wn,[J(k,{disabled:!De.value,modelValue:c.cephalometricsContent,"onUpdate:modelValue":h=>c.cephalometricsContent=h,onInput:h=>ue(),onFocus:h=>c.measured=!1,onBlur:h=>Ie(c),class:H({measured:c.measured===!0})},null,8,["disabled","modelValue","onUpdate:modelValue","onInput","onFocus","onBlur","class"]),ao(l("img",qn,null,512),[[po,c.orthOptionsList.findIndex(h=>h.id==c.optionId)==0]]),ao(l("img",Gn,null,512),[[po,c.orthOptionsList.findIndex(h=>h.id==c.optionId)==2]])]),J(a,{class:"cephaRadio",onChange:h=>je(c.optionId,c,"侧位片"),modelValue:c.optionId,"onUpdate:modelValue":h=>c.optionId=h},{default:u(()=>[(t(!0),i(w,null,P(c==null?void 0:c.orthOptionsList,h=>(t(),b(o,{disabled:!De.value,label:h.id,class:H({serious:h.serious=="1",checked:h.choosen===!0}),key:h.id},{default:u(()=>[z(S(h.optionName),1)]),_:2},1032,["disabled","label","class"]))),128))]),_:2},1032,["onChange","modelValue","onUpdate:modelValue"])])])):(t(),i("div",Zn,[l("div",Jn,S(c.titleName),1),J(M,{class:"box-item",effect:"light",placement:"top"},{default:u(()=>[Xn]),_:1}),l("div",Yn,[J(a,{modelValue:c.optionId,"onUpdate:modelValue":h=>c.optionId=h,onChange:h=>je(c.optionId,c)},{default:u(()=>[(t(!0),i(w,null,P(c==null?void 0:c.orthOptionsList,h=>(t(),b(o,{disabled:!De.value,label:h.id,class:H({serious:h.serious=="1",checked:h.choosen===!0}),key:h.id},{default:u(()=>[z(S(h.optionName),1)]),_:2},1032,["disabled","label","class"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])])]))],64))),128))])])],512)]),J(ae,{modelValue:to.value,"onUpdate:modelValue":s[2]||(s[2]=c=>to.value=c),title:"影像管理",width:"1183px",onClose:ge,"close-on-click-modal":!1},{footer:u(()=>[l("span",Cl,[J(f,{onClick:s[1]||(s[1]=c=>to.value=!1)},{default:u(()=>[z("取消")]),_:1}),J(f,{type:"primary",onClick:Q},{default:u(()=>[z(" 确定 ")]),_:1})])]),default:u(()=>[l("div",{class:"imageManagement",ref_key:"loadingTarget2",ref:V},[l("div",Hn,[l("div",zn,[Qn,Kn,l("div",el,[l("div",ol,[J(f,{type:"primary",link:"",icon:ze(Ps)},{default:u(()=>[z("上传图片")]),_:1},8,["icon"])]),l("input",{class:"file-upload__input",type:"file",onChange:_e,multiple:""},null,32)])]),l("div",tl,[me.value.length==0?(t(),i("img",sl)):(t(!0),i(w,{key:1},P(me.value,(c,h)=>(t(),i("div",{key:h},[l("div",null,S(c.StartTime.split("T")[0]),1),l("div",al,[(t(!0),i(w,null,P(c.imageList,A=>(t(),i("div",{class:"item",key:A.id,onMouseenter:$=>A.showFlag=!0,onMouseleave:$=>A.showFlag=!1},[l("div",ll,[l("img",{style:{display:"block"},class:H(["img",{choose:A.choose===!0}]),src:A.imgUrl,draggable:"true",onDragstart:$=>C(A,$),onDragend:d,onClick:$=>xe(A)},null,42,il),ao(l("img",{src:bs,style:{position:"absolute",right:"6px",bottom:"6px"},onClick:$=>xe(A)},null,8,dl),[[po,A.choose===!0]])])],40,nl))),128))]),!c.file&&h===me.value.length-1?(t(),i("div",{key:0,style:{display:"inline-flex",color:"#4E5969",cursor:"pointer"},onClick:ne},ul)):W("",!0)]))),128))]),l("div",hl,[l("span",pl,"已选中"+S(pe.value)+"张",1),J(f,{onClick:_},{default:u(()=>[z("自动分类")]),_:1})])]),l("div",fl,[ml,l("div",vl,[(t(!0),i(w,null,P(g.value,c=>(t(),i("div",{class:"item",key:c.typeName,onMouseenter:h=>c.showFlag=!0,onMouseleave:h=>c.showFlag=!1},[l("div",gl,[l("img",{class:H(["img",{hover:c.reminder===!0,animate__animated:c.reminder===!0,animate__bounce:c.reminder===!0}]),style:{display:"block"},src:c.fileUrl,onDrop:h=>D(h,c),onDragover:no(te,["prevent"]),onDragleave:Se,onDragstart:h=>ye(c),onDragend:d},null,42,yl)]),J(de,{width:"300","confirm-button-text":"确认",icon:ze(Ms),"icon-color":"#FF7D00","cancel-button-text":"取消",title:"确认删除该张图片吗？",onConfirm:h=>F(c)},{reference:u(()=>[c.showFlag&&!c.fileUrl.startsWith("data:image")?(t(),i("img",Il)):W("",!0)]),_:2},1032,["icon","onConfirm"]),l("div",bl,S(c.caption),1)],40,_l))),128))])])],512)]),_:1},8,["modelValue"]),l("div",{class:"overlay",ref_key:"overlayRef",ref:Ke},[kl,Ll,j.value?(t(),i("img",{key:0,class:"zoomPanoImage",src:zo.value,style:{cursor:"pointer"},onClick:q},null,8,wl)):W("",!0),j.value?W("",!0):(t(),i("canvas",{key:1,id:"myZoomCanvas",onClick:mt})),l("img",{src:Sa,style:{position:"fixed",right:"20px",top:"20px",cursor:"pointer"},onClick:s[3]||(s[3]=c=>mt(!0))})],512),Nl],64)}}},$l=Xe(xl,[["__scopeId","data-v-87b13372"]]);const Tl={class:"content"},Ul=["onClick"],Vl={class:"suffix"},Sl={class:"showRange"},Ol={class:"text"},El={class:"text"},Pl={class:"text"},Ml={__name:"modelAnalysis",props:{titleName:String,min:String,max:String,placeholder:String,left:String,middle:String,right:String,conclusion:String,value:Number,cephalometricsContent:String,hasVal:Boolean},emits:["change"],setup(O,{emit:y}){const N=O,R=I(N.cephalometricsContent),j=y,oe=ce=>{var K;R.value||(K=ce.target.parentElement.children[1].classList)==null||K.remove("clicked")},q=ce=>{console.log(ce.target.value==="")};Ft(R,ce=>{j("change",ce,N.value)});let X=I(null);const E=ce=>{var K;Array.from(ce.target.parentElement.classList).includes("googleInput")&&((K=ce.target.parentElement.children[1].classList)==null||K.add("clicked"),ce.target.parentElement.children[0].focus(),X.value=ce.target.parentElement.children[1])};return(ce,K)=>(t(),i("div",Tl,[l("div",{class:"googleInput",onClick:no(E,["stop"])},[ao(l("input",{onInput:q,"onUpdate:modelValue":K[0]||(K[0]=Y=>R.value=Y),onBlur:oe},null,544),[[As,R.value]]),N.placeholder?(t(),i("span",{key:0,class:H(["placeholder",{clicked:N.hasVal}])},S(N.placeholder),3)):W("",!0),l("div",Vl,S(O.titleName==="SPEE曲线"?"mm":"%"),1)],8,Ul),l("div",Sl,[l("div",{class:H(["range left",{active:N.conclusion===N.left}])},[l("div",Ol,S(N.left),1)],2),l("div",{class:H(["range middle",{active:N.conclusion===N.middle}])},[l("div",El,S(N.middle),1)],2),l("div",{class:H(["range right",{active:N.conclusion===N.right}])},[l("div",Pl,S(N.right),1)],2),l("div",{class:H(["refNum firstRefNum",{distanceNum:String(N.min).endsWith("m")}])},S(N.min),3),l("div",{class:H(["refNum secondRefNum",{distanceNum:String(N.max).endsWith("m")}])},S(N.max),3)])]))}},Al=Xe(Ml,[["__scopeId","data-v-134eb27b"]]);const Dl={class:"formItem"},Rl={class:"formItem__content"},Fl={__name:"customFormItem",props:{label:String,width:String,showMark:Boolean},setup(O){return(y,N)=>{const R=Pt;return t(),i("div",Dl,[l("div",{class:"formItem__label",style:fo({width:O.width})},[z(S(O.label),1),O.showMark?(t(),b(R,{key:0,class:"box-item",effect:"light",placement:"top-start"},{content:u(()=>[z(S(y.content),1)]),default:u(()=>[l("img",{onMouseenter:N[0]||(N[0]=(...j)=>y.enterTool&&y.enterTool(...j)),onMouseleave:N[1]||(N[1]=(...j)=>y.leaveTool&&y.leaveTool(...j)),src:Wo,style:{cursor:"pointer"}},null,32)]),_:1})):W("",!0)],4),l("div",Rl,[Dt(y.$slots,"default",{},void 0,!0)])])}}},Bl=Xe(Fl,[["__scopeId","data-v-ae329d43"]]);const jl={class:"stepThree"},Wl={class:"content"},ql={__name:"stepThree",props:{pdfId:String},setup(O,{expose:y}){const N=I(!1);y({clicked:N});const R=O,oe=co().params.appId,q=I({});async function X(){const K=await Te(`/prod-api/business/orthClass/list/2/模型分析/${oe}`),Y=K.data[0].orthTitleList[2];K.data[0].orthTitleList.splice(2,1),K.data[0].orthTitleList.splice(3,0,Y),q.value=K.data[0],q.value.orthTitleList.forEach((U,m)=>{if(N.value=U.orthOptionsList.some(G=>G.choosen==!0),U.hasVal=!!U.cephalometricsContent,m<=1){U.optionId="";const G=U.orthOptionsList.filter(fe=>fe.choosen===!0);G.length>0&&(U.optionId=G[0].id)}else if(U.value=+U.cephalometricsContent,U.titleName=="SPEE曲线"?(U.min="0mm",U.max="2mm"):(U.min=(U.orthOptionsList[0].optionName*100).toFixed(2)+"%",U.max=(U.orthOptionsList[1].optionName*100).toFixed(2)+"%"),U.placeholder=m==2?"":U.titleName.substr(-4).slice(0,3),U.left=m==2?"反曲":"偏低",U.middle="正常",U.right=m==2?"过深":"偏高",U.titleName=="SPEE曲线")U.minVal=0,U.maxVal=2,U.cephalometricsContent?U.conclusion=+U.cephalometricsContent<0?U.left:+U.cephalometricsContent>2?U.right:U.middle:U.conclusion="";else{let G=U.orthOptionsList[0].optionName,fe=U.orthOptionsList[1].optionName;U.cephalometricsContent?+U.cephalometricsContent/100<G?U.conclusion=U.left:+U.cephalometricsContent/100>fe?U.conclusion=U.right:U.conclusion=U.middle:U.conclusion=""}})}X();const E=(K,Y)=>{Y.value=+K,Y.value&&(Y.min.endsWith("m")?Y.conclusion=Y.value<+Y.min.slice(0,1)?Y.left:Y.value>+Y.max.slice(0,1)?Y.right:Y.middle:Y.conclusion=Y.value<+Y.min.slice(0,5)?Y.left:Y.value>+Y.max.slice(0,5)?Y.right:Y.middle);const U={apmtId:oe,titleId:Y.id,optionsIdStr:[],otherContent:"",cephalometricsContent:K===""?"":Y.value+"",fdiToothCode:"",showPosition:""};ve("/prod-api/business/optionsResult",U)},ce=(K,Y)=>{N.value=!0,R.pdfId&&sessionStorage.removeItem(R.pdfId),vo(K,Y,oe),Ne(Y.optionId,Y,"",oe)};return(K,Y)=>{const U=mo,m=ro;return t(),i("div",jl,[J(Ee,{text:"模型分析",backgroundColor:"#f4f7fd"}),l("div",Wl,[(t(!0),i(w,null,P(q.value.orthTitleList,(G,fe)=>(t(),b(Bl,{label:fe<=1?G.titleName:fe<4?G.titleName.slice(0,8):"",width:"110px",showMark:G.titleName==="Bolton指数（前牙比）",content:G.prompt,key:G.id},{default:u(()=>[fe<=1?(t(),b(m,{key:0,modelValue:G.optionId,"onUpdate:modelValue":_e=>G.optionId=_e,onChange:_e=>ce(G.optionId,G)},{default:u(()=>[(t(!0),i(w,null,P(G.orthOptionsList,_e=>(t(),b(U,{key:_e.id,class:H({serious:_e.serious=="1",checked:_e.choosen===!0}),label:_e.id},{default:u(()=>[z(S(_e.optionName),1)]),_:2},1032,["class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):(t(),b(Al,Ds({key:1,titleName:G.titleName},G,{onChange:_e=>E(_e,G)}),null,16,["titleName","onChange"]))]),_:2},1032,["label","showMark","content"]))),128))])])}}},Gl=Xe(ql,[["__scopeId","data-v-0eb4bc2e"]]);const Zl=O=>(No("data-v-e65991eb"),O=O(),xo(),O),Jl={class:"stepFour"},Xl={key:0,class:"content"},Yl={class:"questionItem__header"},Hl=Zl(()=>l("img",{src:$s},null,-1)),zl={class:"questionItem__header__title"},Ql={class:"questionItem__content content"},Kl={class:"question_level_two"},ei={class:"itemContainer"},oi={class:"singleQuestionItem__label"},ti={class:"singleQuestionItem__content"},si={key:1,style:{padding:"20px"}},ai={class:"content diagnose"},ni={key:0,src:Me},li={key:1,src:Ae},ii={__name:"stepFour",props:{pdfId:String},setup(O,{expose:y}){const N=I(!1);y({clicked:N});const R=O,oe=co().params.appId,q=I([]);async function X(){const Y=await Te(`/prod-api/business/orthClass/issuesList?apmtId=${oe}&serious=1`);if(Y.data){const U=Y.data.reduce((m,G)=>{if(m[G.question_level_one]){const fe=m[G.question_level_one].list1.find(_e=>_e.question_level_two===G.question_level_two);fe?fe.list2.push({title_name:G.title_name,option_names:G.option_names}):m[G.question_level_one].list1.push({question_level_two:G.question_level_two,list2:[{title_name:G.title_name,option_names:G.option_names}]})}else m[G.question_level_one]=G,m[G.question_level_one].list1=[],m[G.question_level_one].list1.push({question_level_two:G.question_level_two,list2:[{title_name:G.title_name,option_names:G.option_names}]});return m},{});q.value=Object.values(U),console.log(q.value)}}X();const E=I([]);async function ce(){const Y=await Te(`/prod-api/business/orthClass/list/2/诊断/${oe}`);E.value=Y.data,Y.data[0].classFlag&&(N.value=!0),Y.data.forEach(U=>U.orthTitleList.forEach(m=>m.showInput=!1)),Y.data.forEach(U=>{U.orthTitleList.forEach(m=>{if(m.type==1){m.optionId="",m.text="",m.showInput=!1;const G=m.orthOptionsList.filter(fe=>fe.choosen===!0);G.length>0&&(m.optionId=G[0].id)}else if(m.type==2){m.optionId=[],m.optionId1=[],m.text="",m.showInput=!1;const G=m.orthOptionsList.filter(fe=>fe.choosen===!0);G.length>0&&(m.optionId=G.map(fe=>fe.id),m.optionId1=m.optionId)}})})}ce();const K=(Y,U)=>{N.value=!0,R.pdfId&&sessionStorage.removeItem(R.pdfId),vo(Y,U,oe),Ne(U.optionId,U,"",oe)};return(Y,U)=>{const m=mo,G=ro,fe=Lo,_e=wo;return t(),i("div",Jl,[J(Ee,{text:"问题列表",backgroundColor:"#f4f7fd"}),q.value.length>0?(t(),i("div",Xl,[(t(!0),i(w,null,P(q.value,Ie=>(t(),i("div",{class:"questionItem",key:Ie.id},[l("div",Yl,[Hl,l("span",zl,S(Ie.question_level_one),1)]),l("div",Ql,[(t(!0),i(w,null,P(Ie.list1,ue=>(t(),i("div",{class:"singleQuestionItem",key:ue.id},[l("div",Kl,S(ue.question_level_two),1),l("div",ei,[(t(!0),i(w,null,P(ue.list2,pe=>(t(),i("div",{class:"item",key:pe.title_name},[l("span",oi,S(pe.title_name),1),l("span",ti,S(pe.option_names),1)]))),128))])]))),128))])]))),128))])):(t(),i("div",si," 无 ")),J(Ee,{text:"诊断",backgroundColor:"#f4f7fd"}),l("div",ai,[(t(!0),i(w,null,P(E.value,Ie=>(t(),i(w,{key:Ie.id},[(t(!0),i(w,null,P(Ie.orthTitleList,ue=>(t(),b(be,{key:ue.id,label:ue.titleName,width:"80px"},{default:u(()=>[ue.type==1?(t(),b(G,{key:0,modelValue:ue.optionId,"onUpdate:modelValue":pe=>ue.optionId=pe,onChange:pe=>K(ue.optionId,ue)},{default:u(()=>[(t(!0),i(w,null,P(ue.orthOptionsList,pe=>(t(),b(m,{key:pe.id,class:H({serious:pe.serious=="1",checked:pe.choosen===!0}),label:pe.id},{default:u(()=>[z(S(pe.optionName),1)]),_:2},1032,["class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):W("",!0),ue.type==2?(t(),b(_e,{key:1,modelValue:ue.optionId,"onUpdate:modelValue":pe=>ue.optionId=pe,onChange:pe=>K(ue.optionId,ue)},{default:u(()=>[(t(!0),i(w,null,P(ue.orthOptionsList,pe=>(t(),b(fe,{class:H({serious:pe.serious=="1",checked:pe.choosen===!0}),key:pe.id,label:pe.id},{default:u(()=>[z(S(pe.optionName)+" ",1),pe.serious=="0"?(t(),i("img",ni)):(t(),i("img",li))]),_:2},1032,["class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):W("",!0)]),_:2},1032,["label"]))),128))],64))),128))])])}}},di=Xe(ii,[["__scopeId","data-v-e65991eb"]]);const _o=O=>(No("data-v-64a96104"),O=O(),xo(),O),ri={class:"stepFive"},ci={class:"content plan"},ui={key:0,src:Me},hi={key:1,src:Ae},pi={class:"content"},fi={key:0,src:Me},mi={key:1,src:Ae},vi={class:"content"},_i={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",fill:`
                              none
                            `,version:"1.1",width:"9.999975204467773",height:"9.999975204467773",viewBox:"0 0 9.999975204467773 9.999975204467773"},gi=["fill"],yi={key:0,src:Me},Ii={key:1,src:Ae},bi=_o(()=>l("span",{style:{color:"#4e5969"}}," 个月",-1)),Ci={class:"content risk"},ki={key:0,src:Me},Li={key:1,src:Ae},wi={key:0,xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",fill:"none",version:"1.1",width:"9.999975204467773",height:"9.999975204467773",viewBox:"0 0 9.999975204467773 9.999975204467773"},Ni=["fill"],xi={key:1,src:Me},$i={key:2,src:Ae},Ti={class:"selectContainer",id:"selectContainer"},Ui={class:"container"},Vi=["id","onClick"],Si=_o(()=>l("div",{class:"left"},"右",-1)),Oi=_o(()=>l("div",{class:"right"},"左",-1)),Ei={key:0,xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",fill:"none",version:"1.1",width:"9.999975204467773",height:"9.999975204467773",viewBox:"0 0 9.999975204467773 9.999975204467773"},Pi=["fill"],Mi={key:1,src:Me},Ai={key:2,src:Ae},Di={class:"diagramWrapper"},Ri={class:"diagram"},Fi={class:"diagramBox"},Bi={class:"toothItem1"},ji={class:"toothItem2"},Wi={class:"diagramBox"},qi={class:"toothItem3"},Gi={class:"toothItem4"},Zi={class:"selectContainer",id:"selectContainer"},Ji={class:"container"},Xi=["id","onClick"],Yi=_o(()=>l("div",{class:"left"},"右",-1)),Hi=_o(()=>l("div",{class:"right"},"左",-1)),zi={__name:"stepFive",props:{pdfId:String},setup(O,{expose:y}){const N=I(!1),R=I(!1);y({goalClicked:N,methodClicked:R});const j=O,oe=v=>{v.otherContent&&(v.visible=!0),v.hover=!0};let q;const X=v=>{v.hover=!1,q=setTimeout(()=>{v.visible=!1},300);const V=document.querySelectorAll(".myPopper");Array.from(V).forEach(_=>{_.addEventListener("mouseenter",()=>{clearTimeout(q)})})},E=v=>{v.visible=!0,v.hover=!0};let ce;const K=(v,V)=>{V.hover=!1,ce=setTimeout(()=>{V.visible=!1},300);const _=document.querySelectorAll(".myPopper");Array.from(_).forEach(L=>{L.addEventListener("mouseenter",()=>{clearTimeout(ce)})})},U=co().params.appId,m=I([]);async function G(){const v=await Te(`/prod-api/business/orthClass/list/2/方案/${U}`);m.value=v.data,v.data.forEach(V=>V.orthTitleList.forEach(_=>_.showInput=!1)),v.data.forEach(V=>{V.orthTitleList.forEach(_=>{if(_.type==1){_.optionId="",_.text="",_.showInput=!1;const L=_.orthOptionsList.filter(T=>T.choosen===!0);L.length>0&&(_.optionId=L[0].id)}else if(_.type==2){_.optionId=[],_.optionId1=[],_.text="",_.showInput=!1;const L=_.orthOptionsList.filter(T=>T.choosen===!0);L.length>0&&(_.optionId=L.map(T=>T.id),_.optionId1=_.optionId)}})})}G();const fe=I([]);async function _e(){const v=await Te(`/prod-api/business/orthClass/list/2/目标/${U}`);fe.value=v.data,N.value=v.data[0].classFlag,v.data.forEach(V=>V.orthTitleList.forEach(_=>_.showInput=!1)),v.data.forEach(V=>{V.orthTitleList.forEach(_=>{if(_.type==1){_.optionId="",_.text="",_.showInput=!1;const L=_.orthOptionsList.filter(T=>T.choosen===!0);L.length>0&&(_.optionId=L[0].id)}else if(_.type==2){_.optionId=[],_.optionId1=[],_.text="",_.showInput=!1;const L=_.orthOptionsList.filter(T=>T.choosen===!0);L.length>0&&(_.optionId=L.map(T=>T.id),_.optionId1=_.optionId)}})})}_e();const Ie=I([]);async function ue(){const v=await Te(`/prod-api/business/orthClass/list/2/方法/${U}`);Ie.value=v.data,R.value=v.data[0].classFlag,v.data.forEach(V=>V.orthTitleList.forEach(_=>_.showInput=!1)),v.data.forEach(V=>{V.orthTitleList.forEach(_=>{if(_.titleName=="矫治器"){_.optionId=[],_.optionId1=[],_.orthOptionsList.forEach(T=>{var ye,C;T.optionName==="无托槽隐形矫治"?(T.fillColor="#C9CDD4",T.brand=v.data[0].orthTitleList.find(d=>d.titlePrompt=="无托槽"),T.hoverColor="#2e6ce4",T.clicked=!!T.choosen,T.otherContent=(ye=T.brand.orthOptionsList.find(d=>d.choosen===!0))==null?void 0:ye.id):T.optionName==="硅胶矫治器"&&(T.fillColor="#C9CDD4",T.brand=v.data[0].orthTitleList.find(d=>d.titlePrompt=="硅胶"),T.otherContent=(C=T.brand.orthOptionsList.find(d=>d.choosen===!0))==null?void 0:C.id,T.hoverColor="#2e6ce4",T.clicked=!!T.choosen)});const L=_.orthOptionsList.filter(T=>T.choosen===!0);L.length>0&&(_.optionId=L.map(T=>T.id),_.optionId1=_.optionId),_.otherContent=""}else if(_.type==1){_.optionId="",_.text="",_.showInput=!1;const L=_.orthOptionsList.filter(T=>T.choosen===!0);L.length>0&&(_.optionId=L[0].id)}else if(_.type==2){_.optionId=[],_.optionId1=[],_.text="",_.showInput=!1;const L=_.orthOptionsList.filter(T=>T.choosen===!0);L.length>0&&(_.optionId=L.map(T=>T.id),_.optionId1=_.optionId)}})})}ue();const pe=v=>{if(v.cephalometricsContent){const V={apmtId:U,titleId:v.id,optionsIdStr:[],otherContent:"",cephalometricsContent:v.cephalometricsContent,fdiToothCode:"",showPosition:""};ve("/prod-api/business/optionsResult",V)}},xe=I([]);async function F(){const v=await Te(`/prod-api/business/orthClass/list/2/风险/${U}`);xe.value=v.data,xe.value.forEach(V=>{V.orthTitleList.forEach(_=>{_.orthOptionsList.forEach(L=>{if(L.optionSuffix){L.topLeft=[],L.topRight=[],L.bottomLeft=[],L.bottomRight=[];const T=JSON.parse(L.showPosition);L.visible=!1,L.fdiToothCode?(L.toothCode=L.fdiToothCode.split(","),L.fdiToothCode.split(",").forEach((ye,C)=>{ye.startsWith("1")||ye.startsWith("5")?L.topLeft.push(T[C][0]):ye.startsWith("2")||ye.startsWith("6")?L.topRight.push(T[C][0]):ye.startsWith("4")||ye.startsWith("8")?L.bottomLeft.push(T[C][0]):(ye.startsWith("3")||ye.startsWith("7"))&&L.bottomRight.push(T[C][0])})):L.toothCode=[],L.position=T||[],L.submitAble=!1}})})}),xe.value.forEach(V=>V.orthTitleList.forEach(_=>_.showInput=!1)),xe.value.forEach(V=>{V.orthTitleList.forEach(_=>{if(_.type==1)_.optionId="",_.text="";else if(_.type==2){_.optionId=[],_.optionId1=[],_.text="",_.showInput=!1;const L=_.orthOptionsList.filter(T=>T.choosen===!0);L.length>0&&(_.optionId=L.map(T=>T.id),_.optionId1=_.optionId)}_.titleName=="矫治风险"&&_.orthOptionsList.forEach(L=>{(L.optionName==="牙根吸收"||L.optionName==="乳牙早失")&&(L.fillColor="#C9CDD4",L.seriousColor="#f44c4c",L.hoverColor="#2e6ce4",L.clicked=!!L.choosen)})})})}F();const we=(v,V)=>{V.otherContent||(V.clicked=!1)},me=(v,V)=>{v.visible=!1,g.value.forEach(L=>L.forEach(T=>T.active=!1));let _;if(!v.submitAble){if(v.id===237&&!v.toothCode.join()){V.optionId.splice(V.optionId.findIndex(T=>T==237),1);const L=V.orthOptionsList.find(T=>T.id===236);_={apmtId:U,titleId:V.id,optionsIdStr:V.optionId,otherContent:"",cephalometricsContent:"",fdiToothCode:L.toothCode.join(),showPosition:JSON.stringify(L.position),fdiToothCode1:v.toothCode.join(),showPosition1:JSON.stringify(v.position)}}else if(v.id===236&&!v.toothCode.join()){V.optionId.splice(V.optionId.findIndex(T=>T==236),1);const L=V.orthOptionsList.find(T=>T.id===237);_={apmtId:U,titleId:V.id,optionsIdStr:V.optionId,otherContent:"",cephalometricsContent:"",fdiToothCode:L.toothCode.join(),showPosition:JSON.stringify(L.position),fdiToothCode1:v.toothCode.join(),showPosition1:JSON.stringify(v.position)}}}if(v.id===237){const L=V.orthOptionsList.find(T=>T.id===236);L.toothCode&&(_={apmtId:U,titleId:V.id,optionsIdStr:V.optionId,otherContent:"",cephalometricsContent:"",fdiToothCode:L.toothCode.join(),showPosition:JSON.stringify(L.position),fdiToothCode1:v.toothCode.join(),showPosition1:JSON.stringify(v.position)})}else{const L=V.orthOptionsList.find(T=>T.id===237);L.toothCode?_={apmtId:U,titleId:V.id,optionsIdStr:V.optionId,otherContent:"",cephalometricsContent:"",fdiToothCode1:L.toothCode.join(),showPosition1:JSON.stringify(L.position),fdiToothCode:v.toothCode.join(),showPosition:JSON.stringify(v.position)}:(V.optionId.splice(V.optionId.findIndex(T=>T==236),1),_={apmtId:U,titleId:V.id,optionsIdStr:V.optionId,otherContent:"",cephalometricsContent:"",fdiToothCode:L.toothCode.join(),showPosition:JSON.stringify(L.position),fdiToothCode1:v.toothCode.join(),showPosition1:JSON.stringify(v.position)})}ve("/prod-api/business/optionsResult",_).then(()=>{v.submitAble=!1,F()})},Pe=(v,V)=>{Ot(v,V)},le=I(!1);async function ne(v,V,_,L,T){var C;if(T=="目标"&&(console.log(T),N.value=!0),T=="方法"&&(R.value=!0),j.pdfId&&sessionStorage.removeItem(j.pdfId),V.titleName=="矫治风险")le.value=!0,V.orthOptionsList.forEach(d=>{v.includes(d.id)?d.clicked=!0:d.clicked=!1});else if(V.titleName=="矫治器"){const d=V.optionId.filter(x=>!V.optionId1.includes(x)),D=(C=V.orthOptionsList.find(x=>x.id===d[0]))==null?void 0:C.optionName;d&&D&&(D=="无托槽隐形矫治"||D=="硅胶矫治器")&&V.orthOptionsList.forEach(x=>{d.includes(x.id)?(x.clicked=!0,x.visible=!0):x.clicked=!1})}else if(V.titleName=="品牌"){_.visible=!1,Ne(_.otherContent,V,"",U),Ne(L.optionId,L,"",U);return}vo(v,V,U);const ye=await Ne(V.optionId,V,"",U);le.value&&ye.code==200&&F(),ye.code==200&V.titleName=="矫治器"&&ue()}const g=I([]);g.value=Vt();const ie=v=>{g.value.forEach(V=>{V.forEach(_=>{var L;_.active=!1,(L=v.toothCode)!=null&&L.includes(_.value+"")&&(_.active=!0)})})};return(v,V)=>{const _=mo,L=ro,T=Lo,ye=wo,C=jo,d=qo;return t(),i("div",ri,[J(Ee,{text:"方案",backgroundColor:"#f4f7fd"}),l("div",ci,[(t(!0),i(w,null,P(m.value,D=>(t(),i(w,{key:D.id},[(t(!0),i(w,null,P(D.orthTitleList,x=>(t(),b(be,{label:x.titleName,key:x.id},{default:u(()=>[x.type==1?(t(),b(L,{key:0,modelValue:x.optionId,"onUpdate:modelValue":r=>x.optionId=r,onChange:r=>ne(x.optionId,x)},{default:u(()=>[(t(!0),i(w,null,P(x.orthOptionsList,r=>(t(),b(_,{class:H({serious:r.serious=="1",checked:r.choosen===!0}),key:r.id,label:r.id},{default:u(()=>[z(S(r.optionName),1)]),_:2},1032,["class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):W("",!0),x.type==2?(t(),b(ye,{key:1,modelValue:x.optionId,"onUpdate:modelValue":r=>x.optionId=r,onChange:r=>ne(x.optionId,x)},{default:u(()=>[(t(!0),i(w,null,P(x.orthOptionsList,r=>(t(),b(T,{class:H({serious:r.serious=="1",checked:r.choosen===!0}),key:r.id,label:r.id},{default:u(()=>[z(S(r.optionName)+" ",1),r.serious=="0"?(t(),i("img",ui)):(t(),i("img",hi))]),_:2},1032,["class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):W("",!0)]),_:2},1032,["label"]))),128))],64))),128))]),J(Ee,{text:"目标",backgroundColor:"#f4f7fd"}),l("div",pi,[(t(!0),i(w,null,P(fe.value,D=>(t(),i(w,{key:D.id},[(t(!0),i(w,null,P(D.orthTitleList,x=>(t(),b(be,{key:x.id,label:x.titleName,width:"72px"},{default:u(()=>[x.type==1?(t(),b(L,{key:0,modelValue:x.optionId,"onUpdate:modelValue":r=>x.optionId=r,onChange:r=>ne(x.optionId,x,D.className,"","目标")},{default:u(()=>[(t(!0),i(w,null,P(x.orthOptionsList,r=>(t(),b(_,{class:H({serious:r.serious=="1",checked:r.choosen===!0}),key:r.id,label:r.id},{default:u(()=>[z(S(r.optionName),1)]),_:2},1032,["class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):W("",!0),x.type==2?(t(),b(ye,{key:1,modelValue:x.optionId,"onUpdate:modelValue":r=>x.optionId=r,onChange:r=>ne(x.optionId,x,D.className,"","目标")},{default:u(()=>[(t(!0),i(w,null,P(x.orthOptionsList,r=>(t(),b(T,{class:H({serious:r.serious=="1",checked:r.choosen===!0}),key:r.id,label:r.id},{default:u(()=>[z(S(r.optionName)+" ",1),r.serious=="0"?(t(),i("img",fi)):(t(),i("img",mi))]),_:2},1032,["class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):W("",!0)]),_:2},1032,["label"]))),128))],64))),128))]),J(Ee,{text:"方法",backgroundColor:"#f4f7fd"}),l("div",vi,[(t(!0),i(w,null,P(Ie.value,D=>(t(),i(w,{key:D.id},[(t(!0),i(w,null,P(D.orthTitleList,x=>(t(),i(w,{key:x.id},[x.titleName!=="品牌"&&x.titleName!=="预计矫正周期"?(t(),b(be,{key:0,label:x.titleName,width:"100px"},{default:u(()=>[x.type==1?(t(),b(L,{key:0,modelValue:x.optionId,"onUpdate:modelValue":r=>x.optionId=r,onChange:r=>ne(x.optionId,x,"","","方法")},{default:u(()=>[(t(!0),i(w,null,P(x.orthOptionsList,r=>(t(),i(w,{key:r.id},[r.optionSuffix?(t(),b(C,{key:1,"popper-class":"myPopper","popper-style":{width:"auto","min-width":"100px"},placement:"top-start",width:200,visible:r.visible,onAfterLeave:Q=>we(x,r)},{reference:u(()=>[J(_,{class:H({serious:r.serious=="1"}),label:r.id,onMouseenter:Q=>oe(r),onMouseleave:Q=>X(r)},{default:u(()=>[z(S(r.optionName),1),(t(),i("svg",_i,[l("g",null,[l("path",{d:"M0,4.99999C0,2.23857,2.23857,0,4.99999,0C7.76141,0,9.99998,2.23857,9.99998,4.99999C9.99998,7.76141,7.76141,9.99998,4.99999,9.99998C2.23857,9.99998,0,7.76141,0,4.99999C0,4.99999,0,4.99999,0,4.99999ZM5.49999,3.49999C5.49999,3.49999,5.49999,2.49999,5.49999,2.49999C5.49999,2.49999,4.49999,2.49999,4.49999,2.49999C4.49999,2.49999,4.49999,3.49999,4.49999,3.49999C4.49999,3.49999,5.49999,3.49999,5.49999,3.49999C5.49999,3.49999,5.49999,3.49999,5.49999,3.49999ZM4.49999,3.99999C4.49999,3.99999,4.49999,7.49998,4.49999,7.49998C4.49999,7.49998,5.49999,7.49998,5.49999,7.49998C5.49999,7.49998,5.49999,3.99999,5.49999,3.99999C5.49999,3.99999,4.49999,3.99999,4.49999,3.99999C4.49999,3.99999,4.49999,3.99999,4.49999,3.99999Z","fill-rule":"evenodd",fill:r.clicked||r.hover?r.hoverColor:r.fillColor,"fill-opacity":"1"},null,8,gi)])]))]),_:2},1032,["class","label","onMouseenter","onMouseleave"])]),default:u(()=>[J(be,{label:r.brand.titleName},{default:u(()=>[J(L,{modelValue:r.otherContent,"onUpdate:modelValue":Q=>r.otherContent=Q,onChange:Q=>ne(r.otherContent,r.brand,r,x,"方法")},{default:u(()=>[(t(!0),i(w,null,P(r.brand.orthOptionsList,Q=>(t(),b(_,{key:Q.id,class:H({serious:Q.serious=="1"}),label:Q.id},{default:u(()=>[z(S(Q.optionName),1)]),_:2},1032,["class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1032,["label"])]),_:2},1032,["visible","onAfterLeave"])):(t(),b(_,{key:0,class:H({serious:r.serious=="1"}),label:r.id},{default:u(()=>[z(S(r.optionName),1)]),_:2},1032,["class","label"]))],64))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):W("",!0),x.type==2?(t(),b(ye,{key:1,modelValue:x.optionId,"onUpdate:modelValue":r=>x.optionId=r,onChange:r=>ne(x.optionId,x,"","","方法")},{default:u(()=>[(t(!0),i(w,null,P(x.orthOptionsList,r=>(t(),b(T,{key:r.id,class:H({serious:r.serious=="1",checked:r.choosen===!0}),label:r.id},{default:u(()=>[z(S(r.optionName),1),r.serious=="0"?(t(),i("img",yi)):(t(),i("img",Ii))]),_:2},1032,["class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):W("",!0)]),_:2},1032,["label"])):W("",!0),x.titleName=="预计矫正周期"?(t(),b(be,{key:1,label:x.titleName,width:"100px"},{default:u(()=>[J(d,{style:{width:"100px"},modelValue:x.cephalometricsContent,"onUpdate:modelValue":r=>x.cephalometricsContent=r,onBlur:r=>pe(x)},null,8,["modelValue","onUpdate:modelValue","onBlur"]),bi]),_:2},1032,["label"])):W("",!0)],64))),128))],64))),128))]),J(Ee,{text:"风险",backgroundColor:"#f4f7fd"}),l("div",Ci,[(t(!0),i(w,null,P(xe.value,D=>(t(),i(w,{key:D.id},[(t(!0),i(w,null,P(D.orthTitleList,x=>(t(),i(w,{key:x.id},[x.titleName!=="备注"?(t(),b(be,{key:0,label:x.titleName},{default:u(()=>[J(ye,{modelValue:x.optionId,"onUpdate:modelValue":r=>x.optionId=r,onChange:r=>ne(x.optionId,x)},{default:u(()=>[(t(!0),i(w,null,P(x.orthOptionsList,r=>(t(),i(w,{key:r.id},[r.optionSuffix?(t(),i(w,{key:1},[r.fdiToothCode==null?(t(),b(C,{key:0,placement:"right",width:490,trigger:"click",onShow:Q=>ie(r),onAfterLeave:Q=>me(r,x)},{reference:u(()=>[J(T,{onClick:Q=>r.visible=!0,class:H({serious:r.serious=="1",checked:r.choosen===!0}),label:r.id,onMouseenter:Q=>r.hover=!0,onMouseleave:Q=>r.hover=!1},{default:u(()=>[z(S(r.optionName),1),r.optionSuffix?(t(),i("svg",wi,[l("g",null,[l("path",{d:"M0,4.99999C0,2.23857,2.23857,0,4.99999,0C7.76141,0,9.99998,2.23857,9.99998,4.99999C9.99998,7.76141,7.76141,9.99998,4.99999,9.99998C2.23857,9.99998,0,7.76141,0,4.99999C0,4.99999,0,4.99999,0,4.99999ZM5.49999,3.49999C5.49999,3.49999,5.49999,2.49999,5.49999,2.49999C5.49999,2.49999,4.49999,2.49999,4.49999,2.49999C4.49999,2.49999,4.49999,3.49999,4.49999,3.49999C4.49999,3.49999,5.49999,3.49999,5.49999,3.49999C5.49999,3.49999,5.49999,3.49999,5.49999,3.49999ZM4.49999,3.99999C4.49999,3.99999,4.49999,7.49998,4.49999,7.49998C4.49999,7.49998,5.49999,7.49998,5.49999,7.49998C5.49999,7.49998,5.49999,3.99999,5.49999,3.99999C5.49999,3.99999,4.49999,3.99999,4.49999,3.99999C4.49999,3.99999,4.49999,3.99999,4.49999,3.99999Z","fill-rule":"evenodd",fill:r.clicked?r.seriousColor:r.hover?r.hoverColor:r.fillColor,"fill-opacity":"1"},null,8,Ni)])])):W("",!0),r.serious=="0"?(t(),i("img",xi)):(t(),i("img",$i))]),_:2},1032,["onClick","class","label","onMouseenter","onMouseleave"])]),default:u(()=>[l("div",Ti,[l("div",Ui,[(t(!0),i(w,null,P(g.value,(Q,te)=>(t(),i("div",{key:te,class:H(["symptomBox",{itemAlignRight:te===2||te===4||te===0||te===6,marginTop:te==4||te==5,marginBottom:te==2||te==3,marginRight:te===2||te===4||te===0||te===6,marginLeft:te===1||te===3||te===5||te===7}])},[(t(!0),i(w,null,P(Q,(Se,Ye)=>(t(),i("div",{class:H(["symptomItem",{selected:Se.active===!0}]),id:Se.value,key:Ye,onClick:ge=>Pe(Se,r)},S(Se.label),11,Vi))),128))],2))),128))]),Si,Oi])]),_:2},1032,["onShow","onAfterLeave"])):(t(),b(C,{key:1,"popper-class":"myPopper","popper-style":{width:"auto","min-width":"100px"},placement:"top-start",width:200,visible:r.visible},{reference:u(()=>[J(T,{onMouseenter:Q=>E(r),class:H({serious:r.serious=="1",checked:r.choosen===!0}),label:r.id,onMouseleave:Q=>K(Q,r)},{default:u(()=>[z(S(r.optionName),1),r.optionSuffix?(t(),i("svg",Ei,[l("g",null,[l("path",{d:"M0,4.99999C0,2.23857,2.23857,0,4.99999,0C7.76141,0,9.99998,2.23857,9.99998,4.99999C9.99998,7.76141,7.76141,9.99998,4.99999,9.99998C2.23857,9.99998,0,7.76141,0,4.99999C0,4.99999,0,4.99999,0,4.99999ZM5.49999,3.49999C5.49999,3.49999,5.49999,2.49999,5.49999,2.49999C5.49999,2.49999,4.49999,2.49999,4.49999,2.49999C4.49999,2.49999,4.49999,3.49999,4.49999,3.49999C4.49999,3.49999,5.49999,3.49999,5.49999,3.49999C5.49999,3.49999,5.49999,3.49999,5.49999,3.49999ZM4.49999,3.99999C4.49999,3.99999,4.49999,7.49998,4.49999,7.49998C4.49999,7.49998,5.49999,7.49998,5.49999,7.49998C5.49999,7.49998,5.49999,3.99999,5.49999,3.99999C5.49999,3.99999,4.49999,3.99999,4.49999,3.99999C4.49999,3.99999,4.49999,3.99999,4.49999,3.99999Z","fill-rule":"evenodd",fill:r.clicked?r.seriousColor:r.hover?r.hoverColor:r.fillColor,"fill-opacity":"1"},null,8,Pi)])])):W("",!0),r.serious=="0"?(t(),i("img",Mi)):(t(),i("img",Ai))]),_:2},1032,["onMouseenter","class","label","onMouseleave"])]),default:u(()=>[J(C,{placement:"right",width:490,trigger:"click",onShow:Q=>ie(r),onAfterLeave:Q=>me(r,x)},{reference:u(()=>[l("div",Di,[l("div",Ri,[l("div",Fi,[l("div",Bi,S(r.topLeft.sort((Q,te)=>Q.sort-te.sort).map(Q=>Q.value).join("")),1),l("div",ji,S(r.topRight.sort((Q,te)=>Q.sort-te.sort).map(Q=>Q.value).join("")),1)]),l("div",Wi,[l("div",qi,S(r.bottomLeft.sort((Q,te)=>Q.sort-te.sort).map(Q=>Q.value).join("")),1),l("div",Gi,S(r.bottomRight.sort((Q,te)=>Q.sort-te.sort).map(Q=>Q.value).join("")),1)])])])]),default:u(()=>[l("div",Zi,[l("div",Ji,[(t(!0),i(w,null,P(g.value,(Q,te)=>(t(),i("div",{key:te,class:H(["symptomBox",{itemAlignRight:te===2||te===4||te===0||te===6,marginTop:te==4||te==5,marginBottom:te==2||te==3,marginRight:te===2||te===4||te===0||te===6,marginLeft:te===1||te===3||te===5||te===7}])},[(t(!0),i(w,null,P(Q,(Se,Ye)=>(t(),i("div",{class:H(["symptomItem",{selected:Se.active===!0}]),id:Se.value,key:Ye,onClick:ge=>Pe(Se,r)},S(Se.label),11,Xi))),128))],2))),128))]),Yi,Hi])]),_:2},1032,["onShow","onAfterLeave"])]),_:2},1032,["visible"]))],64)):(t(),b(T,{key:0,class:H({serious:r.serious=="1",checked:r.choosen===!0}),label:r.id},{default:u(()=>[z(S(r.optionName)+" ",1),r.serious=="0"?(t(),i("img",ki)):(t(),i("img",Li))]),_:2},1032,["class","label"]))],64))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1032,["label"])):x.titleName=="备注"?(t(),b(be,{key:1,label:x.titleName,width:"72px"},{default:u(()=>[J(d,{style:{width:"100px"},modelValue:x.cephalometricsContent,"onUpdate:modelValue":r=>x.cephalometricsContent=r,onBlur:r=>pe(x)},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),_:2},1032,["label"])):W("",!0)],64))),128))],64))),128))])])}}},Qi=Xe(zi,[["__scopeId","data-v-64a96104"]]);const Ki={class:"ortho-page"},ed={class:"header",style:{position:"relative"}},od={style:{display:"flex","justify-content":"center",flex:1}},td=["onClick"],sd={key:0,class:"step-num"},ad={key:1,style:{"margin-right":"12px"},src:Hs},nd={class:"information"},ld={class:"footer"},id={class:"desc"},dd={class:"desc uploadDesc"},rd=["href"],cd={key:0,style:{"margin-left":"20px"}},ud={class:"dialog-footer"},hd={__name:"index",setup(O){const y=Rs(),N=co(),R=N.params.appId,j=N.params.patientId,oe=[{num:1,desc:"基础信息"},{num:2,desc:"图像分析"},{num:3,desc:"模型分析"},{num:4,desc:"问题列表"},{num:5,desc:"方案目标"},{num:6,desc:"报告预览"}],q=I(0),X=[],E=I(null),ce=I(null),K=I(null),Y=I(null),U=I(null),m=I(null),G=C=>{if(C>q.value){Fe({message:"请点击下一步哦",type:"warning"});return}else F.value=C};Rt(()=>{X.push(E,ce,K,Y,U),document.querySelector(".ortho-page").addEventListener("mousewheel",function(d){d.deltaX!==0&&d.preventDefault()})});const fe=I(),_e=I(0),Ie=I(),ue=I(),pe=()=>{if(F.value==5&&!X[F.value-1].value.goalClicked&&!X[F.value-1].value.methodClicked)Fe("请检查目标和方法是否填写完毕哦");else if(F.value==5&&!X[F.value-1].value.goalClicked){Fe("请检查目标是否填写完毕哦");return}else if(F.value==5&&!X[F.value-1].value.methodClicked){Fe("请检查方法是否填写完毕哦");return}else io(()=>{q.value=F.value,F.value++,lo("/prod-api/business/orthBase",{id:we.value.id,pdfUrl:"",pdfTime:"",progress:F.value}),window.scrollTo(0,0)})},xe=C=>{var d;C&&((d=fe.value)==null||d.close(),lo("/prod-api/business/orthBase",{id:we.value.id,pdfUrl:C,pdfTime:qs(),progress:F.value}),Ie.value=C)},F=I(0),we=I();function me(){Te(`/prod-api/business/orthBase/${R}`).then(C=>{var d,D;C.code===200?(we.value=C.data,F.value=(d=C.data)!=null&&d.progress?C.data.progress:1,q.value=F.value,_e.value=(D=we.value)==null?void 0:D.id,we.value&&we.value.pdfUrl&&(sessionStorage.setItem(`pdfUrl${_e.value}`,we.value.pdfUrl),ue.value=`pdfUrl${_e.value}`,Ie.value=sessionStorage.getItem(`pdfUrl${_e.value}`),F.value=6)):F.value=2})}me();const Pe=()=>{if(F.value==4&&!X[F.value-1].value.clicked){Fe("还未填写诊断哦");return}io(()=>{q.value=F.value,F.value++,lo("/prod-api/business/orthBase",{id:we.value.id,pdfUrl:"",pdfTime:"",progress:F.value}),window.scrollTo(0,0)})},le=()=>{F.value!=1&&io(()=>{q.value=F.value,F.value--,lo("/prod-api/business/orthBase",{id:we.value.id,pdfUrl:"",pdfTime:"",progress:F.value}),window.scrollTo(0,0)})},ne=()=>{y.push("/index")},g=()=>{fetch(Ie.value).then(C=>C.blob()).then(C=>{const d=URL.createObjectURL(C),D=document.createElement("a");D.href=d,D.download="filename.pdf",D.click()})},ie=I(!1),v=I({});async function V(){ie.value=!0;const C=await ve("/prod-api/business/orthBase/selectOrthRisk",{patientId:j,apmtId:R});v.value=C.data,v.value.riskValueSystem="",v.value.riskValue=v.value.riskValue.split("")[0]}const _=I(!1);async function L(){const C=Bo.service({lock:!0,text:"确认审批中",background:"rgba(0, 0, 0, 0.7)"});v.value.pdfUrl=Ie.value;const d=await ve("/prod-api/business/orthBase/sendApproval",v.value);d.code==200&&(ie.value=!1,C.close(),Fe({message:d.msg,type:"success"}))}const T=()=>{y.push("/list")},ye=[{label:"患者姓名",value:"patientName"},{label:"病例号",value:"privateId"},{label:"诊所",value:"abbreviation"},{label:"牙列期",value:"dentitionType"},{label:"术前诊断",value:"diagnoseStr"},{label:"治疗目标",value:"targetStr"},{label:"治疗计划",value:"planStr"},{label:"矫正方案",value:"schemeStr"},{label:"病例风险（系统）",value:"riskValueSystem"},{label:"病历风险（自评）",value:"riskValue"},{label:"预计矫正周期",value:"correctionPeriod"},{label:"说明",value:"explain"}];return(C,d)=>{const D=Fs("ArrowLeft"),x=ys,r=Ys,Q=Et,te=Ts,Se=ro,Ye=St;return t(),i(w,null,[l("div",Ki,[l("div",ed,[l("div",{style:{display:"flex","align-items":"center","margin-right":"40px",cursor:"pointer",width:"100px","margin-left":"20px"},onClick:ne},[J(x,null,{default:u(()=>[J(D)]),_:1}),z("返回列表 ")]),l("div",od,[(t(),i(w,null,P(oe,ge=>l("div",{class:H(["step",{active:F.value===ge.num}]),onClick:Be=>G(ge.num),key:ge.num},[q.value<ge.num||F.value===ge.num?(t(),i("span",sd,S(ge.num),1)):q.value>=ge.num?(t(),i("img",ad)):W("",!0),l("span",{class:H(["step-text",{finished:F.value===ge.num||ge.num<=q.value}])},S(ge.desc),3),J(r,{class:H({finished:F.value===ge.num||ge.num<=q.value})},null,8,["class"])],10,td)),64))])]),l("div",nd,[F.value===1?(t(),b(Na,{key:0,pdfId:ue.value,ref_key:"step1",ref:E},null,8,["pdfId"])):W("",!0),F.value===2?(t(),b($l,{key:1,pdfId:ue.value,ref_key:"step2",ref:ce},null,8,["pdfId"])):W("",!0),F.value===3?(t(),b(Gl,{key:2,pdfId:ue.value,ref_key:"step3",ref:K},null,8,["pdfId"])):W("",!0),F.value===4?(t(),b(di,{key:3,pdfId:ue.value,ref_key:"step4",ref:Y},null,8,["pdfId"])):W("",!0),F.value===5?(t(),b(Qi,{key:4,id:_e.value,pdfId:ue.value,ref_key:"step5",ref:U},null,8,["id","pdfId"])):W("",!0),F.value===6?(t(),b(Ws,{key:5,onGetPdfResult:xe,id:_e.value,ref_key:"pdfComp",ref:m},null,8,["id"])):W("",!0)]),l("div",ld,[F.value>=2&&F.value<=5?(t(),b(Q,{key:0,onClick:le},{default:u(()=>[z("上一步")]),_:1})):W("",!0),F.value==6?(t(),b(Q,{key:1,onClick:g},{default:u(()=>[z(" 下载报告 ")]),_:1})):W("",!0),F.value<5?(t(),b(Q,{key:2,type:"primary",onClick:Pe},{default:u(()=>[z("下一步")]),_:1})):W("",!0),F.value==5?(t(),b(Q,{key:3,type:"primary",onClick:pe},{default:u(()=>[z("生成报告")]),_:1})):W("",!0),F.value==5&&_.value==!0?(t(),b(Q,{key:4,type:"primary",onClick:C.checkApproval},{default:u(()=>[z("查看审批流")]),_:1},8,["onClick"])):W("",!0),F.value==6?(t(),b(Q,{key:5,type:"primary",onClick:V},{default:u(()=>[z("发起审批")]),_:1})):W("",!0),F.value==6&&_.value==!0?(t(),b(Q,{key:6,type:"primary",onClick:T},{default:u(()=>[z("返回列表")]),_:1})):W("",!0)])]),J(Ye,{modelValue:ie.value,"onUpdate:modelValue":d[3]||(d[3]=ge=>ie.value=ge),title:"确认审批",class:"confirmApproval"},{footer:u(()=>[l("span",ud,[J(Q,{onClick:d[2]||(d[2]=ge=>ie.value=!1)},{default:u(()=>[z("取消")]),_:1}),J(Q,{type:"primary",onClick:L},{default:u(()=>[z(" 确认 ")]),_:1})])]),default:u(()=>[(t(),i(w,null,P(ye,(ge,Be)=>(t(),i(w,{key:ge.label},[Be<=6?(t(),b(be,{key:0,label:ge.label,width:"128px"},{default:u(()=>[l("span",id,S(v.value[ge.value]),1)]),_:2},1032,["label"])):W("",!0),Be==7?(t(),b(be,{key:1,label:ge.label,width:"128px"},{default:u(()=>[l("span",dd,[l("a",{href:Ie.value,target:"_blank"},S(Ie.value.split("/")[Ie.value.split("/").length-1]),9,rd)])]),_:2},1032,["label"])):Be==8?(t(),b(be,{key:2,label:ge.label,width:"128px"},{default:u(()=>[J(Se,{modelValue:v.value.riskValue,"onUpdate:modelValue":d[0]||(d[0]=ee=>v.value.riskValue=ee)},{default:u(()=>[(t(),i(w,null,P(["低","中","高"],(ee,Ge)=>J(te,{key:Ge,label:ee},null,8,["label"])),64))]),_:2},1032,["modelValue"]),v.value.ruleText?(t(),i("span",cd,"风险规则说明："+S(v.value.ruleText),1)):W("",!0)]),_:2},1032,["label"])):Be==9?(t(),b(be,{key:3,label:ge.label,width:"128px"},{default:u(()=>[J(Se,{modelValue:v.value.riskValueSystem,"onUpdate:modelValue":d[1]||(d[1]=ee=>v.value.riskValueSystem=ee)},{default:u(()=>[(t(),i(w,null,P(["低","中","高"],(ee,Ge)=>J(te,{key:Ge,label:ee},null,8,["label"])),64))]),_:2},1032,["modelValue"])]),_:2},1032,["label"])):Be==10?(t(),b(be,{key:4,label:ge.label,width:"128px"},{default:u(()=>[z(S(v.value.correctionPeriod?v.value.correctionPeriod+"个月":""),1)]),_:2},1032,["label"])):Be==11?(t(),b(be,{key:5,label:ge.label,width:"128px"},{default:u(()=>[z(S(v.value.explain),1)]),_:2},1032,["label"])):W("",!0)],64))),64))]),_:1},8,["modelValue"])],64)}}},Nd=Xe(hd,[["__scopeId","data-v-c8175842"]]);export{Nd as default};
