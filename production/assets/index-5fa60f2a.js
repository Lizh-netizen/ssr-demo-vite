/* empty css             */import{H as Ue,f as _e,_ as Pe,a as Me,u as xe,E as mo,b as lo,c as Go,G as Zo,d as qt,i as Pt,I as Mt,e as Jo,g as Ts,h as $s,j as Vs,p as Ce,k as Us,l as Gt,m as Ss,n as Os,o as Es,q as Ps,r as Ms}from"./flag-e67bad97.js";import{a as No,b as To,E as Zt}from"./el-button-71c4ff3c.js";/* empty css                */import{f as Xo,E as Jt}from"./el-popper-c37ee595.js";import{E as Xt,a as Yt}from"./el-select-58bdb205.js";import{b as As,d as Ds,a as zt,u as Fs,c as Ht,o as t,k as a,n as z,l as Be,r as Qt,q as R,p as fo,_ as Bs,y as Rs,am as me,C as y,ap as io,I as j,m as r,t as P,v as h,Y as N,a6 as U,s as L,W as J,L as no,an as we,aj as ro,ak as uo,F as Yo,K as xo,ai as js,$ as At,G as Kt,aq as Ws,a4 as Je,a5 as po,ar as qs,w as Gs,ao as Fe,as as Zs,at as ao,au as Dt,av as Js,V as Xs,al as Ys,S as zs,E as Hs}from"./index-caa48956.js";import{_ as Ge}from"./_plugin-vue_export-helper-c27b6911.js";import"./el-tooltip-4ed993c7.js";import{E as Bo}from"./index-15658ff3.js";import{p as Qs}from"./pdf1-6c6cf83b.js";import{f as Ks}from"./formatTime-47d7a857.js";import"./_commonjsHelpers-de833af9.js";/* empty css                                                                   */const ea=As({direction:{type:String,values:["horizontal","vertical"],default:"horizontal"},contentPosition:{type:String,values:["left","center","right"],default:"center"},borderStyle:{type:Ds(String),default:"solid"}}),oa=zt({name:"ElDivider"}),ta=zt({...oa,props:ea,setup(C){const p=C,I=Fs("divider"),v=Ht(()=>I.cssVar({"border-style":p.borderStyle}));return(O,Z)=>(t(),a("div",{class:z([Be(I).b(),Be(I).m(O.direction)]),style:fo(Be(v)),role:"separator"},[O.$slots.default&&O.direction!=="vertical"?(t(),a("div",{key:0,class:z([Be(I).e("text"),Be(I).is(O.contentPosition)])},[Qt(O.$slots,"default")],2)):R("v-if",!0)],6))}});var sa=Bs(ta,[["__file","/home/runner/work/element-plus/element-plus/packages/components/divider/src/divider.vue"]]);const aa=Rs(sa);const na="/assets/Steps-37dd4960.svg",vo=(C,p,I,v,O)=>{var Z,Y,W;if(p.titleName=="关节弹响"){if(((Z=p.orthOptionsList.find(q=>q.id==C))==null?void 0:Z.optionName)=="弹响"){v.value=!0;return}if(C==10){v.value=!1,p.otherContent="",O.value.orthTitleList.forEach(A=>{A.titleName=="关节弹响"?(A.optionId=10,A.text="",A.selectId=""):A.titleName=="侧关节"&&(A.optionId=[],A.text="",A.showInput=!1,A.selectId1="",A.selectId2="")});const q=O.value.orthTitleList.find(A=>A.titleName=="侧关节");let re={apmtId:I,titleId:q.id,optionsIdStr:[],otherContent:"",cephalometricsContent:"",fdiToothCode:"",showPosition:""};me("/prod-api/business/optionsResult",re)}}else if(p.titleName=="骨龄"&&(((Y=p.orthOptionsList.find(q=>q.id==C))==null?void 0:Y.optionName)=="骨龄超"||((W=p.orthOptionsList.find(q=>q.id==C))==null?void 0:W.optionName)=="骨龄晚")){p.orthOptionsList.forEach(q=>{q.id==C?(q.clicked=!0,q.visible=!0):q.clicked=!1});return}p.type==2&&(p.optionId1.includes(10)&&p.optionId1.length<p.optionId.length?(p.optionId1=p.optionId.filter(q=>q!==10),p.optionId=p.optionId1):!p.optionId1.includes(10)&&p.optionId1.length<p.optionId.length&&p.optionId.includes(10)&&(p.optionId1=[10],p.optionId=[10],p.otherContent=""),p.orthOptionsList.forEach(q=>{p.optionId.includes(q.id)?q.choosen=!0:q.choosen=!1})),p.type==1&&(p.orthOptionsList.forEach(q=>{C!==q.id?q.choosen=!1:q.choosen=!0}),(p.titleName=="面中三分之一"||p.titleName=="面下三分之一"||p.titleName=="正貌")&&p.aiFlag=="1"&&(p.aiFlag="0"))};const $o=C=>(ro("data-v-18146a02"),C=C(),uo(),C),la={class:"stepOne"},ia={class:"patientInfo"},da={class:"patientInfo__item"},ra=$o(()=>r("span",{class:"patientInfo__item__desc"},"患者姓名",-1)),ua={class:"patientInfo__item__detail"},ca={class:"patientInfo__item"},ha=$o(()=>r("span",{class:"patientInfo__item__desc"},"病例号",-1)),pa={class:"patientInfo__item__detail"},fa={class:"patientInfo__item"},ma=$o(()=>r("span",{class:"patientInfo__item__desc"},"性别",-1)),va={class:"patientInfo__item__detail"},_a={class:"patientInfo__item"},ga=$o(()=>r("span",{class:"patientInfo__item__desc"},"生日",-1)),ya={class:"patientInfo__item__detail"},Ia={class:"content inquiry",style:{"min-height":"600px"}},ba={class:"innerContent content"},Ca={key:0,src:Pe},ka={key:1,src:Me},La={key:1,style:{display:"flex"}},wa={class:"content"},xa={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",fill:`
                              none
                            `,version:"1.1",width:"9.999975204467773",height:"9.999975204467773",viewBox:"0 0 9.999975204467773 9.999975204467773"},Na=["fill"],Ta={key:0,src:Pe},$a={key:1,src:Me},Va={key:1,style:{display:"inline-flex"}},Ua={class:"specialTitle"},Sa={key:2,style:{display:"inline-flex"}},Oa={class:"specialTitle side"},Ea={__name:"stepOne",props:{pdfId:String},setup(C,{expose:p}){const I=y(!1);p({clicked:I});const v=C,O=y(""),Z=y(""),Y=io(),W=Y.params.appId,q=Y.params.patientId,re=oe=>{oe.otherContent&&(oe.visible=!0),oe.hover=!0};let A;const D=oe=>{oe.hover=!1,A=setTimeout(()=>{oe.visible=!1},300);const ce=document.querySelectorAll(".myPopper");Array.from(ce).forEach(w=>{w.addEventListener("mouseenter",()=>{clearTimeout(A)})})};async function g(oe,ce,w){w.visible=!1,w.otherContent?(await xe(oe,ce,w.otherContent,W)).code==200&ce.titleName=="骨龄"&&G():(ce.optionId="",no(()=>{ce.orthOptionsList.forEach(te=>te.clicked=!1)}))}const u=y({});async function X(){const oe=await we(`prod-api/business/patient/ljPatient/${q}`);u.value=oe.data,sessionStorage.setItem("name",u.value.Name)}X();const H=y([]);async function ue(){const oe=await we(`/prod-api/business/orthClass/list/2/问诊/${W}`);H.value=oe.data,oe.data.forEach(ce=>ce.orthTitleList.forEach(w=>w.showInput=!1)),oe.data.forEach(ce=>{ce.orthTitleList.forEach(w=>{if(w.orthOptionsList[w.orthOptionsList.length-1].otherContent&&(w.otherContent=w.orthOptionsList[w.orthOptionsList.length-1].otherContent),w.type==1){w.optionId="",w.text="",w.showInput=!1;const te=w.orthOptionsList.filter(se=>se.choosen===!0);te.length>0&&(w.optionId=te[0].id)}else if(w.type==2){w.optionId=[],w.optionId1=[],w.text="",w.showInput=!1;const te=w.orthOptionsList.filter(se=>se.choosen===!0);te.length>0&&(w.optionId=te.map(se=>se.id),w.optionId1=w.optionId)}})})}ue();const ne=y({}),le=y([]);async function G(){const oe=await we(`/prod-api/business/orthClass/list/2/临床检查/${W}`);ne.value=oe.data[0],oe.data.forEach(ce=>{ce.orthTitleList.forEach(w=>w.showInput=!1)}),oe.data.forEach(ce=>{ce.orthTitleList.forEach(w=>{if(w.orthOptionsList[w.orthOptionsList.length-1].otherContent&&(w.otherContent=w.orthOptionsList[w.orthOptionsList.length-1].otherContent),w.titleName=="关节弹响"){w.optionId="",w.text="",w.showInput=!1,w.selectId="";const te=w.orthOptionsList.filter(se=>se.choosen===!0);if(te.length>0){w.optionId=te[0].id,Ne.value=w.optionId!==10;const se=w.listMap.filter(ge=>ge.choosen===!0);se.length>0&&(w.selectId=se[0].id)}}else if(w.titleName=="侧关节"){w.optionId=[],w.text="",w.showInput=!1,w.selectId1="",w.selectId2="";const te=w.orthOptionsList.filter(ge=>ge.choosen===!0);te.length>0&&(w.selectId1=te[0].id);const se=w.listMap.filter(ge=>ge.choosen===!0);se.length>0&&(w.selectId2=se[0].id)}else if(w.titleName=="骨龄"){w.optionId="",w.text="",w.showInput=!1,w.selectId1="",w.selectId2="",le.value=w.orthOptionsList.filter(se=>se.optionName==="骨龄超"||se.optionName==="骨龄晚").map(()=>y(null)),w.orthOptionsList.forEach(se=>{(se.optionName==="骨龄超"||se.optionName==="骨龄晚")&&(se.fillColor="#C9CDD4",se.seriousColor="#f44c4c",se.hoverColor="#2e6ce4",se.clicked=!!se.choosen,se.visible=!1)});const te=w.orthOptionsList.filter(se=>se.choosen===!0);te.length>0&&(w.optionId=te[0].id)}else if(w.type==1){w.optionId="",w.text="",w.showInput=!1;const te=w.orthOptionsList.filter(se=>se.choosen===!0);te.length>0&&(w.optionId=te[0].id)}else if(w.type==2){w.optionId=[],w.optionId1=[],w.text="",w.showInput=!1;const te=w.orthOptionsList.filter(se=>se.choosen===!0);te.length>0&&(w.optionId=te.map(se=>se.id),w.optionId1=w.optionId)}})})}G();const Ne=y(!1);async function Se(oe,ce){I.value=!0,v.pdfId&&sessionStorage.removeItem(v.pdfId),vo(oe,ce,W,Ne,ne),(await xe(ce.optionId,ce,"",W)).code==200&ce.titleName=="骨龄"}const Q=oe=>{le.value[oe].value[0].input.value||le.value[oe].value[0].focus()};async function ke(oe,ce){if(ce.titleName=="关节弹响"){let w={apmtId:W,titleId:ce.id,optionsIdStr:[oe.optionId,oe.selectId],otherContent:"",cephalometricsContent:"",fdiToothCode:"",showPosition:""};await me("/prod-api/business/optionsResult",w)}if(ce.titleName=="侧关节"){let w={apmtId:W,titleId:ce.id,optionsIdStr:oe.selectId2==""?[oe.selectId1]:[oe.selectId1,oe.selectId2],otherContent:"",cephalometricsContent:"",fdiToothCode:"",showPosition:""};await me("/prod-api/business/optionsResult",w)}}const pe=(oe,ce)=>{xe(oe,ce,"",W)};return(oe,ce)=>{const w=Xo,te=mo,se=lo,ge=No,fe=To,Xe=Go,T=Xt,V=Yt;return t(),a("div",la,[j(Ue,{text:"患者信息",backgroundColor:"#f4f7fd"}),r("div",ia,[r("div",da,[ra,r("span",ua,P(u.value.Name),1)]),r("div",ca,[ha,r("span",pa,P(u.value.PrivateId),1)]),r("div",fa,[ma,r("span",va,P(u.value.Sex===1?"男":u.value.Sex===2?"女":"未知"),1)]),r("div",_a,[ga,r("span",ya,P(u.value.age),1)])]),j(Ue,{text:"问诊",backgroundColor:"#f4f7fd"}),r("div",Ia,[j(_e,{label:"主诉",width:"58px"},{default:h(()=>[j(w,{modelValue:O.value,"onUpdate:modelValue":ce[0]||(ce[0]=l=>O.value=l)},null,8,["modelValue"])]),_:1}),j(_e,{label:"现病史",width:"58px"},{default:h(()=>[j(w,{modelValue:Z.value,"onUpdate:modelValue":ce[1]||(ce[1]=l=>Z.value=l)},null,8,["modelValue"])]),_:1}),(t(!0),a(N,null,U(H.value,l=>(t(),a(N,{key:l.id},[l.className?(t(),L(_e,{key:0,label:l.className,class:"specialFormItem"},{default:h(()=>[r("div",ba,[(t(!0),a(N,null,U(l.orthTitleList,d=>(t(),L(_e,{label:d.titleName,width:"100px",key:d.id},{default:h(()=>[d.type==1?(t(),L(se,{key:0,modelValue:d.optionId,"onUpdate:modelValue":c=>d.optionId=c,onChange:c=>Se(d.optionId,d)},{default:h(()=>[(t(!0),a(N,null,U(d.orthOptionsList,c=>(t(),L(te,{class:z({serious:c.serious=="1",checked:c.choosen===!0}),key:c.id,label:c.id},{default:h(()=>[J(P(c.optionName),1)]),_:2},1032,["class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):R("",!0),d.type==2?(t(),L(fe,{key:1,modelValue:d.optionId,"onUpdate:modelValue":c=>d.optionId=c,onChange:c=>Se(d.optionId,d)},{default:h(()=>[(t(!0),a(N,null,U(d.orthOptionsList,c=>(t(),L(ge,{class:z({serious:c.serious=="1",checked:c.choosen===!0}),key:c.id,label:c.id},{default:h(()=>[J(P(c.optionName)+" ",1),c.serious=="0"?(t(),a("img",Ca)):(t(),a("img",ka))]),_:2},1032,["class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):R("",!0),d.optionId.constructor===Array&&d.optionId.includes(9)||d.optionId==9?(t(),L(w,{key:2,placeholder:"请输入",modelValue:d.otherContent,"onUpdate:modelValue":c=>d.otherContent=c,onBlur:c=>pe(d.optionId,d)},null,8,["modelValue","onUpdate:modelValue","onBlur"])):R("",!0)]),_:2},1032,["label"]))),128))])]),_:2},1032,["label"])):(t(),a("div",La,[(t(!0),a(N,null,U(l.orthTitleList,d=>(t(),L(_e,{label:d.titleName,width:"100px",key:d.id},{default:h(()=>[j(se,{modelValue:d.optionId,"onUpdate:modelValue":c=>d.optionId=c,onChange:c=>Se(d.optionId,d)},{default:h(()=>[(t(!0),a(N,null,U(d.orthOptionsList,c=>(t(),L(te,{key:c.id,label:c.id,class:z({serious:c.serious=="1",checked:c.choosen===!0})},{default:h(()=>[J(P(c.optionName),1)]),_:2},1032,["label","class"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1032,["label"]))),128))]))],64))),128))]),j(Ue,{text:"临床检查",backgroundColor:"#f4f7fd"}),r("div",wa,[(t(!0),a(N,null,U(ne.value.orthTitleList,l=>(t(),a(N,{key:l.id},[l.titleName!=="关节弹响"&&l.titleName!=="侧关节"?(t(),L(_e,{key:0,label:l.titleName,width:"100px"},{default:h(()=>[l.type==1?(t(),L(se,{key:0,modelValue:l.optionId,"onUpdate:modelValue":d=>l.optionId=d,onChange:d=>Se(l.optionId,l)},{default:h(()=>[(t(!0),a(N,null,U(l.orthOptionsList,(d,c)=>(t(),a(N,{key:d.id},[d.optionSuffix?(t(),L(Xe,{key:1,"popper-class":"myPopper","popper-style":{width:"auto","min-width":"100px"},placement:"top-start",width:200,visible:d.visible,onShow:ie=>Q(c-2)},{reference:h(()=>[j(te,{class:z({serious:d.serious=="1",checked:d.choosen===!0}),label:d.id,onMouseenter:ie=>re(d),onMouseleave:ie=>D(d)},{default:h(()=>[J(P(d.optionName),1),(t(),a("svg",xa,[r("g",null,[r("path",{d:"M0,4.99999C0,2.23857,2.23857,0,4.99999,0C7.76141,0,9.99998,2.23857,9.99998,4.99999C9.99998,7.76141,7.76141,9.99998,4.99999,9.99998C2.23857,9.99998,0,7.76141,0,4.99999C0,4.99999,0,4.99999,0,4.99999ZM5.49999,3.49999C5.49999,3.49999,5.49999,2.49999,5.49999,2.49999C5.49999,2.49999,4.49999,2.49999,4.49999,2.49999C4.49999,2.49999,4.49999,3.49999,4.49999,3.49999C4.49999,3.49999,5.49999,3.49999,5.49999,3.49999C5.49999,3.49999,5.49999,3.49999,5.49999,3.49999ZM4.49999,3.99999C4.49999,3.99999,4.49999,7.49998,4.49999,7.49998C4.49999,7.49998,5.49999,7.49998,5.49999,7.49998C5.49999,7.49998,5.49999,3.99999,5.49999,3.99999C5.49999,3.99999,4.49999,3.99999,4.49999,3.99999C4.49999,3.99999,4.49999,3.99999,4.49999,3.99999Z","fill-rule":"evenodd",fill:d.clicked?d.seriousColor:d.hover?d.hoverColor:d.fillColor,"fill-opacity":"1"},null,8,Na)])]))]),_:2},1032,["class","label","onMouseenter","onMouseleave"])]),default:h(()=>{var ie;return[j(w,{maxlength:"2",ref_for:!0,ref:le.value[c-2],modelValue:d.otherContent,"onUpdate:modelValue":ye=>d.otherContent=ye,onBlur:ye=>g(l.optionId,l,d),class:z({borderless:d.otherContent})},null,8,["modelValue","onUpdate:modelValue","onBlur","class"]),J(P((ie=d.optionSuffix)==null?void 0:ie.substr(-1)),1)]}),_:2},1032,["visible","onShow"])):(t(),L(te,{key:0,class:z({serious:d.serious=="1"}),label:d.id},{default:h(()=>[J(P(d.optionName),1)]),_:2},1032,["class","label"]))],64))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):R("",!0),l.type==2?(t(),L(fe,{key:1,modelValue:l.optionId,"onUpdate:modelValue":d=>l.optionId=d,onChange:d=>Se(l.optionId,l)},{default:h(()=>[(t(!0),a(N,null,U(l.orthOptionsList,d=>(t(),L(ge,{class:z({serious:d.serious=="1",checked:d.choosen===!0}),key:d.id,label:d.id},{default:h(()=>[J(P(d.optionName)+" ",1),d.serious=="0"?(t(),a("img",Ta)):(t(),a("img",$a))]),_:2},1032,["class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):R("",!0),l.optionId.constructor===Array&&l.optionId.includes(9)||l.optionId==9?(t(),L(w,{key:2,placeholder:"请输入",modelValue:l.otherContent,"onUpdate:modelValue":d=>l.otherContent=d,onBlur:d=>pe(l.optionId,l)},null,8,["modelValue","onUpdate:modelValue","onBlur"])):R("",!0)]),_:2},1032,["label"])):R("",!0),l.titleName=="关节弹响"?(t(),a("div",Va,[r("div",Ua,P(l.titleName),1),j(se,{class:"specialRadio",modelValue:l.optionId,"onUpdate:modelValue":d=>l.optionId=d,onChange:d=>Se(l.optionId,l)},{default:h(()=>[(t(!0),a(N,null,U(l.orthOptionsList,d=>(t(),L(te,{class:z({serious:d.serious=="1",checked:d.choosen===!0}),key:d.id,label:d.id},{default:h(()=>[J(P(d.optionName),1)]),_:2},1032,["class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),Ne.value?(t(),L(V,{key:0,modelValue:l.selectId,"onUpdate:modelValue":d=>l.selectId=d,class:"specialSelect",onChange:d=>ke(l,l)},{default:h(()=>[(t(!0),a(N,null,U(l.listMap,d=>(t(),L(T,{key:d.id,label:d.optionName,value:d.id},{default:h(()=>[J(P(d.optionName),1)]),_:2},1032,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):R("",!0)])):R("",!0),Ne.value&&l.titleName=="侧关节"?(t(),a("div",Sa,[r("div",Oa,P(l.titleName),1),j(V,{modelValue:l.selectId1,"onUpdate:modelValue":d=>l.selectId1=d,class:"specialSelect",onChange:d=>ke(l,l)},{default:h(()=>[(t(!0),a(N,null,U(l.orthOptionsList,d=>(t(),L(T,{key:d.id,label:d.optionName,value:d.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),j(V,{modelValue:l.selectId2,"onUpdate:modelValue":d=>l.selectId2=d,class:"specialSelect",onChange:d=>ke(l,l)},{default:h(()=>[(t(!0),a(N,null,U(l.listMap,d=>(t(),L(T,{key:d.id,label:d.optionName,value:d.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])])):R("",!0)],64))),128))])])}}},Pa=Ge(Ea,[["__scopeId","data-v-18146a02"]]);const es=C=>(ro("data-v-0c808553"),C=C(),uo(),C),Ma={class:"diagram"},Aa={class:"diagramBox"},Da={class:"toothItem1"},Fa={class:"toothItem2"},Ba={class:"diagramBox"},Ra={class:"toothItem3"},ja={class:"toothItem4"},Wa={class:"selectContainer",id:"selectContainer"},qa={class:"container"},Ga=["id","onClick"],Za=es(()=>r("div",{class:"left"},"右",-1)),Ja=es(()=>r("div",{class:"right"},"左",-1)),Xa={__name:"tooth",props:["title","appId","data","step"],emits:["submitTooth"],setup(C,{emit:p}){const I=C,v=p,O=y(I.title),Z=y(I.data);Yo(()=>I.title,g=>{O.value=g});const Y=y([]);Y.value=Zo();const W=g=>{Y.value.forEach(u=>{u.forEach(X=>{var H;X.active=!1,(H=g.toothCode)!=null&&H.includes(X.value+"")&&(X.active=!0)})})},q=(g,u)=>{qt(g,u)},re=g=>{if(I.step==2){if(!g.submitAble)return;let u={apmtId:I.appId,titleId:g.id,optionsIdStr:[],otherContent:"",cephalometricsContent:"",fdiToothCode:g.toothCode.join(),showPosition:JSON.stringify(g.position)};me("/prod-api/business/optionsResult",u).then(()=>{g.submitAble=!1})}else v("submitTooth",g)},A=(g,u)=>{if(u.hasImage)u.orthTitleList.forEach(X=>{g!==X&&(X.popVisible=!1)}),g.popVisible=!g.popVisible;else return},D=(g,u)=>{A(g,u)};return(g,u)=>{const X=Go;return t(),L(X,{width:490,visible:O.value.popVisible,onShow:u[1]||(u[1]=H=>W(O.value)),onAfterLeave:u[2]||(u[2]=H=>re(O.value))},{reference:h(()=>{var H,ue,ne,le;return[r("div",{class:"diagramWrapper",onClick:u[0]||(u[0]=xo(G=>D(O.value,Z.value),["stop"]))},[r("div",Ma,[r("div",Aa,[r("div",Da,P((H=O.value.topLeft)==null?void 0:H.sort((G,Ne)=>G.sort-Ne.sort).map(G=>G.value).join("")),1),r("div",Fa,P((ue=O.value.topRight)==null?void 0:ue.sort((G,Ne)=>G.sort-Ne.sort).map(G=>G.value).join("")),1)]),r("div",Ba,[r("div",Ra,P((ne=O.value.bottomLeft)==null?void 0:ne.sort((G,Ne)=>G.sort-Ne.sort).map(G=>G.value).join("")),1),r("div",ja,P((le=O.value.bottomRight)==null?void 0:le.sort((G,Ne)=>G.sort-Ne.sort).map(G=>G.value).join("")),1)])])])]}),default:h(()=>[r("div",Wa,[r("div",qa,[(t(!0),a(N,null,U(Y.value,(H,ue)=>(t(),a("div",{key:ue,class:z(["symptomBox",{itemAlignRight:ue===2||ue===4||ue===0||ue===6,marginTop:ue==4||ue==5,marginBottom:ue==2||ue==3,marginRight:ue===2||ue===4||ue===0||ue===6,marginLeft:ue===1||ue===3||ue===5||ue===7}])},[(t(!0),a(N,null,U(H,(ne,le)=>(t(),a("div",{class:z(["symptomItem",{selected:ne.active===!0}]),id:ne.value,key:le,onClick:xo(G=>q(ne,O.value),["stop"])},P(ne.label),11,Ga))),128))],2))),128))]),Za,Ja])]),_:1},8,["visible"])}}},Ro=Ge(Xa,[["__scopeId","data-v-0c808553"]]),Ya="/assets/arrange-8ba5d6cc.svg",za="/assets/AIFlagForFront-be72ba22.svg",Ha="/assets/AI-1752b7a7.svg",Qa="/assets/downwards-554b1728.svg",Ka="/assets/upwards-d82d8d75.svg",en="/assets/close-3d4ba752.svg";function wo(C,p){let I;C.includes("-")?I=C.split("-").filter(u=>u!=="-"):I=C.split("");const v=p.find(u=>I[0]==="Na"?u.label=="N":u.label==I[0]),O=p.find(u=>u.label==I[1]),Z=p.find(u=>u.label==I[2]),Y={x:O.x-v.x,y:O.y-v.y},W={x:Z.x-O.x,y:Z.y-O.y},q=Math.sqrt(Y.x*Y.x+Y.y*Y.y),re=Math.sqrt(W.x*W.x+W.y*W.y),A=Y.x*W.x+Y.y*W.y;return 180-Math.acos(A/(q*re))*180/Math.PI}function Ao(C,p){const I=C.split("/"),v=I[0],O=I[1],Z=Ft(v,p),Y=Ft(O,p);return Z/(Y!==0?Y:1)*100}function Ft(C,p){let I;C.includes("-")?I=C.split("-").filter(q=>q!=="-"):I=C.split("");const v=p.find(q=>q.label==I[0]),O=p.find(q=>q.label==I[1]),Z=O.x-v.x,Y=O.y-v.y;return Math.sqrt(Z*Z+Y*Y)}function Do(C,p){let I,v,O,Z;C=="U1-SN"&&(I=p.find(u=>u.label=="UI"),v=p.find(u=>u.label=="UI_1"),O=p.find(u=>u.label=="S"),Z=p.find(u=>u.label=="N")),C=="SN-MP"&&(I=p.find(u=>u.label=="S"),v=p.find(u=>u.label=="N"),O=p.find(u=>u.label=="Go_1"),Z=p.find(u=>u.label=="Me")),C=="L1-MP"&&(I=p.find(u=>u.label=="LI"),v=p.find(u=>u.label=="LI_1"),O=p.find(u=>u.label=="Go_1"),Z=p.find(u=>u.label=="Me")),C=="FH-MP"&&(I=p.find(u=>u.label=="P"),v=p.find(u=>u.label=="Or"),O=p.find(u=>u.label=="Go_1"),Z=p.find(u=>u.label=="Me")),C=="ODI"&&(I=p.find(u=>u.label=="A"),v=p.find(u=>u.label=="B"),O=p.find(u=>u.label=="Go"),Z=p.find(u=>u.label=="Gn")),C=="APDIAngle1"&&(I=p.find(u=>u.label=="N"),v=p.find(u=>u.label=="P"),O=p.find(u=>u.label=="P"),Z=p.find(u=>u.label=="Or")),C=="APDIAngle2"&&(I=p.find(u=>u.label=="A"),v=p.find(u=>u.label=="B"),O=p.find(u=>u.label=="N"),Z=p.find(u=>u.label=="P"));const Y={x:v.x-I.x,y:v.y-I.y},W={x:Z.x-O.x,y:Z.y-O.y},q=Y.x*W.x+Y.y*W.y,re=Math.sqrt(Y.x**2+Y.y**2),A=Math.sqrt(W.x**2+W.y**2);return Math.acos(q/(re*A))*(180/Math.PI)}function Bt(C,p,I){const v={x:I.x-p.x,y:I.y-p.y},O={x:C.x-p.x,y:C.y-p.y},Z=(O.x*v.x+O.y*v.y)/(v.x*v.x+v.y*v.y),Y=p.x+Z*v.x,W=p.y+Z*v.y;return{x:Y,y:W}}function jo(C,p,I,v,O,Z,Y){const W={x:(O.x+Z.x)/2,y:(O.y+Z.y)/2},q={x:(I.x+v.x)/2,y:(I.y+v.y)/2},re=Bt(C,W,q),A=Bt(p,W,q),D=A.x-re.x,g=A.y-re.y,u=Math.sqrt(D*D+g*g);return A.x>re.x?u*20/Y:-u*20/Y}jo({x:1,y:2},{x:-1,y:-2},{x:2,y:1},{x:2,y:-1},{x:-2,y:-1},{x:-2,y:1});function Fo(C,p,I){const v=Math.sqrt(Math.pow(p.x-I.x,2)+Math.pow(p.y-I.y,2)),O={x:p.x-C.x,y:p.y-C.y},Z={x:I.x-C.x,y:I.y-C.y};return Math.abs((O.x*Z.y-O.y*Z.x)/v)}function Wo(C,p){const I=p.x-C.x,v=p.y-C.y;return Math.sqrt(I*I+v*v)}function Rt(C){const p=C.find(v=>v.label=="forehead_center"),I=C.find(v=>v.label=="chin_2");return Wo(p,I)/3}function qo(C){C.topLeft=[],C.topRight=[],C.bottomLeft=[],C.bottomRight=[];const p=JSON.parse(C.showPosition);C.fdiToothCode?(C.toothCode=C.fdiToothCode.split(","),C.fdiToothCode.split(",").forEach((I,v)=>{I.startsWith("1")||I.startsWith("5")?C.topLeft.push(p[v][0]):I.startsWith("2")||I.startsWith("6")?C.topRight.push(p[v][0]):I.startsWith("4")||I.startsWith("8")?C.bottomLeft.push(p[v][0]):(I.startsWith("3")||I.startsWith("7"))&&C.bottomRight.push(p[v][0])})):C.toothCode=[],C.position=p||[],C.submitAble=!1}const je=C=>(ro("data-v-924231b7"),C=C(),uo(),C),on={class:"stepTwo"},tn=je(()=>r("img",{src:Ya},null,-1)),sn={class:"content",style:{"min-height":"700px"}},an={key:0,id:"FrontalRose",width:"320",height:"240"},nn={key:1,style:{height:"240px","object-fit":"cover","max-width":"320px"}},ln=["onClick"],dn=["src"],rn={class:"aiFlagImg",src:za},un={key:0,src:Pe},cn={key:1,src:Me},hn={class:"content mouth"},pn={key:0,style:{width:"320px",height:"240px","object-fit":"cover","border-radius":"10px"}},fn=["onClick"],mn=["src"],vn=["src"],_n={key:0,src:Pe},gn={key:1,src:Me},yn={class:"content panoramic"},In=["src"],bn=["onClick"],Cn=["src"],kn={class:"imageItem__content specialComponent",style:{"min-width":"780px"}},Ln={class:"container"},wn={class:"left-column"},xn={key:0,src:Pe},Nn={key:1,src:Me},Tn={class:"right-column"},$n={key:0,src:Pe},Vn={key:1,src:Me},Un={class:"leftLower-column"},Sn={class:"leftLower-column"},On={class:"placeholderContainer"},En=["src"],Pn={class:"imageItem__content specialComponent cephalometric",style:{"min-width":"800px"}},Mn={key:0,class:"formItem"},An=["onMouseenter"],Dn={class:"formItem__content"},Fn={style:{width:"100px",display:"flex","align-items":"center"}},Bn={src:Qa},Rn={src:Ka},jn={key:1,class:"formItem"},Wn={class:"formItem__label"},qn=je(()=>r("img",{src:Jo,style:{opacity:"0"}},null,-1)),Gn={class:"formItem__content"},Zn={class:"imageManagement__images subSection"},Jn={class:"title"},Xn=je(()=>r("div",{class:"title__left"},"图库",-1)),Yn=je(()=>r("div",{class:"title__middle"},[r("img",{src:Ss,style:{"margin-right":"4px"}}),J(" 可直接拖拽照片到右侧指定位置或点击下方一键“自动分类”哦～ ")],-1)),zn={class:"title__right file-upload"},Hn={class:"file-upload__label"},Qn={style:{"padding-left":"14px","padding-bottom":"50px","padding-top":"50px"}},Kn={key:0,class:"imgContainer__empty",src:$s},el={class:"imgContainer"},ol=["onMouseenter","onMouseleave"],tl={style:{position:"relative",border:"1px solid #e5e6eb","border-radius":"12px"}},sl=["src","onDragstart","onClick"],al=["onClick"],nl=je(()=>r("span",null,"加载上次影像",-1)),ll=je(()=>r("img",{src:Os},null,-1)),il=[nl,ll],dl={class:"classifyWrapper"},rl={style:{"margin-right":"6px"}},ul={class:"imageManagement__classify subSection"},cl=je(()=>r("div",{class:"title"},"分类",-1)),hl={class:"imageWrapper"},pl=["onMouseenter","onMouseleave"],fl={style:{position:"relative",border:"1px solid #e5e6eb","border-radius":"12px",overflow:"hidden",height:"80px"}},ml=["src","onDrop","onDragover","onDragstart"],vl={key:0,style:{cursor:"pointer"},class:"deleteImage",src:Vs},_l={class:"item__caption"},gl={class:"dialog-footer"},yl=je(()=>r("div",{class:"overlay__header"},null,-1)),Il=je(()=>r("div",{class:"overlay__mask"},null,-1)),bl=["src"],Cl=je(()=>r("img",{id:"img",style:{opacity:0}},null,-1)),jt=665/390,kl={__name:"stepTwo",props:{pdfId:String,active:Number},setup(C,{expose:p}){const I=io(),v=I.params.appId,O=I.params.patientId;js(()=>{const e=document.createElement("link");e.href=Pt,e.rel="preload",e.as="image",document.head.appendChild(e)});const Z=y(!1);p({clicked:Z});const Y=C,W=y(!1),q=()=>{Qe.value.style.display="flex",W.value=!0},re=()=>{Qe.value.style.display="none",W.value=!1},A=y(window.innerWidth-900),D=y((A.value/jt).toFixed(2));window.addEventListener("resize",()=>{if(window.innerWidth<1080)return;document.getElementById("myCanvas")&&(A.value=window.innerWidth-900,D.value=(A.value/jt).toFixed(2),K.value=Te.value.map(s=>({label:s.label,x:s.x*A.value,y:s.y*D.value})),to(A.value,D.value,!0))});const g=y([]),u=y([]),X=y([]),H=new FormData;g.value=Zo();const ue=y(!1),ne=e=>{const s=e.target.files;if(s.length>16)e.preventDefault(),Fe("最多上传16张图片");else{for(let o=0;o<s.length;o++){const n=s[o];if(H.append("files",n),n){const i=new FileReader;i.onload=()=>{u.value.push(i.result),X.value.push({imgUrl:i.result,showFlag:!1,choose:!0,file:n})},i.readAsDataURL(n)}}ue.value?pe.value[0].imageList=X.value:(pe.value.unshift({file:!0,StartTime:"2023-8-14",imageList:X.value}),ue.value=!0)}},le=e=>{e.measured=!0,e.cephalometricsContent!==e.AIValue&&(e.aiFlag="0");let s={apmtId:v,titleId:e.id,optionsIdStr:[],otherContent:"",cephalometricsContent:e.cephalometricsContent?e.cephalometricsContent:"",fdiToothCode:"",showPosition:""};me("/prod-api/business/optionsResult",s).then(o=>{if(o.code==200&&o.data.optionsId){e.optionId=o.data.optionsId;let n={apmtId:v,titleId:e.id,optionsIdStr:[o.data.optionsId],otherContent:"",cephalometricsContent:"",fdiToothCode:"",showPosition:""};e.inputVal=e.cephalometricsContent,me("/prod-api/business/optionsResult",n),me("/prod-api/business/optionsResult/updateAIType",{apmtId:v,cephalometricsList:[{titleId:e.id,aiType:2}]})}else o.code==500&&o.msg&&(e.cephalometricsContent=e.inputVal,Fe({type:"error",message:o.msg}))})},G=()=>{},Ne=Ht(()=>{let e=0;return pe.value.forEach(s=>{s.imageList.forEach(o=>{o.choose&&e++})}),e}),Se=e=>{e.choose=!e.choose},Q=e=>{e.id?Zs(`/prod-api/business/orthImage/${e.id}`).then(s=>{if(s.code==200){const o=te.value.find(n=>e==n);o.fileUrl=Ce,o.id=void 0}}):e.fileUrl=Ce},ke=y(0),pe=y([]),oe=y([]),ce=()=>{oo.value=!0,te.value.forEach(e=>{e.fileUrl=Ce}),Eo()},w=()=>{if(pe.value.length<oe.value.length){oe.value[pe.value.length].imageList.forEach(s=>{s.imgUrl=s.fileUrl});const e=oe.value.slice(ke.value+1).find(s=>s.imageList.length!==0);e?(pe.value.push(e),ke.value=oe.value.findIndex(s=>s==pe.value[pe.value.length-1]),pe.value[pe.value.length-1].imageList.forEach(s=>{s.imgUrl=s.fileUrl})):Fe("没有更多图像了哦")}},te=y([{caption:"正面像",typeName:"FrontalRepose",fileUrl:Ce},{caption:"正面微笑像",typeName:"FrontalSmile",fileUrl:Ce},{caption:"90度侧面像",typeName:"LeftProfile",fileUrl:Ce},{caption:"90度侧面微笑像",typeName:"RightProfile",fileUrl:Ce},{caption:"45度侧面像",typeName:"LeftSideProfile",fileUrl:Ce},{caption:"45度侧面微笑像",typeName:"RightSideProfile",fileUrl:Ce},{caption:"口内照（左侧）",typeName:"",fileUrl:Ce},{caption:"口内照（右侧）",typeName:"",fileUrl:Ce},{caption:"磨牙关系（左侧）",typeName:"Left",fileUrl:Ce},{caption:"磨牙关系（右侧）",typeName:"Right",fileUrl:Ce},{caption:"正面咬合",typeName:"Anterior",fileUrl:Ce},{caption:"前牙覆盖",typeName:"Cover",fileUrl:Ce},{caption:"上颌",typeName:"Upper",fileUrl:Ce},{caption:"下颌",typeName:"Lower",fileUrl:Ce},{caption:"全景片",typeName:"Panoramic",fileUrl:Ce},{caption:"侧位片",typeName:"Cephalometric",fileUrl:Ce}]);async function se(){let e;const s=await Dt({url:"http://47.101.150.34:8177/bonceph/platform/user/login",method:"post",data:{username:"bonceph",userpwd:"4371f7b311bf4f88cbd27855f3143430"}});return s.status==200&&(e=s.data.data.token),e}const ge=y(!1),fe=y();async function Xe(){if(Ne.value==0)Fe({message:"未选中图片",type:"error"});else{const e=Bo.service({lock:!0,text:"正在分类中",background:"rgba(0, 0, 0, 0.7)",target:fe.value});e.value=!0;const s=new FormData;let o,n;pe.value.filter(_=>_.file===void 0).forEach(_=>{n=_.imageList.filter(x=>x.choose===!0).map(x=>{if(x.choose)return{ljUrl:x.imgUrl,ljId:x.id,LJCreateDatetime:x.timestamp}})}),o=JSON.stringify({patientId:O,apmtId:v,orthImageList:n}),pe.value.filter(_=>_.file===!0).length>0?pe.value.filter(_=>_.file===!0)[0].imageList.filter(_=>_.choose===!0).forEach(_=>{s.append("files",_.file)}):s.append("files",null),s.append("orthImageString",o);const i=await me("/prod-api/business/orthImage/handleMultiImage",s,!0);e.close(),i.code===200&&(pe.value.forEach(_=>_.imageList.forEach(x=>x.choose=!1)),i.data.forEach(_=>{te.value.forEach(x=>{_.typeName==x.typeName&&(x.fileUrl=_.fileUrl,x.imageId=_.fileId)})}))}}const T=y(null),V=y(),l=e=>{T.value=e,T.value.rightDrop=!0,V.value=T.value.fileUrl;const s=document.getElementById("img");s.src=e.fileUrl,s.style.opacity=1,s.width=120,s.height=80,s.style.position="absolute",s.style.top="-9999px",s.style.objectFit="cover",s.style.border="2px solid #2E6CE4",s.style.boxShadow="0px 9px 18px 0px rgba(0, 0, 0, 0.57)",event.dataTransfer.setDragImage(s,60,40)},d=(e,s)=>{e.file?(s.dataTransfer.setData("text/plain",e),T.value=s.dataTransfer.files[0]):T.value=e;const o=document.getElementById("img");o.src=e.imgUrl,o.style.opacity=1,o.width=120,o.height=80,o.style.position="absolute",o.style.top="-9999px",o.style.objectFit="cover",o.style.border="2px solid #2E6CE4",o.style.boxShadow="0px 9px 18px 0px rgba(0, 0, 0, 0.57)",s.dataTransfer.setDragImage(o,60,40)},c=()=>{const e=document.getElementById("img");e.style.opacity=0},ie=(e,s)=>{const o=document.getElementById("img");if(o.style.opacity=0,e.target.classList.remove("hover"),!T.value.rightDrop)Le(T.value,s);else{if(T.value.id)Q(T.value);else{const n=te.value.find(i=>T.value.fileUrl==i.fileUrl);n.fileUrl=Ce}s.id?ao("/prod-api/business/orthImage",{id:s.id,imageUrl:V.value}).then(()=>{Eo()}):s.fileUrl=V.value}},ye=y(0);async function Le(e,s){const o=new FormData;e.type?(o.append("file",e,"Cover"),o.append("orthImageString",JSON.stringify({patientId:O,apmtId:v,orthImageList:[]}))):o.append("orthImageString",JSON.stringify({patientId:O,apmtId:v,orthImageList:[{ljUrl:e.imgUrl,ljId:e.id,LJCreateDatetime:e.timestamp}]}));const n=await me("/prod-api/business/orthImage/handleSingleImage",o,!0);n.code==200&&n.data[0].fileUrl?(s.fileUrl=n.data[0].fileUrl,s.imageId=n.data[0].fileId):(s.fileUrl=Ce,ye.value==0?(ye.value++,Fe({message:"拖拽失败，请再试一次",type:"warning"})):Fe({message:"拖拽失败，请联系管理员",type:"warning"}))}async function We(){oo.value=!1,te.value.forEach(o=>o.reminder=!1);const s=te.value.filter(o=>o.fileUrl.startsWith("https")).map(o=>({imageType:o.caption,imageUrl:o.fileUrl,imageId:o.fileId||null}));me("/prod-api/business/orthImage",{apmtId:v,orthImageList:s}).then(()=>{$()})}const be=e=>{!e.target.src.endsWith("jpeg")&&!e.target.src.endsWith("jpg")&&(e.target.src=Es,e.target.classList.add("hover"))},Ie=e=>{!e.target.src.endsWith("jpeg")&&!e.target.src.endsWith("jpg")&&(e.target.src=Ce),e.target.classList.remove("hover")};function $(){co(),pt(),at(),ht()}const f=()=>{te.value.forEach(e=>e.reminder=!1)},S=y([]),he=y([]),Oe=["forehead_center","eyebrow_right_corner_left","eyebrow_left_corner_right","nose_middle_contour","chin_2","cheek_right_1","cheek_left_1"],Ye=y(0),Ho=y(0),Vo=y(0);function Qo(e,s,o,n){const i=new Image,_=document.getElementById(n),x=_.getContext("2d");i.onload=function(){const F=i.width,m=i.height;let M=F,de=m;Vo.value=F/m,M>e&&(M=e,de=M/Vo.value),de>s&&(de=s,M=de*Vo.value),_.width=M,Ye.value=M,_.height=de,Ho.value=de,x.clearRect(0,0,_.width,_.height),x.drawImage(i,0,0,M,de),os(x,i,_,qe.value)},i.src=o}function os(e,s,o,n){e.clearRect(0,0,o.width,o.height),e.drawImage(s,0,0,o.width,o.height),n.forEach(function(i){const _=i.x,x=i.y;e.beginPath(),e.arc(_,x,2,0,2*Math.PI),e.fillStyle="red",e.fill()}),ns(e,o)}async function ts(e){const s=Fo(e[6],e[0],e[3]),o=Fo(e[5],e[0],e[3]),n=S.value[0].orthTitleList[0];if(n.aiFlag="1",n.aiTest=!0,s<o){const i=n.orthOptionsList[2].id;await xe(i,n,"",v)}else if(s>o){const i=n.orthOptionsList[1].id;await xe(i,n,"",v)}else{const i=n.orthOptionsList[0].id;await xe(i,n,"",v)}}async function ss(e){const s=S.value[0].orthTitleList[3];s.aiFlag="1",s.aiTest=!0;const o=Fo(e[3],e[2],e[1]),n=Rt(e);ot(o,n,s)}async function as(e){const s=S.value[0].orthTitleList[4];s.aiFlag="1",s.aiTest=!0;const o=Wo(e[3],e[4]),n=Rt(e);ot(o,n,s)}async function Ko(e){await ts(e),await ss(e),await as(e),co()}const et=y(!1);async function ot(e,s,o){if(e>s){const n=o.orthOptionsList[2].id;await xe(n,o,"",v)}else if(e<s){const n=o.orthOptionsList[1].id;await xe(n,o,"",v)}else{const n=o.orthOptionsList[0].id;await xe(n,o,"",v)}co()}function ns(e,s){e.strokeStyle="green",e.lineWidth=1,e.beginPath(),qe.value.forEach(o=>{e.moveTo(0,o.y),e.lineTo(s.width,o.y),e.strokeStyle="blue"}),e.stroke(),e.strokeStyle="purple",e.lineWidth=1,e.beginPath(),e.moveTo(qe.value[0].x,0),e.lineTo(qe.value[3].x,s.height),e.stroke()}async function ls(e){me("/prod-api/business/orthPoint",{apmtId:v,pointType:2,pointList:e})}const qe=y([]),_o=y(),tt=y();async function co(){const e=await we(`/prod-api/business/orthClass/list/2/面型评估/${v}`);S.value=e.data,e.data.forEach(s=>s.orthTitleList.forEach(o=>o.showInput=!1)),e.data.forEach(s=>{if(!s.imageUrl)s.hasImage=!1;else{s.hasImage=!0;const o=document.createElement("link");if(o.href=s.imageUrl,o.rel="preload",o.as="image",document.head.appendChild(o),s.className==="正面像"){const n=s.orthTitleList.find(de=>de.titleName=="正貌"),i=s.orthTitleList.find(de=>de.titleName=="面中三分之一"),_=s.orthTitleList.find(de=>de.titleName=="面下三分之一"),x=n.orthOptionsList.some(de=>de.choosen==!0),F=i.orthOptionsList.some(de=>de.choosen==!0),m=_.orthOptionsList.some(de=>de.choosen==!0);et.value=!x||!F||!m,_o.value=s.imageUrl;const M=new FormData;M.append("imageUrl",s.imageUrl),we(`/prod-api/business/orthPoint/list?apmtId=${v}&pointType=2`).then(de=>{de.data.length>0?(qe.value=de.data.map(ee=>({label:ee.pointName,x:ee.xcoordinate,y:ee.ycoordinate})),et.value&&Ko(qe.value),no(()=>{go&&Qo(320,240,_o.value,"FrontalRose")})):me("/prod-api/business/orthImage/calculateFaceShapeSet",M,!0).then(ee=>{const ae=ee.data.face_list[0].landmark201,k=new Image;k.onload=()=>{const{width:b,height:B,ratio:E}=is(k.width,k.height,320,240),so=b/k.width,ve=B/k.height;qe.value=Oe.map(He=>({label:He,x:ae[He].x*so,y:ae[He].y*ve})),Ko(qe.value);const Ns=qe.value.map(He=>[He.label,He.x,He.y]);ls(Ns)},k.src=_o.value,no(()=>{go&&Qo(320,240,_o.value,"FrontalRose")})})})}s.className=="正面微笑像"&&(tt.value=s.imageUrl)}if(s.className=="90度侧面像"){he.value=[...s.orthTitleList];const o=s.orthTitleList.find(x=>x.titleName=="凸面型表现"),n=s.orthTitleList.find(x=>x.titleName=="凹面型表现"),i=!o.orthOptionsList.some(x=>x.choosen===!0),_=!n.orthOptionsList.some(x=>x.choosen===!0);i&&_?s.orthTitleList.splice(1,2):_?s.orthTitleList.splice(2,1):i&&s.orthTitleList.splice(1,1)}s.orthTitleList.forEach(o=>{if(o.type==1){o.optionId="",o.text="",o.showInput=!1;const n=o.orthOptionsList.filter(i=>i.choosen===!0);n.length>0&&(o.optionId=n[0].id)}else if(o.type==2){o.optionId=[],o.optionId1=[],o.text="",o.showInput=!1;const n=o.orthOptionsList.filter(i=>i.choosen===!0);n.length>0&&(o.optionId=n.map(i=>i.id),o.optionId1=o.optionId)}})}),Po.value.style.display="block"}function is(e,s,o,n){let i=0,_=e,x=s;return i=e/s,_>o&&(_=o,x=_/i),x>n&&(x=n,_=x*i),{width:_,height:x,ratio:i}}const st=y([]);async function at(){const e=await we(`/prod-api/business/orthClass/list/2/口内照/${v}`);st.value=e.data,e.data.forEach(s=>s.orthTitleList.forEach(o=>o.showInput=!1)),e.data.forEach(s=>{s.imageUrl?s.hasImage=!0:s.hasImage=!1,s.orthTitleList.forEach(o=>{if(o.type==1){o.optionId="",o.text="",o.showInput=!1;const n=o.orthOptionsList.filter(i=>i.choosen===!0);n.length>0&&(o.optionId=n[0].id)}else if(o.type==2){o.optionId=[],o.optionId1=[],o.text="",o.showInput=!1;const n=o.orthOptionsList.filter(i=>i.choosen===!0);n.length>0&&(o.optionId=n.map(i=>i.id),o.optionId1=o.optionId)}})})}const nt=[co,at,ht,pt,Cs];let go=!1;At(()=>{go=!0});async function ds(){for(;nt.length>0;){const e=nt.shift();if(go)break;await e()}}ds(),At(()=>{});const lt=y(),$e=y([]),it=y(),dt=y(),rt=y(!1),ut=y([]);function ct(e){e.value.forEach(s=>{s.orthTitleList.forEach(o=>{qo(o)})}),e.value.forEach(s=>{s.orthTitleList.forEach(o=>{if(o.type==1){o.optionId="",o.text="",o.showInput=!1;const n=o.orthOptionsList.filter(i=>i.choosen===!0);n.length>0&&(o.optionId=n[0].id)}else if(o.type==2){o.optionId=[],o.optionId1=[],o.text="",o.showInput=!1;const n=o.orthOptionsList.filter(i=>i.choosen===!0);n.length>0&&(o.optionId=n.map(i=>i.id),o.optionId1=o.optionId)}})})}async function ht(){const e=await we(`/prod-api/business/orthClass/list/2/全景片/${v}`);$e.value=e.data,e.data.forEach(s=>{if(it.value=s.sourceApmtId?s.sourceApmtId:v,dt.value=s.id,s.imageUrl?(s.hasImage=!0,lt.value=s.imageUrl):s.hasImage=!1,!s.flag){rt.value=!0;const o={sourceApmtId:it.value,apmtId:v,classId:dt.value,location:"2"};me("/prod-api/business/orthClass/mouthCheck",o).then(n=>{if(n.code==200){const i=$e.value[0].orthTitleList.slice(0,6);ut.value=n.data.slice(6),$e.value[0].orthTitleList=[...i,...ut.value],ct($e)}})}s.orthTitleList.forEach(o=>{o.showInput=!1,o.popVisible=!1})}),rt.value||ct($e)}const ho=y();ho.value=Pt;const Ae=y(null),Ee=y([]);function rs(e){return/^[a-zA-Z]$/.test(e)}async function pt(){const e=await we(`/prod-api/business/orthClass/list/2/侧位片/${v}`);Ee.value=e.data[0].orthTitleList,Ae.value=e.data[0].imageUrl,Ee.value.some(s=>s.aiFlag=="0")&&(Oo.value=!0),Ae.value&&(Ee.value.some(s=>s.cephalometricsContent)?we(`/prod-api/business/orthPoint/list/?apmtId=${v}`).then(s=>{Lo.value=!0,bo.value=s.data,Co.value=bo.value.filter(o=>wt.includes(o.pointName)),Te.value=Co.value.map(o=>({label:o.pointName,x:o.xCoordinate,y:o.yCoordinate})),to(A.value,D.value,!0)}):to(A.value,D.value,!1)),Ee.value.forEach(s=>{rs(s.titleName[0])&&(s.showInput=!0),s.cephalometricsContent&&(s.measured=!0);const o=s.orthOptionsList.filter(n=>n.choosen===!0);o.length>0&&(s.optionId=o[0].id),s.AIValue=s.cephalometricsContent,s.inputVal=s.cephalometricsContent})}async function us(e){return fetch(e).then(s=>s.blob())}const Qe=y(null),ft=y(0),mt=y(0),vt=()=>{const e=new Image,s=document.getElementById("myZoomCanvas"),o=s.getContext("2d");e.onload=function(){const n=e.width,i=e.height;let _=n,x=i;const F=window.innerWidth,m=window.innerHeight;_>F?(_=F,x=_/ze.value):(e.width=window.innerWidth,e.height=e.width/ze.value,_=e.width,x=e.height),x>m?(x=m,_=x*ze.value):(e.width=window.innerWidth,e.height=e.width/ze.value,_=e.width,x=e.height),s.width=_,ft.value=s.width,s.height=x,mt.value=s.height,Ve.value=Te.value.map(M=>({label:M.label,x:M.x*_,y:M.y*x})),Mo(o,e,s,!0)},s.addEventListener("mousemove",n=>fs(n,e,s,o,ft.value,mt.value)),s.addEventListener("mousedown",n=>hs(n,s)),s.addEventListener("mouseup",ps),e.src=Ae.value,e.crossOrigin="anonymous"},cs=()=>{Qe.value.style.display="flex",vt()},_t=y(0),gt=y(0),yt=y(0),It=y(0),Uo=y(!1),Ke=y(null);function hs(e,s){Ke.value=kt(e,s),_t.value=e.clientX,gt.value=e.clientY}function ps(e){Uo.value=!1,Ke.value=null,yt.value=e.clientX,It.value=e.clientY}let bt=y(0),Ct=y(0);const Ze=y(),So=y(!0);function fs(e,s,o,n,i,_){const x=kt(e,o);if(x)n.fillStyle="white",n.font="20px Arial",n.fillText(x.label,x.x+5,x.y-5),So.value=!1;else{if(So.value)return;vt(),So.value=!0}if(Oo.value=!0,Uo.value=!0,Uo.value&&Ke.value){let F=e.clientX-o.getBoundingClientRect().x,m=e.clientY-o.getBoundingClientRect().y;Ke.value.x=F,Ke.value.y=m;let M=Te.value.find(ee=>ee.label==Ke.value.label);M.x=F/i,M.y=m/_,Ze.value=M.label,bt.value=M.x,Ct.value=M.y;const de=Ve.value.find(ee=>ee.label==M.label);if(de.x=M.x*i,de.y=M.y*_,Mo(n,s,o,!0),Ze.value&&(n.fillStyle="white",n.font="20px Arial",n.fillText(M.label,de.x+5,de.y-5)),St.forEach(ee=>{if(M.label!=="A"&&M.label!=="Me"&&ee.includes(M.label)){let ae=Ao(ee,Ve.value);De(ae,ee,!0)}else if(M.label=="Me"&&(ee.includes("M")||ee.includes("Me"))){let ae=Ao(ee,Ve.value);De(ae,ee,!0)}Ee.value.forEach(ae=>{ae.titleName.includes(M.label)&&(ae.changeCoor=!0),M.label=="Me"&&(ae.titleName.includes("M")||ae.titleName.includes("Me"))&&(ae.changeCoor=!0)})}),Ut.forEach(ee=>{if(M.label!=="A"&&M.label!=="Me"&&ee.includes(M.label)){let ae=wo(ee,Ve.value);De(ae,ee,!0)}else if(M.label=="Me"&&(ee.includes("M")||ee.includes("Me"))){let ae=wo(ee,Ve.value);De(ae,ee,!0)}else if(M.label=="A"&&ee.includes(M.label)&&!ee.includes("Ar")){let ae=wo(ee,Ve.value);De(ae,ee,!0)}Ee.value.forEach(ae=>{(M.label=="Me"&&(ae.titleName.includes("M")||ae.titleName.includes("Me"))||M.label=="A"&&ae.titleName.includes("A")&&!ae.titleName.includes("Ar")||ae.titleName.includes(M.label))&&(ae.changeCoor=!0)})}),Ot.forEach(ee=>{if(M.label!=="A"&&M.label!=="Me"&&ee.includes(M.label)){let ae=Do(ee,Ve.value);De(ae,ee,!0)}else if(M.label=="Me"&&(ee.includes("M")||ee.includes("Me"))){let ae=Do(ee,Ve.value);De(ae,ee,!0)}Ee.value.forEach(ae=>{ae.titleName.includes(M.label)&&(ae.changeCoor=!0),M.label=="Me"&&(ae.titleName.includes("M")||ae.titleName.includes("Me"))&&(ae.changeCoor=!0)})}),["A","B","UI","LI","L6","U6"].includes(M.label)){Ee.value.forEach(ve=>{ve.titleName=="Wits"&&(ve.changeCoor=!0)});const ee=Ve.value.find(ve=>ve.label=="A"),ae=Ve.value.find(ve=>ve.label=="B"),k=Ve.value.find(ve=>ve.label=="UI"),b=Ve.value.find(ve=>ve.label=="LI"),B=Ve.value.find(ve=>ve.label=="U6"),E=Ve.value.find(ve=>ve.label=="L6"),so=jo(ee,ae,k,b,B,E,Io.value,yo.value);De(so,"Wits",!0)}}}function kt(e,s){const o=s.getBoundingClientRect().x,n=s.getBoundingClientRect().y,i=e.clientX,_=e.clientY;for(let x=0;x<Ve.value.length;x++){let F=Ve.value[x],m=i-o-F.x,M=_-n-F.y;if(Math.sqrt(m*m+M*M)<=5)return F}return null}const yo=y(0),Io=y(0),ms=y(null),Lt=e=>{if(W.value){Qe.value.style.display="none",W.value=!1;return}else if(e===!0||!(gt.value!==It.value||_t.value!==yt.value)){Qe.value.style.display="none",to(A.value,D.value,!0),Ee.value.forEach(o=>{if(Ze.value!=="Me"&&Ze.value!=="A"){if(o.titleName.includes(Ze.value)){o.aiFlag="0";let n={apmtId:v,titleId:o.id,optionsIdStr:[],otherContent:"",cephalometricsContent:o.cephalometricsContent,fdiToothCode:"",showPosition:""};me("/prod-api/business/optionsResult",n).then(i=>{if(i.code==200&&i.data.optionsId){o.optionId=i.data.optionsId;let _={apmtId:v,titleId:o.id,optionsIdStr:[i.data.optionsId],otherContent:"",cephalometricsContent:"",fdiToothCode:"",showPosition:""};me("/prod-api/business/optionsResult",_)}})}}else if(Ze.value=="Me"&&(o.titleName.includes("M")||o.titleName.includes("Me"))){o.aiFlag="0";let n={apmtId:v,titleId:o.id,optionsIdStr:[],otherContent:"",cephalometricsContent:o.cephalometricsContent,fdiToothCode:"",showPosition:""};me("/prod-api/business/optionsResult",n).then(i=>{if(i.code==200){o.optionId=i.data.optionsId;let _={apmtId:v,titleId:o.id,optionsIdStr:[i.data.optionsId],otherContent:"",cephalometricsContent:"",fdiToothCode:"",showPosition:""};me("/prod-api/business/optionsResult",_)}})}else if(Ze.value=="A"&&(o.titleName.includes("A")&&o.titleName.length==3||o.titleName=="Wits")){o.aiFlag="0";let n={apmtId:v,titleId:o.id,optionsIdStr:[],otherContent:"",cephalometricsContent:o.cephalometricsContent,fdiToothCode:"",showPosition:""};me("/prod-api/business/optionsResult",n).then(i=>{if(i.code==200&&i.data.optionsId){o.optionId=i.data.optionsId;let _={apmtId:v,titleId:o.id,optionsIdStr:[i.data.optionsId],otherContent:"",cephalometricsContent:"",fdiToothCode:"",showPosition:""};me("/prod-api/business/optionsResult",_)}})}}),ao("/prod-api/business/orthPoint",{apmtId:v,pointName:Ze.value,xCoordinate:bt.value,yCoordinate:Ct.value});const s=Ee.value.filter(o=>o.changeCoor===!0).map(o=>({titleId:o.id,aiType:1}));me("/prod-api/business/optionsResult/updateAIType",{apmtId:v,cephalometricsList:s})}},bo=y([]),K=y([]),Ve=y([]),Te=y([]),Co=y([]),wt=["A","N","B","Or","Po","Go","Go_1","UI","UI_1","S","P","Go`","Me","Ar","LI","LI_1","Ratio1","Ratio2","U6","L6","Gn","ANS","PNS"];let xt,Nt,Tt;async function vs(e){const s=new FormData;s.append("file",e),s.append("mobile","13014532111");const o=await se();if(o){const n=await Dt({url:"http://47.101.150.34:8177/bonceph/platform/marker/predict",method:"post",data:s,headers:{Authorization:`${o}`,"content-type":"multipart/form-data"}});n.status==200&&(bo.value=n.data.data,Co.value=bo.value.filter(i=>wt.includes(i[0])),Te.value=Co.value.map(i=>({label:i[0],x:i[1],y:i[2]})),xt=Te.value.find(i=>i.label=="Ratio1"),Nt=Te.value.find(i=>i.label=="Ratio2"),Tt=Wo(xt,Nt))}}const Oo=y(!1);function _s(e,s,o,n,i,_,x,F){const m=(F-_)*(o-e)-(x-i)*(n-s);if(m===0)return null;const M=((x-i)*(s-_)-(F-_)*(e-i))/m,de=e+M*(o-e),ee=s+M*(n-s);return{x:de,y:ee}}const gs=(e,s,o,n,i)=>{e.beginPath(),e.moveTo(s.x,s.y),e.lineTo(o.x,o.y),e.stroke(),e.beginPath(),e.moveTo(n.x,n.y),e.lineTo(i.x,i.y),e.stroke()},eo=(e,s,o,n,i)=>{const _=_s(s.x,s.y,o.x,o.y,n.x,n.y,i.x,i.y);e.beginPath(),e.moveTo(s.x,s.y),e.lineTo(o.x,o.y),e.stroke(),e.beginPath(),e.moveTo(n.x,n.y),e.lineTo(i.x,i.y),e.stroke(),Is(s,_,n)},$t=(e,s,o,n)=>{e.beginPath(),e.moveTo(s.x,s.y),e.lineTo(o.x,o.y),e.lineTo(n.x,n.y),e.stroke()};function Vt(e,s,o){const n={x:s.x-e.x,y:s.y-e.y},i={x:o.x-e.x,y:o.y-e.y},_=Math.sqrt(n.x**2+n.y**2),x=(i.x*n.x+i.y*n.y)/_**2;return{x:e.x+x*n.x,y:e.y+x*n.y}}const ys=e=>{if(Lo.value){const o=document.getElementById("myCanvas").getContext("2d");o.lineWidth=1.5,o.save(),o.strokeStyle="blue";let n=[],i,_,x,F;if(["颈椎分期","腺样体","扁桃体"].includes(e))return;if(["S-Go/N-Me","S-N/Go`-Me"].includes(e))n=e.split("/").map(m=>m.split("-")),i=K.value.find(m=>m.label==n[0][0]),_=K.value.find(m=>m.label==n[0][1]),x=K.value.find(m=>m.label==n[1][0]),F=K.value.find(m=>m.label==n[1][1]),gs(o,i,_,x,F);else if(e.includes("-"))n=e.split("-").filter(m=>m!=="-"),n.length==2?(e==="L1-MP"&&(i=K.value.find(m=>m.label=="LI_1"),_=K.value.find(m=>m.label=="LI"),x=K.value.find(m=>m.label=="Go_1"),F=K.value.find(m=>m.label=="Me"),eo(o,i,_,x,F)),e==="SN-MP"&&(i=K.value.find(m=>m.label=="S"),_=K.value.find(m=>m.label=="N"),x=K.value.find(m=>m.label=="Go_1"),F=K.value.find(m=>m.label=="Me"),eo(o,i,_,x,F)),e==="U1-SN"&&(i=K.value.find(m=>m.label=="UI_1"),_=K.value.find(m=>m.label=="UI"),x=K.value.find(m=>m.label=="S"),F=K.value.find(m=>m.label=="N"),eo(o,i,_,x,F)),e==="FH-MP"&&(i=K.value.find(m=>m.label=="P"),_=K.value.find(m=>m.label=="Or"),x=K.value.find(m=>m.label=="Go_1"),F=K.value.find(m=>m.label=="Me"),eo(o,i,_,x,F))):n.length==3&&(n[0]=="Na"?(i=K.value.find(m=>m.label=="N"),_=K.value.find(m=>m.label==n[1]),x=K.value.find(m=>m.label==n[2]),$t(o,i,_,x)):(i=K.value.find(m=>m.label==n[0]),_=K.value.find(m=>m.label==n[1]),x=K.value.find(m=>m.label==n[2]),$t(o,i,_,x)));else if(e=="Wits"){const m=K.value.find(ve=>ve.label=="A"),M=K.value.find(ve=>ve.label=="B"),de=K.value.find(ve=>ve.label=="UI"),ee=K.value.find(ve=>ve.label=="LI"),ae=K.value.find(ve=>ve.label=="U6"),k=K.value.find(ve=>ve.label=="L6"),b={x:(ae.x+k.x)/2,y:(ae.y+k.y)/2},B={x:(de.x+ee.x)/2,y:(de.y+ee.y)/2},E=Vt(B,b,m),so=Vt(B,b,M);o.beginPath(),o.moveTo(b.x,b.y),o.lineTo(B.x,B.y),o.strokeStyle="blue",o.stroke(),o.setLineDash([5,5]),o.beginPath(),o.moveTo(m.x,m.y),o.lineTo(E.x,E.y),o.strokeStyle="blue",o.stroke(),o.setLineDash([5,5]),o.beginPath(),o.moveTo(M.x,M.y),o.lineTo(so.x,so.y),o.strokeStyle="blue",o.stroke()}else e=="ODI"?(i=K.value.find(m=>m.label=="A"),_=K.value.find(m=>m.label=="B"),x=K.value.find(m=>m.label=="Go"),F=K.value.find(m=>m.label=="Gn"),eo(o,i,_,x,F)):e=="APDI"?(i=K.value.find(m=>m.label=="A"),_=K.value.find(m=>m.label=="B"),x=K.value.find(m=>m.label=="Go"),F=K.value.find(m=>m.label=="Gn"),eo(o,i,_,x,F)):(n=e.split(""),i=K.value.find(m=>m.label==n[0]),_=K.value.find(m=>m.label==n[1]),x=K.value.find(m=>m.label==n[2]),o.beginPath(),o.moveTo(i.x,i.y),o.lineTo(_.x,_.y),o.lineTo(x.x,x.y),o.stroke())}};function Is(e,s,o){const i=document.getElementById("myCanvas").getContext("2d");i.setLineDash([5,5]),i.beginPath(),i.moveTo(e.x,e.y),i.lineTo(s.x,s.y),i.lineTo(o.x,o.y),i.stroke()}const bs=()=>{Lo.value&&to(A.value,D.value,!0)},oo=y(!1),ko=e=>{oo.value=!0,te.value.find(s=>s.caption===e).reminder=!0,Eo()};async function Cs(){pe.value.length===0&&we(`/prod-api/business/orthImage/imageList?patientId=${O}`).then(e=>{oe.value=e.data,e.data.find(s=>s.imageList.length!==0)&&(pe.value[0]=e.data.find(s=>s.imageList.length!==0),ke.value=e.data.findIndex(s=>s.imageList.length!==0),pe.value[0].imageList.forEach(s=>{s.imgUrl=s.fileUrl,s.choose=!1}))})}async function Eo(){const e=await we(`/prod-api/business/orthImage/list?apmtId=${v}`);e.code==200&&e.data.length>0?e.data.forEach(s=>{te.value.forEach(o=>{s.imageType==o.caption&&(o.fileUrl=s.imageUrl,o.id=s.id)})}):te.value.forEach(s=>{s.fileUrl=Ce})}const Ut=["ANB","Ar-Go`-Me","Ar-Go`-N","Na-Go`-Me","S-Ar-Go`","Na-S-Ar","SNA","SNB"],St=["S-Go/N-Me","S-N/Go`-Me"],Ot=["U1-SN","SN-MP","L1-MP","FH-MP"];function De(e,s,o){const n=Ee.value.find(i=>i.titleName==s);n.cephalometricsContent=e.toFixed(2),n.inputVal=n.cephalometricsContent,n.AIValue=n.cephalometricsContent,o?n.aiFlag="0":n.aiFlag="1"}function ks(){St.forEach(F=>{let m=Ao(F,K.value);De(m,F,!1)}),Ut.forEach(F=>{let m=wo(F,K.value);De(m,F,!1)}),Ot.forEach(F=>{let m=Do(F,K.value);De(m,F,!1)}),Te.value=Te.value.map(F=>({label:F.label,x:F.x*1,y:F.y*1}));const e=Te.value.find(F=>F.label=="A"),s=Te.value.find(F=>F.label=="B"),o=Te.value.find(F=>F.label=="UI"),n=Te.value.find(F=>F.label=="LI"),i=Te.value.find(F=>F.label=="U6"),_=Te.value.find(F=>F.label=="L6"),x=jo(e,s,o,n,i,_,Tt);De(x,"Wits",!1)}async function Ls(){Ee.value.forEach(e=>{if(!["颈椎分期","腺样体","扁桃体"].includes(e.titleName)){e.measured=!0;let s={apmtId:v,titleId:e.id,optionsIdStr:[],otherContent:"",cephalometricsContent:e.cephalometricsContent,fdiToothCode:"",showPosition:"",aiFlag:"1"};me("/prod-api/business/optionsResult",s).then(o=>{if(o.code==200&&o.data.optionsId){e.optionId=o.data.optionsId;let n={apmtId:v,titleId:e.id,optionsIdStr:[o.data.optionsId],otherContent:"",cephalometricsContent:"",fdiToothCode:"",showPosition:""};me("/prod-api/business/optionsResult",n)}})}}),me("/prod-api/business/orthPoint",{apmtId:v,pointList:Te.value.map(e=>[e.label,e.x,e.y])})}const Lo=y(!1);function ws(){to(A.value,D.value,!0),ks(),Ls(),Ee.value.forEach(e=>e.aiFlag="1"),ge.value=!1}const Po=y(null),Et=()=>{const e=Bo.service({lock:!0,text:"正在计算中",background:"rgba(0, 0, 0, 0.7)",target:Po.value});e.value=!0,Ae.value&&us(Ae.value).then(s=>{vs(s).then(()=>{Lo.value=!0,K.value=Te.value.map(o=>({label:o.label,x:o.x*Io.value,y:o.y*yo.value})),e.close(),ws()})}).catch(s=>console.error("Error converting imageUrl to File:",s))};function Mo(e,s,o,n){e.clearRect(0,0,o.width,o.height),e.drawImage(s,0,0,o.width,o.height),n?Ve.value.forEach(function(i){const _=i.x,x=i.y;e.beginPath(),e.arc(_,x,5,0,2*Math.PI),e.fillStyle="red",e.fill()}):K.value.forEach(function(i){const _=i.x,x=i.y;e.beginPath(),e.arc(_,x,2,0,2*Math.PI),e.fillStyle="red",e.fill(),e.fillStyle="white",e.font="20px Arial"})}let ze=y(0);function to(e,s,o){const n=new Image,i=document.getElementById("myCanvas"),_=i.getContext("2d");n.onload=function(){const x=n.width,F=n.height;let m=x,M=F;ze.value=x/F,m>e&&(m=e,M=m/ze.value),M>s&&(M=s,m=M*ze.value),i.width=m,Io.value=m,A.value=m,i.height=M,yo.value=M,D.value=M,K.value=Te.value.map(de=>({label:de.label,x:de.x*Io.value,y:de.y*yo.value})),_.clearRect(0,0,i.width,i.height),_.drawImage(n,0,0,m,M),o&&Mo(_,n,i,!1)},n.src=Ae.value,n.crossOrigin="anonymous"}Kt(()=>{Yo(Te.value,e=>{e&&Oo.value&&Et()}),window.addEventListener("click",e=>{const s=document.querySelector(".el-popper.el-popover");if(s&&e.target!==s&&!s.contains(e.target)){const o=$e.value[0].orthTitleList.findIndex(n=>n.popVisible===!0);o!==-1&&($e.value[0].orthTitleList[o].popVisible=!1)}})});const Re=(e,s,o)=>{if(Y.pdfId&&sessionStorage.removeItem(Y.pdfId),s.titleName=="侧貌"){const n=S.value.find(i=>i.className=="90度侧面像");if(s.orthOptionsList.find(i=>e==i.id).optionName=="凸面型"){const i=he.value.find(_=>_.titleName=="凹面型表现");xe([],i,"",v),n.orthTitleList=he.value.filter(_=>!_.titleName.includes("凹")),i.orthOptionsList.forEach(_=>_.choosen=!1),i.optionId=[]}else if(s.orthOptionsList.find(i=>e==i.id).optionName=="凹面型"){const i=he.value.find(_=>_.titleName=="凸面型表现");xe([],i,"",v),n.orthTitleList=he.value.filter(_=>!_.titleName.includes("凸")),i.optionId=[],i.orthOptionsList.forEach(_=>_.choosen=!1)}else if(s.orthOptionsList.find(i=>e==i.id).optionName=="直面型"){n.orthTitleList=he.value.filter(x=>!x.titleName.includes("凸")&&!x.titleName.includes("凹"));const i=he.value.find(x=>x.titleName=="凸面型表现"),_=he.value.find(x=>x.titleName=="凹面型表现");i.optionId=[],_.optionId=[],xe([],i,"",v),xe([],_,"",v),co()}}o=="侧位片"&&(s.aiFlag="0",me("/prod-api/business/optionsResult/updateAIType",{apmtId:v,cephalometricsList:[{titleId:s.id,aiType:3}]})),vo(e,s,v),xe(s.optionId,s,"",v)},xs=(e,s)=>{xe(e,s,"",v)};return(e,s)=>{const o=mo,n=lo,i=No,_=To,x=Xo,F=Ro,m=Zt,M=Jt,de=Us,ee=Gt,ae=Ws("lazy");return t(),a(N,null,[r("div",on,[r("div",{class:"button",onClick:ce},[tn,J("影像管理")]),j(Ue,{text:"面型评估",backgroundColor:"#f4f7fd"}),r("div",sn,[(t(!0),a(N,null,U(S.value,(k,b)=>(t(),L(Mt,{key:k.id,imageCaption:k.className,class:z({removeBorder:k.className==="90度侧面像"||k.className==="45度侧面像"})},{img:h(()=>[k.imageUrl?(t(),a(N,{key:0},[k.className=="正面像"?(t(),a("canvas",an)):Je((t(),a("img",nn,null,512)),[[ae,k.imageUrl]])],64)):(t(),a("div",{key:1,class:"imageItem__placeholder",onClick:B=>ko(k.className)},[r("img",{src:ho.value,class:"addPic"},null,8,dn)],8,ln))]),content:h(()=>[(t(!0),a(N,null,U(k.orthTitleList,B=>(t(),L(_e,{key:B.id,label:B.titleName,width:"120px"},{default:h(()=>[B.type==1?(t(),L(n,{key:0,modelValue:B.optionId,"onUpdate:modelValue":E=>B.optionId=E,onChange:E=>Re(B.optionId,B,k.className,k)},{default:h(()=>[(t(!0),a(N,null,U(B.orthOptionsList,E=>(t(),L(o,{disabled:!k.hasImage,class:z({serious:E.serious=="1",checked:E.choosen===!0}),key:E.id,label:E.id},{default:h(()=>[J(P(E.optionName)+" ",1),Je(r("img",rn,null,512),[[po,B.aiFlag=="1"&&b==0&&E.choosen]])]),_:2},1032,["disabled","class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):R("",!0),B.type==2?(t(),L(_,{key:1,modelValue:B.optionId,"onUpdate:modelValue":E=>B.optionId=E,onChange:E=>Re(B.optionId,B,k.className,k)},{default:h(()=>[(t(!0),a(N,null,U(B.orthOptionsList,E=>(t(),L(i,{disabled:!k.hasImage,class:z({serious:E.serious=="1",checked:E.choosen===!0}),key:E.id,label:E.id},{default:h(()=>[J(P(E.optionName)+" ",1),E.serious=="0"?(t(),a("img",un)):(t(),a("img",cn))]),_:2},1032,["disabled","class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):R("",!0)]),_:2},1032,["label"]))),128))]),_:2},1032,["imageCaption","class"]))),128))]),j(Ue,{text:"口内照"}),r("div",hn,[(t(!0),a(N,null,U(st.value,k=>(t(),L(Mt,{key:k.id,imageCaption:k.className},{img:h(()=>[k.imageUrl?Je((t(),a("img",pn,null,512)),[[ae,k.imageUrl]]):(t(),a("div",{key:1,class:"imageItem__placeholder",onClick:b=>ko(k.className)},[r("img",{src:ho.value,class:"addPic"},null,8,mn)],8,fn))]),content:h(()=>[k.className=="正面咬合"?(t(),a("img",{key:0,src:tt.value,alt:""},null,8,vn)):R("",!0),r("div",null,[(t(!0),a(N,null,U(k.orthTitleList,b=>(t(),L(_e,{key:b.id,label:b.titleName,width:"100px"},{default:h(()=>[b.type==1?(t(),L(n,{key:0,modelValue:b.optionId,"onUpdate:modelValue":B=>b.optionId=B,onChange:B=>Re(b.optionId,b)},{default:h(()=>[(t(!0),a(N,null,U(b.orthOptionsList,B=>(t(),L(o,{disabled:!k.hasImage,class:z({serious:B.serious=="1",checked:B.choosen===!0}),key:B.id,label:B.id},{default:h(()=>[J(P(B.optionName),1)]),_:2},1032,["disabled","class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):R("",!0),b.type==2?(t(),L(_,{key:1,modelValue:b.optionId,"onUpdate:modelValue":B=>b.optionId=B,onChange:B=>Re(b.optionId,b)},{default:h(()=>[(t(!0),a(N,null,U(b.orthOptionsList,B=>(t(),L(i,{disabled:!k.hasImage,class:z({serious:B.serious=="1",checked:B.choosen===!0}),key:B.id,label:B.id},{default:h(()=>[J(P(B.optionName)+" ",1),B.serious=="0"?(t(),a("img",_n)):(t(),a("img",gn))]),_:2},1032,["disabled","class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):R("",!0)]),_:2},1032,["label"]))),128))])]),_:2},1032,["imageCaption"]))),128))]),j(Ue,{text:"全景片"}),r("div",yn,[(t(!0),a(N,null,U($e.value,k=>(t(),a("div",{key:k.id,class:"placeholderContainer"},[r("div",{class:"image",style:fo({flex:k.imageUrl?"1":"0","min-width":k.imageUrl?"250px":"auto"})},[k.imageUrl?(t(),a("img",{key:0,src:k.imageUrl,style:{width:"100%",cursor:"pointer"},onClick:q},null,8,In)):(t(),a("div",{key:1,class:"imageItem__placeholder",onClick:b=>ko(k.className)},[r("img",{src:ho.value,class:"addPic"},null,8,Cn)],8,bn))],4),r("div",kn,[r("div",Ln,[r("div",wn,[(t(!0),a(N,null,U($e.value[0].orthTitleList,(b,B)=>(t(),a(N,{key:b.id},[B<=2?(t(),L(_e,{key:0,label:b.titleName,width:"120px"},{default:h(()=>[b.type==1?(t(),L(n,{key:0,modelValue:b.optionId,"onUpdate:modelValue":E=>b.optionId=E,onChange:E=>Re(b.optionId,b)},{default:h(()=>[(t(!0),a(N,null,U(b.orthOptionsList,E=>(t(),L(o,{disabled:!$e.value[0].hasImage,class:z({serious:E.serious=="1",checked:E.choosen===!0}),key:E.id,label:E.id},{default:h(()=>[J(P(E.optionName),1)]),_:2},1032,["disabled","class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):R("",!0),b.optionId==136?(t(),L(x,{key:1,placeholder:"请输入",modelValue:b.otherContent,"onUpdate:modelValue":E=>b.otherContent=E,onBlur:E=>xs(b.optionId,b)},null,8,["modelValue","onUpdate:modelValue","onBlur"])):b.type==2?(t(),L(_,{key:2,modelValue:b.optionId,"onUpdate:modelValue":E=>b.optionId=E,onChange:E=>Re(b.optionId,b)},{default:h(()=>[(t(!0),a(N,null,U(b.orthOptionsList,E=>(t(),L(i,{disabled:!$e.value[0].hasImage,class:z({serious:E.serious=="1",checked:E.choosen===!0}),key:E.id,label:E.id},{default:h(()=>[J(P(E.optionName)+" ",1),E.serious=="0"?(t(),a("img",xn)):(t(),a("img",Nn))]),_:2},1032,["disabled","class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):R("",!0)]),_:2},1032,["label"])):R("",!0)],64))),128))]),r("div",Tn,[(t(!0),a(N,null,U($e.value[0].orthTitleList,(b,B)=>(t(),a(N,{key:b.id},[B<=5&&B>=3?(t(),L(_e,{key:0,label:b.titleName,width:"120px"},{default:h(()=>[b.type==1?(t(),L(n,{key:0,modelValue:b.optionId,"onUpdate:modelValue":E=>b.optionId=E,onChange:E=>Re(b.optionId,b)},{default:h(()=>[(t(!0),a(N,null,U(b.orthOptionsList,E=>(t(),L(o,{disabled:!$e.value[0].hasImage,class:z({serious:E.serious=="1",checked:E.choosen===!0}),key:E.id,label:E.id},{default:h(()=>[J(P(E.optionName),1)]),_:2},1032,["disabled","class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):R("",!0),b.type==2?(t(),L(_,{key:1,modelValue:b.optionId,"onUpdate:modelValue":E=>b.optionId=E,onChange:E=>Re(b.optionId,b)},{default:h(()=>[(t(!0),a(N,null,U(b.orthOptionsList,E=>(t(),L(i,{disabled:!$e.value[0].hasImage,class:z({serious:E.serious=="1",checked:E.choosen===!0}),key:E.id,label:E.id},{default:h(()=>[J(P(E.optionName)+" ",1),E.serious=="0"?(t(),a("img",$n)):(t(),a("img",Vn))]),_:2},1032,["disabled","class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):R("",!0)]),_:2},1032,["label"])):R("",!0)],64))),128))]),r("div",Un,[(t(!0),a(N,null,U($e.value[0].orthTitleList,(b,B)=>(t(),a(N,{key:b.id},[B>=6&&B<=12?(t(),L(_e,{key:0,label:b.titleName,width:"120px"},{default:h(()=>[j(F,{step:2,title:b,appId:Be(v),data:$e.value[0]},null,8,["title","appId","data"])]),_:2},1032,["label"])):R("",!0)],64))),128))]),r("div",Sn,[(t(!0),a(N,null,U($e.value[0].orthTitleList,(b,B)=>(t(),a(N,{key:b.id},[B>=13?(t(),L(_e,{key:0,label:b.titleName,width:"120px"},{default:h(()=>[j(F,{step:2,title:b,appId:Be(v),data:$e.value[0]},null,8,["title","appId","data"])]),_:2},1032,["label"])):R("",!0)],64))),128))])])])]))),128))]),j(Ue,{text:"侧位片"}),r("div",{class:"content cephalometric",ref_key:"loadingTarget",ref:Po,style:{display:"none"}},[r("div",On,[r("div",{class:"image",style:fo({flex:Ae.value?"1":"0"})},[Je(r("canvas",{ref_key:"myCanvas",ref:ms,id:"myCanvas",onClick:cs,style:{cursor:"pointer"}},null,512),[[po,Ae.value]]),Ae.value?(t(),L(m,{key:0,class:"cephalometric__button",type:"primary",onClick:Et},{default:h(()=>[J("AI测量")]),_:1})):(t(),a("div",{key:1,class:"imageItem__placeholder",onClick:s[0]||(s[0]=k=>ko("侧位片"))},[r("img",{src:ho.value,class:"addPic"},null,8,En)]))],4),r("div",Pn,[(t(!0),a(N,null,U(Ee.value,k=>(t(),a(N,{key:k.id},[k.showInput?(t(),a("div",Mn,[r("div",{class:"formItem__label",onMouseenter:b=>ys(k.titleName),onMouseleave:bs},P(k.titleName=="Wits"?k.titleName+"(mm)":k.titleName=="S-Go/N-Me"||k.titleName=="S-N/Go`-Me"?k.titleName+"(%)":k.titleName+"(˚)"),41,An),j(M,{class:"box-item",effect:"light",placement:"top",content:k.titlePrompt},{default:h(()=>[r("img",{src:Jo,class:z({hide:["SNA","SNB"].includes(k.titleName)})},null,2)]),_:2},1032,["content"]),r("div",Dn,[r("img",{src:Ha,style:fo({opacity:`${k.aiFlag=="1"?1:0}`})},null,4),r("div",Fn,[j(x,{disabled:!Ae.value,modelValue:k.cephalometricsContent,"onUpdate:modelValue":b=>k.cephalometricsContent=b,onInput:b=>G(),onFocus:b=>k.measured=!1,onBlur:b=>le(k),class:z({measured:k.measured===!0})},null,8,["disabled","modelValue","onUpdate:modelValue","onInput","onFocus","onBlur","class"]),Je(r("img",Bn,null,512),[[po,k.orthOptionsList.findIndex(b=>b.id==k.optionId)==0]]),Je(r("img",Rn,null,512),[[po,k.orthOptionsList.findIndex(b=>b.id==k.optionId)==2]])]),j(n,{class:"cephaRadio",onChange:b=>Re(k.optionId,k,"侧位片"),modelValue:k.optionId,"onUpdate:modelValue":b=>k.optionId=b},{default:h(()=>[(t(!0),a(N,null,U(k==null?void 0:k.orthOptionsList,b=>(t(),L(o,{disabled:!Ae.value,label:b.id,class:z({serious:b.serious=="1",checked:b.choosen===!0}),key:b.id},{default:h(()=>[J(P(b.optionName),1)]),_:2},1032,["disabled","label","class"]))),128))]),_:2},1032,["onChange","modelValue","onUpdate:modelValue"])])])):(t(),a("div",jn,[r("div",Wn,P(k.titleName),1),j(M,{class:"box-item",effect:"light",placement:"top"},{default:h(()=>[qn]),_:1}),r("div",Gn,[j(n,{modelValue:k.optionId,"onUpdate:modelValue":b=>k.optionId=b,onChange:b=>Re(k.optionId,k)},{default:h(()=>[(t(!0),a(N,null,U(k==null?void 0:k.orthOptionsList,b=>(t(),L(o,{disabled:!Ae.value,label:b.id,class:z({serious:b.serious=="1",checked:b.choosen===!0}),key:b.id},{default:h(()=>[J(P(b.optionName),1)]),_:2},1032,["disabled","label","class"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])])]))],64))),128))])])],512)]),j(ee,{modelValue:oo.value,"onUpdate:modelValue":s[2]||(s[2]=k=>oo.value=k),title:"影像管理",width:"1183px",onClose:f,"close-on-click-modal":!1},{footer:h(()=>[r("span",gl,[j(m,{onClick:s[1]||(s[1]=k=>oo.value=!1)},{default:h(()=>[J("取消")]),_:1}),j(m,{type:"primary",onClick:We},{default:h(()=>[J(" 确定 ")]),_:1})])]),default:h(()=>[r("div",{class:"imageManagement",ref_key:"loadingTarget2",ref:fe},[r("div",Zn,[r("div",Jn,[Xn,Yn,r("div",zn,[r("div",Hn,[j(m,{type:"primary",link:"",icon:Be(qs)},{default:h(()=>[J("上传图片")]),_:1},8,["icon"])]),r("input",{class:"file-upload__input",type:"file",onChange:ne,multiple:""},null,32)])]),r("div",Qn,[pe.value.length==0?(t(),a("img",Kn)):(t(!0),a(N,{key:1},U(pe.value,(k,b)=>(t(),a("div",{key:b},[r("div",null,P(k.StartTime.split("T")[0]),1),r("div",el,[(t(!0),a(N,null,U(k.imageList,B=>(t(),a("div",{class:"item",key:B.id,onMouseenter:E=>B.showFlag=!0,onMouseleave:E=>B.showFlag=!1},[r("div",tl,[r("img",{style:{display:"block"},class:z(["img",{choose:B.choose===!0}]),src:B.imgUrl,draggable:"true",onDragstart:E=>d(B,E),onDragend:c,onClick:E=>Se(B)},null,42,sl),Je(r("img",{src:Ts,style:{position:"absolute",right:"6px",bottom:"6px"},onClick:E=>Se(B)},null,8,al),[[po,B.choose===!0]])])],40,ol))),128))]),!k.file&&b===pe.value.length-1?(t(),a("div",{key:0,style:{display:"inline-flex",color:"#4E5969",cursor:"pointer"},onClick:w},il)):R("",!0)]))),128))]),r("div",dl,[r("span",rl,"已选中"+P(Ne.value)+"张",1),j(m,{onClick:Xe},{default:h(()=>[J("自动分类")]),_:1})])]),r("div",ul,[cl,r("div",hl,[(t(!0),a(N,null,U(te.value,k=>(t(),a("div",{class:"item",key:k.typeName,onMouseenter:b=>k.showFlag=!0,onMouseleave:b=>k.showFlag=!1},[r("div",fl,[r("img",{class:z(["img",{hover:k.reminder===!0,animate__animated:k.reminder===!0,animate__bounce:k.reminder===!0}]),style:{display:"block"},src:k.fileUrl,onDrop:b=>ie(b,k),onDragover:xo(be,["prevent"]),onDragleave:Ie,onDragstart:b=>l(k),onDragend:c},null,42,ml)]),j(de,{width:"300","confirm-button-text":"确认",icon:Be(Gs),"icon-color":"#FF7D00","cancel-button-text":"取消",title:"确认删除该张图片吗？",onConfirm:b=>Q(k)},{reference:h(()=>[k.showFlag&&!k.fileUrl.startsWith("data:image")?(t(),a("img",vl)):R("",!0)]),_:2},1032,["icon","onConfirm"]),r("div",_l,P(k.caption),1)],40,pl))),128))])])],512)]),_:1},8,["modelValue"]),r("div",{class:"overlay",ref_key:"overlayRef",ref:Qe},[yl,Il,W.value?(t(),a("img",{key:0,class:"zoomPanoImage",src:lt.value,style:{cursor:"pointer"},onClick:re},null,8,bl)):R("",!0),W.value?R("",!0):(t(),a("canvas",{key:1,id:"myZoomCanvas",onClick:Lt})),r("img",{src:en,style:{position:"fixed",right:"20px",top:"20px",cursor:"pointer"},onClick:s[3]||(s[3]=k=>Lt(!0))})],512),Cl],64)}}},Ll=Ge(kl,[["__scopeId","data-v-924231b7"]]);const wl={class:"content"},xl=["onClick"],Nl={class:"suffix"},Tl={class:"showRange"},$l={class:"text"},Vl={class:"text"},Ul={class:"text"},Sl={__name:"modelAnalysis",props:{titleName:String,min:String,max:String,placeholder:String,left:String,middle:String,right:String,conclusion:String,value:Number,cephalometricsContent:String,hasVal:Boolean},emits:["change"],setup(C,{emit:p}){const I=C,v=y(I.cephalometricsContent),O=p,Z=re=>{var A;v.value||(A=re.target.parentElement.children[1].classList)==null||A.remove("clicked")},Y=re=>{console.log(re.target.value==="")};Yo(v,re=>{O("change",re,I.value)});let W=y(null);const q=re=>{var A;Array.from(re.target.parentElement.classList).includes("googleInput")&&((A=re.target.parentElement.children[1].classList)==null||A.add("clicked"),re.target.parentElement.children[0].focus(),W.value=re.target.parentElement.children[1])};return(re,A)=>(t(),a("div",wl,[r("div",{class:"googleInput",onClick:xo(q,["stop"])},[Je(r("input",{onInput:Y,"onUpdate:modelValue":A[0]||(A[0]=D=>v.value=D),onBlur:Z},null,544),[[Js,v.value]]),I.placeholder?(t(),a("span",{key:0,class:z(["placeholder",{clicked:I.hasVal}])},P(I.placeholder),3)):R("",!0),r("div",Nl,P(C.titleName==="SPEE曲线"?"mm":"%"),1)],8,xl),r("div",Tl,[r("div",{class:z(["range left",{active:I.conclusion===I.left}])},[r("div",$l,P(I.left),1)],2),r("div",{class:z(["range middle",{active:I.conclusion===I.middle}])},[r("div",Vl,P(I.middle),1)],2),r("div",{class:z(["range right",{active:I.conclusion===I.right}])},[r("div",Ul,P(I.right),1)],2),r("div",{class:z(["refNum firstRefNum",{distanceNum:String(I.min).endsWith("m")}])},P(I.min),3),r("div",{class:z(["refNum secondRefNum",{distanceNum:String(I.max).endsWith("m")}])},P(I.max),3)])]))}},Ol=Ge(Sl,[["__scopeId","data-v-134eb27b"]]);const El={class:"formItem"},Pl={class:"formItem__content"},Ml={__name:"customFormItem",props:{label:String,width:String,showMark:Boolean},setup(C){return(p,I)=>{const v=Jt;return t(),a("div",El,[r("div",{class:"formItem__label",style:fo({width:C.width})},[J(P(C.label),1),C.showMark?(t(),L(v,{key:0,class:"box-item",effect:"light",placement:"top-start"},{content:h(()=>[J(P(p.content),1)]),default:h(()=>[r("img",{onMouseenter:I[0]||(I[0]=(...O)=>p.enterTool&&p.enterTool(...O)),onMouseleave:I[1]||(I[1]=(...O)=>p.leaveTool&&p.leaveTool(...O)),src:Jo,style:{cursor:"pointer"}},null,32)]),_:1})):R("",!0)],4),r("div",Pl,[Qt(p.$slots,"default",{},void 0,!0)])])}}},Wt=Ge(Ml,[["__scopeId","data-v-ae329d43"]]);const Al={class:"stepThree"},Dl={class:"content"},Fl={__name:"stepThree",props:{pdfId:String,dentitionType:String},setup(C,{expose:p}){const I=y(!1);p({clicked:I});const v=C,Z=io().params.appId,Y=y({});async function W(){const A=await we(`/prod-api/business/orthClass/list/2/模型分析/${Z}`),D=A.data[0].orthTitleList[2];A.data[0].orthTitleList.splice(2,1),A.data[0].orthTitleList.splice(3,0,D),Y.value=A.data[0],Y.value.orthTitleList.forEach((g,u)=>{if(I.value=g.orthOptionsList.some(X=>X.choosen==!0),g.hasVal=!!g.cephalometricsContent,u<=1){g.optionId="";const X=g.orthOptionsList.filter(H=>H.choosen===!0);X.length>0&&(g.optionId=X[0].id)}else if(g.value=+g.cephalometricsContent,g.titleName=="SPEE曲线"?(g.min="0mm",g.max="2mm"):(g.min=(g.orthOptionsList[0].optionName*100).toFixed(2)+"%",g.max=(g.orthOptionsList[1].optionName*100).toFixed(2)+"%"),g.placeholder=u==2?"":g.titleName.substr(-4).slice(0,3),g.left=u==2?"反曲":"偏低",g.middle="正常",g.right=u==2?"过深":"偏高",g.titleName=="SPEE曲线")g.minVal=0,g.maxVal=2,g.cephalometricsContent?g.conclusion=+g.cephalometricsContent<0?g.left:+g.cephalometricsContent>2?g.right:g.middle:g.conclusion="";else{let X=g.orthOptionsList[0].optionName,H=g.orthOptionsList[1].optionName;g.cephalometricsContent?+g.cephalometricsContent/100<X?g.conclusion=g.left:+g.cephalometricsContent/100>H?g.conclusion=g.right:g.conclusion=g.middle:g.conclusion=""}})}W();const q=(A,D)=>{D.value=+A,D.value&&(D.min.endsWith("m")?D.conclusion=D.value<+D.min.slice(0,1)?D.left:D.value>+D.max.slice(0,1)?D.right:D.middle:D.conclusion=D.value<+D.min.slice(0,5)?D.left:D.value>+D.max.slice(0,5)?D.right:D.middle);const g={apmtId:Z,titleId:D.id,optionsIdStr:[],otherContent:"",cephalometricsContent:A===""?"":D.value+"",fdiToothCode:"",showPosition:""};me("/prod-api/business/optionsResult",g)},re=(A,D)=>{I.value=!0,v.pdfId&&sessionStorage.removeItem(v.pdfId),vo(A,D,Z),xe(D.optionId,D,"",Z)};return(A,D)=>{var X;const g=mo,u=lo;return t(),a("div",Al,[j(Ue,{text:"模型分析",backgroundColor:"#f4f7fd"}),r("div",Dl,[(t(!0),a(N,null,U((X=Y.value.orthTitleList)==null?void 0:X.slice(0,2),(H,ue)=>(t(),L(Wt,{label:H.titleName,width:"110px",key:H.id},{default:h(()=>[ue<=1?(t(),L(u,{key:0,modelValue:H.optionId,"onUpdate:modelValue":ne=>H.optionId=ne,onChange:ne=>re(H.optionId,H)},{default:h(()=>[(t(!0),a(N,null,U(H.orthOptionsList,ne=>(t(),L(g,{key:ne.id,class:z({serious:ne.serious=="1",checked:ne.choosen===!0}),label:ne.id},{default:h(()=>[J(P(ne.optionName),1)]),_:2},1032,["class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):R("",!0)]),_:2},1032,["label"]))),128)),C.dentitionType=="恒牙列"?(t(!0),a(N,{key:0},U(Y.value.orthTitleList.slice(2),(H,ue)=>(t(),L(Wt,{label:ue<=1?H.titleName.slice(0,8):"",width:"110px",showMark:H.titleName==="Bolton指数（前牙比）",content:H.prompt,key:H.id},{default:h(()=>[j(Ol,Xs({titleName:H.titleName},H,{onChange:ne=>q(ne,H)}),null,16,["titleName","onChange"])]),_:2},1032,["label","showMark","content"]))),128)):R("",!0)])])}}},Bl=Ge(Fl,[["__scopeId","data-v-013b2734"]]);const Rl=C=>(ro("data-v-b0df6ba3"),C=C(),uo(),C),jl={class:"stepFour"},Wl={key:0,class:"content",style:{"padding-top":"4px"}},ql={class:"questionItem__header"},Gl=Rl(()=>r("img",{src:Ps},null,-1)),Zl={class:"questionItem__header__title"},Jl={class:"questionItem__content content"},Xl={class:"question_level_two"},Yl={class:"itemContainer"},zl={class:"singleQuestionItem__label"},Hl={class:"singleQuestionItem__content"},Ql={key:1,style:{padding:"20px"}},Kl={class:"content diagnose"},ei={key:0,src:Pe},oi={key:1,src:Me},ti={__name:"stepFour",props:{pdfId:String},setup(C,{expose:p}){const I=y(!1);p({clicked:I});const v=C,Z=io().params.appId,Y=y([]);async function W(){const D=await we(`/prod-api/business/orthClass/issuesList?apmtId=${Z}&serious=1`);if(D.data){const g=D.data.reduce((u,X)=>{if(u[X.question_level_one]){const H=u[X.question_level_one].list1.find(ue=>ue.question_level_two===X.question_level_two);H?H.list2.push({title_name:X.title_name,option_names:X.option_names}):u[X.question_level_one].list1.push({question_level_two:X.question_level_two,list2:[{title_name:X.title_name,option_names:X.option_names}]})}else u[X.question_level_one]=X,u[X.question_level_one].list1=[],u[X.question_level_one].list1.push({question_level_two:X.question_level_two,list2:[{title_name:X.title_name,option_names:X.option_names}]});return u},{});Y.value=Object.values(g)}}W();const q=y([]);async function re(){const D=await we(`/prod-api/business/orthClass/list/2/诊断/${Z}`);q.value=D.data,D.data[0].classFlag&&(I.value=!0),D.data.forEach(g=>g.orthTitleList.forEach(u=>u.showInput=!1)),D.data.forEach(g=>{g.orthTitleList.forEach(u=>{if(u.type==1){u.optionId="",u.text="",u.showInput=!1;const X=u.orthOptionsList.filter(H=>H.choosen===!0);X.length>0&&(u.optionId=X[0].id)}else if(u.type==2){u.optionId=[],u.optionId1=[],u.text="",u.showInput=!1;const X=u.orthOptionsList.filter(H=>H.choosen===!0);X.length>0&&(u.optionId=X.map(H=>H.id),u.optionId1=u.optionId)}})})}re();const A=(D,g)=>{I.value=!0,v.pdfId&&sessionStorage.removeItem(v.pdfId),vo(D,g,Z),xe(g.optionId,g,"",Z)};return(D,g)=>{const u=mo,X=lo,H=No,ue=To;return t(),a("div",jl,[j(Ue,{text:"问题列表",backgroundColor:"#f4f7fd"}),Y.value.length>0?(t(),a("div",Wl,[(t(!0),a(N,null,U(Y.value,ne=>(t(),a("div",{class:"questionItem",key:ne.id},[r("div",ql,[Gl,r("span",Zl,P(ne.question_level_one),1)]),r("div",Jl,[(t(!0),a(N,null,U(ne.list1,le=>(t(),a("div",{class:"singleQuestionItem",key:le.id},[r("div",Xl,P(le.question_level_two),1),r("div",Yl,[(t(!0),a(N,null,U(le.list2,G=>(t(),a("div",{class:"item",key:G.title_name},[r("span",zl,P(G.title_name),1),r("span",Hl,P(G.option_names),1)]))),128))])]))),128))])]))),128))])):(t(),a("div",Ql," 无 ")),j(Ue,{text:"诊断",backgroundColor:"#f4f7fd",style:{"margin-top":"20px"}}),r("div",Kl,[(t(!0),a(N,null,U(q.value,ne=>(t(),a(N,{key:ne.id},[(t(!0),a(N,null,U(ne.orthTitleList,le=>(t(),L(_e,{key:le.id,label:le.titleName,width:"80px"},{default:h(()=>[le.type==1?(t(),L(X,{key:0,modelValue:le.optionId,"onUpdate:modelValue":G=>le.optionId=G,onChange:G=>A(le.optionId,le)},{default:h(()=>[(t(!0),a(N,null,U(le.orthOptionsList,G=>(t(),L(u,{key:G.id,class:z({serious:G.serious=="1",checked:G.choosen===!0}),label:G.id},{default:h(()=>[J(P(G.optionName),1)]),_:2},1032,["class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):R("",!0),le.type==2?(t(),L(ue,{key:1,modelValue:le.optionId,"onUpdate:modelValue":G=>le.optionId=G,onChange:G=>A(le.optionId,le)},{default:h(()=>[(t(!0),a(N,null,U(le.orthOptionsList,G=>(t(),L(H,{class:z({serious:G.serious=="1",checked:G.choosen===!0}),key:G.id,label:G.id},{default:h(()=>[J(P(G.optionName)+" ",1),G.serious=="0"?(t(),a("img",ei)):(t(),a("img",oi))]),_:2},1032,["class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):R("",!0)]),_:2},1032,["label"]))),128))],64))),128))])])}}},si=Ge(ti,[["__scopeId","data-v-b0df6ba3"]]);const zo=C=>(ro("data-v-11bfeb72"),C=C(),uo(),C),ai={class:"stepFive"},ni={class:"content plan"},li={key:0,src:Pe},ii={key:1,src:Me},di={class:"content"},ri={key:0,src:Pe},ui={key:1,src:Me},ci={class:"content"},hi={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",fill:`
                              none
                            `,version:"1.1",width:"9.999975204467773",height:"9.999975204467773",viewBox:"0 0 9.999975204467773 9.999975204467773"},pi=["fill"],fi={key:0,src:Pe},mi={key:1,src:Me},vi={class:"content"},_i=zo(()=>r("span",{style:{color:"#4e5969","margin-left":"8px"}}," 个月",-1)),gi={class:"content risk"},yi={key:0,src:Pe},Ii={key:1,src:Me},bi={key:0,xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",fill:"none",version:"1.1",width:"9.999975204467773",height:"9.999975204467773",viewBox:"0 0 9.999975204467773 9.999975204467773"},Ci=["fill"],ki={key:1,src:Pe},Li={key:2,src:Me},wi={class:"selectContainer",id:"selectContainer"},xi={class:"container"},Ni=["id","onClick"],Ti=zo(()=>r("div",{class:"left"},"右",-1)),$i=zo(()=>r("div",{class:"right"},"左",-1)),Vi={key:0,xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",fill:"none",version:"1.1",width:"9.999975204467773",height:"9.999975204467773",viewBox:"0 0 9.999975204467773 9.999975204467773"},Ui=["fill"],Si={key:1,src:Pe},Oi={key:2,src:Me},Ei={class:"content"},Pi={__name:"stepFive",props:{pdfId:String},setup(C,{expose:p}){const I=y(!1),v=y(!1);p({goalClicked:I,methodClicked:v});const O=C,Z=T=>{T.otherContent&&(T.visible=!0),T.hover=!0};let Y;const W=T=>{T.hover=!1,Y=setTimeout(()=>{T.visible=!1},300);const V=document.querySelectorAll(".myPopper");Array.from(V).forEach(l=>{l.addEventListener("mouseenter",()=>{clearTimeout(Y)})})},q=T=>{T.visible=!0,T.hover=!0};let re;const A=(T,V)=>{V.hover=!1,re=setTimeout(()=>{V.visible=!1},300);const l=document.querySelectorAll(".myPopper");Array.from(l).forEach(d=>{d.addEventListener("mouseenter",()=>{clearTimeout(re)})})},g=io().params.appId,u=y([]);async function X(){const T=await we(`/prod-api/business/orthClass/list/2/方案/${g}`);u.value=T.data,T.data.forEach(V=>V.orthTitleList.forEach(l=>l.showInput=!1)),T.data.forEach(V=>{V.orthTitleList.forEach(l=>{if(l.type==1){l.optionId="",l.text="",l.showInput=!1;const d=l.orthOptionsList.filter(c=>c.choosen===!0);d.length>0&&(l.optionId=d[0].id)}else if(l.type==2){l.optionId=[],l.optionId1=[],l.text="",l.showInput=!1;const d=l.orthOptionsList.filter(c=>c.choosen===!0);d.length>0&&(l.optionId=d.map(c=>c.id),l.optionId1=l.optionId)}else l.type==4&&qo(l)})})}X();const H=y([]);async function ue(){const T=await we(`/prod-api/business/orthClass/list/2/目标/${g}`);H.value=T.data,I.value=T.data[0].classFlag,T.data.forEach(V=>V.orthTitleList.forEach(l=>l.showInput=!1)),T.data.forEach(V=>{V.orthTitleList.forEach(l=>{if(l.type==1){l.optionId="",l.text="",l.showInput=!1;const d=l.orthOptionsList.filter(c=>c.choosen===!0);d.length>0&&(l.optionId=d[0].id)}else if(l.type==2){l.optionId=[],l.optionId1=[],l.text="",l.showInput=!1;const d=l.orthOptionsList.filter(c=>c.choosen===!0);d.length>0&&(l.optionId=d.map(c=>c.id),l.optionId1=l.optionId)}})})}ue();const ne=y([]);async function le(){const T=await we(`/prod-api/business/orthClass/list/2/方法/${g}`);ne.value=T.data,v.value=T.data[0].classFlag,T.data.forEach(V=>V.orthTitleList.forEach(l=>l.showInput=!1)),T.data.forEach(V=>{V.orthTitleList.forEach(l=>{if(l.titleName=="矫治器"){l.optionId=[],l.optionId1=[],l.orthOptionsList.forEach(c=>{var ie,ye;c.optionName==="无托槽隐形矫治"?(c.fillColor="#C9CDD4",c.brand=T.data[0].orthTitleList.find(Le=>Le.titlePrompt=="无托槽"),c.hoverColor="#2e6ce4",c.clicked=!!c.choosen,c.otherContent=(ie=c.brand.orthOptionsList.find(Le=>Le.choosen===!0))==null?void 0:ie.id):c.optionName==="硅胶矫治器"&&(c.fillColor="#C9CDD4",c.brand=T.data[0].orthTitleList.find(Le=>Le.titlePrompt=="硅胶"),c.otherContent=(ye=c.brand.orthOptionsList.find(Le=>Le.choosen===!0))==null?void 0:ye.id,c.hoverColor="#2e6ce4",c.clicked=!!c.choosen)});const d=l.orthOptionsList.filter(c=>c.choosen===!0);d.length>0&&(l.optionId=d.map(c=>c.id),l.optionId1=l.optionId),l.otherContent=""}else if(l.type==1){l.optionId="",l.text="",l.showInput=!1;const d=l.orthOptionsList.filter(c=>c.choosen===!0);d.length>0&&(l.optionId=d[0].id)}else if(l.type==2){l.optionId=[],l.optionId1=[],l.text="",l.showInput=!1;const d=l.orthOptionsList.filter(c=>c.choosen===!0);d.length>0&&(l.optionId=d.map(c=>c.id),l.optionId1=l.optionId)}})})}le();const G=y([]);async function Ne(){const T=await we(`/prod-api/business/orthClass/list/2/周期/${g}`);G.value=T.data}const Se=y([]);async function Q(){const T=await we(`/prod-api/business/orthClass/list/2/备注/${g}`);Se.value=T.data}Ne(),Q();const ke=T=>{if(T.cephalometricsContent){const V={apmtId:g,titleId:T.id,optionsIdStr:[],otherContent:"",cephalometricsContent:T.cephalometricsContent,fdiToothCode:"",showPosition:""};me("/prod-api/business/optionsResult",V)}},pe=y([]);async function oe(){const T=await we(`/prod-api/business/orthClass/list/2/风险/${g}`);pe.value=T.data,pe.value.forEach(V=>{V.orthTitleList.forEach(l=>{l.orthOptionsList.forEach(d=>{d.optionSuffix&&qo(d)})})}),pe.value.forEach(V=>V.orthTitleList.forEach(l=>l.showInput=!1)),pe.value.forEach(V=>{V.orthTitleList.forEach(l=>{if(l.type==1)l.optionId="",l.text="";else if(l.type==2){l.optionId=[],l.optionId1=[],l.text="",l.showInput=!1;const d=l.orthOptionsList.filter(c=>c.choosen===!0);d.length>0&&(l.optionId=d.map(c=>c.id),l.optionId1=l.optionId)}l.titleName=="矫治风险"&&l.orthOptionsList.forEach(d=>{(d.optionName==="牙根吸收"||d.optionName==="乳牙早失")&&(d.fillColor="#C9CDD4",d.seriousColor="#f44c4c",d.hoverColor="#2e6ce4",d.clicked=!!d.choosen)})})})}oe();const ce=(T,V)=>{V.otherContent||(V.clicked=!1)},w=(T,V)=>{T.visible=!1,fe.value.forEach(d=>d.forEach(c=>c.active=!1));let l;if(!T.submitAble){if(T.id===237&&!T.toothCode.join()){V.optionId.splice(V.optionId.findIndex(c=>c==237),1);const d=V.orthOptionsList.find(c=>c.id===236);l={apmtId:g,titleId:V.id,optionsIdStr:V.optionId,otherContent:"",cephalometricsContent:"",fdiToothCode:d.toothCode.join(),showPosition:JSON.stringify(d.position),fdiToothCode1:T.toothCode.join(),showPosition1:JSON.stringify(T.position)}}else if(T.id===236&&!T.toothCode.join()){V.optionId.splice(V.optionId.findIndex(c=>c==236),1);const d=V.orthOptionsList.find(c=>c.id===237);l={apmtId:g,titleId:V.id,optionsIdStr:V.optionId,otherContent:"",cephalometricsContent:"",fdiToothCode:d.toothCode.join(),showPosition:JSON.stringify(d.position),fdiToothCode1:T.toothCode.join(),showPosition1:JSON.stringify(T.position)}}}if(T.id===237){const d=V.orthOptionsList.find(c=>c.id===236);d.toothCode&&(l={apmtId:g,titleId:V.id,optionsIdStr:V.optionId,otherContent:"",cephalometricsContent:"",fdiToothCode:d.toothCode.join(),showPosition:JSON.stringify(d.position),fdiToothCode1:T.toothCode.join(),showPosition1:JSON.stringify(T.position)})}else{const d=V.orthOptionsList.find(c=>c.id===237);d.toothCode?l={apmtId:g,titleId:V.id,optionsIdStr:V.optionId,otherContent:"",cephalometricsContent:"",fdiToothCode1:d.toothCode.join(),showPosition1:JSON.stringify(d.position),fdiToothCode:T.toothCode.join(),showPosition:JSON.stringify(T.position)}:(V.optionId.splice(V.optionId.findIndex(c=>c==236),1),l={apmtId:g,titleId:V.id,optionsIdStr:V.optionId,otherContent:"",cephalometricsContent:"",fdiToothCode:d.toothCode.join(),showPosition:JSON.stringify(d.position),fdiToothCode1:T.toothCode.join(),showPosition1:JSON.stringify(T.position)})}me("/prod-api/business/optionsResult",l).then(()=>{T.submitAble=!1,oe()})},te=(T,V)=>{qt(T,V)},se=y(!1);async function ge(T,V,l,d,c){var ye;if(c=="目标"&&(I.value=!0),c=="方法"&&(v.value=!0),O.pdfId&&sessionStorage.removeItem(O.pdfId),V.titleName=="矫治风险")se.value=!0,V.orthOptionsList.forEach(Le=>{T.includes(Le.id)?Le.clicked=!0:Le.clicked=!1});else if(V.titleName=="矫治器"){const Le=V.optionId.filter(be=>!V.optionId1.includes(be)),We=(ye=V.orthOptionsList.find(be=>be.id===Le[0]))==null?void 0:ye.optionName;Le&&We&&(We=="无托槽隐形矫治"||We=="硅胶矫治器")&&V.orthOptionsList.forEach(be=>{Le.includes(be.id)?(be.clicked=!0,be.visible=!0):be.clicked=!1})}else if(V.titleName=="品牌"){l.visible=!1,xe(l.otherContent,V,"",g),xe(d.optionId,d,"",g);return}vo(T,V,g);const ie=await xe(V.optionId,V,"",g);se.value&&ie.code==200&&oe(),ie.code==200&V.titleName=="矫治器"&&le()}const fe=y([]);fe.value=Zo();const Xe=T=>{fe.value.forEach(V=>{V.forEach(l=>{var d;l.active=!1,(d=T.toothCode)!=null&&d.includes(l.value+"")&&(l.active=!0)})})};return(T,V)=>{const l=mo,d=lo,c=No,ie=To,ye=Go,Le=Xt,We=Yt,be=Xo;return t(),a("div",ai,[j(Ue,{text:"方案",backgroundColor:"#f4f7fd"}),r("div",ni,[(t(!0),a(N,null,U(u.value,Ie=>(t(),a(N,{key:Ie.id},[(t(!0),a(N,null,U(Ie.orthTitleList,($,f)=>(t(),L(_e,{label:$.titleName,key:$.id},{default:h(()=>[f==0?(t(),a(N,{key:0},[$.type==1?(t(),L(d,{key:0,modelValue:$.optionId,"onUpdate:modelValue":S=>$.optionId=S,onChange:S=>ge($.optionId,$)},{default:h(()=>[(t(!0),a(N,null,U($.orthOptionsList,S=>(t(),L(l,{class:z({serious:S.serious=="1",checked:S.choosen===!0}),key:S.id,label:S.id},{default:h(()=>[J(P(S.optionName),1)]),_:2},1032,["class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):R("",!0),$.type==2?(t(),L(ie,{key:1,modelValue:$.optionId,"onUpdate:modelValue":S=>$.optionId=S,onChange:S=>ge($.optionId,$)},{default:h(()=>[(t(!0),a(N,null,U($.orthOptionsList,S=>(t(),L(c,{class:z({serious:S.serious=="1",checked:S.choosen===!0}),key:S.id,label:S.id},{default:h(()=>[J(P(S.optionName)+" ",1),S.serious=="0"?(t(),a("img",li)):(t(),a("img",ii))]),_:2},1032,["class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):R("",!0)],64)):(t(),L(Ro,{key:1,title:$,appId:Be(g),step:2},null,8,["title","appId"]))]),_:2},1032,["label"]))),128))],64))),128))]),j(Ue,{text:"目标",backgroundColor:"#f4f7fd"}),r("div",di,[(t(!0),a(N,null,U(H.value,Ie=>(t(),a(N,{key:Ie.id},[(t(!0),a(N,null,U(Ie.orthTitleList,$=>(t(),L(_e,{key:$.id,label:$.titleName,width:"72px"},{default:h(()=>[$.type==1?(t(),L(d,{key:0,modelValue:$.optionId,"onUpdate:modelValue":f=>$.optionId=f,onChange:f=>ge($.optionId,$,Ie.className,"","目标")},{default:h(()=>[(t(!0),a(N,null,U($.orthOptionsList,f=>(t(),L(l,{class:z({serious:f.serious=="1",checked:f.choosen===!0}),key:f.id,label:f.id},{default:h(()=>[J(P(f.optionName),1)]),_:2},1032,["class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):R("",!0),$.type==2?(t(),L(ie,{key:1,modelValue:$.optionId,"onUpdate:modelValue":f=>$.optionId=f,onChange:f=>ge($.optionId,$,Ie.className,"","目标")},{default:h(()=>[(t(!0),a(N,null,U($.orthOptionsList,f=>(t(),L(c,{class:z({serious:f.serious=="1",checked:f.choosen===!0}),key:f.id,label:f.id},{default:h(()=>[J(P(f.optionName)+" ",1),f.serious=="0"?(t(),a("img",ri)):(t(),a("img",ui))]),_:2},1032,["class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):R("",!0)]),_:2},1032,["label"]))),128))],64))),128))]),j(Ue,{text:"方法",backgroundColor:"#f4f7fd"}),r("div",ci,[(t(!0),a(N,null,U(ne.value,Ie=>(t(),a(N,{key:Ie.id},[(t(!0),a(N,null,U(Ie.orthTitleList,$=>(t(),a(N,{key:$.id},[$.titleName!=="品牌"&&$.titleName!=="预计矫正周期"?(t(),L(_e,{key:0,label:$.titleName,width:"86px"},{default:h(()=>[$.type==1?(t(),L(d,{key:0,modelValue:$.optionId,"onUpdate:modelValue":f=>$.optionId=f,onChange:f=>ge($.optionId,$,"","","方法")},{default:h(()=>[(t(!0),a(N,null,U($.orthOptionsList,f=>(t(),a(N,{key:f.id},[f.optionSuffix?(t(),L(ye,{key:1,"popper-class":"myPopper","popper-style":{width:"auto","min-width":"100px"},placement:"top-start",width:200,visible:f.visible,onAfterLeave:S=>ce($,f)},{reference:h(()=>[j(l,{class:z({serious:f.serious=="1"}),label:f.id,onMouseenter:S=>Z(f),onMouseleave:S=>W(f)},{default:h(()=>[J(P(f.optionName),1),(t(),a("svg",hi,[r("g",null,[r("path",{d:"M0,4.99999C0,2.23857,2.23857,0,4.99999,0C7.76141,0,9.99998,2.23857,9.99998,4.99999C9.99998,7.76141,7.76141,9.99998,4.99999,9.99998C2.23857,9.99998,0,7.76141,0,4.99999C0,4.99999,0,4.99999,0,4.99999ZM5.49999,3.49999C5.49999,3.49999,5.49999,2.49999,5.49999,2.49999C5.49999,2.49999,4.49999,2.49999,4.49999,2.49999C4.49999,2.49999,4.49999,3.49999,4.49999,3.49999C4.49999,3.49999,5.49999,3.49999,5.49999,3.49999C5.49999,3.49999,5.49999,3.49999,5.49999,3.49999ZM4.49999,3.99999C4.49999,3.99999,4.49999,7.49998,4.49999,7.49998C4.49999,7.49998,5.49999,7.49998,5.49999,7.49998C5.49999,7.49998,5.49999,3.99999,5.49999,3.99999C5.49999,3.99999,4.49999,3.99999,4.49999,3.99999C4.49999,3.99999,4.49999,3.99999,4.49999,3.99999Z","fill-rule":"evenodd",fill:f.clicked||f.hover?f.hoverColor:f.fillColor,"fill-opacity":"1"},null,8,pi)])]))]),_:2},1032,["class","label","onMouseenter","onMouseleave"])]),default:h(()=>[j(_e,{label:f.brand.titleName},{default:h(()=>[j(d,{modelValue:f.otherContent,"onUpdate:modelValue":S=>f.otherContent=S,onChange:S=>ge(f.otherContent,f.brand,f,$,"方法")},{default:h(()=>[(t(!0),a(N,null,U(f.brand.orthOptionsList,S=>(t(),L(l,{key:S.id,class:z({serious:S.serious=="1"}),label:S.id},{default:h(()=>[J(P(S.optionName),1)]),_:2},1032,["class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1032,["label"])]),_:2},1032,["visible","onAfterLeave"])):(t(),L(l,{key:0,class:z({serious:f.serious=="1"}),label:f.id},{default:h(()=>[J(P(f.optionName),1)]),_:2},1032,["class","label"]))],64))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):R("",!0),$.type==2?(t(),L(ie,{key:1,modelValue:$.optionId,"onUpdate:modelValue":f=>$.optionId=f,onChange:f=>ge($.optionId,$,"","","方法")},{default:h(()=>[(t(!0),a(N,null,U($.orthOptionsList,f=>(t(),L(c,{key:f.id,class:z({serious:f.serious=="1",checked:f.choosen===!0}),label:f.id},{default:h(()=>[J(P(f.optionName),1),f.serious=="0"?(t(),a("img",fi)):(t(),a("img",mi))]),_:2},1032,["class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):R("",!0)]),_:2},1032,["label"])):R("",!0)],64))),128))],64))),128))]),j(Ue,{text:"周期",backgroundColor:"#f4f7fd"}),r("div",vi,[(t(!0),a(N,null,U(G.value,Ie=>(t(),a(N,{key:Ie.id},[(t(!0),a(N,null,U(Ie.orthTitleList,$=>(t(),L(_e,{key:$.id,label:$.titleName},{default:h(()=>[j(We,{style:{width:"60px"},modelValue:$.cephalometricsContent,"onUpdate:modelValue":f=>$.cephalometricsContent=f,onChange:f=>ke($),filterable:"",remote:""},{default:h(()=>[(t(),a(N,null,U([10,15,18,20],f=>j(Le,{key:f,label:f,value:f},null,8,["label","value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),_i]),_:2},1032,["label"]))),128))],64))),128))]),j(Ue,{text:"风险",backgroundColor:"#f4f7fd"}),r("div",gi,[(t(!0),a(N,null,U(pe.value,Ie=>(t(),a(N,{key:Ie.id},[(t(!0),a(N,null,U(Ie.orthTitleList,$=>(t(),a(N,{key:$.id},[$.titleName!=="备注"?(t(),L(_e,{key:0,label:$.titleName},{default:h(()=>[j(ie,{modelValue:$.optionId,"onUpdate:modelValue":f=>$.optionId=f,onChange:f=>ge($.optionId,$)},{default:h(()=>[(t(!0),a(N,null,U($.orthOptionsList,f=>(t(),a(N,{key:f.id},[f.optionSuffix?(t(),a(N,{key:1},[f.fdiToothCode==null?(t(),L(ye,{key:0,placement:"right",width:490,trigger:"click",onShow:S=>Xe(f),onAfterLeave:S=>w(f,$)},{reference:h(()=>[j(c,{onClick:S=>f.visible=!0,class:z({serious:f.serious=="1",checked:f.choosen===!0}),label:f.id,onMouseenter:S=>f.hover=!0,onMouseleave:S=>f.hover=!1},{default:h(()=>[J(P(f.optionName),1),f.optionSuffix?(t(),a("svg",bi,[r("g",null,[r("path",{d:"M0,4.99999C0,2.23857,2.23857,0,4.99999,0C7.76141,0,9.99998,2.23857,9.99998,4.99999C9.99998,7.76141,7.76141,9.99998,4.99999,9.99998C2.23857,9.99998,0,7.76141,0,4.99999C0,4.99999,0,4.99999,0,4.99999ZM5.49999,3.49999C5.49999,3.49999,5.49999,2.49999,5.49999,2.49999C5.49999,2.49999,4.49999,2.49999,4.49999,2.49999C4.49999,2.49999,4.49999,3.49999,4.49999,3.49999C4.49999,3.49999,5.49999,3.49999,5.49999,3.49999C5.49999,3.49999,5.49999,3.49999,5.49999,3.49999ZM4.49999,3.99999C4.49999,3.99999,4.49999,7.49998,4.49999,7.49998C4.49999,7.49998,5.49999,7.49998,5.49999,7.49998C5.49999,7.49998,5.49999,3.99999,5.49999,3.99999C5.49999,3.99999,4.49999,3.99999,4.49999,3.99999C4.49999,3.99999,4.49999,3.99999,4.49999,3.99999Z","fill-rule":"evenodd",fill:f.clicked?f.seriousColor:f.hover?f.hoverColor:f.fillColor,"fill-opacity":"1"},null,8,Ci)])])):R("",!0),f.serious=="0"?(t(),a("img",ki)):(t(),a("img",Li))]),_:2},1032,["onClick","class","label","onMouseenter","onMouseleave"])]),default:h(()=>[r("div",wi,[r("div",xi,[(t(!0),a(N,null,U(fe.value,(S,he)=>(t(),a("div",{key:he,class:z(["symptomBox",{itemAlignRight:he===2||he===4||he===0||he===6,marginTop:he==4||he==5,marginBottom:he==2||he==3,marginRight:he===2||he===4||he===0||he===6,marginLeft:he===1||he===3||he===5||he===7}])},[(t(!0),a(N,null,U(S,(Oe,Ye)=>(t(),a("div",{class:z(["symptomItem",{selected:Oe.active===!0}]),id:Oe.value,key:Ye,onClick:Ho=>te(Oe,f)},P(Oe.label),11,Ni))),128))],2))),128))]),Ti,$i])]),_:2},1032,["onShow","onAfterLeave"])):(t(),L(ye,{key:1,"popper-class":"myPopper","popper-style":{width:"auto","min-width":"100px"},placement:"top-start",width:200,visible:f.visible},{reference:h(()=>[j(c,{onMouseenter:S=>q(f),class:z({serious:f.serious=="1",checked:f.choosen===!0}),label:f.id,onMouseleave:S=>A(S,f)},{default:h(()=>[J(P(f.optionName),1),f.optionSuffix?(t(),a("svg",Vi,[r("g",null,[r("path",{d:"M0,4.99999C0,2.23857,2.23857,0,4.99999,0C7.76141,0,9.99998,2.23857,9.99998,4.99999C9.99998,7.76141,7.76141,9.99998,4.99999,9.99998C2.23857,9.99998,0,7.76141,0,4.99999C0,4.99999,0,4.99999,0,4.99999ZM5.49999,3.49999C5.49999,3.49999,5.49999,2.49999,5.49999,2.49999C5.49999,2.49999,4.49999,2.49999,4.49999,2.49999C4.49999,2.49999,4.49999,3.49999,4.49999,3.49999C4.49999,3.49999,5.49999,3.49999,5.49999,3.49999C5.49999,3.49999,5.49999,3.49999,5.49999,3.49999ZM4.49999,3.99999C4.49999,3.99999,4.49999,7.49998,4.49999,7.49998C4.49999,7.49998,5.49999,7.49998,5.49999,7.49998C5.49999,7.49998,5.49999,3.99999,5.49999,3.99999C5.49999,3.99999,4.49999,3.99999,4.49999,3.99999C4.49999,3.99999,4.49999,3.99999,4.49999,3.99999Z","fill-rule":"evenodd",fill:f.clicked?f.seriousColor:f.hover?f.hoverColor:f.fillColor,"fill-opacity":"1"},null,8,Ui)])])):R("",!0),f.serious=="0"?(t(),a("img",Si)):(t(),a("img",Oi))]),_:2},1032,["onMouseenter","class","label","onMouseleave"])]),default:h(()=>[j(Ro,{step:5,title:f,appId:Be(g),onSubmitTooth:S=>w(S,$)},null,8,["title","appId","onSubmitTooth"])]),_:2},1032,["visible"]))],64)):(t(),L(c,{key:0,class:z({serious:f.serious=="1",checked:f.choosen===!0}),label:f.id},{default:h(()=>[J(P(f.optionName)+" ",1),f.serious=="0"?(t(),a("img",yi)):(t(),a("img",Ii))]),_:2},1032,["class","label"]))],64))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1032,["label"])):$.titleName=="备注"?(t(),L(_e,{key:1,label:$.titleName,width:"72px"},{default:h(()=>[j(be,{style:{width:"100px"},modelValue:$.cephalometricsContent,"onUpdate:modelValue":f=>$.cephalometricsContent=f,onBlur:f=>ke($)},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),_:2},1032,["label"])):R("",!0)],64))),128))],64))),128))]),j(Ue,{text:"备注",backgroundColor:"#f4f7fd"}),r("div",Ei,[(t(!0),a(N,null,U(Se.value,Ie=>(t(),a(N,{key:Ie.id},[(t(!0),a(N,null,U(Ie.orthTitleList,$=>(t(),L(_e,{key:$.id,label:$.titleName},{default:h(()=>[j(be,{style:{width:"400px"},modelValue:$.cephalometricsContent,"onUpdate:modelValue":f=>$.cephalometricsContent=f,onBlur:f=>ke($)},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),_:2},1032,["label"]))),128))],64))),128))])])}}},Mi=Ge(Pi,[["__scopeId","data-v-11bfeb72"]]);const Ai=C=>(ro("data-v-2c27b87c"),C=C(),uo(),C),Di={style:{background:"#f2f3f5"}},Fi=Ai(()=>r("div",{class:"gap"},null,-1)),Bi={class:"header"},Ri={style:{display:"flex","justify-content":"center",flex:1}},ji=["onClick"],Wi={key:0,class:"step-num"},qi={key:1,style:{"margin-right":"12px"},src:na},Gi={class:"ortho-page"},Zi={class:"information"},Ji={class:"footer"},Xi={class:"desc"},Yi={class:"desc uploadDesc"},zi=["href"],Hi={key:0,style:{"margin-left":"20px"}},Qi={class:"dialog-footer"},Ki={__name:"index",setup(C){const p=y();window.addEventListener("message",function(c){c.origin==="https://odostest.orangedental.cn:4403"&&(p.value=c.data)});const I=Ys(),v=io(),O=v.params.appId,Z=v.params.patientId,Y=[{num:1,desc:"基础信息"},{num:2,desc:"图像分析"},{num:3,desc:"模型分析"},{num:4,desc:"问题列表"},{num:5,desc:"方案目标"},{num:6,desc:"报告预览"}],W=y(0),q=[],re=y(null),A=y(null),D=y(null),g=y(null),u=y(null),X=y(null),H=c=>{if(c>W.value){Fe({message:"请点击下一步哦",type:"warning"});return}else Q.value=c};Kt(()=>{q.push(re,A,D,g,u),document.querySelector(".ortho-page").addEventListener("mousewheel",function(ie){ie.deltaX!==0&&ie.preventDefault()})});const ue=y(),ne=y(0),le=y(),G=y(),Ne=()=>{if(Q.value==5&&!q[Q.value-1].value.goalClicked&&!q[Q.value-1].value.methodClicked)Fe({message:"请检查目标和方法是否填写完毕哦",type:"error"});else if(Q.value==5&&!q[Q.value-1].value.goalClicked){Fe({message:"请检查目标是否填写完毕哦",type:"error"});return}else if(Q.value==5&&!q[Q.value-1].value.methodClicked){Fe({message:"请检查方法是否填写完毕哦",type:"error"});return}else no(()=>{W.value=Q.value,Q.value++,ao("/prod-api/business/orthBase",{id:ke.value.id,pdfUrl:"",pdfTime:"",progress:Q.value}),window.scrollTo(0,0)})},Se=c=>{var ie;c&&((ie=ue.value)==null||ie.close(),ao("/prod-api/business/orthBase",{id:ke.value.id,pdfUrl:c,pdfTime:Ks(),progress:Q.value}),le.value=c)},Q=y(0),ke=y(),pe=y();function oe(){we(`/prod-api/business/orthBase/${O}`).then(c=>{var ie,ye;c.code===200?(ke.value=c.data,Q.value=(ie=c.data)!=null&&ie.progress?c.data.progress:1,W.value=Q.value,ne.value=(ye=ke.value)==null?void 0:ye.id,pe.value=c.data.dentitionType,ke.value&&ke.value.pdfUrl&&(sessionStorage.setItem(`pdfUrl${ne.value}`,ke.value.pdfUrl),G.value=`pdfUrl${ne.value}`,le.value=sessionStorage.getItem(`pdfUrl${ne.value}`),Q.value=6)):Q.value=2})}oe();const ce=()=>{if(Q.value==4&&!q[Q.value-1].value.clicked){Fe({message:"还未填写诊断哦",type:"error"});return}no(()=>{W.value=Q.value,Q.value++,ao("/prod-api/business/orthBase",{id:ke.value.id,pdfUrl:"",pdfTime:"",progress:Q.value}),window.scrollTo(0,0)})},w=()=>{Q.value!=1&&no(()=>{W.value=Q.value,Q.value--,ao("/prod-api/business/orthBase",{id:ke.value.id,pdfUrl:"",pdfTime:"",progress:Q.value}),window.scrollTo(0,0)})},te=()=>{I.push("/index")},se=()=>{fetch(le.value).then(c=>c.blob()).then(c=>{const ie=URL.createObjectURL(c),ye=document.createElement("a");ye.href=ie,ye.download="filename.pdf",ye.click()})},ge=y(!1),fe=y({});async function Xe(){ge.value=!0;const c=await me("/prod-api/business/orthBase/selectOrthRisk",{patientId:Z,apmtId:O});fe.value=c.data,fe.value.dentitionType=c.data.dentitionType||"无",fe.value.riskValueSystem="",fe.value.riskValue=fe.value.riskValue.split("")[0]}const T=y(!1);async function V(){try{const c=Bo.service({lock:!0,text:"发起审批中",background:"rgba(0, 0, 0, 0.7)"});fe.value.pdfUrl=le.value,fe.value.riskValueSystem=fe.value.riskValueSystem?fe.value.riskValueSystem:"无";const ie=await me("/prod-api/business/orthBase/sendApproval",{patientId:Z,apmtId:O,...fe.value});ge.value=!1,c.close(),ie.code===200&&Fe({type:"success",message:ie.msg})}catch{}}const l=()=>{I.push("/list")},d=[{label:"患者姓名",value:"patientName"},{label:"病例号",value:"privateId"},{label:"诊所",value:"abbreviation"},{label:"牙列期",value:"dentitionType"},{label:"术前诊断",value:"diagnoseStr"},{label:"治疗目标",value:"targetStr"},{label:"治疗计划",value:"planStr"},{label:"矫正方案",value:"schemeStr"},{label:"病例风险（系统）",value:"riskValueSystem"},{label:"病历风险（自评）",value:"riskValue"},{label:"预计矫正周期",value:"correctionPeriod"},{label:"说明",value:"explain"}];return(c,ie)=>{const ye=zs("ArrowLeft"),Le=Hs,We=aa,be=Zt,Ie=Ms,$=lo,f=Gt;return t(),a("div",Di,[Fi,r("div",Bi,[r("div",{style:{display:"flex","align-items":"center","margin-right":"40px",cursor:"pointer",width:"100px","margin-left":"20px"},onClick:te},[j(Le,null,{default:h(()=>[j(ye)]),_:1}),J("返回列表 ")]),r("div",Ri,[(t(),a(N,null,U(Y,S=>r("div",{class:z(["step",{active:Q.value===S.num}]),onClick:he=>H(S.num),key:S.num},[W.value<S.num||Q.value===S.num?(t(),a("span",Wi,P(S.num),1)):W.value>=S.num?(t(),a("img",qi)):R("",!0),r("span",{class:z(["step-text",{finished:Q.value===S.num||S.num<=W.value}])},P(S.desc),3),j(We,{class:z({finished:Q.value===S.num||S.num<=W.value})},null,8,["class"])],10,ji)),64))])]),r("div",Gi,[r("div",Zi,[Q.value===1?(t(),L(Pa,{key:0,pdfId:G.value,ref_key:"step1",ref:re},null,8,["pdfId"])):R("",!0),Q.value===2?(t(),L(Ll,{key:1,pdfId:G.value,ref_key:"step2",ref:A},null,8,["pdfId"])):R("",!0),Q.value===3?(t(),L(Bl,{key:2,pdfId:G.value,ref_key:"step3",ref:D,dentitionType:pe.value},null,8,["pdfId","dentitionType"])):R("",!0),Q.value===4?(t(),L(si,{key:3,pdfId:G.value,ref_key:"step4",ref:g},null,8,["pdfId"])):R("",!0),Q.value===5?(t(),L(Mi,{key:4,id:ne.value,pdfId:G.value,ref_key:"step5",ref:u},null,8,["id","pdfId"])):R("",!0),Q.value===6?(t(),L(Qs,{key:5,onGetPdfResult:Se,id:ne.value,ref_key:"pdfComp",ref:X},null,8,["id"])):R("",!0)]),r("div",Ji,[Q.value>=2&&Q.value<=5?(t(),L(be,{key:0,onClick:w},{default:h(()=>[J("上一步")]),_:1})):R("",!0),Q.value==6?(t(),L(be,{key:1,onClick:se},{default:h(()=>[J(" 下载报告 ")]),_:1})):R("",!0),Q.value<5?(t(),L(be,{key:2,type:"primary",onClick:ce},{default:h(()=>[J("下一步")]),_:1})):R("",!0),Q.value==5?(t(),L(be,{key:3,type:"primary",onClick:Ne},{default:h(()=>[J("生成报告")]),_:1})):R("",!0),Q.value==5&&T.value==!0?(t(),L(be,{key:4,type:"primary",onClick:c.checkApproval},{default:h(()=>[J("查看审批流")]),_:1},8,["onClick"])):R("",!0),Q.value==6?(t(),L(be,{key:5,type:"primary",onClick:Xe},{default:h(()=>[J("发起审批")]),_:1})):R("",!0),Q.value==6&&T.value==!0?(t(),L(be,{key:6,type:"primary",onClick:l},{default:h(()=>[J("返回列表")]),_:1})):R("",!0)])]),j(f,{modelValue:ge.value,"onUpdate:modelValue":ie[3]||(ie[3]=S=>ge.value=S),"close-on-press-escape":!1,title:"确认审批",class:"confirmApproval"},{footer:h(()=>[r("span",Qi,[j(be,{onClick:ie[2]||(ie[2]=S=>ge.value=!1)},{default:h(()=>[J("取消")]),_:1}),j(be,{type:"primary",onClick:V},{default:h(()=>[J(" 确认 ")]),_:1})])]),default:h(()=>[(t(),a(N,null,U(d,(S,he)=>(t(),a(N,{key:S.label},[he<=6?(t(),L(_e,{key:0,label:S.label,width:"128px"},{default:h(()=>[r("span",Xi,P(fe.value[S.value]),1)]),_:2},1032,["label"])):R("",!0),he==7?(t(),L(_e,{key:1,label:S.label,width:"128px"},{default:h(()=>[r("span",Yi,[r("a",{href:le.value,target:"_blank"},P(le.value.split("/")[le.value.split("/").length-1]),9,zi)])]),_:2},1032,["label"])):he==8?(t(),L(_e,{key:2,label:S.label,width:"128px"},{default:h(()=>[j($,{modelValue:fe.value.riskValue,"onUpdate:modelValue":ie[0]||(ie[0]=Oe=>fe.value.riskValue=Oe),disabled:""},{default:h(()=>[(t(),a(N,null,U(["低","中","高"],(Oe,Ye)=>j(Ie,{key:Ye,label:Oe},null,8,["label"])),64))]),_:2},1032,["modelValue"]),fe.value.ruleText?(t(),a("span",Hi,"风险规则说明："+P(fe.value.ruleText),1)):R("",!0)]),_:2},1032,["label"])):he==9?(t(),L(_e,{key:3,label:S.label,width:"128px"},{default:h(()=>[j($,{modelValue:fe.value.riskValueSystem,"onUpdate:modelValue":ie[1]||(ie[1]=Oe=>fe.value.riskValueSystem=Oe)},{default:h(()=>[(t(),a(N,null,U(["低","中","高"],(Oe,Ye)=>j(Ie,{key:Ye,label:Oe},null,8,["label"])),64))]),_:2},1032,["modelValue"])]),_:2},1032,["label"])):he==10?(t(),L(_e,{key:4,label:S.label,width:"128px"},{default:h(()=>[J(P(fe.value.correctionPeriod?fe.value.correctionPeriod+"个月":""),1)]),_:2},1032,["label"])):he==11?(t(),L(_e,{key:5,label:S.label,width:"128px"},{default:h(()=>[J(P(fe.value.explain),1)]),_:2},1032,["label"])):R("",!0)],64))),64))]),_:1},8,["modelValue"])])}}},fd=Ge(Ki,[["__scopeId","data-v-2c27b87c"]]);export{fd as default};
