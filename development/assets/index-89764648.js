import{_ as ws,E as Ls}from"./base-64978b4d.js";import{H as Se,f as _e,_ as Pe,a as Me,u as xe,E as mo,b as no,c as Go,G as Zo,d as Rt,i as Ot,I as Et,e as xs,g as Ns,h as Ts,p as Ce,j as $s,k as jt,l as Jo,m as Vs,n as Us,o as Ss,q as Os,r as Es}from"./flag-8c8f6715.js";import{a as xo,b as No,E as Wt}from"./el-button-508d01eb.js";/* empty css                */import{f as Xo,E as qt}from"./el-popper-71a0ec90.js";import{E as Ps,a as Ms}from"./el-select-74dd9475.js";import{P as me,_ as Ge,G as Le,E as Fe,D as As,a as so,b as Pt}from"./_plugin-vue_export-helper-8cd5caf8.js";import{b as Ds,d as Fs,a as Gt,u as Bs,c as Zt,o,k as n,n as Y,l as Be,r as Jt,q as R,p as fo,y as Rs,B as I,ai as lo,F as j,m as r,t as E,v as h,V as T,a2 as S,s as C,T as J,I as ao,af as io,ag as ro,C as Yo,H as Lo,ae as js,D as Xt,aj as Ws,a0 as Je,a1 as po,ak as qs,w as Gs,al as Zs,S as Js,ah as Xs,P as Ys}from"./index-64f103c8.js";import"./el-tooltip-4ed993c7.js";import{E as Bo}from"./index-12d91fd1.js";import{p as zs}from"./pdf1-6e7599c6.js";import{f as Hs}from"./formatTime-47d7a857.js";import"./_commonjsHelpers-de833af9.js";const Qs=Ds({direction:{type:String,values:["horizontal","vertical"],default:"horizontal"},contentPosition:{type:String,values:["left","center","right"],default:"center"},borderStyle:{type:Fs(String),default:"solid"}}),Ks=Gt({name:"ElDivider"}),ea=Gt({...Ks,props:Qs,setup(k){const p=k,g=Bs("divider"),f=Zt(()=>g.cssVar({"border-style":p.borderStyle}));return(U,G)=>(o(),n("div",{class:Y([Be(g).b(),Be(g).m(U.direction)]),style:fo(Be(f)),role:"separator"},[U.$slots.default&&U.direction!=="vertical"?(o(),n("div",{key:0,class:Y([Be(g).e("text"),Be(g).is(U.contentPosition)])},[Jt(U.$slots,"default")],2)):R("v-if",!0)],6))}});var oa=ws(ea,[["__file","/home/runner/work/element-plus/element-plus/packages/components/divider/src/divider.vue"]]);const ta=Rs(oa);const sa="/assets/Steps-37dd4960.svg",vo=(k,p,g,f,U)=>{var G,X,W;if(p.titleName=="关节弹响"){if(((G=p.orthOptionsList.find(q=>q.id==k))==null?void 0:G.optionName)=="弹响"){f.value=!0;return}if(k==10){f.value=!1,p.otherContent="",U.value.orthTitleList.forEach(A=>{A.titleName=="关节弹响"?(A.optionId=10,A.text="",A.selectId=""):A.titleName=="侧关节"&&(A.optionId=[],A.text="",A.showInput=!1,A.selectId1="",A.selectId2="")});const q=U.value.orthTitleList.find(A=>A.titleName=="侧关节");let re={apmtId:g,titleId:q.id,optionsIdStr:[],otherContent:"",cephalometricsContent:"",fdiToothCode:"",showPosition:""};me("/prod-api/business/optionsResult",re)}}else if(p.titleName=="骨龄"&&(((X=p.orthOptionsList.find(q=>q.id==k))==null?void 0:X.optionName)=="骨龄超"||((W=p.orthOptionsList.find(q=>q.id==k))==null?void 0:W.optionName)=="骨龄晚")){p.orthOptionsList.forEach(q=>{q.id==k?(q.clicked=!0,q.visible=!0):q.clicked=!1});return}p.type==2&&(p.optionId1.includes(10)&&p.optionId1.length<p.optionId.length?(p.optionId1=p.optionId.filter(q=>q!==10),p.optionId=p.optionId1):!p.optionId1.includes(10)&&p.optionId1.length<p.optionId.length&&p.optionId.includes(10)&&(p.optionId1=[10],p.optionId=[10],p.otherContent=""),p.orthOptionsList.forEach(q=>{p.optionId.includes(q.id)?q.choosen=!0:q.choosen=!1})),p.type==1&&(p.orthOptionsList.forEach(q=>{k!==q.id?q.choosen=!1:q.choosen=!0}),(p.titleName=="面中三分之一"||p.titleName=="面下三分之一"||p.titleName=="正貌")&&p.aiFlag=="1"&&(p.aiFlag="0"))};const To=k=>(io("data-v-18146a02"),k=k(),ro(),k),aa={class:"stepOne"},na={class:"patientInfo"},la={class:"patientInfo__item"},ia=To(()=>r("span",{class:"patientInfo__item__desc"},"患者姓名",-1)),da={class:"patientInfo__item__detail"},ra={class:"patientInfo__item"},ua=To(()=>r("span",{class:"patientInfo__item__desc"},"病例号",-1)),ca={class:"patientInfo__item__detail"},ha={class:"patientInfo__item"},pa=To(()=>r("span",{class:"patientInfo__item__desc"},"性别",-1)),fa={class:"patientInfo__item__detail"},ma={class:"patientInfo__item"},va=To(()=>r("span",{class:"patientInfo__item__desc"},"生日",-1)),_a={class:"patientInfo__item__detail"},ga={class:"content inquiry",style:{"min-height":"600px"}},ya={class:"innerContent content"},Ia={key:0,src:Pe},ba={key:1,src:Me},Ca={key:1,style:{display:"flex"}},ka={class:"content"},wa={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",fill:`
                              none
                            `,version:"1.1",width:"9.999975204467773",height:"9.999975204467773",viewBox:"0 0 9.999975204467773 9.999975204467773"},La=["fill"],xa={key:0,src:Pe},Na={key:1,src:Me},Ta={key:1,style:{display:"inline-flex"}},$a={class:"specialTitle"},Va={key:2,style:{display:"inline-flex"}},Ua={class:"specialTitle side"},Sa={__name:"stepOne",props:{pdfId:String},setup(k,{expose:p}){const g=I(!1);p({clicked:g});const f=k,U=I(""),G=I(""),X=lo(),W=X.params.appId,q=X.params.patientId,re=ee=>{ee.otherContent&&(ee.visible=!0),ee.hover=!0};let A;const D=ee=>{ee.hover=!1,A=setTimeout(()=>{ee.visible=!1},300);const ue=document.querySelectorAll(".myPopper");Array.from(ue).forEach(x=>{x.addEventListener("mouseenter",()=>{clearTimeout(A)})})};async function y(ee,ue,x){x.visible=!1,x.otherContent?(await xe(ee,ue,x.otherContent,W)).code==200&ue.titleName=="骨龄"&&Z():(ue.optionId="",ao(()=>{ue.orthOptionsList.forEach(oe=>oe.clicked=!1)}))}const u=I({});async function M(){const ee=await Le(`prod-api/business/patient/ljPatient/${q}`);u.value=ee.data,sessionStorage.setItem("name",u.value.Name)}M();const de=I([]);async function ae(){const ee=await Le(`/prod-api/business/orthClass/list/2/问诊/${W}`);de.value=ee.data,ee.data.forEach(ue=>ue.orthTitleList.forEach(x=>x.showInput=!1)),ee.data.forEach(ue=>{ue.orthTitleList.forEach(x=>{if(x.orthOptionsList[x.orthOptionsList.length-1].otherContent&&(x.otherContent=x.orthOptionsList[x.orthOptionsList.length-1].otherContent),x.type==1){x.optionId="",x.text="",x.showInput=!1;const oe=x.orthOptionsList.filter(te=>te.choosen===!0);oe.length>0&&(x.optionId=oe[0].id)}else if(x.type==2){x.optionId=[],x.optionId1=[],x.text="",x.showInput=!1;const oe=x.orthOptionsList.filter(te=>te.choosen===!0);oe.length>0&&(x.optionId=oe.map(te=>te.id),x.optionId1=x.optionId)}})})}ae();const fe=I({}),ne=I([]);async function Z(){const ee=await Le(`/prod-api/business/orthClass/list/2/临床检查/${W}`);fe.value=ee.data[0],ee.data.forEach(ue=>{ue.orthTitleList.forEach(x=>x.showInput=!1)}),ee.data.forEach(ue=>{ue.orthTitleList.forEach(x=>{if(x.orthOptionsList[x.orthOptionsList.length-1].otherContent&&(x.otherContent=x.orthOptionsList[x.orthOptionsList.length-1].otherContent),x.titleName=="关节弹响"){x.optionId="",x.text="",x.showInput=!1,x.selectId="";const oe=x.orthOptionsList.filter(te=>te.choosen===!0);if(oe.length>0){x.optionId=oe[0].id,Ne.value=x.optionId!==10;const te=x.listMap.filter(ye=>ye.choosen===!0);te.length>0&&(x.selectId=te[0].id)}}else if(x.titleName=="侧关节"){x.optionId=[],x.text="",x.showInput=!1,x.selectId1="",x.selectId2="";const oe=x.orthOptionsList.filter(ye=>ye.choosen===!0);oe.length>0&&(x.selectId1=oe[0].id);const te=x.listMap.filter(ye=>ye.choosen===!0);te.length>0&&(x.selectId2=te[0].id)}else if(x.titleName=="骨龄"){x.optionId="",x.text="",x.showInput=!1,x.selectId1="",x.selectId2="",ne.value=x.orthOptionsList.filter(te=>te.optionName==="骨龄超"||te.optionName==="骨龄晚").map(()=>I(null)),x.orthOptionsList.forEach(te=>{(te.optionName==="骨龄超"||te.optionName==="骨龄晚")&&(te.fillColor="#C9CDD4",te.seriousColor="#f44c4c",te.hoverColor="#2e6ce4",te.clicked=!!te.choosen,te.visible=!1)});const oe=x.orthOptionsList.filter(te=>te.choosen===!0);oe.length>0&&(x.optionId=oe[0].id)}else if(x.type==1){x.optionId="",x.text="",x.showInput=!1;const oe=x.orthOptionsList.filter(te=>te.choosen===!0);oe.length>0&&(x.optionId=oe[0].id)}else if(x.type==2){x.optionId=[],x.optionId1=[],x.text="",x.showInput=!1;const oe=x.orthOptionsList.filter(te=>te.choosen===!0);oe.length>0&&(x.optionId=oe.map(te=>te.id),x.optionId1=x.optionId)}})})}Z();const Ne=I(!1);async function Oe(ee,ue){g.value=!0,f.pdfId&&sessionStorage.removeItem(f.pdfId),vo(ee,ue,W,Ne,fe),(await xe(ue.optionId,ue,"",W)).code==200&ue.titleName=="骨龄"}const z=ee=>{ne.value[ee].value[0].input.value||ne.value[ee].value[0].focus()};async function ke(ee,ue){if(ue.titleName=="关节弹响"){let x={apmtId:W,titleId:ue.id,optionsIdStr:[ee.optionId,ee.selectId],otherContent:"",cephalometricsContent:"",fdiToothCode:"",showPosition:""};await me("/prod-api/business/optionsResult",x)}if(ue.titleName=="侧关节"){let x={apmtId:W,titleId:ue.id,optionsIdStr:ee.selectId2==""?[ee.selectId1]:[ee.selectId1,ee.selectId2],otherContent:"",cephalometricsContent:"",fdiToothCode:"",showPosition:""};await me("/prod-api/business/optionsResult",x)}}const he=(ee,ue)=>{xe(ee,ue,"",W)};return(ee,ue)=>{const x=Xo,oe=mo,te=no,ye=xo,pe=No,Xe=Go,$=Ps,V=Ms;return o(),n("div",aa,[j(Se,{text:"患者信息",backgroundColor:"#f4f7fd"}),r("div",na,[r("div",la,[ia,r("span",da,E(u.value.Name),1)]),r("div",ra,[ua,r("span",ca,E(u.value.PrivateId),1)]),r("div",ha,[pa,r("span",fa,E(u.value.Sex===1?"男":u.value.Sex===2?"女":"未知"),1)]),r("div",ma,[va,r("span",_a,E(u.value.age),1)])]),j(Se,{text:"问诊",backgroundColor:"#f4f7fd"}),r("div",ga,[j(_e,{label:"主诉",width:"58px"},{default:h(()=>[j(x,{modelValue:U.value,"onUpdate:modelValue":ue[0]||(ue[0]=l=>U.value=l)},null,8,["modelValue"])]),_:1}),j(_e,{label:"现病史",width:"58px"},{default:h(()=>[j(x,{modelValue:G.value,"onUpdate:modelValue":ue[1]||(ue[1]=l=>G.value=l)},null,8,["modelValue"])]),_:1}),(o(!0),n(T,null,S(de.value,l=>(o(),n(T,{key:l.id},[l.className?(o(),C(_e,{key:0,label:l.className,class:"specialFormItem"},{default:h(()=>[r("div",ya,[(o(!0),n(T,null,S(l.orthTitleList,d=>(o(),C(_e,{label:d.titleName,width:"100px",key:d.id},{default:h(()=>[d.type==1?(o(),C(te,{key:0,modelValue:d.optionId,"onUpdate:modelValue":c=>d.optionId=c,onChange:c=>Oe(d.optionId,d)},{default:h(()=>[(o(!0),n(T,null,S(d.orthOptionsList,c=>(o(),C(oe,{class:Y({serious:c.serious=="1",checked:c.choosen===!0}),key:c.id,label:c.id},{default:h(()=>[J(E(c.optionName),1)]),_:2},1032,["class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):R("",!0),d.type==2?(o(),C(pe,{key:1,modelValue:d.optionId,"onUpdate:modelValue":c=>d.optionId=c,onChange:c=>Oe(d.optionId,d)},{default:h(()=>[(o(!0),n(T,null,S(d.orthOptionsList,c=>(o(),C(ye,{class:Y({serious:c.serious=="1",checked:c.choosen===!0}),key:c.id,label:c.id},{default:h(()=>[J(E(c.optionName)+" ",1),c.serious=="0"?(o(),n("img",Ia)):(o(),n("img",ba))]),_:2},1032,["class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):R("",!0),d.optionId.constructor===Array&&d.optionId.includes(9)||d.optionId==9?(o(),C(x,{key:2,placeholder:"请输入",modelValue:d.otherContent,"onUpdate:modelValue":c=>d.otherContent=c,onBlur:c=>he(d.optionId,d)},null,8,["modelValue","onUpdate:modelValue","onBlur"])):R("",!0)]),_:2},1032,["label"]))),128))])]),_:2},1032,["label"])):(o(),n("div",Ca,[(o(!0),n(T,null,S(l.orthTitleList,d=>(o(),C(_e,{label:d.titleName,width:"100px",key:d.id},{default:h(()=>[j(te,{modelValue:d.optionId,"onUpdate:modelValue":c=>d.optionId=c,onChange:c=>Oe(d.optionId,d)},{default:h(()=>[(o(!0),n(T,null,S(d.orthOptionsList,c=>(o(),C(oe,{key:c.id,label:c.id,class:Y({serious:c.serious=="1",checked:c.choosen===!0})},{default:h(()=>[J(E(c.optionName),1)]),_:2},1032,["label","class"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1032,["label"]))),128))]))],64))),128))]),j(Se,{text:"临床检查",backgroundColor:"#f4f7fd"}),r("div",ka,[(o(!0),n(T,null,S(fe.value.orthTitleList,l=>(o(),n(T,{key:l.id},[l.titleName!=="关节弹响"&&l.titleName!=="侧关节"?(o(),C(_e,{key:0,label:l.titleName,width:"100px"},{default:h(()=>[l.type==1?(o(),C(te,{key:0,modelValue:l.optionId,"onUpdate:modelValue":d=>l.optionId=d,onChange:d=>Oe(l.optionId,l)},{default:h(()=>[(o(!0),n(T,null,S(l.orthOptionsList,(d,c)=>(o(),n(T,{key:d.id},[d.optionSuffix?(o(),C(Xe,{key:1,"popper-class":"myPopper","popper-style":{width:"auto","min-width":"100px"},placement:"top-start",width:200,visible:d.visible,onShow:le=>z(c-2)},{reference:h(()=>[j(oe,{class:Y({serious:d.serious=="1",checked:d.choosen===!0}),label:d.id,onMouseenter:le=>re(d),onMouseleave:le=>D(d)},{default:h(()=>[J(E(d.optionName),1),(o(),n("svg",wa,[r("g",null,[r("path",{d:"M0,4.99999C0,2.23857,2.23857,0,4.99999,0C7.76141,0,9.99998,2.23857,9.99998,4.99999C9.99998,7.76141,7.76141,9.99998,4.99999,9.99998C2.23857,9.99998,0,7.76141,0,4.99999C0,4.99999,0,4.99999,0,4.99999ZM5.49999,3.49999C5.49999,3.49999,5.49999,2.49999,5.49999,2.49999C5.49999,2.49999,4.49999,2.49999,4.49999,2.49999C4.49999,2.49999,4.49999,3.49999,4.49999,3.49999C4.49999,3.49999,5.49999,3.49999,5.49999,3.49999C5.49999,3.49999,5.49999,3.49999,5.49999,3.49999ZM4.49999,3.99999C4.49999,3.99999,4.49999,7.49998,4.49999,7.49998C4.49999,7.49998,5.49999,7.49998,5.49999,7.49998C5.49999,7.49998,5.49999,3.99999,5.49999,3.99999C5.49999,3.99999,4.49999,3.99999,4.49999,3.99999C4.49999,3.99999,4.49999,3.99999,4.49999,3.99999Z","fill-rule":"evenodd",fill:d.clicked?d.seriousColor:d.hover?d.hoverColor:d.fillColor,"fill-opacity":"1"},null,8,La)])]))]),_:2},1032,["class","label","onMouseenter","onMouseleave"])]),default:h(()=>{var le;return[j(x,{maxlength:"2",ref_for:!0,ref:ne.value[c-2],modelValue:d.otherContent,"onUpdate:modelValue":Ie=>d.otherContent=Ie,onBlur:Ie=>y(l.optionId,l,d),class:Y({borderless:d.otherContent})},null,8,["modelValue","onUpdate:modelValue","onBlur","class"]),J(E((le=d.optionSuffix)==null?void 0:le.substr(-1)),1)]}),_:2},1032,["visible","onShow"])):(o(),C(oe,{key:0,class:Y({serious:d.serious=="1"}),label:d.id},{default:h(()=>[J(E(d.optionName),1)]),_:2},1032,["class","label"]))],64))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):R("",!0),l.type==2?(o(),C(pe,{key:1,modelValue:l.optionId,"onUpdate:modelValue":d=>l.optionId=d,onChange:d=>Oe(l.optionId,l)},{default:h(()=>[(o(!0),n(T,null,S(l.orthOptionsList,d=>(o(),C(ye,{class:Y({serious:d.serious=="1",checked:d.choosen===!0}),key:d.id,label:d.id},{default:h(()=>[J(E(d.optionName)+" ",1),d.serious=="0"?(o(),n("img",xa)):(o(),n("img",Na))]),_:2},1032,["class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):R("",!0),l.optionId.constructor===Array&&l.optionId.includes(9)||l.optionId==9?(o(),C(x,{key:2,placeholder:"请输入",modelValue:l.otherContent,"onUpdate:modelValue":d=>l.otherContent=d,onBlur:d=>he(l.optionId,l)},null,8,["modelValue","onUpdate:modelValue","onBlur"])):R("",!0)]),_:2},1032,["label"])):R("",!0),l.titleName=="关节弹响"?(o(),n("div",Ta,[r("div",$a,E(l.titleName),1),j(te,{class:"specialRadio",modelValue:l.optionId,"onUpdate:modelValue":d=>l.optionId=d,onChange:d=>Oe(l.optionId,l)},{default:h(()=>[(o(!0),n(T,null,S(l.orthOptionsList,d=>(o(),C(oe,{class:Y({serious:d.serious=="1",checked:d.choosen===!0}),key:d.id,label:d.id},{default:h(()=>[J(E(d.optionName),1)]),_:2},1032,["class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),Ne.value?(o(),C(V,{key:0,modelValue:l.selectId,"onUpdate:modelValue":d=>l.selectId=d,class:"specialSelect",onChange:d=>ke(l,l)},{default:h(()=>[(o(!0),n(T,null,S(l.listMap,d=>(o(),C($,{key:d.id,label:d.optionName,value:d.id},{default:h(()=>[J(E(d.optionName),1)]),_:2},1032,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):R("",!0)])):R("",!0),Ne.value&&l.titleName=="侧关节"?(o(),n("div",Va,[r("div",Ua,E(l.titleName),1),j(V,{modelValue:l.selectId1,"onUpdate:modelValue":d=>l.selectId1=d,class:"specialSelect",onChange:d=>ke(l,l)},{default:h(()=>[(o(!0),n(T,null,S(l.orthOptionsList,d=>(o(),C($,{key:d.id,label:d.optionName,value:d.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),j(V,{modelValue:l.selectId2,"onUpdate:modelValue":d=>l.selectId2=d,class:"specialSelect",onChange:d=>ke(l,l)},{default:h(()=>[(o(!0),n(T,null,S(l.listMap,d=>(o(),C($,{key:d.id,label:d.optionName,value:d.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])])):R("",!0)],64))),128))])])}}},Oa=Ge(Sa,[["__scopeId","data-v-18146a02"]]);const Yt=k=>(io("data-v-32374294"),k=k(),ro(),k),Ea={class:"diagram"},Pa={class:"diagramBox"},Ma={class:"toothItem1"},Aa={class:"toothItem2"},Da={class:"diagramBox"},Fa={class:"toothItem3"},Ba={class:"toothItem4"},Ra={class:"selectContainer",id:"selectContainer"},ja={class:"container"},Wa=["id","onClick"],qa=Yt(()=>r("div",{class:"left"},"右",-1)),Ga=Yt(()=>r("div",{class:"right"},"左",-1)),Za={__name:"tooth",props:["title","appId","data","step"],emits:["submitTooth"],setup(k,{emit:p}){const g=k,f=p,U=I(g.title),G=I(g.data);Yo(()=>g.title,y=>{U.value=y});const X=I([]);X.value=Zo();const W=y=>{X.value.forEach(u=>{u.forEach(M=>{var de;M.active=!1,(de=y.toothCode)!=null&&de.includes(M.value+"")&&(M.active=!0)})})},q=(y,u)=>{Rt(y,u)},re=y=>{if(g.step==2){if(!y.submitAble)return;let u={apmtId:g.appId,titleId:y.id,optionsIdStr:[],otherContent:"",cephalometricsContent:"",fdiToothCode:y.toothCode.join(),showPosition:JSON.stringify(y.position)};me("/prod-api/business/optionsResult",u).then(()=>{y.submitAble=!1})}else f("submitTooth",y)},A=(y,u)=>{if(console.log(y,u),u.hasImage)u.orthTitleList.forEach(M=>{y!==M&&(M.popVisible=!1)}),y.popVisible=!y.popVisible,console.log();else return},D=(y,u)=>{A(y,u)};return(y,u)=>{const M=Go;return o(),C(M,{width:490,visible:U.value.popVisible,onShow:u[1]||(u[1]=de=>W(U.value)),onAfterLeave:u[2]||(u[2]=de=>re(U.value))},{reference:h(()=>{var de,ae,fe,ne;return[r("div",{class:"diagramWrapper",onClick:u[0]||(u[0]=Lo(Z=>D(U.value,G.value),["stop"]))},[r("div",Ea,[r("div",Pa,[r("div",Ma,E((de=U.value.topLeft)==null?void 0:de.sort((Z,Ne)=>Z.sort-Ne.sort).map(Z=>Z.value).join("")),1),r("div",Aa,E((ae=U.value.topRight)==null?void 0:ae.sort((Z,Ne)=>Z.sort-Ne.sort).map(Z=>Z.value).join("")),1)]),r("div",Da,[r("div",Fa,E((fe=U.value.bottomLeft)==null?void 0:fe.sort((Z,Ne)=>Z.sort-Ne.sort).map(Z=>Z.value).join("")),1),r("div",Ba,E((ne=U.value.bottomRight)==null?void 0:ne.sort((Z,Ne)=>Z.sort-Ne.sort).map(Z=>Z.value).join("")),1)])])])]}),default:h(()=>[r("div",Ra,[r("div",ja,[(o(!0),n(T,null,S(X.value,(de,ae)=>(o(),n("div",{key:ae,class:Y(["symptomBox",{itemAlignRight:ae===2||ae===4||ae===0||ae===6,marginTop:ae==4||ae==5,marginBottom:ae==2||ae==3,marginRight:ae===2||ae===4||ae===0||ae===6,marginLeft:ae===1||ae===3||ae===5||ae===7}])},[(o(!0),n(T,null,S(de,(fe,ne)=>(o(),n("div",{class:Y(["symptomItem",{selected:fe.active===!0}]),id:fe.value,key:ne,onClick:Lo(Z=>q(fe,U.value),["stop"])},E(fe.label),11,Wa))),128))],2))),128))]),qa,Ga])]),_:1},8,["visible"])}}},Ro=Ge(Za,[["__scopeId","data-v-32374294"]]),Ja="/assets/arrange-8ba5d6cc.svg",Xa="/assets/AIFlagForFront-be72ba22.svg",Ya="/assets/AI-1752b7a7.svg",za="/assets/downwards-554b1728.svg",Ha="/assets/upwards-d82d8d75.svg",Qa="/assets/close-3d4ba752.svg";function wo(k,p){let g;k.includes("-")?g=k.split("-").filter(u=>u!=="-"):g=k.split("");const f=p.find(u=>g[0]==="Na"?u.label=="N":u.label==g[0]),U=p.find(u=>u.label==g[1]),G=p.find(u=>u.label==g[2]),X={x:U.x-f.x,y:U.y-f.y},W={x:G.x-U.x,y:G.y-U.y},q=Math.sqrt(X.x*X.x+X.y*X.y),re=Math.sqrt(W.x*W.x+W.y*W.y),A=X.x*W.x+X.y*W.y;return 180-Math.acos(A/(q*re))*180/Math.PI}function Ao(k,p){const g=k.split("/"),f=g[0],U=g[1],G=Mt(f,p),X=Mt(U,p);return G/(X!==0?X:1)*100}function Mt(k,p){let g;k.includes("-")?g=k.split("-").filter(q=>q!=="-"):g=k.split("");const f=p.find(q=>q.label==g[0]),U=p.find(q=>q.label==g[1]),G=U.x-f.x,X=U.y-f.y;return Math.sqrt(G*G+X*X)}function Do(k,p){let g,f,U,G;k=="U1-SN"&&(g=p.find(u=>u.label=="UI"),f=p.find(u=>u.label=="UI_1"),U=p.find(u=>u.label=="S"),G=p.find(u=>u.label=="N")),k=="SN-MP"&&(g=p.find(u=>u.label=="S"),f=p.find(u=>u.label=="N"),U=p.find(u=>u.label=="Go_1"),G=p.find(u=>u.label=="Me")),k=="L1-MP"&&(g=p.find(u=>u.label=="LI"),f=p.find(u=>u.label=="LI_1"),U=p.find(u=>u.label=="Go_1"),G=p.find(u=>u.label=="Me")),k=="FH-MP"&&(g=p.find(u=>u.label=="P"),f=p.find(u=>u.label=="Or"),U=p.find(u=>u.label=="Go_1"),G=p.find(u=>u.label=="Me")),k=="ODI"&&(g=p.find(u=>u.label=="A"),f=p.find(u=>u.label=="B"),U=p.find(u=>u.label=="Go"),G=p.find(u=>u.label=="Gn"),console.log(g,f,U,G)),k=="APDIAngle1"&&(g=p.find(u=>u.label=="N"),f=p.find(u=>u.label=="P"),U=p.find(u=>u.label=="P"),G=p.find(u=>u.label=="Or")),k=="APDIAngle2"&&(g=p.find(u=>u.label=="A"),f=p.find(u=>u.label=="B"),U=p.find(u=>u.label=="N"),G=p.find(u=>u.label=="P"));const X={x:f.x-g.x,y:f.y-g.y},W={x:G.x-U.x,y:G.y-U.y},q=X.x*W.x+X.y*W.y,re=Math.sqrt(X.x**2+X.y**2),A=Math.sqrt(W.x**2+W.y**2);return Math.acos(q/(re*A))*(180/Math.PI)}function At(k,p,g){const f={x:g.x-p.x,y:g.y-p.y},U={x:k.x-p.x,y:k.y-p.y},G=(U.x*f.x+U.y*f.y)/(f.x*f.x+f.y*f.y),X=p.x+G*f.x,W=p.y+G*f.y;return{x:X,y:W}}function jo(k,p,g,f,U,G,X){console.log(k,p,g,f,U,G);const W={x:(U.x+G.x)/2,y:(U.y+G.y)/2},q={x:(g.x+f.x)/2,y:(g.y+f.y)/2},re=At(k,W,q),A=At(p,W,q),D=A.x-re.x,y=A.y-re.y,u=Math.sqrt(D*D+y*y);return A.x>re.x?u*20/X:-u*20/X}jo({x:1,y:2},{x:-1,y:-2},{x:2,y:1},{x:2,y:-1},{x:-2,y:-1},{x:-2,y:1});function Fo(k,p,g){const f=Math.sqrt(Math.pow(p.x-g.x,2)+Math.pow(p.y-g.y,2)),U={x:p.x-k.x,y:p.y-k.y},G={x:g.x-k.x,y:g.y-k.y};return Math.abs((U.x*G.y-U.y*G.x)/f)}function Wo(k,p){const g=p.x-k.x,f=p.y-k.y;return Math.sqrt(g*g+f*f)}function Dt(k){const p=k.find(f=>f.label=="forehead_center"),g=k.find(f=>f.label=="chin_2");return Wo(p,g)/3}function qo(k){k.topLeft=[],k.topRight=[],k.bottomLeft=[],k.bottomRight=[];const p=JSON.parse(k.showPosition);k.fdiToothCode?(k.toothCode=k.fdiToothCode.split(","),k.fdiToothCode.split(",").forEach((g,f)=>{g.startsWith("1")||g.startsWith("5")?k.topLeft.push(p[f][0]):g.startsWith("2")||g.startsWith("6")?k.topRight.push(p[f][0]):g.startsWith("4")||g.startsWith("8")?k.bottomLeft.push(p[f][0]):(g.startsWith("3")||g.startsWith("7"))&&k.bottomRight.push(p[f][0])})):k.toothCode=[],k.position=p||[],k.submitAble=!1}const Re=k=>(io("data-v-52fdf6ef"),k=k(),ro(),k),Ka={class:"stepTwo"},en=Re(()=>r("img",{src:Ja},null,-1)),on={class:"content",style:{"min-height":"700px"}},tn={key:0,id:"FrontalRose",width:"320",height:"240"},sn={key:1,style:{height:"240px","object-fit":"cover","max-width":"320px"}},an=["onClick"],nn=["src"],ln={class:"aiFlagImg",src:Xa},dn={key:0,src:Pe},rn={key:1,src:Me},un={class:"content mouth"},cn={key:0,style:{width:"320px",height:"240px","object-fit":"cover","border-radius":"10px"}},hn=["onClick"],pn=["src"],fn=["src"],mn={key:0,src:Pe},vn={key:1,src:Me},_n={class:"content panoramic"},gn=["src"],yn=["onClick"],In=["src"],bn={class:"imageItem__content specialComponent",style:{"min-width":"780px"}},Cn={class:"container"},kn={class:"left-column"},wn={key:0,src:Pe},Ln={key:1,src:Me},xn={class:"right-column"},Nn={key:0,src:Pe},Tn={key:1,src:Me},$n={class:"leftLower-column"},Vn={class:"leftLower-column"},Un={class:"placeholderContainer"},Sn=["src"],On={class:"imageItem__content specialComponent cephalometric",style:{"min-width":"800px"}},En={key:0,class:"formItem"},Pn=["onMouseenter"],Mn=Re(()=>r("img",{src:Jo},null,-1)),An={class:"formItem__content"},Dn={style:{width:"100px",display:"flex","align-items":"center"}},Fn={src:za},Bn={src:Ha},Rn={key:1,class:"formItem"},jn={class:"formItem__label"},Wn=Re(()=>r("img",{src:Jo},null,-1)),qn={class:"formItem__content"},Gn={class:"imageManagement__images subSection"},Zn={class:"title"},Jn=Re(()=>r("div",{class:"title__left"},"图库",-1)),Xn=Re(()=>r("div",{class:"title__middle"},[r("img",{src:Vs,style:{"margin-right":"4px"}}),J(" 可直接拖拽照片到右侧指定位置或点击下方一键“自动分类”哦～ ")],-1)),Yn={class:"title__right file-upload"},zn={class:"file-upload__label"},Hn={style:{"padding-left":"14px","padding-bottom":"50px","padding-top":"50px"}},Qn={key:0,class:"imgContainer__empty",src:Ns},Kn={class:"imgContainer"},el=["onMouseenter","onMouseleave"],ol={style:{position:"relative",border:"1px solid #e5e6eb","border-radius":"12px"}},tl=["src","onDragstart","onClick"],sl=["onClick"],al=Re(()=>r("span",null,"加载上次影像",-1)),nl=Re(()=>r("img",{src:Us},null,-1)),ll=[al,nl],il={class:"classifyWrapper"},dl={style:{"margin-right":"6px"}},rl={class:"imageManagement__classify subSection"},ul=Re(()=>r("div",{class:"title"},"分类",-1)),cl={class:"imageWrapper"},hl=["onMouseenter","onMouseleave"],pl={style:{position:"relative",border:"1px solid #e5e6eb","border-radius":"12px",overflow:"hidden",height:"80px"}},fl=["src","onDrop","onDragover","onDragstart"],ml={key:0,style:{cursor:"pointer"},class:"deleteImage",src:Ts},vl={class:"item__caption"},_l={class:"dialog-footer"},gl=Re(()=>r("div",{class:"overlay__header"},null,-1)),yl=Re(()=>r("div",{class:"overlay__mask"},null,-1)),Il=["src"],bl=Re(()=>r("img",{id:"img",style:{opacity:0}},null,-1)),Ft=665/390,Cl={__name:"stepTwo",props:{pdfId:String},setup(k,{expose:p}){const g=lo(),f=g.params.appId,U=g.params.patientId;js(()=>{const e=document.createElement("link");e.href=Ot,e.rel="preload",e.as="image",document.head.appendChild(e)});const G=I(!1);p({clicked:G});const X=k,W=I(!1),q=()=>{He.value.style.display="flex",W.value=!0},re=()=>{He.value.style.display="none",W.value=!1},A=I(window.innerWidth-900),D=I((A.value/Ft).toFixed(2));window.addEventListener("resize",()=>{if(window.innerWidth<1080)return;document.getElementById("myCanvas")&&(A.value=window.innerWidth-900,D.value=(A.value/Ft).toFixed(2),H.value=Te.value.map(s=>({label:s.label,x:s.x*A.value,y:s.y*D.value})),oo(A.value,D.value,!0))});const y=I([]),u=I([]),M=I([]),de=new FormData;y.value=Zo();const ae=I(!1),fe=e=>{const s=e.target.files;if(s.length>16)e.preventDefault(),Fe("最多上传16张图片");else{for(let t=0;t<s.length;t++){const a=s[t];if(de.append("files",a),a){const i=new FileReader;i.onload=()=>{u.value.push(i.result),M.value.push({imgUrl:i.result,showFlag:!1,choose:!0,file:a})},i.readAsDataURL(a)}}ae.value?he.value[0].imageList=M.value:(he.value.unshift({file:!0,StartTime:"2023-8-14",imageList:M.value}),ae.value=!0)}},ne=e=>{e.measured=!0,e.cephalometricsContent!==e.AIValue&&(e.aiFlag="0");let s={apmtId:f,titleId:e.id,optionsIdStr:[],otherContent:"",cephalometricsContent:e.cephalometricsContent?e.cephalometricsContent:"",fdiToothCode:"",showPosition:""};me("/prod-api/business/optionsResult",s).then(t=>{if(t.code==200&&t.data.optionsId){e.optionId=t.data.optionsId;let a={apmtId:f,titleId:e.id,optionsIdStr:[t.data.optionsId],otherContent:"",cephalometricsContent:"",fdiToothCode:"",showPosition:""};e.inputVal=e.cephalometricsContent,me("/prod-api/business/optionsResult",a),me("/prod-api/business/optionsResult/updateAIType",{apmtId:f,cephalometricsList:[{titleId:e.id,aiType:2}]})}else t.code==500&&t.msg&&(e.cephalometricsContent=e.inputVal,Fe({type:"error",message:t.msg}))})},Z=()=>{},Ne=Zt(()=>{let e=0;return he.value.forEach(s=>{s.imageList.forEach(t=>{t.choose&&e++})}),e}),Oe=e=>{e.choose=!e.choose},z=e=>{e.id?As(`/prod-api/business/orthImage/${e.id}`).then(s=>{if(s.code==200){const t=oe.value.find(a=>e==a);t.fileUrl=Ce,t.id=void 0}}):e.fileUrl=Ce},ke=I(0),he=I([]),ee=I([]),ue=()=>{eo.value=!0,oe.value.forEach(e=>{e.fileUrl=Ce}),Eo()},x=()=>{if(he.value.length<ee.value.length){ee.value[he.value.length].imageList.forEach(s=>{s.imgUrl=s.fileUrl});const e=ee.value.slice(ke.value+1).find(s=>s.imageList.length!==0);e?(he.value.push(e),ke.value=ee.value.findIndex(s=>s==he.value[he.value.length-1]),he.value[he.value.length-1].imageList.forEach(s=>{s.imgUrl=s.fileUrl})):Fe("没有更多图像了哦")}},oe=I([{caption:"正面像",typeName:"FrontalRepose",fileUrl:Ce},{caption:"正面微笑像",typeName:"FrontalSmile",fileUrl:Ce},{caption:"90度侧面像",typeName:"LeftProfile",fileUrl:Ce},{caption:"90度侧面微笑像",typeName:"RightProfile",fileUrl:Ce},{caption:"45度侧面像",typeName:"LeftSideProfile",fileUrl:Ce},{caption:"45度侧面微笑像",typeName:"RightSideProfile",fileUrl:Ce},{caption:"口内照（左侧）",typeName:"",fileUrl:Ce},{caption:"口内照（右侧）",typeName:"",fileUrl:Ce},{caption:"磨牙关系（左侧）",typeName:"Left",fileUrl:Ce},{caption:"磨牙关系（右侧）",typeName:"Right",fileUrl:Ce},{caption:"正面咬合",typeName:"Anterior",fileUrl:Ce},{caption:"前牙覆盖",typeName:"Cover",fileUrl:Ce},{caption:"上颌",typeName:"Upper",fileUrl:Ce},{caption:"下颌",typeName:"Lower",fileUrl:Ce},{caption:"全景片",typeName:"Panoramic",fileUrl:Ce},{caption:"侧位片",typeName:"Cephalometric",fileUrl:Ce}]);async function te(){let e;const s=await Pt({url:"http://47.101.150.34:8177/bonceph/platform/user/login",method:"post",data:{username:"bonceph",userpwd:"4371f7b311bf4f88cbd27855f3143430"}});return s.status==200&&(e=s.data.data.token),e}const ye=I(!1),pe=I();async function Xe(){if(Ne.value==0)Fe({message:"未选中图片",type:"error"});else{const e=Bo.service({lock:!0,text:"正在分类中",background:"rgba(0, 0, 0, 0.7)",target:pe.value});e.value=!0;const s=new FormData;let t,a;he.value.filter(_=>_.file===void 0).forEach(_=>{a=_.imageList.filter(N=>N.choose===!0).map(N=>{if(N.choose)return{ljUrl:N.imgUrl,ljId:N.id,LJCreateDatetime:N.timestamp}})}),t=JSON.stringify({patientId:U,apmtId:f,orthImageList:a}),he.value.filter(_=>_.file===!0).length>0?he.value.filter(_=>_.file===!0)[0].imageList.filter(_=>_.choose===!0).forEach(_=>{s.append("files",_.file)}):s.append("files",null),s.append("orthImageString",t);const i=await me("/prod-api/business/orthImage/handleMultiImage",s,!0);e.close(),i.code===200&&(he.value.forEach(_=>_.imageList.forEach(N=>N.choose=!1)),i.data.forEach(_=>{oe.value.forEach(N=>{_.typeName==N.typeName&&(N.fileUrl=_.fileUrl,N.imageId=_.fileId)})}))}}const $=I(null),V=I(),l=e=>{$.value=e,$.value.rightDrop=!0,V.value=$.value.fileUrl;const s=document.getElementById("img");s.src=e.fileUrl,s.style.opacity=1,s.width=120,s.height=80,s.style.position="absolute",s.style.top="-9999px",s.style.objectFit="cover",s.style.border="2px solid #2E6CE4",s.style.boxShadow="0px 9px 18px 0px rgba(0, 0, 0, 0.57)",event.dataTransfer.setDragImage(s,60,40)},d=(e,s)=>{e.file?(s.dataTransfer.setData("text/plain",e),$.value=s.dataTransfer.files[0]):$.value=e;const t=document.getElementById("img");t.src=e.imgUrl,t.style.opacity=1,t.width=120,t.height=80,t.style.position="absolute",t.style.top="-9999px",t.style.objectFit="cover",t.style.border="2px solid #2E6CE4",t.style.boxShadow="0px 9px 18px 0px rgba(0, 0, 0, 0.57)",s.dataTransfer.setDragImage(t,60,40)},c=()=>{const e=document.getElementById("img");e.style.opacity=0},le=(e,s)=>{const t=document.getElementById("img");if(t.style.opacity=0,e.target.classList.remove("hover"),!$.value.rightDrop)be($.value,s);else{if($.value.id)z($.value);else{const a=oe.value.find(i=>$.value.fileUrl==i.fileUrl);a.fileUrl=Ce}s.id?so("/prod-api/business/orthImage",{id:s.id,imageUrl:V.value}).then(()=>{Eo()}):s.fileUrl=V.value}},Ie=I(0);async function be(e,s){const t=new FormData;e.type?(t.append("file",e,"Cover"),t.append("orthImageString",JSON.stringify({patientId:U,apmtId:f,orthImageList:[]}))):t.append("orthImageString",JSON.stringify({patientId:U,apmtId:f,orthImageList:[{ljUrl:e.imgUrl,ljId:e.id,LJCreateDatetime:e.timestamp}]}));const a=await me("/prod-api/business/orthImage/handleSingleImage",t,!0);a.code==200&&a.data[0].fileUrl?(s.fileUrl=a.data[0].fileUrl,s.imageId=a.data[0].fileId):(s.fileUrl=Ce,Ie.value==0?(Ie.value++,Fe({message:"拖拽失败，请再试一次",type:"warning"})):Fe({message:"拖拽失败，请联系管理员",type:"warning"}))}async function ge(){eo.value=!1,oe.value.forEach(t=>t.reminder=!1);const s=oe.value.filter(t=>t.fileUrl.startsWith("https")).map(t=>({imageType:t.caption,imageUrl:t.fileUrl,imageId:t.fileId||null}));me("/prod-api/business/orthImage",{apmtId:f,orthImageList:s}).then(()=>{Q()})}const L=e=>{!e.target.src.endsWith("jpeg")&&!e.target.src.endsWith("jpg")&&(e.target.src=Ss,e.target.classList.add("hover"))},m=e=>{!e.target.src.endsWith("jpeg")&&!e.target.src.endsWith("jpg")&&(e.target.src=Ce),e.target.classList.remove("hover")};function Q(){co(),ct(),tt(),ut()}const we=()=>{oe.value.forEach(e=>e.reminder=!1)},ce=I([]),$e=I([]),je=["forehead_center","eyebrow_right_corner_left","eyebrow_left_corner_right","nose_middle_contour","chin_2","cheek_right_1","cheek_left_1"],uo=I(0),zt=I(0),Vo=I(0);function zo(e,s,t,a){const i=new Image,_=document.getElementById(a),N=_.getContext("2d");i.onload=function(){const F=i.width,v=i.height;let P=F,ie=v;Vo.value=F/v,P>e&&(P=e,ie=P/Vo.value),ie>s&&(ie=s,P=ie*Vo.value),_.width=P,uo.value=P,_.height=ie,zt.value=ie,N.clearRect(0,0,_.width,_.height),N.drawImage(i,0,0,P,ie),Ht(N,i,_,qe.value)},i.src=t}function Ht(e,s,t,a){e.clearRect(0,0,t.width,t.height),e.drawImage(s,0,0,t.width,t.height),a.forEach(function(i){const _=i.x,N=i.y;e.beginPath(),e.arc(_,N,2,0,2*Math.PI),e.fillStyle="red",e.fill()}),os(e,t)}async function Qt(e){const s=Fo(e[6],e[0],e[3]),t=Fo(e[5],e[0],e[3]),a=ce.value[0].orthTitleList[0];if(a.aiFlag="1",a.aiTest=!0,s<t){const i=a.orthOptionsList[2].id;await xe(i,a,"",f)}else if(s>t){const i=a.orthOptionsList[1].id;await xe(i,a,"",f)}else{const i=a.orthOptionsList[0].id;await xe(i,a,"",f)}}async function Kt(e){const s=ce.value[0].orthTitleList[3];s.aiFlag="1",s.aiTest=!0;const t=Fo(e[3],e[2],e[1]),a=Dt(e);Ko(t,a,s)}async function es(e){const s=ce.value[0].orthTitleList[4];s.aiFlag="1",s.aiTest=!0;const t=Wo(e[3],e[4]),a=Dt(e);Ko(t,a,s)}async function Ho(e){await Qt(e),await Kt(e),await es(e),co()}const Qo=I(!1);async function Ko(e,s,t){if(e>s){const a=t.orthOptionsList[2].id;await xe(a,t,"",f)}else if(e<s){const a=t.orthOptionsList[1].id;await xe(a,t,"",f)}else{const a=t.orthOptionsList[0].id;await xe(a,t,"",f)}co()}function os(e,s){e.strokeStyle="green",e.lineWidth=1,e.beginPath(),qe.value.forEach(t=>{e.moveTo(0,t.y),e.lineTo(s.width,t.y),e.strokeStyle="blue"}),e.stroke(),e.strokeStyle="purple",e.lineWidth=1,e.beginPath(),e.moveTo(qe.value[0].x,0),e.lineTo(qe.value[3].x,s.height),e.stroke()}async function ts(e){me("/prod-api/business/orthPoint",{apmtId:f,pointType:2,pointList:e})}const qe=I([]),_o=I(),et=I();async function co(){const e=await Le(`/prod-api/business/orthClass/list/2/面型评估/${f}`);ce.value=e.data,e.data.forEach(s=>s.orthTitleList.forEach(t=>t.showInput=!1)),e.data.forEach(s=>{if(!s.imageUrl)s.hasImage=!1;else{s.hasImage=!0;const t=document.createElement("link");if(t.href=s.imageUrl,t.rel="preload",t.as="image",document.head.appendChild(t),s.className==="正面像"){const a=s.orthTitleList.find(ie=>ie.titleName=="正貌"),i=s.orthTitleList.find(ie=>ie.titleName=="面中三分之一"),_=s.orthTitleList.find(ie=>ie.titleName=="面下三分之一"),N=a.orthOptionsList.some(ie=>ie.choosen==!0),F=i.orthOptionsList.some(ie=>ie.choosen==!0),v=_.orthOptionsList.some(ie=>ie.choosen==!0);Qo.value=!N||!F||!v,_o.value=s.imageUrl;const P=new FormData;P.append("imageUrl",s.imageUrl),Le(`/prod-api/business/orthPoint/list?apmtId=${f}&pointType=2`).then(ie=>{ie.data.length>0?(qe.value=ie.data.map(K=>({label:K.pointName,x:K.xcoordinate,y:K.ycoordinate})),Qo.value&&Ho(qe.value),ao(()=>{zo(320,240,_o.value,"FrontalRose")})):me("/prod-api/business/orthImage/calculateFaceShapeSet",P,!0).then(K=>{const se=K.data.face_list[0].landmark201,w=new Image;w.onload=()=>{const{width:b,height:B,ratio:O}=ss(w.width,w.height,320,240),to=b/w.width,ve=B/w.height;qe.value=je.map(ze=>({label:ze,x:se[ze].x*to,y:se[ze].y*ve})),Ho(qe.value);const ks=qe.value.map(ze=>[ze.label,ze.x,ze.y]);ts(ks)},w.src=_o.value,ao(()=>{zo(320,240,_o.value,"FrontalRose")})})})}s.className=="正面微笑像"&&(et.value=s.imageUrl)}if(s.className=="90度侧面像"){$e.value=[...s.orthTitleList];const t=s.orthTitleList.find(N=>N.titleName=="凸面型表现"),a=s.orthTitleList.find(N=>N.titleName=="凹面型表现"),i=!t.orthOptionsList.some(N=>N.choosen===!0),_=!a.orthOptionsList.some(N=>N.choosen===!0);i&&_?s.orthTitleList.splice(1,2):_?s.orthTitleList.splice(2,1):i&&s.orthTitleList.splice(1,1)}s.orthTitleList.forEach(t=>{if(t.type==1){t.optionId="",t.text="",t.showInput=!1;const a=t.orthOptionsList.filter(i=>i.choosen===!0);a.length>0&&(t.optionId=a[0].id)}else if(t.type==2){t.optionId=[],t.optionId1=[],t.text="",t.showInput=!1;const a=t.orthOptionsList.filter(i=>i.choosen===!0);a.length>0&&(t.optionId=a.map(i=>i.id),t.optionId1=t.optionId)}})}),Po.value.style.display="block"}function ss(e,s,t,a){let i=0,_=e,N=s;return i=e/s,_>t&&(_=t,N=_/i),N>a&&(N=a,_=N*i),{width:_,height:N,ratio:i}}const ot=I([]);async function tt(){const e=await Le(`/prod-api/business/orthClass/list/2/口内照/${f}`);ot.value=e.data,e.data.forEach(s=>s.orthTitleList.forEach(t=>t.showInput=!1)),e.data.forEach(s=>{s.imageUrl?s.hasImage=!0:s.hasImage=!1,s.orthTitleList.forEach(t=>{if(t.type==1){t.optionId="",t.text="",t.showInput=!1;const a=t.orthOptionsList.filter(i=>i.choosen===!0);a.length>0&&(t.optionId=a[0].id)}else if(t.type==2){t.optionId=[],t.optionId1=[],t.text="",t.showInput=!1;const a=t.orthOptionsList.filter(i=>i.choosen===!0);a.length>0&&(t.optionId=a.map(i=>i.id),t.optionId1=t.optionId)}})})}const st=[co,tt,ut,ct,gs];async function as(){for(;st.length>0;)await st.shift()()}as();const at=I(),Ve=I([]),nt=I(),lt=I(),it=I(!1),dt=I([]);function rt(e){e.value.forEach(s=>{s.orthTitleList.forEach(t=>{qo(t)})}),e.value.forEach(s=>{s.orthTitleList.forEach(t=>{if(t.type==1){t.optionId="",t.text="",t.showInput=!1;const a=t.orthOptionsList.filter(i=>i.choosen===!0);a.length>0&&(t.optionId=a[0].id)}else if(t.type==2){t.optionId=[],t.optionId1=[],t.text="",t.showInput=!1;const a=t.orthOptionsList.filter(i=>i.choosen===!0);a.length>0&&(t.optionId=a.map(i=>i.id),t.optionId1=t.optionId)}})})}async function ut(){const e=await Le(`/prod-api/business/orthClass/list/2/全景片/${f}`);Ve.value=e.data,e.data.forEach(s=>{if(nt.value=s.sourceApmtId?s.sourceApmtId:f,lt.value=s.id,s.imageUrl?(s.hasImage=!0,at.value=s.imageUrl):s.hasImage=!1,!s.flag){it.value=!0;const t={sourceApmtId:nt.value,apmtId:f,classId:lt.value,location:"2"};me("/prod-api/business/orthClass/mouthCheck",t).then(a=>{if(a.code==200){const i=Ve.value[0].orthTitleList.slice(0,6);dt.value=a.data.slice(6),Ve.value[0].orthTitleList=[...i,...dt.value],rt(Ve)}})}s.orthTitleList.forEach(t=>{t.showInput=!1,t.popVisible=!1})}),it.value||rt(Ve)}const ho=I();ho.value=Ot;const Ae=I(null),Ee=I([]);function ns(e){return/^[a-zA-Z]$/.test(e)}async function ct(){const e=await Le(`/prod-api/business/orthClass/list/2/侧位片/${f}`);Ee.value=e.data[0].orthTitleList,Ae.value=e.data[0].imageUrl,Ee.value.some(s=>s.aiFlag=="0")&&(Oo.value=!0),Ae.value&&(Ee.value.some(s=>s.cephalometricsContent)?Le(`/prod-api/business/orthPoint/list/?apmtId=${f}`).then(s=>{ko.value=!0,Io.value=s.data,bo.value=Io.value.filter(t=>kt.includes(t.pointName)),Te.value=bo.value.map(t=>({label:t.pointName,x:t.xCoordinate,y:t.yCoordinate})),oo(A.value,D.value,!0)}):oo(A.value,D.value,!1)),Ee.value.forEach(s=>{ns(s.titleName[0])&&(s.showInput=!0),s.cephalometricsContent&&(s.measured=!0);const t=s.orthOptionsList.filter(a=>a.choosen===!0);t.length>0&&(s.optionId=t[0].id),s.AIValue=s.cephalometricsContent,s.inputVal=s.cephalometricsContent})}async function ls(e){return fetch(e).then(s=>s.blob())}const He=I(null),ht=I(0),pt=I(0),ft=()=>{const e=new Image,s=document.getElementById("myZoomCanvas"),t=s.getContext("2d");e.onload=function(){const a=e.width,i=e.height;let _=a,N=i;const F=window.innerWidth,v=window.innerHeight;_>F?(_=F,N=_/Ye.value):(e.width=window.innerWidth,e.height=e.width/Ye.value,_=e.width,N=e.height),N>v?(N=v,_=N*Ye.value):(e.width=window.innerWidth,e.height=e.width/Ye.value,_=e.width,N=e.height),s.width=_,ht.value=s.width,s.height=N,pt.value=s.height,Ue.value=Te.value.map(P=>({label:P.label,x:P.x*_,y:P.y*N})),Mo(t,e,s,!0)},s.addEventListener("mousemove",a=>us(a,e,s,t,ht.value,pt.value)),s.addEventListener("mousedown",a=>ds(a,s)),s.addEventListener("mouseup",rs),e.src=Ae.value,e.crossOrigin="anonymous"},is=()=>{He.value.style.display="flex",ft()},mt=I(0),vt=I(0),_t=I(0),gt=I(0),Uo=I(!1),Qe=I(null);function ds(e,s){Qe.value=bt(e,s),mt.value=e.clientX,vt.value=e.clientY}function rs(e){Uo.value=!1,Qe.value=null,_t.value=e.clientX,gt.value=e.clientY}let yt=I(0),It=I(0);const Ze=I(),So=I(!0);function us(e,s,t,a,i,_){const N=bt(e,t);if(N)a.fillStyle="white",a.font="20px Arial",a.fillText(N.label,N.x+5,N.y-5),So.value=!1;else{if(So.value)return;ft(),So.value=!0}if(Oo.value=!0,Uo.value=!0,Uo.value&&Qe.value){let F=e.clientX-t.getBoundingClientRect().x,v=e.clientY-t.getBoundingClientRect().y;Qe.value.x=F,Qe.value.y=v;let P=Te.value.find(K=>K.label==Qe.value.label);P.x=F/i,P.y=v/_,Ze.value=P.label,yt.value=P.x,It.value=P.y;const ie=Ue.value.find(K=>K.label==P.label);if(ie.x=P.x*i,ie.y=P.y*_,Mo(a,s,t,!0),Ze.value&&(a.fillStyle="white",a.font="20px Arial",a.fillText(P.label,ie.x+5,ie.y-5)),Vt.forEach(K=>{if(P.label!=="A"&&P.label!=="Me"&&K.includes(P.label)){let se=Ao(K,Ue.value);De(se,K,!0)}else if(P.label=="Me"&&(K.includes("M")||K.includes("Me"))){let se=Ao(K,Ue.value);De(se,K,!0)}Ee.value.forEach(se=>{se.titleName.includes(P.label)&&(se.changeCoor=!0),P.label=="Me"&&(se.titleName.includes("M")||se.titleName.includes("Me"))&&(se.changeCoor=!0)})}),$t.forEach(K=>{if(P.label!=="A"&&P.label!=="Me"&&K.includes(P.label)){let se=wo(K,Ue.value);De(se,K,!0)}else if(P.label=="Me"&&(K.includes("M")||K.includes("Me"))){let se=wo(K,Ue.value);De(se,K,!0)}else if(P.label=="A"&&K.includes(P.label)&&!K.includes("Ar")){let se=wo(K,Ue.value);De(se,K,!0)}Ee.value.forEach(se=>{(P.label=="Me"&&(se.titleName.includes("M")||se.titleName.includes("Me"))||P.label=="A"&&se.titleName.includes("A")&&!se.titleName.includes("Ar")||se.titleName.includes(P.label))&&(se.changeCoor=!0)})}),Ut.forEach(K=>{if(P.label!=="A"&&P.label!=="Me"&&K.includes(P.label)){let se=Do(K,Ue.value);De(se,K,!0)}else if(P.label=="Me"&&(K.includes("M")||K.includes("Me"))){let se=Do(K,Ue.value);De(se,K,!0)}Ee.value.forEach(se=>{se.titleName.includes(P.label)&&(se.changeCoor=!0),P.label=="Me"&&(se.titleName.includes("M")||se.titleName.includes("Me"))&&(se.changeCoor=!0)})}),["A","B","UI","LI","L6","U6"].includes(P.label)){Ee.value.forEach(ve=>{ve.titleName=="Wits"&&(ve.changeCoor=!0)});const K=Ue.value.find(ve=>ve.label=="A"),se=Ue.value.find(ve=>ve.label=="B"),w=Ue.value.find(ve=>ve.label=="UI"),b=Ue.value.find(ve=>ve.label=="LI"),B=Ue.value.find(ve=>ve.label=="U6"),O=Ue.value.find(ve=>ve.label=="L6"),to=jo(K,se,w,b,B,O,yo.value,go.value);De(to,"Wits",!0)}}}function bt(e,s){const t=s.getBoundingClientRect().x,a=s.getBoundingClientRect().y,i=e.clientX,_=e.clientY;for(let N=0;N<Ue.value.length;N++){let F=Ue.value[N],v=i-t-F.x,P=_-a-F.y;if(Math.sqrt(v*v+P*P)<=5)return F}return null}const go=I(0),yo=I(0),cs=I(null),Ct=e=>{if(W.value){He.value.style.display="none",W.value=!1;return}else if(e===!0||!(vt.value!==gt.value||mt.value!==_t.value)){He.value.style.display="none",oo(A.value,D.value,!0),Ee.value.forEach(t=>{if(Ze.value!=="Me"&&Ze.value!=="A"){if(t.titleName.includes(Ze.value)){t.aiFlag="0";let a={apmtId:f,titleId:t.id,optionsIdStr:[],otherContent:"",cephalometricsContent:t.cephalometricsContent,fdiToothCode:"",showPosition:""};me("/prod-api/business/optionsResult",a).then(i=>{if(i.code==200&&i.data.optionsId){t.optionId=i.data.optionsId;let _={apmtId:f,titleId:t.id,optionsIdStr:[i.data.optionsId],otherContent:"",cephalometricsContent:"",fdiToothCode:"",showPosition:""};me("/prod-api/business/optionsResult",_)}})}}else if(Ze.value=="Me"&&(t.titleName.includes("M")||t.titleName.includes("Me"))){t.aiFlag="0";let a={apmtId:f,titleId:t.id,optionsIdStr:[],otherContent:"",cephalometricsContent:t.cephalometricsContent,fdiToothCode:"",showPosition:""};me("/prod-api/business/optionsResult",a).then(i=>{if(i.code==200){t.optionId=i.data.optionsId;let _={apmtId:f,titleId:t.id,optionsIdStr:[i.data.optionsId],otherContent:"",cephalometricsContent:"",fdiToothCode:"",showPosition:""};me("/prod-api/business/optionsResult",_)}})}else if(Ze.value=="A"&&(t.titleName.includes("A")&&t.titleName.length==3||t.titleName=="Wits")){t.aiFlag="0";let a={apmtId:f,titleId:t.id,optionsIdStr:[],otherContent:"",cephalometricsContent:t.cephalometricsContent,fdiToothCode:"",showPosition:""};me("/prod-api/business/optionsResult",a).then(i=>{if(i.code==200&&i.data.optionsId){t.optionId=i.data.optionsId;let _={apmtId:f,titleId:t.id,optionsIdStr:[i.data.optionsId],otherContent:"",cephalometricsContent:"",fdiToothCode:"",showPosition:""};me("/prod-api/business/optionsResult",_)}})}}),so("/prod-api/business/orthPoint",{apmtId:f,pointName:Ze.value,xCoordinate:yt.value,yCoordinate:It.value});const s=Ee.value.filter(t=>t.changeCoor===!0).map(t=>({titleId:t.id,aiType:1}));me("/prod-api/business/optionsResult/updateAIType",{apmtId:f,cephalometricsList:s})}},Io=I([]),H=I([]),Ue=I([]),Te=I([]),bo=I([]),kt=["A","N","B","Or","Po","Go","Go_1","UI","UI_1","S","P","Go`","Me","Ar","LI","LI_1","Ratio1","Ratio2","U6","L6","Gn","ANS","PNS"];let wt,Lt,xt;async function hs(e){const s=new FormData;s.append("file",e),s.append("mobile","13014532111");const t=await te();if(t){const a=await Pt({url:"http://47.101.150.34:8177/bonceph/platform/marker/predict",method:"post",data:s,headers:{Authorization:`${t}`,"content-type":"multipart/form-data"}});a.status==200&&(Io.value=a.data.data,bo.value=Io.value.filter(i=>kt.includes(i[0])),Te.value=bo.value.map(i=>({label:i[0],x:i[1],y:i[2]})),wt=Te.value.find(i=>i.label=="Ratio1"),Lt=Te.value.find(i=>i.label=="Ratio2"),xt=Wo(wt,Lt))}}const Oo=I(!1);function ps(e,s,t,a,i,_,N,F){const v=(F-_)*(t-e)-(N-i)*(a-s);if(v===0)return null;const P=((N-i)*(s-_)-(F-_)*(e-i))/v,ie=e+P*(t-e),K=s+P*(a-s);return{x:ie,y:K}}const fs=(e,s,t,a,i)=>{e.beginPath(),e.moveTo(s.x,s.y),e.lineTo(t.x,t.y),e.stroke(),e.beginPath(),e.moveTo(a.x,a.y),e.lineTo(i.x,i.y),e.stroke()},Ke=(e,s,t,a,i)=>{const _=ps(s.x,s.y,t.x,t.y,a.x,a.y,i.x,i.y);e.beginPath(),e.moveTo(s.x,s.y),e.lineTo(t.x,t.y),e.stroke(),e.beginPath(),e.moveTo(a.x,a.y),e.lineTo(i.x,i.y),e.stroke(),vs(s,_,a)},Nt=(e,s,t,a)=>{e.beginPath(),e.moveTo(s.x,s.y),e.lineTo(t.x,t.y),e.lineTo(a.x,a.y),e.stroke()};function Tt(e,s,t){const a={x:s.x-e.x,y:s.y-e.y},i={x:t.x-e.x,y:t.y-e.y},_=Math.sqrt(a.x**2+a.y**2),N=(i.x*a.x+i.y*a.y)/_**2;return{x:e.x+N*a.x,y:e.y+N*a.y}}const ms=e=>{if(ko.value){const t=document.getElementById("myCanvas").getContext("2d");t.lineWidth=1.5,t.save(),t.strokeStyle="blue";let a=[],i,_,N,F;if(["颈椎分期","腺样体","扁桃体"].includes(e))return;if(["S-Go/N-Me","S-N/Go`-Me"].includes(e))a=e.split("/").map(v=>v.split("-")),i=H.value.find(v=>v.label==a[0][0]),_=H.value.find(v=>v.label==a[0][1]),N=H.value.find(v=>v.label==a[1][0]),F=H.value.find(v=>v.label==a[1][1]),fs(t,i,_,N,F);else if(e.includes("-"))a=e.split("-").filter(v=>v!=="-"),a.length==2?(e==="L1-MP"&&(i=H.value.find(v=>v.label=="LI_1"),_=H.value.find(v=>v.label=="LI"),N=H.value.find(v=>v.label=="Go_1"),F=H.value.find(v=>v.label=="Me"),Ke(t,i,_,N,F)),e==="SN-MP"&&(i=H.value.find(v=>v.label=="S"),_=H.value.find(v=>v.label=="N"),N=H.value.find(v=>v.label=="Go_1"),F=H.value.find(v=>v.label=="Me"),Ke(t,i,_,N,F)),e==="U1-SN"&&(i=H.value.find(v=>v.label=="UI_1"),_=H.value.find(v=>v.label=="UI"),N=H.value.find(v=>v.label=="S"),F=H.value.find(v=>v.label=="N"),Ke(t,i,_,N,F)),e==="FH-MP"&&(i=H.value.find(v=>v.label=="P"),_=H.value.find(v=>v.label=="Or"),N=H.value.find(v=>v.label=="Go_1"),F=H.value.find(v=>v.label=="Me"),Ke(t,i,_,N,F))):a.length==3&&(a[0]=="Na"?(i=H.value.find(v=>v.label=="N"),_=H.value.find(v=>v.label==a[1]),N=H.value.find(v=>v.label==a[2]),Nt(t,i,_,N)):(i=H.value.find(v=>v.label==a[0]),_=H.value.find(v=>v.label==a[1]),N=H.value.find(v=>v.label==a[2]),Nt(t,i,_,N)));else if(e=="Wits"){const v=H.value.find(ve=>ve.label=="A"),P=H.value.find(ve=>ve.label=="B"),ie=H.value.find(ve=>ve.label=="UI"),K=H.value.find(ve=>ve.label=="LI"),se=H.value.find(ve=>ve.label=="U6"),w=H.value.find(ve=>ve.label=="L6"),b={x:(se.x+w.x)/2,y:(se.y+w.y)/2},B={x:(ie.x+K.x)/2,y:(ie.y+K.y)/2},O=Tt(B,b,v),to=Tt(B,b,P);t.beginPath(),t.moveTo(b.x,b.y),t.lineTo(B.x,B.y),t.strokeStyle="blue",t.stroke(),t.setLineDash([5,5]),t.beginPath(),t.moveTo(v.x,v.y),t.lineTo(O.x,O.y),t.strokeStyle="blue",t.stroke(),t.setLineDash([5,5]),t.beginPath(),t.moveTo(P.x,P.y),t.lineTo(to.x,to.y),t.strokeStyle="blue",t.stroke()}else e=="ODI"?(i=H.value.find(v=>v.label=="A"),_=H.value.find(v=>v.label=="B"),N=H.value.find(v=>v.label=="Go"),F=H.value.find(v=>v.label=="Gn"),Ke(t,i,_,N,F)):e=="APDI"?(i=H.value.find(v=>v.label=="A"),_=H.value.find(v=>v.label=="B"),N=H.value.find(v=>v.label=="Go"),F=H.value.find(v=>v.label=="Gn"),Ke(t,i,_,N,F)):(a=e.split(""),i=H.value.find(v=>v.label==a[0]),_=H.value.find(v=>v.label==a[1]),N=H.value.find(v=>v.label==a[2]),t.beginPath(),t.moveTo(i.x,i.y),t.lineTo(_.x,_.y),t.lineTo(N.x,N.y),t.stroke())}};function vs(e,s,t){const i=document.getElementById("myCanvas").getContext("2d");i.setLineDash([5,5]),i.beginPath(),i.moveTo(e.x,e.y),i.lineTo(s.x,s.y),i.lineTo(t.x,t.y),i.stroke()}const _s=()=>{ko.value&&oo(A.value,D.value,!0)},eo=I(!1),Co=e=>{eo.value=!0,oe.value.find(s=>s.caption===e).reminder=!0,Eo()};async function gs(){he.value.length===0&&Le(`/prod-api/business/orthImage/imageList?patientId=${U}`).then(e=>{ee.value=e.data,e.data.find(s=>s.imageList.length!==0)&&(he.value[0]=e.data.find(s=>s.imageList.length!==0),ke.value=e.data.findIndex(s=>s.imageList.length!==0),he.value[0].imageList.forEach(s=>{s.imgUrl=s.fileUrl,s.choose=!1}))})}async function Eo(){const e=await Le(`/prod-api/business/orthImage/list?apmtId=${f}`);e.code==200&&e.data.length>0?e.data.forEach(s=>{oe.value.forEach(t=>{s.imageType==t.caption&&(t.fileUrl=s.imageUrl,t.id=s.id)})}):oe.value.forEach(s=>{s.fileUrl=Ce})}const $t=["ANB","Ar-Go`-Me","Ar-Go`-N","Na-Go`-Me","S-Ar-Go`","Na-S-Ar","SNA","SNB"],Vt=["S-Go/N-Me","S-N/Go`-Me"],Ut=["U1-SN","SN-MP","L1-MP","FH-MP"];function De(e,s,t){const a=Ee.value.find(i=>i.titleName==s);a.cephalometricsContent=e.toFixed(2),a.inputVal=a.cephalometricsContent,a.AIValue=a.cephalometricsContent,t?a.aiFlag="0":a.aiFlag="1"}function ys(){Vt.forEach(F=>{let v=Ao(F,H.value);De(v,F,!1)}),$t.forEach(F=>{let v=wo(F,H.value);De(v,F,!1)}),Ut.forEach(F=>{let v=Do(F,H.value);De(v,F,!1)}),Te.value=Te.value.map(F=>({label:F.label,x:F.x*1,y:F.y*1}));const e=Te.value.find(F=>F.label=="A"),s=Te.value.find(F=>F.label=="B"),t=Te.value.find(F=>F.label=="UI"),a=Te.value.find(F=>F.label=="LI"),i=Te.value.find(F=>F.label=="U6"),_=Te.value.find(F=>F.label=="L6"),N=jo(e,s,t,a,i,_,xt);De(N,"Wits",!1)}async function Is(){Ee.value.forEach(e=>{if(!["颈椎分期","腺样体","扁桃体"].includes(e.titleName)){e.measured=!0;let s={apmtId:f,titleId:e.id,optionsIdStr:[],otherContent:"",cephalometricsContent:e.cephalometricsContent,fdiToothCode:"",showPosition:"",aiFlag:"1"};me("/prod-api/business/optionsResult",s).then(t=>{if(t.code==200&&t.data.optionsId){e.optionId=t.data.optionsId;let a={apmtId:f,titleId:e.id,optionsIdStr:[t.data.optionsId],otherContent:"",cephalometricsContent:"",fdiToothCode:"",showPosition:""};me("/prod-api/business/optionsResult",a)}})}}),me("/prod-api/business/orthPoint",{apmtId:f,pointList:Te.value.map(e=>[e.label,e.x,e.y])})}const ko=I(!1);function bs(){oo(A.value,D.value,!0),ys(),Is(),Ee.value.forEach(e=>e.aiFlag="1"),ye.value=!1}const Po=I(null),St=()=>{const e=Bo.service({lock:!0,text:"正在计算中",background:"rgba(0, 0, 0, 0.7)",target:Po.value});e.value=!0,Ae.value&&ls(Ae.value).then(s=>{hs(s).then(()=>{ko.value=!0,H.value=Te.value.map(t=>({label:t.label,x:t.x*yo.value,y:t.y*go.value})),e.close(),bs()})}).catch(s=>console.error("Error converting imageUrl to File:",s))};function Mo(e,s,t,a){e.clearRect(0,0,t.width,t.height),e.drawImage(s,0,0,t.width,t.height),a?Ue.value.forEach(function(i){const _=i.x,N=i.y;e.beginPath(),e.arc(_,N,5,0,2*Math.PI),e.fillStyle="red",e.fill()}):H.value.forEach(function(i){const _=i.x,N=i.y;e.beginPath(),e.arc(_,N,2,0,2*Math.PI),e.fillStyle="red",e.fill(),e.fillStyle="white",e.font="20px Arial"})}let Ye=I(0);function oo(e,s,t){const a=new Image,i=document.getElementById("myCanvas"),_=i.getContext("2d");a.onload=function(){const N=a.width,F=a.height;let v=N,P=F;Ye.value=N/F,v>e&&(v=e,P=v/Ye.value),P>s&&(P=s,v=P*Ye.value),i.width=v,yo.value=v,A.value=v,i.height=P,go.value=P,D.value=P,H.value=Te.value.map(ie=>({label:ie.label,x:ie.x*yo.value,y:ie.y*go.value})),_.clearRect(0,0,i.width,i.height),_.drawImage(a,0,0,v,P),t&&Mo(_,a,i,!1)},a.src=Ae.value,a.crossOrigin="anonymous"}Xt(()=>{Yo(Te.value,e=>{e&&Oo.value&&St()}),window.addEventListener("click",e=>{const s=document.querySelector(".el-popper.el-popover");if(s&&e.target!==s&&!s.contains(e.target)){const t=Ve.value[0].orthTitleList.findIndex(a=>a.popVisible===!0);t!==-1&&(Ve.value[0].orthTitleList[t].popVisible=!1)}})});const We=(e,s,t)=>{if(X.pdfId&&sessionStorage.removeItem(X.pdfId),s.titleName=="侧貌"){const a=ce.value.find(i=>i.className=="90度侧面像");if(s.orthOptionsList.find(i=>e==i.id).optionName=="凸面型"){const i=$e.value.find(_=>_.titleName=="凹面型表现");xe([],i,"",f),a.orthTitleList=$e.value.filter(_=>!_.titleName.includes("凹")),i.orthOptionsList.forEach(_=>_.choosen=!1),i.optionId=[]}else if(s.orthOptionsList.find(i=>e==i.id).optionName=="凹面型"){const i=$e.value.find(_=>_.titleName=="凸面型表现");xe([],i,"",f),a.orthTitleList=$e.value.filter(_=>!_.titleName.includes("凸")),i.optionId=[],i.orthOptionsList.forEach(_=>_.choosen=!1)}else if(s.orthOptionsList.find(i=>e==i.id).optionName=="直面型"){a.orthTitleList=$e.value.filter(N=>!N.titleName.includes("凸")&&!N.titleName.includes("凹"));const i=$e.value.find(N=>N.titleName=="凸面型表现"),_=$e.value.find(N=>N.titleName=="凹面型表现");i.optionId=[],_.optionId=[],xe([],i,"",f),xe([],_,"",f),co()}}t=="侧位片"&&(s.aiFlag="0",me("/prod-api/business/optionsResult/updateAIType",{apmtId:f,cephalometricsList:[{titleId:s.id,aiType:3}]})),vo(e,s,f),xe(s.optionId,s,"",f)},Cs=(e,s)=>{xe(e,s,"",f)};return(e,s)=>{const t=mo,a=no,i=xo,_=No,N=Xo,F=Ro,v=Wt,P=qt,ie=$s,K=jt,se=Ws("lazy");return o(),n(T,null,[r("div",Ka,[r("div",{class:"button",onClick:ue},[en,J("影像管理")]),j(Se,{text:"面型评估",backgroundColor:"#f4f7fd"}),r("div",on,[(o(!0),n(T,null,S(ce.value,(w,b)=>(o(),C(Et,{key:w.id,imageCaption:w.className,class:Y({removeBorder:w.className==="90度侧面像"||w.className==="45度侧面像"})},{img:h(()=>[w.imageUrl?(o(),n(T,{key:0},[w.className=="正面像"?(o(),n("canvas",tn)):Je((o(),n("img",sn,null,512)),[[se,w.imageUrl]])],64)):(o(),n("div",{key:1,class:"imageItem__placeholder",onClick:B=>Co(w.className)},[r("img",{src:ho.value,class:"addPic"},null,8,nn)],8,an))]),content:h(()=>[(o(!0),n(T,null,S(w.orthTitleList,B=>(o(),C(_e,{key:B.id,label:B.titleName,width:"120px"},{default:h(()=>[B.type==1?(o(),C(a,{key:0,modelValue:B.optionId,"onUpdate:modelValue":O=>B.optionId=O,onChange:O=>We(B.optionId,B,w.className,w)},{default:h(()=>[(o(!0),n(T,null,S(B.orthOptionsList,O=>(o(),C(t,{disabled:!w.hasImage,class:Y({serious:O.serious=="1",checked:O.choosen===!0}),key:O.id,label:O.id},{default:h(()=>[J(E(O.optionName)+" ",1),Je(r("img",ln,null,512),[[po,B.aiFlag=="1"&&b==0&&O.choosen]])]),_:2},1032,["disabled","class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):R("",!0),B.type==2?(o(),C(_,{key:1,modelValue:B.optionId,"onUpdate:modelValue":O=>B.optionId=O,onChange:O=>We(B.optionId,B,w.className,w)},{default:h(()=>[(o(!0),n(T,null,S(B.orthOptionsList,O=>(o(),C(i,{disabled:!w.hasImage,class:Y({serious:O.serious=="1",checked:O.choosen===!0}),key:O.id,label:O.id},{default:h(()=>[J(E(O.optionName)+" ",1),O.serious=="0"?(o(),n("img",dn)):(o(),n("img",rn))]),_:2},1032,["disabled","class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):R("",!0)]),_:2},1032,["label"]))),128))]),_:2},1032,["imageCaption","class"]))),128))]),j(Se,{text:"口内照"}),r("div",un,[(o(!0),n(T,null,S(ot.value,w=>(o(),C(Et,{key:w.id,imageCaption:w.className},{img:h(()=>[w.imageUrl?Je((o(),n("img",cn,null,512)),[[se,w.imageUrl]]):(o(),n("div",{key:1,class:"imageItem__placeholder",onClick:b=>Co(w.className)},[r("img",{src:ho.value,class:"addPic"},null,8,pn)],8,hn))]),content:h(()=>[w.className=="正面咬合"?(o(),n("img",{key:0,src:et.value,alt:""},null,8,fn)):R("",!0),r("div",null,[(o(!0),n(T,null,S(w.orthTitleList,b=>(o(),C(_e,{key:b.id,label:b.titleName,width:"100px"},{default:h(()=>[b.type==1?(o(),C(a,{key:0,modelValue:b.optionId,"onUpdate:modelValue":B=>b.optionId=B,onChange:B=>We(b.optionId,b)},{default:h(()=>[(o(!0),n(T,null,S(b.orthOptionsList,B=>(o(),C(t,{disabled:!w.hasImage,class:Y({serious:B.serious=="1",checked:B.choosen===!0}),key:B.id,label:B.id},{default:h(()=>[J(E(B.optionName),1)]),_:2},1032,["disabled","class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):R("",!0),b.type==2?(o(),C(_,{key:1,modelValue:b.optionId,"onUpdate:modelValue":B=>b.optionId=B,onChange:B=>We(b.optionId,b)},{default:h(()=>[(o(!0),n(T,null,S(b.orthOptionsList,B=>(o(),C(i,{disabled:!w.hasImage,class:Y({serious:B.serious=="1",checked:B.choosen===!0}),key:B.id,label:B.id},{default:h(()=>[J(E(B.optionName)+" ",1),B.serious=="0"?(o(),n("img",mn)):(o(),n("img",vn))]),_:2},1032,["disabled","class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):R("",!0)]),_:2},1032,["label"]))),128))])]),_:2},1032,["imageCaption"]))),128))]),j(Se,{text:"全景片"}),r("div",_n,[(o(!0),n(T,null,S(Ve.value,w=>(o(),n("div",{key:w.id,class:"placeholderContainer"},[r("div",{class:"image",style:fo({flex:w.imageUrl?"1":"0","min-width":w.imageUrl?"250px":"auto"})},[w.imageUrl?(o(),n("img",{key:0,src:w.imageUrl,style:{width:"100%",cursor:"pointer"},onClick:q},null,8,gn)):(o(),n("div",{key:1,class:"imageItem__placeholder",onClick:b=>Co(w.className)},[r("img",{src:ho.value,class:"addPic"},null,8,In)],8,yn))],4),r("div",bn,[r("div",Cn,[r("div",kn,[(o(!0),n(T,null,S(Ve.value[0].orthTitleList,(b,B)=>(o(),n(T,{key:b.id},[B<=2?(o(),C(_e,{key:0,label:b.titleName,width:"120px"},{default:h(()=>[b.type==1?(o(),C(a,{key:0,modelValue:b.optionId,"onUpdate:modelValue":O=>b.optionId=O,onChange:O=>We(b.optionId,b)},{default:h(()=>[(o(!0),n(T,null,S(b.orthOptionsList,O=>(o(),C(t,{disabled:!Ve.value[0].hasImage,class:Y({serious:O.serious=="1",checked:O.choosen===!0}),key:O.id,label:O.id},{default:h(()=>[J(E(O.optionName),1)]),_:2},1032,["disabled","class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):R("",!0),b.optionId==136?(o(),C(N,{key:1,placeholder:"请输入",modelValue:b.otherContent,"onUpdate:modelValue":O=>b.otherContent=O,onBlur:O=>Cs(b.optionId,b)},null,8,["modelValue","onUpdate:modelValue","onBlur"])):b.type==2?(o(),C(_,{key:2,modelValue:b.optionId,"onUpdate:modelValue":O=>b.optionId=O,onChange:O=>We(b.optionId,b)},{default:h(()=>[(o(!0),n(T,null,S(b.orthOptionsList,O=>(o(),C(i,{disabled:!Ve.value[0].hasImage,class:Y({serious:O.serious=="1",checked:O.choosen===!0}),key:O.id,label:O.id},{default:h(()=>[J(E(O.optionName)+" ",1),O.serious=="0"?(o(),n("img",wn)):(o(),n("img",Ln))]),_:2},1032,["disabled","class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):R("",!0)]),_:2},1032,["label"])):R("",!0)],64))),128))]),r("div",xn,[(o(!0),n(T,null,S(Ve.value[0].orthTitleList,(b,B)=>(o(),n(T,{key:b.id},[B<=5&&B>=3?(o(),C(_e,{key:0,label:b.titleName,width:"120px"},{default:h(()=>[b.type==1?(o(),C(a,{key:0,modelValue:b.optionId,"onUpdate:modelValue":O=>b.optionId=O,onChange:O=>We(b.optionId,b)},{default:h(()=>[(o(!0),n(T,null,S(b.orthOptionsList,O=>(o(),C(t,{disabled:!Ve.value[0].hasImage,class:Y({serious:O.serious=="1",checked:O.choosen===!0}),key:O.id,label:O.id},{default:h(()=>[J(E(O.optionName),1)]),_:2},1032,["disabled","class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):R("",!0),b.type==2?(o(),C(_,{key:1,modelValue:b.optionId,"onUpdate:modelValue":O=>b.optionId=O,onChange:O=>We(b.optionId,b)},{default:h(()=>[(o(!0),n(T,null,S(b.orthOptionsList,O=>(o(),C(i,{disabled:!Ve.value[0].hasImage,class:Y({serious:O.serious=="1",checked:O.choosen===!0}),key:O.id,label:O.id},{default:h(()=>[J(E(O.optionName)+" ",1),O.serious=="0"?(o(),n("img",Nn)):(o(),n("img",Tn))]),_:2},1032,["disabled","class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):R("",!0)]),_:2},1032,["label"])):R("",!0)],64))),128))]),r("div",$n,[(o(!0),n(T,null,S(Ve.value[0].orthTitleList,(b,B)=>(o(),n(T,{key:b.id},[B>=6&&B<=12?(o(),C(_e,{key:0,label:b.titleName,width:"120px"},{default:h(()=>[j(F,{step:2,title:b,appId:Be(f),data:Ve.value[0]},null,8,["title","appId","data"])]),_:2},1032,["label"])):R("",!0)],64))),128))]),r("div",Vn,[(o(!0),n(T,null,S(Ve.value[0].orthTitleList,(b,B)=>(o(),n(T,{key:b.id},[B>=13?(o(),C(_e,{key:0,label:b.titleName,width:"120px"},{default:h(()=>[j(F,{step:2,title:b,appId:Be(f),data:Ve.value[0]},null,8,["title","appId","data"])]),_:2},1032,["label"])):R("",!0)],64))),128))])])])]))),128))]),j(Se,{text:"侧位片"}),r("div",{class:"content cephalometric",ref_key:"loadingTarget",ref:Po,style:{display:"none"}},[r("div",Un,[r("div",{class:"image",style:fo({flex:Ae.value?"1":"0"})},[Je(r("canvas",{ref_key:"myCanvas",ref:cs,id:"myCanvas",onClick:is,style:{cursor:"pointer"}},null,512),[[po,Ae.value]]),Ae.value?(o(),C(v,{key:0,class:"cephalometric__button",type:"primary",onClick:St},{default:h(()=>[J("AI测量")]),_:1})):(o(),n("div",{key:1,class:"imageItem__placeholder",onClick:s[0]||(s[0]=w=>Co("侧位片"))},[r("img",{src:ho.value,class:"addPic"},null,8,Sn)]))],4),r("div",On,[(o(!0),n(T,null,S(Ee.value,w=>(o(),n(T,{key:w.id},[w.showInput?(o(),n("div",En,[r("div",{class:"formItem__label",onMouseenter:b=>ms(w.titleName),onMouseleave:_s},E(w.titleName=="Wits"?w.titleName+"(mm)":w.titleName=="S-Go/N-Me"||w.titleName=="S-N/Go`-Me"?w.titleName+"(%)":w.titleName+"(˚)"),41,Pn),["SNA","SNB","扁桃体","腺样体","颈椎分期"].includes(w.titleName)?R("",!0):(o(),C(P,{key:0,class:"box-item",effect:"light",placement:"top",content:w.titlePrompt},{default:h(()=>[Mn]),_:2},1032,["content"])),r("div",An,[r("img",{src:Ya,style:fo({opacity:`${w.aiFlag=="1"?1:0}`})},null,4),r("div",Dn,[j(N,{disabled:!Ae.value,modelValue:w.cephalometricsContent,"onUpdate:modelValue":b=>w.cephalometricsContent=b,onInput:b=>Z(),onFocus:b=>w.measured=!1,onBlur:b=>ne(w),class:Y({measured:w.measured===!0})},null,8,["disabled","modelValue","onUpdate:modelValue","onInput","onFocus","onBlur","class"]),Je(r("img",Fn,null,512),[[po,w.orthOptionsList.findIndex(b=>b.id==w.optionId)==0]]),Je(r("img",Bn,null,512),[[po,w.orthOptionsList.findIndex(b=>b.id==w.optionId)==2]])]),j(a,{class:"cephaRadio",onChange:b=>We(w.optionId,w,"侧位片"),modelValue:w.optionId,"onUpdate:modelValue":b=>w.optionId=b},{default:h(()=>[(o(!0),n(T,null,S(w==null?void 0:w.orthOptionsList,b=>(o(),C(t,{disabled:!Ae.value,label:b.id,class:Y({serious:b.serious=="1",checked:b.choosen===!0}),key:b.id},{default:h(()=>[J(E(b.optionName),1)]),_:2},1032,["disabled","label","class"]))),128))]),_:2},1032,["onChange","modelValue","onUpdate:modelValue"])])])):(o(),n("div",Rn,[r("div",jn,E(w.titleName),1),j(P,{class:"box-item",effect:"light",placement:"top"},{default:h(()=>[Wn]),_:1}),r("div",qn,[j(a,{modelValue:w.optionId,"onUpdate:modelValue":b=>w.optionId=b,onChange:b=>We(w.optionId,w)},{default:h(()=>[(o(!0),n(T,null,S(w==null?void 0:w.orthOptionsList,b=>(o(),C(t,{disabled:!Ae.value,label:b.id,class:Y({serious:b.serious=="1",checked:b.choosen===!0}),key:b.id},{default:h(()=>[J(E(b.optionName),1)]),_:2},1032,["disabled","label","class"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])])]))],64))),128))])])],512)]),j(K,{modelValue:eo.value,"onUpdate:modelValue":s[2]||(s[2]=w=>eo.value=w),title:"影像管理",width:"1183px",onClose:we,"close-on-click-modal":!1},{footer:h(()=>[r("span",_l,[j(v,{onClick:s[1]||(s[1]=w=>eo.value=!1)},{default:h(()=>[J("取消")]),_:1}),j(v,{type:"primary",onClick:ge},{default:h(()=>[J(" 确定 ")]),_:1})])]),default:h(()=>[r("div",{class:"imageManagement",ref_key:"loadingTarget2",ref:pe},[r("div",Gn,[r("div",Zn,[Jn,Xn,r("div",Yn,[r("div",zn,[j(v,{type:"primary",link:"",icon:Be(qs)},{default:h(()=>[J("上传图片")]),_:1},8,["icon"])]),r("input",{class:"file-upload__input",type:"file",onChange:fe,multiple:""},null,32)])]),r("div",Hn,[he.value.length==0?(o(),n("img",Qn)):(o(!0),n(T,{key:1},S(he.value,(w,b)=>(o(),n("div",{key:b},[r("div",null,E(w.StartTime.split("T")[0]),1),r("div",Kn,[(o(!0),n(T,null,S(w.imageList,B=>(o(),n("div",{class:"item",key:B.id,onMouseenter:O=>B.showFlag=!0,onMouseleave:O=>B.showFlag=!1},[r("div",ol,[r("img",{style:{display:"block"},class:Y(["img",{choose:B.choose===!0}]),src:B.imgUrl,draggable:"true",onDragstart:O=>d(B,O),onDragend:c,onClick:O=>Oe(B)},null,42,tl),Je(r("img",{src:xs,style:{position:"absolute",right:"6px",bottom:"6px"},onClick:O=>Oe(B)},null,8,sl),[[po,B.choose===!0]])])],40,el))),128))]),!w.file&&b===he.value.length-1?(o(),n("div",{key:0,style:{display:"inline-flex",color:"#4E5969",cursor:"pointer"},onClick:x},ll)):R("",!0)]))),128))]),r("div",il,[r("span",dl,"已选中"+E(Ne.value)+"张",1),j(v,{onClick:Xe},{default:h(()=>[J("自动分类")]),_:1})])]),r("div",rl,[ul,r("div",cl,[(o(!0),n(T,null,S(oe.value,w=>(o(),n("div",{class:"item",key:w.typeName,onMouseenter:b=>w.showFlag=!0,onMouseleave:b=>w.showFlag=!1},[r("div",pl,[r("img",{class:Y(["img",{hover:w.reminder===!0,animate__animated:w.reminder===!0,animate__bounce:w.reminder===!0}]),style:{display:"block"},src:w.fileUrl,onDrop:b=>le(b,w),onDragover:Lo(L,["prevent"]),onDragleave:m,onDragstart:b=>l(w),onDragend:c},null,42,fl)]),j(ie,{width:"300","confirm-button-text":"确认",icon:Be(Gs),"icon-color":"#FF7D00","cancel-button-text":"取消",title:"确认删除该张图片吗？",onConfirm:b=>z(w)},{reference:h(()=>[w.showFlag&&!w.fileUrl.startsWith("data:image")?(o(),n("img",ml)):R("",!0)]),_:2},1032,["icon","onConfirm"]),r("div",vl,E(w.caption),1)],40,hl))),128))])])],512)]),_:1},8,["modelValue"]),r("div",{class:"overlay",ref_key:"overlayRef",ref:He},[gl,yl,W.value?(o(),n("img",{key:0,class:"zoomPanoImage",src:at.value,style:{cursor:"pointer"},onClick:re},null,8,Il)):R("",!0),W.value?R("",!0):(o(),n("canvas",{key:1,id:"myZoomCanvas",onClick:Ct})),r("img",{src:Qa,style:{position:"fixed",right:"20px",top:"20px",cursor:"pointer"},onClick:s[3]||(s[3]=w=>Ct(!0))})],512),bl],64)}}},kl=Ge(Cl,[["__scopeId","data-v-52fdf6ef"]]);const wl={class:"content"},Ll=["onClick"],xl={class:"suffix"},Nl={class:"showRange"},Tl={class:"text"},$l={class:"text"},Vl={class:"text"},Ul={__name:"modelAnalysis",props:{titleName:String,min:String,max:String,placeholder:String,left:String,middle:String,right:String,conclusion:String,value:Number,cephalometricsContent:String,hasVal:Boolean},emits:["change"],setup(k,{emit:p}){const g=k,f=I(g.cephalometricsContent),U=p,G=re=>{var A;f.value||(A=re.target.parentElement.children[1].classList)==null||A.remove("clicked")},X=re=>{console.log(re.target.value==="")};Yo(f,re=>{U("change",re,g.value)});let W=I(null);const q=re=>{var A;Array.from(re.target.parentElement.classList).includes("googleInput")&&((A=re.target.parentElement.children[1].classList)==null||A.add("clicked"),re.target.parentElement.children[0].focus(),W.value=re.target.parentElement.children[1])};return(re,A)=>(o(),n("div",wl,[r("div",{class:"googleInput",onClick:Lo(q,["stop"])},[Je(r("input",{onInput:X,"onUpdate:modelValue":A[0]||(A[0]=D=>f.value=D),onBlur:G},null,544),[[Zs,f.value]]),g.placeholder?(o(),n("span",{key:0,class:Y(["placeholder",{clicked:g.hasVal}])},E(g.placeholder),3)):R("",!0),r("div",xl,E(k.titleName==="SPEE曲线"?"mm":"%"),1)],8,Ll),r("div",Nl,[r("div",{class:Y(["range left",{active:g.conclusion===g.left}])},[r("div",Tl,E(g.left),1)],2),r("div",{class:Y(["range middle",{active:g.conclusion===g.middle}])},[r("div",$l,E(g.middle),1)],2),r("div",{class:Y(["range right",{active:g.conclusion===g.right}])},[r("div",Vl,E(g.right),1)],2),r("div",{class:Y(["refNum firstRefNum",{distanceNum:String(g.min).endsWith("m")}])},E(g.min),3),r("div",{class:Y(["refNum secondRefNum",{distanceNum:String(g.max).endsWith("m")}])},E(g.max),3)])]))}},Sl=Ge(Ul,[["__scopeId","data-v-134eb27b"]]);const Ol={class:"formItem"},El={class:"formItem__content"},Pl={__name:"customFormItem",props:{label:String,width:String,showMark:Boolean},setup(k){return(p,g)=>{const f=qt;return o(),n("div",Ol,[r("div",{class:"formItem__label",style:fo({width:k.width})},[J(E(k.label),1),k.showMark?(o(),C(f,{key:0,class:"box-item",effect:"light",placement:"top-start"},{content:h(()=>[J(E(p.content),1)]),default:h(()=>[r("img",{onMouseenter:g[0]||(g[0]=(...U)=>p.enterTool&&p.enterTool(...U)),onMouseleave:g[1]||(g[1]=(...U)=>p.leaveTool&&p.leaveTool(...U)),src:Jo,style:{cursor:"pointer"}},null,32)]),_:1})):R("",!0)],4),r("div",El,[Jt(p.$slots,"default",{},void 0,!0)])])}}},Bt=Ge(Pl,[["__scopeId","data-v-ae329d43"]]);const Ml={class:"stepThree"},Al={class:"content"},Dl={__name:"stepThree",props:{pdfId:String,dentitionType:String},setup(k,{expose:p}){const g=I(!1);p({clicked:g});const f=k,G=lo().params.appId,X=I({});async function W(){const A=await Le(`/prod-api/business/orthClass/list/2/模型分析/${G}`),D=A.data[0].orthTitleList[2];A.data[0].orthTitleList.splice(2,1),A.data[0].orthTitleList.splice(3,0,D),X.value=A.data[0],X.value.orthTitleList.forEach((y,u)=>{if(g.value=y.orthOptionsList.some(M=>M.choosen==!0),y.hasVal=!!y.cephalometricsContent,u<=1){y.optionId="";const M=y.orthOptionsList.filter(de=>de.choosen===!0);M.length>0&&(y.optionId=M[0].id)}else if(y.value=+y.cephalometricsContent,y.titleName=="SPEE曲线"?(y.min="0mm",y.max="2mm"):(y.min=(y.orthOptionsList[0].optionName*100).toFixed(2)+"%",y.max=(y.orthOptionsList[1].optionName*100).toFixed(2)+"%"),y.placeholder=u==2?"":y.titleName.substr(-4).slice(0,3),y.left=u==2?"反曲":"偏低",y.middle="正常",y.right=u==2?"过深":"偏高",y.titleName=="SPEE曲线")y.minVal=0,y.maxVal=2,y.cephalometricsContent?y.conclusion=+y.cephalometricsContent<0?y.left:+y.cephalometricsContent>2?y.right:y.middle:y.conclusion="";else{let M=y.orthOptionsList[0].optionName,de=y.orthOptionsList[1].optionName;y.cephalometricsContent?+y.cephalometricsContent/100<M?y.conclusion=y.left:+y.cephalometricsContent/100>de?y.conclusion=y.right:y.conclusion=y.middle:y.conclusion=""}})}W();const q=(A,D)=>{D.value=+A,D.value&&(D.min.endsWith("m")?D.conclusion=D.value<+D.min.slice(0,1)?D.left:D.value>+D.max.slice(0,1)?D.right:D.middle:D.conclusion=D.value<+D.min.slice(0,5)?D.left:D.value>+D.max.slice(0,5)?D.right:D.middle);const y={apmtId:G,titleId:D.id,optionsIdStr:[],otherContent:"",cephalometricsContent:A===""?"":D.value+"",fdiToothCode:"",showPosition:""};me("/prod-api/business/optionsResult",y)},re=(A,D)=>{g.value=!0,f.pdfId&&sessionStorage.removeItem(f.pdfId),vo(A,D,G),xe(D.optionId,D,"",G)};return(A,D)=>{const y=mo,u=no;return o(),n("div",Ml,[j(Se,{text:"模型分析",backgroundColor:"#f4f7fd"}),r("div",Al,[(o(!0),n(T,null,S(X.value.orthTitleList.slice(0,2),(M,de)=>(o(),C(Bt,{label:M.titleName,width:"110px",key:M.id},{default:h(()=>[de<=1?(o(),C(u,{key:0,modelValue:M.optionId,"onUpdate:modelValue":ae=>M.optionId=ae,onChange:ae=>re(M.optionId,M)},{default:h(()=>[(o(!0),n(T,null,S(M.orthOptionsList,ae=>(o(),C(y,{key:ae.id,class:Y({serious:ae.serious=="1",checked:ae.choosen===!0}),label:ae.id},{default:h(()=>[J(E(ae.optionName),1)]),_:2},1032,["class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):R("",!0)]),_:2},1032,["label"]))),128)),k.dentitionType=="恒牙列"?(o(!0),n(T,{key:0},S(X.value.orthTitleList.slice(2),(M,de)=>(o(),C(Bt,{label:de<=1?M.titleName.slice(0,8):"",width:"110px",showMark:M.titleName==="Bolton指数（前牙比）",content:M.prompt,key:M.id},{default:h(()=>[j(Sl,Js({titleName:M.titleName},M,{onChange:ae=>q(ae,M)}),null,16,["titleName","onChange"])]),_:2},1032,["label","showMark","content"]))),128)):R("",!0)])])}}},Fl=Ge(Dl,[["__scopeId","data-v-44c1302f"]]);const Bl=k=>(io("data-v-eebefa5f"),k=k(),ro(),k),Rl={class:"stepFour"},jl={key:0,class:"content",style:{"padding-top":"4px"}},Wl={class:"questionItem__header"},ql=Bl(()=>r("img",{src:Os},null,-1)),Gl={class:"questionItem__header__title"},Zl={class:"questionItem__content content"},Jl={class:"question_level_two"},Xl={class:"itemContainer"},Yl={class:"singleQuestionItem__label"},zl={class:"singleQuestionItem__content"},Hl={key:1,style:{padding:"20px"}},Ql={class:"content diagnose"},Kl={key:0,src:Pe},ei={key:1,src:Me},oi={__name:"stepFour",props:{pdfId:String},setup(k,{expose:p}){const g=I(!1);p({clicked:g});const f=k,G=lo().params.appId,X=I([]);async function W(){const D=await Le(`/prod-api/business/orthClass/issuesList?apmtId=${G}&serious=1`);if(D.data){const y=D.data.reduce((u,M)=>{if(u[M.question_level_one]){const de=u[M.question_level_one].list1.find(ae=>ae.question_level_two===M.question_level_two);de?de.list2.push({title_name:M.title_name,option_names:M.option_names}):u[M.question_level_one].list1.push({question_level_two:M.question_level_two,list2:[{title_name:M.title_name,option_names:M.option_names}]})}else u[M.question_level_one]=M,u[M.question_level_one].list1=[],u[M.question_level_one].list1.push({question_level_two:M.question_level_two,list2:[{title_name:M.title_name,option_names:M.option_names}]});return u},{});X.value=Object.values(y),console.log(X.value)}}W();const q=I([]);async function re(){const D=await Le(`/prod-api/business/orthClass/list/2/诊断/${G}`);q.value=D.data,D.data[0].classFlag&&(g.value=!0),D.data.forEach(y=>y.orthTitleList.forEach(u=>u.showInput=!1)),D.data.forEach(y=>{y.orthTitleList.forEach(u=>{if(u.type==1){u.optionId="",u.text="",u.showInput=!1;const M=u.orthOptionsList.filter(de=>de.choosen===!0);M.length>0&&(u.optionId=M[0].id)}else if(u.type==2){u.optionId=[],u.optionId1=[],u.text="",u.showInput=!1;const M=u.orthOptionsList.filter(de=>de.choosen===!0);M.length>0&&(u.optionId=M.map(de=>de.id),u.optionId1=u.optionId)}})})}re();const A=(D,y)=>{g.value=!0,f.pdfId&&sessionStorage.removeItem(f.pdfId),vo(D,y,G),xe(y.optionId,y,"",G)};return(D,y)=>{const u=mo,M=no,de=xo,ae=No;return o(),n("div",Rl,[j(Se,{text:"问题列表",backgroundColor:"#f4f7fd"}),X.value.length>0?(o(),n("div",jl,[(o(!0),n(T,null,S(X.value,fe=>(o(),n("div",{class:"questionItem",key:fe.id},[r("div",Wl,[ql,r("span",Gl,E(fe.question_level_one),1)]),r("div",Zl,[(o(!0),n(T,null,S(fe.list1,ne=>(o(),n("div",{class:"singleQuestionItem",key:ne.id},[r("div",Jl,E(ne.question_level_two),1),r("div",Xl,[(o(!0),n(T,null,S(ne.list2,Z=>(o(),n("div",{class:"item",key:Z.title_name},[r("span",Yl,E(Z.title_name),1),r("span",zl,E(Z.option_names),1)]))),128))])]))),128))])]))),128))])):(o(),n("div",Hl," 无 ")),j(Se,{text:"诊断",backgroundColor:"#f4f7fd",style:{"margin-top":"20px"}}),r("div",Ql,[(o(!0),n(T,null,S(q.value,fe=>(o(),n(T,{key:fe.id},[(o(!0),n(T,null,S(fe.orthTitleList,ne=>(o(),C(_e,{key:ne.id,label:ne.titleName,width:"80px"},{default:h(()=>[ne.type==1?(o(),C(M,{key:0,modelValue:ne.optionId,"onUpdate:modelValue":Z=>ne.optionId=Z,onChange:Z=>A(ne.optionId,ne)},{default:h(()=>[(o(!0),n(T,null,S(ne.orthOptionsList,Z=>(o(),C(u,{key:Z.id,class:Y({serious:Z.serious=="1",checked:Z.choosen===!0}),label:Z.id},{default:h(()=>[J(E(Z.optionName),1)]),_:2},1032,["class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):R("",!0),ne.type==2?(o(),C(ae,{key:1,modelValue:ne.optionId,"onUpdate:modelValue":Z=>ne.optionId=Z,onChange:Z=>A(ne.optionId,ne)},{default:h(()=>[(o(!0),n(T,null,S(ne.orthOptionsList,Z=>(o(),C(de,{class:Y({serious:Z.serious=="1",checked:Z.choosen===!0}),key:Z.id,label:Z.id},{default:h(()=>[J(E(Z.optionName)+" ",1),Z.serious=="0"?(o(),n("img",Kl)):(o(),n("img",ei))]),_:2},1032,["class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):R("",!0)]),_:2},1032,["label"]))),128))],64))),128))])])}}},ti=Ge(oi,[["__scopeId","data-v-eebefa5f"]]);const $o=k=>(io("data-v-09beca11"),k=k(),ro(),k),si={class:"stepFive"},ai={class:"content plan"},ni={key:0,src:Pe},li={key:1,src:Me},ii={class:"content"},di={key:0,src:Pe},ri={key:1,src:Me},ui={class:"content"},ci={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",fill:`
                              none
                            `,version:"1.1",width:"9.999975204467773",height:"9.999975204467773",viewBox:"0 0 9.999975204467773 9.999975204467773"},hi=["fill"],pi={key:0,src:Pe},fi={key:1,src:Me},mi=$o(()=>r("span",{style:{color:"#4e5969"}}," 个月",-1)),vi={class:"content"},_i=$o(()=>r("span",{style:{color:"#4e5969","margin-left":"8px"}}," 个月",-1)),gi={class:"content risk"},yi={key:0,src:Pe},Ii={key:1,src:Me},bi={key:0,xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",fill:"none",version:"1.1",width:"9.999975204467773",height:"9.999975204467773",viewBox:"0 0 9.999975204467773 9.999975204467773"},Ci=["fill"],ki={key:1,src:Pe},wi={key:2,src:Me},Li={class:"selectContainer",id:"selectContainer"},xi={class:"container"},Ni=["id","onClick"],Ti=$o(()=>r("div",{class:"left"},"右",-1)),$i=$o(()=>r("div",{class:"right"},"左",-1)),Vi={key:0,xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",fill:"none",version:"1.1",width:"9.999975204467773",height:"9.999975204467773",viewBox:"0 0 9.999975204467773 9.999975204467773"},Ui=["fill"],Si={key:1,src:Pe},Oi={key:2,src:Me},Ei={class:"content"},Pi={__name:"stepFive",props:{pdfId:String},setup(k,{expose:p}){const g=I(!1),f=I(!1);p({goalClicked:g,methodClicked:f});const U=k,G=$=>{$.otherContent&&($.visible=!0),$.hover=!0};let X;const W=$=>{$.hover=!1,X=setTimeout(()=>{$.visible=!1},300);const V=document.querySelectorAll(".myPopper");Array.from(V).forEach(l=>{l.addEventListener("mouseenter",()=>{clearTimeout(X)})})},q=$=>{$.visible=!0,$.hover=!0};let re;const A=($,V)=>{V.hover=!1,re=setTimeout(()=>{V.visible=!1},300);const l=document.querySelectorAll(".myPopper");Array.from(l).forEach(d=>{d.addEventListener("mouseenter",()=>{clearTimeout(re)})})},y=lo().params.appId,u=I([]);async function M(){const $=await Le(`/prod-api/business/orthClass/list/2/方案/${y}`);u.value=$.data,$.data.forEach(V=>V.orthTitleList.forEach(l=>l.showInput=!1)),$.data.forEach(V=>{V.orthTitleList.forEach(l=>{if(l.type==1){l.optionId="",l.text="",l.showInput=!1;const d=l.orthOptionsList.filter(c=>c.choosen===!0);d.length>0&&(l.optionId=d[0].id)}else if(l.type==2){l.optionId=[],l.optionId1=[],l.text="",l.showInput=!1;const d=l.orthOptionsList.filter(c=>c.choosen===!0);d.length>0&&(l.optionId=d.map(c=>c.id),l.optionId1=l.optionId)}else l.type==4&&qo(l)})})}M();const de=I([]);async function ae(){const $=await Le(`/prod-api/business/orthClass/list/2/目标/${y}`);de.value=$.data,g.value=$.data[0].classFlag,$.data.forEach(V=>V.orthTitleList.forEach(l=>l.showInput=!1)),$.data.forEach(V=>{V.orthTitleList.forEach(l=>{if(l.type==1){l.optionId="",l.text="",l.showInput=!1;const d=l.orthOptionsList.filter(c=>c.choosen===!0);d.length>0&&(l.optionId=d[0].id)}else if(l.type==2){l.optionId=[],l.optionId1=[],l.text="",l.showInput=!1;const d=l.orthOptionsList.filter(c=>c.choosen===!0);d.length>0&&(l.optionId=d.map(c=>c.id),l.optionId1=l.optionId)}})})}ae();const fe=I([]);async function ne(){const $=await Le(`/prod-api/business/orthClass/list/2/方法/${y}`);fe.value=$.data,f.value=$.data[0].classFlag,$.data.forEach(V=>V.orthTitleList.forEach(l=>l.showInput=!1)),$.data.forEach(V=>{V.orthTitleList.forEach(l=>{if(l.titleName=="矫治器"){l.optionId=[],l.optionId1=[],l.orthOptionsList.forEach(c=>{var le,Ie;c.optionName==="无托槽隐形矫治"?(c.fillColor="#C9CDD4",c.brand=$.data[0].orthTitleList.find(be=>be.titlePrompt=="无托槽"),c.hoverColor="#2e6ce4",c.clicked=!!c.choosen,c.otherContent=(le=c.brand.orthOptionsList.find(be=>be.choosen===!0))==null?void 0:le.id):c.optionName==="硅胶矫治器"&&(c.fillColor="#C9CDD4",c.brand=$.data[0].orthTitleList.find(be=>be.titlePrompt=="硅胶"),c.otherContent=(Ie=c.brand.orthOptionsList.find(be=>be.choosen===!0))==null?void 0:Ie.id,c.hoverColor="#2e6ce4",c.clicked=!!c.choosen)});const d=l.orthOptionsList.filter(c=>c.choosen===!0);d.length>0&&(l.optionId=d.map(c=>c.id),l.optionId1=l.optionId),l.otherContent=""}else if(l.type==1){l.optionId="",l.text="",l.showInput=!1;const d=l.orthOptionsList.filter(c=>c.choosen===!0);d.length>0&&(l.optionId=d[0].id)}else if(l.type==2){l.optionId=[],l.optionId1=[],l.text="",l.showInput=!1;const d=l.orthOptionsList.filter(c=>c.choosen===!0);d.length>0&&(l.optionId=d.map(c=>c.id),l.optionId1=l.optionId)}})})}ne();const Z=I([]);async function Ne(){const $=await Le(`/prod-api/business/orthClass/list/2/周期/${y}`);Z.value=$.data}const Oe=I([]);async function z(){const $=await Le(`/prod-api/business/orthClass/list/2/备注/${y}`);Oe.value=$.data}Ne(),z();const ke=$=>{if($.cephalometricsContent){const V={apmtId:y,titleId:$.id,optionsIdStr:[],otherContent:"",cephalometricsContent:$.cephalometricsContent,fdiToothCode:"",showPosition:""};me("/prod-api/business/optionsResult",V)}},he=I([]);async function ee(){const $=await Le(`/prod-api/business/orthClass/list/2/风险/${y}`);he.value=$.data,he.value.forEach(V=>{V.orthTitleList.forEach(l=>{l.orthOptionsList.forEach(d=>{d.optionSuffix&&qo(d)})})}),he.value.forEach(V=>V.orthTitleList.forEach(l=>l.showInput=!1)),he.value.forEach(V=>{V.orthTitleList.forEach(l=>{if(l.type==1)l.optionId="",l.text="";else if(l.type==2){l.optionId=[],l.optionId1=[],l.text="",l.showInput=!1;const d=l.orthOptionsList.filter(c=>c.choosen===!0);d.length>0&&(l.optionId=d.map(c=>c.id),l.optionId1=l.optionId)}l.titleName=="矫治风险"&&l.orthOptionsList.forEach(d=>{(d.optionName==="牙根吸收"||d.optionName==="乳牙早失")&&(d.fillColor="#C9CDD4",d.seriousColor="#f44c4c",d.hoverColor="#2e6ce4",d.clicked=!!d.choosen)})})})}ee();const ue=($,V)=>{V.otherContent||(V.clicked=!1)},x=($,V)=>{$.visible=!1,pe.value.forEach(d=>d.forEach(c=>c.active=!1));let l;if(!$.submitAble){if($.id===237&&!$.toothCode.join()){V.optionId.splice(V.optionId.findIndex(c=>c==237),1);const d=V.orthOptionsList.find(c=>c.id===236);l={apmtId:y,titleId:V.id,optionsIdStr:V.optionId,otherContent:"",cephalometricsContent:"",fdiToothCode:d.toothCode.join(),showPosition:JSON.stringify(d.position),fdiToothCode1:$.toothCode.join(),showPosition1:JSON.stringify($.position)}}else if($.id===236&&!$.toothCode.join()){V.optionId.splice(V.optionId.findIndex(c=>c==236),1);const d=V.orthOptionsList.find(c=>c.id===237);l={apmtId:y,titleId:V.id,optionsIdStr:V.optionId,otherContent:"",cephalometricsContent:"",fdiToothCode:d.toothCode.join(),showPosition:JSON.stringify(d.position),fdiToothCode1:$.toothCode.join(),showPosition1:JSON.stringify($.position)}}}if($.id===237){const d=V.orthOptionsList.find(c=>c.id===236);d.toothCode&&(l={apmtId:y,titleId:V.id,optionsIdStr:V.optionId,otherContent:"",cephalometricsContent:"",fdiToothCode:d.toothCode.join(),showPosition:JSON.stringify(d.position),fdiToothCode1:$.toothCode.join(),showPosition1:JSON.stringify($.position)})}else{const d=V.orthOptionsList.find(c=>c.id===237);d.toothCode?l={apmtId:y,titleId:V.id,optionsIdStr:V.optionId,otherContent:"",cephalometricsContent:"",fdiToothCode1:d.toothCode.join(),showPosition1:JSON.stringify(d.position),fdiToothCode:$.toothCode.join(),showPosition:JSON.stringify($.position)}:(V.optionId.splice(V.optionId.findIndex(c=>c==236),1),l={apmtId:y,titleId:V.id,optionsIdStr:V.optionId,otherContent:"",cephalometricsContent:"",fdiToothCode:d.toothCode.join(),showPosition:JSON.stringify(d.position),fdiToothCode1:$.toothCode.join(),showPosition1:JSON.stringify($.position)})}me("/prod-api/business/optionsResult",l).then(()=>{$.submitAble=!1,ee()})},oe=($,V)=>{Rt($,V)},te=I(!1);async function ye($,V,l,d,c){var Ie;if(c=="目标"&&(console.log(c),g.value=!0),c=="方法"&&(f.value=!0),U.pdfId&&sessionStorage.removeItem(U.pdfId),V.titleName=="矫治风险")te.value=!0,V.orthOptionsList.forEach(be=>{$.includes(be.id)?be.clicked=!0:be.clicked=!1});else if(V.titleName=="矫治器"){const be=V.optionId.filter(L=>!V.optionId1.includes(L)),ge=(Ie=V.orthOptionsList.find(L=>L.id===be[0]))==null?void 0:Ie.optionName;be&&ge&&(ge=="无托槽隐形矫治"||ge=="硅胶矫治器")&&V.orthOptionsList.forEach(L=>{be.includes(L.id)?(L.clicked=!0,L.visible=!0):L.clicked=!1})}else if(V.titleName=="品牌"){l.visible=!1,xe(l.otherContent,V,"",y),xe(d.optionId,d,"",y);return}vo($,V,y);const le=await xe(V.optionId,V,"",y);te.value&&le.code==200&&ee(),le.code==200&V.titleName=="矫治器"&&ne()}const pe=I([]);pe.value=Zo();const Xe=$=>{pe.value.forEach(V=>{V.forEach(l=>{var d;l.active=!1,(d=$.toothCode)!=null&&d.includes(l.value+"")&&(l.active=!0)})})};return($,V)=>{const l=mo,d=no,c=xo,le=No,Ie=Go,be=Xo;return o(),n("div",si,[j(Se,{text:"方案",backgroundColor:"#f4f7fd"}),r("div",ai,[(o(!0),n(T,null,S(u.value,ge=>(o(),n(T,{key:ge.id},[(o(!0),n(T,null,S(ge.orthTitleList,(L,m)=>(o(),C(_e,{label:L.titleName,key:L.id},{default:h(()=>[m==0?(o(),n(T,{key:0},[L.type==1?(o(),C(d,{key:0,modelValue:L.optionId,"onUpdate:modelValue":Q=>L.optionId=Q,onChange:Q=>ye(L.optionId,L)},{default:h(()=>[(o(!0),n(T,null,S(L.orthOptionsList,Q=>(o(),C(l,{class:Y({serious:Q.serious=="1",checked:Q.choosen===!0}),key:Q.id,label:Q.id},{default:h(()=>[J(E(Q.optionName),1)]),_:2},1032,["class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):R("",!0),L.type==2?(o(),C(le,{key:1,modelValue:L.optionId,"onUpdate:modelValue":Q=>L.optionId=Q,onChange:Q=>ye(L.optionId,L)},{default:h(()=>[(o(!0),n(T,null,S(L.orthOptionsList,Q=>(o(),C(c,{class:Y({serious:Q.serious=="1",checked:Q.choosen===!0}),key:Q.id,label:Q.id},{default:h(()=>[J(E(Q.optionName)+" ",1),Q.serious=="0"?(o(),n("img",ni)):(o(),n("img",li))]),_:2},1032,["class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):R("",!0)],64)):(o(),C(Ro,{key:1,title:L,appId:Be(y)},null,8,["title","appId"]))]),_:2},1032,["label"]))),128))],64))),128))]),j(Se,{text:"目标",backgroundColor:"#f4f7fd"}),r("div",ii,[(o(!0),n(T,null,S(de.value,ge=>(o(),n(T,{key:ge.id},[(o(!0),n(T,null,S(ge.orthTitleList,L=>(o(),C(_e,{key:L.id,label:L.titleName,width:"72px"},{default:h(()=>[L.type==1?(o(),C(d,{key:0,modelValue:L.optionId,"onUpdate:modelValue":m=>L.optionId=m,onChange:m=>ye(L.optionId,L,ge.className,"","目标")},{default:h(()=>[(o(!0),n(T,null,S(L.orthOptionsList,m=>(o(),C(l,{class:Y({serious:m.serious=="1",checked:m.choosen===!0}),key:m.id,label:m.id},{default:h(()=>[J(E(m.optionName),1)]),_:2},1032,["class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):R("",!0),L.type==2?(o(),C(le,{key:1,modelValue:L.optionId,"onUpdate:modelValue":m=>L.optionId=m,onChange:m=>ye(L.optionId,L,ge.className,"","目标")},{default:h(()=>[(o(!0),n(T,null,S(L.orthOptionsList,m=>(o(),C(c,{class:Y({serious:m.serious=="1",checked:m.choosen===!0}),key:m.id,label:m.id},{default:h(()=>[J(E(m.optionName)+" ",1),m.serious=="0"?(o(),n("img",di)):(o(),n("img",ri))]),_:2},1032,["class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):R("",!0)]),_:2},1032,["label"]))),128))],64))),128))]),j(Se,{text:"方法",backgroundColor:"#f4f7fd"}),r("div",ui,[(o(!0),n(T,null,S(fe.value,ge=>(o(),n(T,{key:ge.id},[(o(!0),n(T,null,S(ge.orthTitleList,L=>(o(),n(T,{key:L.id},[L.titleName!=="品牌"&&L.titleName!=="预计矫正周期"?(o(),C(_e,{key:0,label:L.titleName,width:"86px"},{default:h(()=>[L.type==1?(o(),C(d,{key:0,modelValue:L.optionId,"onUpdate:modelValue":m=>L.optionId=m,onChange:m=>ye(L.optionId,L,"","","方法")},{default:h(()=>[(o(!0),n(T,null,S(L.orthOptionsList,m=>(o(),n(T,{key:m.id},[m.optionSuffix?(o(),C(Ie,{key:1,"popper-class":"myPopper","popper-style":{width:"auto","min-width":"100px"},placement:"top-start",width:200,visible:m.visible,onAfterLeave:Q=>ue(L,m)},{reference:h(()=>[j(l,{class:Y({serious:m.serious=="1"}),label:m.id,onMouseenter:Q=>G(m),onMouseleave:Q=>W(m)},{default:h(()=>[J(E(m.optionName),1),(o(),n("svg",ci,[r("g",null,[r("path",{d:"M0,4.99999C0,2.23857,2.23857,0,4.99999,0C7.76141,0,9.99998,2.23857,9.99998,4.99999C9.99998,7.76141,7.76141,9.99998,4.99999,9.99998C2.23857,9.99998,0,7.76141,0,4.99999C0,4.99999,0,4.99999,0,4.99999ZM5.49999,3.49999C5.49999,3.49999,5.49999,2.49999,5.49999,2.49999C5.49999,2.49999,4.49999,2.49999,4.49999,2.49999C4.49999,2.49999,4.49999,3.49999,4.49999,3.49999C4.49999,3.49999,5.49999,3.49999,5.49999,3.49999C5.49999,3.49999,5.49999,3.49999,5.49999,3.49999ZM4.49999,3.99999C4.49999,3.99999,4.49999,7.49998,4.49999,7.49998C4.49999,7.49998,5.49999,7.49998,5.49999,7.49998C5.49999,7.49998,5.49999,3.99999,5.49999,3.99999C5.49999,3.99999,4.49999,3.99999,4.49999,3.99999C4.49999,3.99999,4.49999,3.99999,4.49999,3.99999Z","fill-rule":"evenodd",fill:m.clicked||m.hover?m.hoverColor:m.fillColor,"fill-opacity":"1"},null,8,hi)])]))]),_:2},1032,["class","label","onMouseenter","onMouseleave"])]),default:h(()=>[j(_e,{label:m.brand.titleName},{default:h(()=>[j(d,{modelValue:m.otherContent,"onUpdate:modelValue":Q=>m.otherContent=Q,onChange:Q=>ye(m.otherContent,m.brand,m,L,"方法")},{default:h(()=>[(o(!0),n(T,null,S(m.brand.orthOptionsList,Q=>(o(),C(l,{key:Q.id,class:Y({serious:Q.serious=="1"}),label:Q.id},{default:h(()=>[J(E(Q.optionName),1)]),_:2},1032,["class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1032,["label"])]),_:2},1032,["visible","onAfterLeave"])):(o(),C(l,{key:0,class:Y({serious:m.serious=="1"}),label:m.id},{default:h(()=>[J(E(m.optionName),1)]),_:2},1032,["class","label"]))],64))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):R("",!0),L.type==2?(o(),C(le,{key:1,modelValue:L.optionId,"onUpdate:modelValue":m=>L.optionId=m,onChange:m=>ye(L.optionId,L,"","","方法")},{default:h(()=>[(o(!0),n(T,null,S(L.orthOptionsList,m=>(o(),C(c,{key:m.id,class:Y({serious:m.serious=="1",checked:m.choosen===!0}),label:m.id},{default:h(()=>[J(E(m.optionName),1),m.serious=="0"?(o(),n("img",pi)):(o(),n("img",fi))]),_:2},1032,["class","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):R("",!0)]),_:2},1032,["label"])):R("",!0),L.titleName=="预计矫正周期"?(o(),C(_e,{key:1,label:L.titleName,width:"100px"},{default:h(()=>[j(be,{style:{width:"100px"},modelValue:L.cephalometricsContent,"onUpdate:modelValue":m=>L.cephalometricsContent=m,onBlur:m=>ke(L)},null,8,["modelValue","onUpdate:modelValue","onBlur"]),mi]),_:2},1032,["label"])):R("",!0)],64))),128))],64))),128))]),j(Se,{text:"周期",backgroundColor:"#f4f7fd"}),r("div",vi,[(o(!0),n(T,null,S(Z.value,ge=>(o(),n(T,{key:ge.id},[(o(!0),n(T,null,S(ge.orthTitleList,L=>(o(),C(_e,{key:L.id,label:L.titleName},{default:h(()=>[j(be,{style:{width:"100px"},modelValue:L.cephalometricsContent,"onUpdate:modelValue":m=>L.cephalometricsContent=m,onBlur:m=>ke(L)},null,8,["modelValue","onUpdate:modelValue","onBlur"]),_i]),_:2},1032,["label"]))),128))],64))),128))]),j(Se,{text:"风险",backgroundColor:"#f4f7fd"}),r("div",gi,[(o(!0),n(T,null,S(he.value,ge=>(o(),n(T,{key:ge.id},[(o(!0),n(T,null,S(ge.orthTitleList,L=>(o(),n(T,{key:L.id},[L.titleName!=="备注"?(o(),C(_e,{key:0,label:L.titleName},{default:h(()=>[j(le,{modelValue:L.optionId,"onUpdate:modelValue":m=>L.optionId=m,onChange:m=>ye(L.optionId,L)},{default:h(()=>[(o(!0),n(T,null,S(L.orthOptionsList,m=>(o(),n(T,{key:m.id},[m.optionSuffix?(o(),n(T,{key:1},[m.fdiToothCode==null?(o(),C(Ie,{key:0,placement:"right",width:490,trigger:"click",onShow:Q=>Xe(m),onAfterLeave:Q=>x(m,L)},{reference:h(()=>[j(c,{onClick:Q=>m.visible=!0,class:Y({serious:m.serious=="1",checked:m.choosen===!0}),label:m.id,onMouseenter:Q=>m.hover=!0,onMouseleave:Q=>m.hover=!1},{default:h(()=>[J(E(m.optionName),1),m.optionSuffix?(o(),n("svg",bi,[r("g",null,[r("path",{d:"M0,4.99999C0,2.23857,2.23857,0,4.99999,0C7.76141,0,9.99998,2.23857,9.99998,4.99999C9.99998,7.76141,7.76141,9.99998,4.99999,9.99998C2.23857,9.99998,0,7.76141,0,4.99999C0,4.99999,0,4.99999,0,4.99999ZM5.49999,3.49999C5.49999,3.49999,5.49999,2.49999,5.49999,2.49999C5.49999,2.49999,4.49999,2.49999,4.49999,2.49999C4.49999,2.49999,4.49999,3.49999,4.49999,3.49999C4.49999,3.49999,5.49999,3.49999,5.49999,3.49999C5.49999,3.49999,5.49999,3.49999,5.49999,3.49999ZM4.49999,3.99999C4.49999,3.99999,4.49999,7.49998,4.49999,7.49998C4.49999,7.49998,5.49999,7.49998,5.49999,7.49998C5.49999,7.49998,5.49999,3.99999,5.49999,3.99999C5.49999,3.99999,4.49999,3.99999,4.49999,3.99999C4.49999,3.99999,4.49999,3.99999,4.49999,3.99999Z","fill-rule":"evenodd",fill:m.clicked?m.seriousColor:m.hover?m.hoverColor:m.fillColor,"fill-opacity":"1"},null,8,Ci)])])):R("",!0),m.serious=="0"?(o(),n("img",ki)):(o(),n("img",wi))]),_:2},1032,["onClick","class","label","onMouseenter","onMouseleave"])]),default:h(()=>[r("div",Li,[r("div",xi,[(o(!0),n(T,null,S(pe.value,(Q,we)=>(o(),n("div",{key:we,class:Y(["symptomBox",{itemAlignRight:we===2||we===4||we===0||we===6,marginTop:we==4||we==5,marginBottom:we==2||we==3,marginRight:we===2||we===4||we===0||we===6,marginLeft:we===1||we===3||we===5||we===7}])},[(o(!0),n(T,null,S(Q,(ce,$e)=>(o(),n("div",{class:Y(["symptomItem",{selected:ce.active===!0}]),id:ce.value,key:$e,onClick:je=>oe(ce,m)},E(ce.label),11,Ni))),128))],2))),128))]),Ti,$i])]),_:2},1032,["onShow","onAfterLeave"])):(o(),C(Ie,{key:1,"popper-class":"myPopper","popper-style":{width:"auto","min-width":"100px"},placement:"top-start",width:200,visible:m.visible},{reference:h(()=>[j(c,{onMouseenter:Q=>q(m),class:Y({serious:m.serious=="1",checked:m.choosen===!0}),label:m.id,onMouseleave:Q=>A(Q,m)},{default:h(()=>[J(E(m.optionName),1),m.optionSuffix?(o(),n("svg",Vi,[r("g",null,[r("path",{d:"M0,4.99999C0,2.23857,2.23857,0,4.99999,0C7.76141,0,9.99998,2.23857,9.99998,4.99999C9.99998,7.76141,7.76141,9.99998,4.99999,9.99998C2.23857,9.99998,0,7.76141,0,4.99999C0,4.99999,0,4.99999,0,4.99999ZM5.49999,3.49999C5.49999,3.49999,5.49999,2.49999,5.49999,2.49999C5.49999,2.49999,4.49999,2.49999,4.49999,2.49999C4.49999,2.49999,4.49999,3.49999,4.49999,3.49999C4.49999,3.49999,5.49999,3.49999,5.49999,3.49999C5.49999,3.49999,5.49999,3.49999,5.49999,3.49999ZM4.49999,3.99999C4.49999,3.99999,4.49999,7.49998,4.49999,7.49998C4.49999,7.49998,5.49999,7.49998,5.49999,7.49998C5.49999,7.49998,5.49999,3.99999,5.49999,3.99999C5.49999,3.99999,4.49999,3.99999,4.49999,3.99999C4.49999,3.99999,4.49999,3.99999,4.49999,3.99999Z","fill-rule":"evenodd",fill:m.clicked?m.seriousColor:m.hover?m.hoverColor:m.fillColor,"fill-opacity":"1"},null,8,Ui)])])):R("",!0),m.serious=="0"?(o(),n("img",Si)):(o(),n("img",Oi))]),_:2},1032,["onMouseenter","class","label","onMouseleave"])]),default:h(()=>[j(Ro,{step:5,title:m,appId:Be(y),onSubmitTooth:Q=>x(Q,L)},null,8,["title","appId","onSubmitTooth"])]),_:2},1032,["visible"]))],64)):(o(),C(c,{key:0,class:Y({serious:m.serious=="1",checked:m.choosen===!0}),label:m.id},{default:h(()=>[J(E(m.optionName)+" ",1),m.serious=="0"?(o(),n("img",yi)):(o(),n("img",Ii))]),_:2},1032,["class","label"]))],64))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1032,["label"])):L.titleName=="备注"?(o(),C(_e,{key:1,label:L.titleName,width:"72px"},{default:h(()=>[j(be,{style:{width:"100px"},modelValue:L.cephalometricsContent,"onUpdate:modelValue":m=>L.cephalometricsContent=m,onBlur:m=>ke(L)},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),_:2},1032,["label"])):R("",!0)],64))),128))],64))),128))]),j(Se,{text:"备注",backgroundColor:"#f4f7fd"}),r("div",Ei,[(o(!0),n(T,null,S(Oe.value,ge=>(o(),n(T,{key:ge.id},[(o(!0),n(T,null,S(ge.orthTitleList,L=>(o(),C(_e,{key:L.id,label:L.titleName},{default:h(()=>[j(be,{style:{width:"400px"},modelValue:L.cephalometricsContent,"onUpdate:modelValue":m=>L.cephalometricsContent=m,onBlur:m=>ke(L)},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),_:2},1032,["label"]))),128))],64))),128))])])}}},Mi=Ge(Pi,[["__scopeId","data-v-09beca11"]]);const Ai=k=>(io("data-v-bac99614"),k=k(),ro(),k),Di={style:{background:"#f2f3f5"}},Fi=Ai(()=>r("div",{class:"gap"},null,-1)),Bi={class:"header"},Ri={style:{display:"flex","justify-content":"center",flex:1}},ji=["onClick"],Wi={key:0,class:"step-num"},qi={key:1,style:{"margin-right":"12px"},src:sa},Gi={class:"ortho-page"},Zi={class:"information"},Ji={class:"footer"},Xi={class:"desc"},Yi={class:"desc uploadDesc"},zi=["href"],Hi={key:0,style:{"margin-left":"20px"}},Qi={class:"dialog-footer"},Ki={__name:"index",setup(k){const p=I();window.addEventListener("message",function(c){c.origin==="https://odostest.orangedental.cn:4403"&&(p.value=c.data)});const g=Xs(),f=lo(),U=f.params.appId,G=f.params.patientId,X=[{num:1,desc:"基础信息"},{num:2,desc:"图像分析"},{num:3,desc:"模型分析"},{num:4,desc:"问题列表"},{num:5,desc:"方案目标"},{num:6,desc:"报告预览"}],W=I(0),q=[],re=I(null),A=I(null),D=I(null),y=I(null),u=I(null),M=I(null),de=c=>{if(c>W.value){Fe({message:"请点击下一步哦",type:"warning"});return}else z.value=c};Xt(()=>{q.push(re,A,D,y,u),document.querySelector(".ortho-page").addEventListener("mousewheel",function(le){le.deltaX!==0&&le.preventDefault()})});const ae=I(),fe=I(0),ne=I(),Z=I(),Ne=()=>{if(z.value==5&&!q[z.value-1].value.goalClicked&&!q[z.value-1].value.methodClicked)Fe({message:"请检查目标和方法是否填写完毕哦",type:"error"});else if(z.value==5&&!q[z.value-1].value.goalClicked){Fe({message:"请检查目标是否填写完毕哦",type:"error"});return}else if(z.value==5&&!q[z.value-1].value.methodClicked){Fe({message:"请检查方法是否填写完毕哦",type:"error"});return}else ao(()=>{W.value=z.value,z.value++,so("/prod-api/business/orthBase",{id:ke.value.id,pdfUrl:"",pdfTime:"",progress:z.value}),window.scrollTo(0,0)})},Oe=c=>{var le;c&&((le=ae.value)==null||le.close(),so("/prod-api/business/orthBase",{id:ke.value.id,pdfUrl:c,pdfTime:Hs(),progress:z.value}),ne.value=c)},z=I(0),ke=I(),he=I();function ee(){Le(`/prod-api/business/orthBase/${U}`).then(c=>{var le,Ie;c.code===200?(ke.value=c.data,z.value=(le=c.data)!=null&&le.progress?c.data.progress:1,W.value=z.value,fe.value=(Ie=ke.value)==null?void 0:Ie.id,he.value=c.data.dentitionType,ke.value&&ke.value.pdfUrl&&(sessionStorage.setItem(`pdfUrl${fe.value}`,ke.value.pdfUrl),Z.value=`pdfUrl${fe.value}`,ne.value=sessionStorage.getItem(`pdfUrl${fe.value}`),z.value=6)):z.value=2})}ee();const ue=()=>{if(z.value==4&&!q[z.value-1].value.clicked){Fe({message:"还未填写诊断哦",type:"error"});return}ao(()=>{W.value=z.value,z.value++,so("/prod-api/business/orthBase",{id:ke.value.id,pdfUrl:"",pdfTime:"",progress:z.value}),window.scrollTo(0,0)})},x=()=>{z.value!=1&&ao(()=>{W.value=z.value,z.value--,so("/prod-api/business/orthBase",{id:ke.value.id,pdfUrl:"",pdfTime:"",progress:z.value}),window.scrollTo(0,0)})},oe=()=>{g.push("/index")},te=()=>{fetch(ne.value).then(c=>c.blob()).then(c=>{const le=URL.createObjectURL(c),Ie=document.createElement("a");Ie.href=le,Ie.download="filename.pdf",Ie.click()})},ye=I(!1),pe=I({});async function Xe(){ye.value=!0;const c=await me("/prod-api/business/orthBase/selectOrthRisk",{patientId:G,apmtId:U});pe.value=c.data,pe.value.dentitionType=c.data.dentitionType||"无",pe.value.riskValueSystem="",pe.value.riskValue=pe.value.riskValue.split("")[0]}const $=I(!1);async function V(){try{const c=Bo.service({lock:!0,text:"发起审批中",background:"rgba(0, 0, 0, 0.7)"});pe.value.pdfUrl=ne.value,pe.value.riskValueSystem=pe.value.riskValueSystem?pe.value.riskValueSystem:"无";const le=await me("/prod-api/business/orthBase/sendApproval",{patientId:G,apmtId:U,...pe.value});ye.value=!1,c.close(),le.code===200&&Fe({type:"success",message:le.msg})}catch{}}const l=()=>{g.push("/list")},d=[{label:"患者姓名",value:"patientName"},{label:"病例号",value:"privateId"},{label:"诊所",value:"abbreviation"},{label:"牙列期",value:"dentitionType"},{label:"术前诊断",value:"diagnoseStr"},{label:"治疗目标",value:"targetStr"},{label:"治疗计划",value:"planStr"},{label:"矫正方案",value:"schemeStr"},{label:"病例风险（系统）",value:"riskValueSystem"},{label:"病历风险（自评）",value:"riskValue"},{label:"预计矫正周期",value:"correctionPeriod"},{label:"说明",value:"explain"}];return(c,le)=>{const Ie=Ys("ArrowLeft"),be=Ls,ge=ta,L=Wt,m=Es,Q=no,we=jt;return o(),n("div",Di,[Fi,r("div",Bi,[r("div",{style:{display:"flex","align-items":"center","margin-right":"40px",cursor:"pointer",width:"100px","margin-left":"20px"},onClick:oe},[j(be,null,{default:h(()=>[j(Ie)]),_:1}),J("返回列表 ")]),r("div",Ri,[(o(),n(T,null,S(X,ce=>r("div",{class:Y(["step",{active:z.value===ce.num}]),onClick:$e=>de(ce.num),key:ce.num},[W.value<ce.num||z.value===ce.num?(o(),n("span",Wi,E(ce.num),1)):W.value>=ce.num?(o(),n("img",qi)):R("",!0),r("span",{class:Y(["step-text",{finished:z.value===ce.num||ce.num<=W.value}])},E(ce.desc),3),j(ge,{class:Y({finished:z.value===ce.num||ce.num<=W.value})},null,8,["class"])],10,ji)),64))])]),r("div",Gi,[r("div",Zi,[z.value===1?(o(),C(Oa,{key:0,pdfId:Z.value,ref_key:"step1",ref:re},null,8,["pdfId"])):R("",!0),z.value===2?(o(),C(kl,{key:1,pdfId:Z.value,ref_key:"step2",ref:A},null,8,["pdfId"])):R("",!0),z.value===3?(o(),C(Fl,{key:2,pdfId:Z.value,ref_key:"step3",ref:D,dentitionType:he.value},null,8,["pdfId","dentitionType"])):R("",!0),z.value===4?(o(),C(ti,{key:3,pdfId:Z.value,ref_key:"step4",ref:y},null,8,["pdfId"])):R("",!0),z.value===5?(o(),C(Mi,{key:4,id:fe.value,pdfId:Z.value,ref_key:"step5",ref:u},null,8,["id","pdfId"])):R("",!0),z.value===6?(o(),C(zs,{key:5,onGetPdfResult:Oe,id:fe.value,ref_key:"pdfComp",ref:M},null,8,["id"])):R("",!0)]),r("div",Ji,[z.value>=2&&z.value<=5?(o(),C(L,{key:0,onClick:x},{default:h(()=>[J("上一步")]),_:1})):R("",!0),z.value==6?(o(),C(L,{key:1,onClick:te},{default:h(()=>[J(" 下载报告 ")]),_:1})):R("",!0),z.value<5?(o(),C(L,{key:2,type:"primary",onClick:ue},{default:h(()=>[J("下一步")]),_:1})):R("",!0),z.value==5?(o(),C(L,{key:3,type:"primary",onClick:Ne},{default:h(()=>[J("生成报告")]),_:1})):R("",!0),z.value==5&&$.value==!0?(o(),C(L,{key:4,type:"primary",onClick:c.checkApproval},{default:h(()=>[J("查看审批流")]),_:1},8,["onClick"])):R("",!0),z.value==6?(o(),C(L,{key:5,type:"primary",onClick:Xe},{default:h(()=>[J("发起审批")]),_:1})):R("",!0),z.value==6&&$.value==!0?(o(),C(L,{key:6,type:"primary",onClick:l},{default:h(()=>[J("返回列表")]),_:1})):R("",!0)])]),j(we,{modelValue:ye.value,"onUpdate:modelValue":le[3]||(le[3]=ce=>ye.value=ce),"close-on-press-escape":!1,title:"确认审批",class:"confirmApproval"},{footer:h(()=>[r("span",Qi,[j(L,{onClick:le[2]||(le[2]=ce=>ye.value=!1)},{default:h(()=>[J("取消")]),_:1}),j(L,{type:"primary",onClick:V},{default:h(()=>[J(" 确认 ")]),_:1})])]),default:h(()=>[(o(),n(T,null,S(d,(ce,$e)=>(o(),n(T,{key:ce.label},[$e<=6?(o(),C(_e,{key:0,label:ce.label,width:"128px"},{default:h(()=>[r("span",Xi,E(pe.value[ce.value]),1)]),_:2},1032,["label"])):R("",!0),$e==7?(o(),C(_e,{key:1,label:ce.label,width:"128px"},{default:h(()=>[r("span",Yi,[r("a",{href:ne.value,target:"_blank"},E(ne.value.split("/")[ne.value.split("/").length-1]),9,zi)])]),_:2},1032,["label"])):$e==8?(o(),C(_e,{key:2,label:ce.label,width:"128px"},{default:h(()=>[j(Q,{modelValue:pe.value.riskValue,"onUpdate:modelValue":le[0]||(le[0]=je=>pe.value.riskValue=je),disabled:""},{default:h(()=>[(o(),n(T,null,S(["低","中","高"],(je,uo)=>j(m,{key:uo,label:je},null,8,["label"])),64))]),_:2},1032,["modelValue"]),pe.value.ruleText?(o(),n("span",Hi,"风险规则说明："+E(pe.value.ruleText),1)):R("",!0)]),_:2},1032,["label"])):$e==9?(o(),C(_e,{key:3,label:ce.label,width:"128px"},{default:h(()=>[j(Q,{modelValue:pe.value.riskValueSystem,"onUpdate:modelValue":le[1]||(le[1]=je=>pe.value.riskValueSystem=je)},{default:h(()=>[(o(),n(T,null,S(["低","中","高"],(je,uo)=>j(m,{key:uo,label:je},null,8,["label"])),64))]),_:2},1032,["modelValue"])]),_:2},1032,["label"])):$e==10?(o(),C(_e,{key:4,label:ce.label,width:"128px"},{default:h(()=>[J(E(pe.value.correctionPeriod?pe.value.correctionPeriod+"个月":""),1)]),_:2},1032,["label"])):$e==11?(o(),C(_e,{key:5,label:ce.label,width:"128px"},{default:h(()=>[J(E(pe.value.explain),1)]),_:2},1032,["label"])):R("",!0)],64))),64))]),_:1},8,["modelValue"])])}}},pd=Ge(Ki,[["__scopeId","data-v-bac99614"]]);export{pd as default};
